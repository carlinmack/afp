<div id="Metric">
<div class="head">
<h1>Theory Metric</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Metric and semimetric spaces
    Author:      Tim Makarios &lt;tjm1983 at gmail.com&gt;, 2012
    Maintainer:  Tim Makarios &lt;tjm1983 at gmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Metric and semimetric spaces"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Metric
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Analysis/Multivariate_Analysis.html">HOL-Analysis.Multivariate_Analysis</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> semimetric <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">dist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonneg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">x</span> <span class="free">y</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> eq_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> symm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="free">dist</span> <span class="free">y</span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> refl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">x</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> metric <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">dist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> triangle<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">x</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">dist</span> <span class="free">y</span> <span class="free">x</span> <span class="main">+</span> <span class="free">dist</span> <span class="free">y</span> <span class="free">z</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> metric <span class="main">&lt;</span> semimetric
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="skolem">w</span> <span class="skolem">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> this
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">dist</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> triangle <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">dist</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">dist</span> <span class="skolem">y</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">z</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="skolem">w</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="free">dist</span> <span class="skolem">z</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> triangle <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="skolem">w</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="free">dist</span> <span class="skolem">z</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="free">dist</span> <span class="skolem">y</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="skolem">y</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">dist</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">dist</span> <span class="skolem">y</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">norm_dist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_normed_vector<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">norm_dist</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> norm <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> norm_metric<span class="main">:</span> metric <span class="quoted">norm_dist</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm_dist <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
  <span class="keyword1"><span class="command">from</span></span> norm_triangle_ineq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">-</span> <span class="skolem">z</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">≤</span> norm <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> norm <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> norm_minus_commute <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span>
    <span class="quoted"><span class="quoted">"norm_dist <span class="skolem">x</span> <span class="skolem">z</span> <span class="main">≤</span> norm_dist <span class="skolem">y</span> <span class="skolem">x</span> <span class="main">+</span> norm_dist <span class="skolem">y</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Miscellany">
<div class="head">
<h1>Theory Miscellany</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Miscellaneous results
    Author:      Tim Makarios &lt;tjm1983 at gmail.com&gt;, 2012
    Maintainer:  Tim Makarios &lt;tjm1983 at gmail.com&gt;
*)</span>

<span class="comment1">(*Some of these theorems were moved to the Isabelle repository *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Miscellaneous results"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Miscellany
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Metric.html">Metric</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unordered_pair_element_equality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> doubleton_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> unordered_pair_equality<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">q</span><span class="main">,</span> <span class="free">p</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> cosine_rule<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">^</span> <span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>finite<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm_dist <span class="free">a</span> <span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span>
  <span class="main">(</span>norm_dist <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>norm_dist <span class="free">b</span> <span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">-</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> dot_norm <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">c</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="main">(</span>norm <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> scalar_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="keyword1">*s</span> <span class="free">x</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">vector</span>

<span class="keyword1"><span class="command">lemma</span></span> norm_dist_dot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm_dist <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_norm_eq_inner<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dep2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_vector <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dep2</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">w</span> <span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="bound">r</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="bound">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real2_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">u</span> <span class="free">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="free">v</span><span class="main">$</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">v</span><span class="main">$</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span><span class="main"><span class="main">]</span></span> forall_2 assms<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rotate2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">2</span> <span class="main">⇒</span> real<span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rotate2</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> vector <span class="main">[</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">$</span><span class="numeral">2</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">$</span><span class="main">1</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> vector_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> rotate2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>rotate2 <span class="free">x</span><span class="main">)</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span><span class="main">$</span><span class="numeral">2</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>rotate2 <span class="free">x</span><span class="main">)</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">x</span><span class="main">$</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rotate2_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rotate2_rotate2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rotate2 <span class="main">(</span>rotate2 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rotate2 <span class="main">(</span>rotate2 <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span><span class="main">$</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rotate2 <span class="main">(</span>rotate2 <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span><span class="main">$</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> real2_eq <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rotate2 <span class="main">(</span>rotate2 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rotate2_dot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rotate2 <span class="free">u</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span>rotate2 <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∙</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inner_vec_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rotate2_scaleR <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rotate2 <span class="main">(</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>rotate2 <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rotate2 <span class="main">(</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>rotate2 <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">$</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>rotate2 <span class="main">(</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>rotate2 <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">$</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> real2_eq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rotate2_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rotate2 <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span>rotate2 <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> scaleR_minus_left <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>rotate2 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span>rotate2 <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> rotate2_scaleR <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rotate2_eq <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rotate2 <span class="free">x</span> <span class="main">=</span> rotate2 <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"rotate2 <span class="free">x</span> <span class="main">=</span> rotate2 <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rotate2 <span class="free">x</span> <span class="main">=</span> rotate2 <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rotate2 <span class="main">(</span>rotate2 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> rotate2 <span class="main">(</span>rotate2 <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dot2_rearrange_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">u</span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">$</span><span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span><span class="main">$</span><span class="numeral">2</span> <span class="main">/</span> <span class="free">x</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>rotate2 <span class="free">x</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="var">?u'</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">$</span><span class="main">1</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">u</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inner_vec_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">$</span><span class="main">1</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="main">1</span> <span class="main">/</span> <span class="free">x</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="main">-</span><span class="free">u</span><span class="main">$</span><span class="numeral">2</span> <span class="main">/</span> <span class="free">x</span><span class="main">$</span><span class="main">1</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">$</span><span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="var">?u'</span><span class="main">$</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">$</span><span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="var">?u'</span><span class="main">$</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="var">?u'</span><span class="main">$</span><span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> real2_eq <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="var">?u'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dot2_rearrange_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">u</span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">$</span><span class="numeral">2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">u</span><span class="main">$</span><span class="main">1</span> <span class="main">/</span> <span class="free">x</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>rotate2 <span class="free">x</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="var">?u'</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> dot2_rearrange_1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rotate2 <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"rotate2 <span class="free">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"rotate2 <span class="free">u</span> <span class="main">=</span> rotate2 <span class="var">?u'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="var">?u'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dot2_rearrange<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">u</span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="free">u</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>rotate2 <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> real2_eq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">$</span><span class="numeral">2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> dot2_rearrange_2 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">$</span><span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> dot2_rearrange_1 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real2_orthogonal_dep2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">u</span> <span class="free">v</span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dep2 <span class="free">u</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rotate2 <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> dot2_rearrange <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="free">u</span> <span class="main">=</span> <span class="bound">r</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?w</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">=</span> <span class="bound">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> dep2_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dot_left_diff_distrib<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">u</span> <span class="free">v</span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span> <span class="main">-</span> <span class="free">v</span><span class="main">)</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span> <span class="main">∙</span> <span class="free">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">v</span> <span class="main">∙</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span> <span class="main">∙</span> <span class="free">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">v</span> <span class="main">∙</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">u</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">v</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inner_vec_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> sum_subtractf <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">u</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">v</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">u</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span> <span class="main">-</span> <span class="free">v</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> left_diff_distrib <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted">real</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="free">u</span><span class="main">$</span><span class="bound">i</span> <span class="main">-</span> <span class="free">v</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span> <span class="main">-</span> <span class="free">v</span><span class="main">)</span> <span class="main">∙</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inner_vec_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dot_right_diff_distrib<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">u</span> <span class="free">v</span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∙</span> <span class="main">(</span><span class="free">u</span> <span class="main">-</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∙</span> <span class="free">u</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="main">∙</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> inner_commute <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∙</span> <span class="main">(</span><span class="free">u</span> <span class="main">-</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span> <span class="main">-</span> <span class="free">v</span><span class="main">)</span> <span class="main">∙</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> dot_left_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">-</span> <span class="free">v</span> <span class="main">∙</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> inner_commute <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∙</span> <span class="free">u</span> <span class="main">-</span> <span class="free">x</span> <span class="main">∙</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> am_gm2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> right_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> left_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">*</span> <span class="free">a</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="free">a</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="free">b</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">*</span> <span class="free">a</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="free">a</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="free">b</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> distrib_right <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> distrib_left <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">≤</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> real_sqrt_le_mono <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> real_sqrt_eq_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">≤</span> sqrt <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">+</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> real_sqrt_abs2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> real_sqrt_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">4</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span>
    <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> refl_on_allrel<span class="main">:</span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> refl_on_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> refl_on_restrict<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="free">r</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹refl_on <span class="free">A</span> <span class="free">r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> refl_on_allrel <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> refl_on_Int
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sym_allrel<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sym_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> sym_restrict<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span><span class="free">r</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">×</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹sym <span class="free">r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> sym_allrel <span class="keyword2"><span class="keyword">and</span></span> sym_Int
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> trans_allrel<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> trans_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> equiv_Int<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">B</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"equiv <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="free">r</span> <span class="main">∩</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> refl_on_Int <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> sym_Int <span class="keyword2"><span class="keyword">and</span></span> trans_Int
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> equiv_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equiv_allrel<span class="main">:</span> <span class="quoted"><span class="quoted">"equiv <span class="free">A</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> equiv_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> refl_on_allrel sym_allrel trans_allrel<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> equiv_restrict<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"equiv <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="free">r</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="free">A</span> <span class="free">r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> equiv_allrel <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> equiv_Int
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> invertible_times_eq_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*v</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms invertible_def matrix_left_invertible_ker <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> times_invertible_eq_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">v*</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> transpose_invertible assms invertible_times_eq_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> matrix_id_invertible<span class="main">:</span>
  <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>mat <span class="main">1</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>semiring_1<span class="main">)</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invertible_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Image_refl_on_nonempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">r</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹refl_on <span class="free">A</span> <span class="free">r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> refl_on_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quotient_element_nonempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> <span class="free">A</span><span class="main">//</span><span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms in_quotient_imp_non_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> zero_3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span><span class="main">::</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> card_suc_ge_insert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">x</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≥</span> card <span class="main">(</span>insert <span class="free">x</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> card_insert_le_m1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> card_le_UNIV<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>finite<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≤</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> partition_Image_element<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> <span class="free">A</span><span class="main">//</span><span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Image_singleton_iff assms equiv_class_eq_iff quotientE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> card_insert_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="free">x</span> <span class="free">A</span><span class="main">)</span> <span class="main">≥</span> card <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card.infinite card_insert_le zero_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> choose_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">S</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> card_eq_SucD <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> choose_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">S</span> <span class="main">=</span> <span class="numeral">2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> card_eq_SucD <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> insert <span class="skolem">x</span> <span class="skolem">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">T</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">T</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> choose_1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">=</span> insert <span class="skolem">x</span> <span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> choose_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">S</span> <span class="main">=</span> <span class="numeral">3</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> card_eq_SucD <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> insert <span class="skolem">x</span> <span class="skolem">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">T</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">T</span> <span class="main">=</span> <span class="numeral">2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> choose_2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">T</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">=</span> insert <span class="skolem">x</span> <span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_gt_0_diff_singleton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="free">S</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">S</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_ge_0_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="free">S</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_Diff_singleton<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eq_3_or_of_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">j</span> <span class="main">::</span> <span class="quoted"><span class="numeral">4</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">j'</span><span class="main">::</span><span class="numeral">3</span><span class="main">.</span> <span class="free">j</span> <span class="main">=</span> of_int <span class="main">(</span>Rep_bit1 <span class="bound">j'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j_int</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">j_int</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j_int</span> <span class="main">&lt;</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="numeral">4</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j_int</span> <span class="main">≤</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">j_int</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span><span class="numeral">4</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">j'</span><span class="main">::</span><span class="numeral">3</span><span class="main">.</span> of_int <span class="skolem">j_int</span> <span class="main">=</span> of_int <span class="main">(</span>Rep_bit1 <span class="bound">j'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j_int</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span>
      <span class="quoted"><span class="quoted">"of_int <span class="skolem">j_int</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span><span class="numeral">4</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">j'</span><span class="main">::</span><span class="numeral">3</span><span class="main">.</span> of_int <span class="skolem">j_int</span> <span class="main">=</span> of_int <span class="main">(</span>Rep_bit1 <span class="bound">j'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j_int</span> <span class="main">≠</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j_int</span> <span class="main">≤</span> <span class="numeral">3</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j_int</span> <span class="main">&lt;</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="skolem">j_int</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j_int</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Rep_bit1 <span class="main">(</span>Abs_bit1 <span class="skolem">j_int</span> <span class="main">::</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j_int</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bit1.Abs_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">j_int</span> <span class="main">=</span> of_int <span class="main">(</span>Rep_bit1 <span class="main">(</span>Abs_bit1 <span class="skolem">j_int</span> <span class="main">::</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span>
      <span class="quoted"><span class="quoted">"of_int <span class="skolem">j_int</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span><span class="numeral">4</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">j'</span><span class="main">::</span><span class="numeral">3</span><span class="main">.</span> of_int <span class="skolem">j_int</span> <span class="main">=</span> of_int <span class="main">(</span>Rep_bit1 <span class="bound">j'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sgn_plus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_idom"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">x</span> <span class="main">=</span> sgn <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> sgn <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms same_sgn_sgn_add<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sgn_div<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">x</span> <span class="main">=</span> sgn <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">/</span> <span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sgn_1_pos sgn_eq_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_plus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_idom"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">x</span> <span class="main">=</span> sgn <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">+</span> <span class="main">¦</span><span class="free">y</span><span class="main">¦</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms same_sgn_abs_add<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sgn_plus_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_idom"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="main">¦</span><span class="free">y</span><span class="main">¦</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> sgn <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Tarski">
<div class="head">
<h1>Theory Tarski</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Tarski's geometry
    Author:      Tim Makarios &lt;tjm1983 at gmail.com&gt;, 2012
    Maintainer:  Tim Makarios &lt;tjm1983 at gmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Tarski's geometry"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Tarski
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a> <a href="Miscellany.html">Miscellany</a> <a href="Metric.html">Metric</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"The axioms"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The axioms, and all theorems beginning with \emph{th}
  followed by a number, are based on corresponding axioms and
  theorems in \cite{schwabhauser}.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> tarski_first3 <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> bool"</span></span>     <span class="main">(</span><span class="quoted">"_ _ <span class="keyword1"><span class="keyword1">\&lt;congruent&gt;</span></span> _ _"</span> <span class="main">[</span>99<span class="main">,</span>99<span class="main">,</span>99<span class="main">,</span>99<span class="main">]</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="bound">b</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">p</span> <span class="bound">q</span> <span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="bound">p</span> <span class="bound">q</span> <span class="main">∧</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="bound">r</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="bound">p</span> <span class="bound">q</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="bound">r</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="bound">c</span> <span class="bound">c</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> tarski_first5 <span class="main">=</span> tarski_first3 <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span> <span class="bound">q</span> <span class="bound">a</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">a</span> <span class="bound">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="bound">b</span> <span class="bound">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> A5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">a'</span> <span class="bound">b'</span> <span class="bound">c'</span> <span class="bound">d'</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">∧</span> <span class="free">B</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">∧</span> <span class="free">B</span> <span class="bound">a'</span> <span class="bound">b'</span> <span class="bound">c'</span>
                                               <span class="main">∧</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="bound">a'</span> <span class="bound">b'</span> <span class="main">∧</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="bound">b'</span> <span class="bound">c'</span> <span class="main">∧</span> <span class="bound">a</span> <span class="bound">d</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="bound">a'</span> <span class="bound">d'</span> <span class="main">∧</span> <span class="bound">b</span> <span class="bound">d</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="bound">b'</span> <span class="bound">d'</span>
                                       <span class="main">⟶</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="bound">c'</span> <span class="bound">d'</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> tarski_absolute_space <span class="main">=</span> tarski_first5 <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">B</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">a</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> A7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="free">B</span> <span class="bound">a</span> <span class="bound">p</span> <span class="bound">c</span> <span class="main">∧</span> <span class="free">B</span> <span class="bound">b</span> <span class="bound">q</span> <span class="bound">c</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span> <span class="bound">p</span> <span class="bound">x</span> <span class="bound">b</span> <span class="main">∧</span> <span class="free">B</span> <span class="bound">q</span> <span class="bound">x</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> A11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="free">B</span> <span class="bound">a</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>
                        <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="free">B</span> <span class="bound">x</span> <span class="bound">b</span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> tarski_absolute <span class="main">=</span> tarski_absolute_space <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="main">¬</span> <span class="free">B</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">B</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">a</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">B</span> <span class="bound">c</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> A9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="bound">q</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="bound">q</span> <span class="main">∧</span> <span class="bound">a</span> <span class="bound">p</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="bound">a</span> <span class="bound">q</span> <span class="main">∧</span> <span class="bound">b</span> <span class="bound">p</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="bound">b</span> <span class="bound">q</span> <span class="main">∧</span> <span class="bound">c</span> <span class="bound">p</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="bound">c</span> <span class="bound">q</span>
                             <span class="main">⟶</span> <span class="free">B</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">∨</span> <span class="free">B</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">a</span> <span class="main">∨</span> <span class="free">B</span> <span class="bound">c</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> tarski_space <span class="main">=</span> tarski_absolute_space <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">t</span><span class="main">.</span> <span class="free">B</span> <span class="bound">a</span> <span class="bound">d</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">B</span> <span class="bound">b</span> <span class="bound">d</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">d</span> 
                                    <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">B</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">B</span> <span class="bound">a</span> <span class="bound">c</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">B</span> <span class="bound">x</span> <span class="bound">t</span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> tarski <span class="main">=</span> tarski_absolute <span class="main">+</span> tarski_space

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Semimetric spaces satisfy the first three axioms"</span></span>

<span class="keyword1"><span class="command">context</span></span> semimetric
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">smC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ _ <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>m</sub></span> _ _"</span> <span class="main">[</span>99<span class="main">,</span>99<span class="main">,</span>99<span class="main">,</span>99<span class="main">]</span> 50<span class="main">)</span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1"><span class="free">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>m</sub></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> <span class="free">dist</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="free">dist</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> semimetric <span class="main">&lt;</span> tarski_first3 <span class="quoted">smC</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> symm <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="bound">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="bound">b</span> <span class="bound">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">p</span> <span class="bound">q</span> <span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">a</span> <span class="bound">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="bound">p</span> <span class="bound">q</span> <span class="main">∧</span> <span class="bound">a</span> <span class="bound">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="bound">r</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="bound">p</span> <span class="bound">q</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="bound">r</span> <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">a</span> <span class="bound">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="bound">c</span> <span class="bound">c</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Some consequences of the first three axioms"</span></span>

<span class="keyword1"><span class="command">context</span></span> tarski_first3
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">notation</span></span> <span class="main">%</span>invisible <span class="free">C</span> <span class="main">(</span><span class="quoted">"_ _ <span class="keyword1">≡</span> _ _"</span> <span class="main">[</span>99<span class="main">,</span>99<span class="main">,</span>99<span class="main">,</span>99<span class="main">]</span> 50<span class="main">)</span>
  <span class="keyword1"><span class="command">lemma</span></span> A1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">b</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A1<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> A2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">;</span> <span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">r</span> <span class="free">s</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">p</span> <span class="free">q</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">r</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">r</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> A3'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A3<span class="main">)</span>

  <span class="keyword1"><span class="command">theorem</span></span> th2_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> A2' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> A1' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> th2_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">c</span> <span class="free">d</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A2' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> th2_1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> th2_3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span><span class="main">;</span> <span class="free">c</span> <span class="free">d</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">e</span> <span class="free">f</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">e</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> th2_2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="free">d</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="free">d</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">e</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A2' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="free">d</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">a</span> <span class="free">b</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> th2_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">b</span> <span class="free">a</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> th2_3 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> A1' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> th2_5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">d</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> th2_3 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> A1' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_segment</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_segment</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">segments</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">segments</span> <span class="main">=</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> is_segment <span class="bound">X</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> set <span class="main">⇒</span> <span class="tfree">'p</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SC</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">w</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">w</span><span class="main">,</span> <span class="bound">x</span><span class="main">}</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">w</span> <span class="bound">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="bound">y</span> <span class="bound">z</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SC_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span> set <span class="main">×</span> <span class="tfree">'p</span> set<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SC_rel</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">X</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">|</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> SC <span class="bound">X</span> <span class="bound">Y</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> left_segment_congruence<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="free">q</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> unordered_pair_element_equality <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="free">q</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">=</span> <span class="free">p</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> unordered_pair_element_equality <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="free">q</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">=</span> <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="free">a</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> th2_4 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> right_segment_congruence<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">c</span><span class="main">,</span> <span class="free">d</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">p</span> <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> th2_2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">p</span> <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="free">q</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> left_segment_congruence <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="free">c</span><span class="main">,</span> <span class="free">d</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="free">d</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> th2_2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> C_SC_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span> <span class="main">=</span> SC <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">{</span><span class="free">c</span><span class="main">,</span> <span class="free">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> SC_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">c</span><span class="main">,</span> <span class="free">d</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"SC <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">{</span><span class="free">c</span><span class="main">,</span> <span class="free">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"SC <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">{</span><span class="free">c</span><span class="main">,</span> <span class="free">d</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> SC_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">c</span><span class="main">,</span> <span class="free">d</span><span class="main">}</span>"</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">c</span><span class="main">,</span> <span class="free">d</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="skolem">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="skolem">y</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> left_segment_congruence <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
        <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">x</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="skolem">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="skolem">y</span> <span class="skolem">z</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="skolem">y</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> right_segment_congruence <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="free">c</span><span class="main">,</span> <span class="free">d</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemmas</span></span> SC_refl <span class="main">=</span> th2_1 <span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

  <span class="keyword1"><span class="command">lemma</span></span> SC_rel_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"refl_on segments SC_rel"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">note</span></span> refl_on_def <span class="main">[</span><span class="operator">of</span> <span class="quoted">segments</span> <span class="quoted">SC_rel</span><span class="main">]</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Z</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">∈</span> SC_rel"</span></span>
      <span class="keyword1"><span class="command">with</span></span> SC_rel_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">X</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"SC <span class="skolem">X</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹SC <span class="skolem">X</span> <span class="skolem">Y</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> SC_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="skolem">Y</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="bound">x</span><span class="main">.</span> <span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="bound">w</span><span class="main">,</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> is_segment_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">X</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> is_segment_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Y</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_segment <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_segment <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> segments_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> segments"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> segments"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Z</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">X</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">∈</span> segments <span class="main">×</span> segments"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"SC_rel <span class="main">⊆</span> segments <span class="main">×</span> segments"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> segments"</span></span>
      <span class="keyword1"><span class="command">with</span></span> segments_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_segment <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> is_segment_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">X</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> SC_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="skolem">X</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> SC_refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SC <span class="skolem">X</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_SC_equiv<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> SC_rel_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">X</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> SC_rel"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∈</span> segments <span class="main">⟶</span> <span class="main">(</span><span class="bound">X</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> SC_rel"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> SC_sym<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"SC <span class="free">X</span> <span class="free">Y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"SC <span class="free">Y</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> SC_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">Y</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹SC <span class="free">X</span> <span class="free">Y</span>›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="skolem">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="skolem">y</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> th2_2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="skolem">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="skolem">y</span> <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="skolem">z</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="skolem">w</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> SC_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Y</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">x</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Y</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"SC <span class="free">Y</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_SC_equiv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> SC_sym'<span class="main">:</span> <span class="quoted"><span class="quoted">"SC <span class="free">X</span> <span class="free">Y</span> <span class="main">=</span> SC <span class="free">Y</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"SC <span class="free">X</span> <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> SC_sym <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">Y</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"SC <span class="free">Y</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"SC <span class="free">Y</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> SC_sym <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Y</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"SC <span class="free">X</span> <span class="free">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> SC_rel_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"sym SC_rel"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">X</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> SC_rel"</span></span>
      <span class="keyword1"><span class="command">with</span></span> SC_rel_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SC <span class="skolem">X</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> SC_sym' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SC <span class="skolem">Y</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> SC_rel_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Y</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> SC_rel"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">with</span></span> sym_def <span class="main">[</span><span class="operator">of</span> <span class="quoted">SC_rel</span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> SC_trans<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"SC <span class="free">X</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"SC <span class="free">Y</span> <span class="free">Z</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"SC <span class="free">X</span> <span class="free">Z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> SC_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">Y</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹SC <span class="free">X</span> <span class="free">Y</span>›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="skolem">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="skolem">y</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> SC_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Y</span></span> <span class="quoted"><span class="free">Z</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹SC <span class="free">Y</span> <span class="free">Z</span>›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">q</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Z</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">r</span><span class="main">,</span> <span class="skolem">s</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">q</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="skolem">r</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Y</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Y</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">q</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="skolem">q</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="skolem">r</span> <span class="skolem">s</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="skolem">z</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="skolem">r</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_SC_equiv<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> th2_3 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="skolem">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="skolem">y</span> <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="skolem">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="skolem">r</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> SC_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">Z</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">x</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Z</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">r</span><span class="main">,</span> <span class="skolem">s</span><span class="main">}</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"SC <span class="free">X</span> <span class="free">Z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_SC_equiv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> SC_rel_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"trans SC_rel"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">Z</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">X</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> SC_rel"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Y</span><span class="main">,</span> <span class="skolem">Z</span><span class="main">)</span> <span class="main">∈</span> SC_rel"</span></span>
      <span class="keyword1"><span class="command">with</span></span> SC_rel_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SC <span class="skolem">X</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"SC <span class="skolem">Y</span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> SC_trans <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="skolem">Y</span></span> <span class="quoted"><span class="skolem">Z</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SC <span class="skolem">X</span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> SC_rel_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">X</span><span class="main">,</span> <span class="skolem">Z</span><span class="main">)</span> <span class="main">∈</span> SC_rel"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">with</span></span> trans_def <span class="main">[</span><span class="operator">of</span> <span class="quoted">SC_rel</span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> A3_reversed<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">a</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">b</span> <span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="free">a</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">b</span> <span class="free">c</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="free">c</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">a</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> th2_2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> A3'<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">lemma</span></span> equiv_segments_SC_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"equiv segments SC_rel"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equiv_def SC_rel_refl SC_rel_sym SC_rel_trans<span class="main">)</span>
    
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Some consequences of the first five axioms"</span></span>

<span class="keyword1"><span class="command">context</span></span> tarski_first5
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> A4'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span> <span class="free">q</span> <span class="free">a</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">a</span> <span class="bound">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">b</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A4 <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">theorem</span></span> th2_8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">a</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">b</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> A4' <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="skolem">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">b</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> A3' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="skolem">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">b</span> <span class="free">b</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">OFS</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'p</span><span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">OFS</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">a'</span></span></span> <span class="free"><span class="bound"><span class="entity">b'</span></span></span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="free"><span class="bound"><span class="entity">d'</span></span></span> <span class="main">≡</span>
      <span class="free">B</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="free">B</span> <span class="free"><span class="bound"><span class="entity">a'</span></span></span> <span class="free"><span class="bound"><span class="entity">b'</span></span></span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free"><span class="bound"><span class="entity">a'</span></span></span> <span class="free"><span class="bound"><span class="entity">b'</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free"><span class="bound"><span class="entity">b'</span></span></span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free"><span class="bound"><span class="entity">a'</span></span></span> <span class="free"><span class="bound"><span class="entity">d'</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free"><span class="bound"><span class="entity">b'</span></span></span> <span class="free"><span class="bound"><span class="entity">d'</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> A5'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>OFS <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">a'</span> <span class="free">b'</span> <span class="free">c'</span> <span class="free">d'</span><span class="main">;</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">c</span> <span class="free">d</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c'</span> <span class="free">d'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"OFS <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">a'</span> <span class="free">b'</span> <span class="free">c'</span> <span class="free">d'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A5 <span class="keyword2"><span class="keyword">and</span></span> OFS_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> th2_11<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> hypotheses<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a'</span> <span class="free">b'</span> <span class="free">c'</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">a'</span> <span class="free">b'</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="free">c</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">b'</span> <span class="free">c'</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">c</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">a'</span> <span class="free">c'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="free">b</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">a'</span> <span class="free">b'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a'</span> <span class="main">=</span> <span class="free">b'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A3_reversed<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="free">c</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">b'</span> <span class="free">c'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">note</span></span> A5' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">a'</span></span> <span class="quoted"><span class="free">b'</span></span> <span class="quoted"><span class="free">c'</span></span> <span class="quoted"><span class="free">a'</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
        unordered_pair_equality <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
        unordered_pair_equality <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a'</span></span> <span class="quoted"><span class="free">c'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> OFS_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">a'</span></span> <span class="quoted"><span class="free">b'</span></span> <span class="quoted"><span class="free">c'</span></span> <span class="quoted"><span class="free">a'</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          hypotheses <span class="keyword2"><span class="keyword">and</span></span>
          th2_8 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">a'</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          unordered_pair_equality <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          unordered_pair_equality <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a'</span></span> <span class="quoted"><span class="free">b'</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"OFS <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">a</span> <span class="free">a'</span> <span class="free">b'</span> <span class="free">c'</span> <span class="free">a'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_SC_equiv<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_SC_equiv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> A4_unique<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">q</span> <span class="free">a</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">b</span> <span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">q</span> <span class="free">a</span> <span class="free">x'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">x'</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">b</span> <span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> SC_sym' <span class="keyword2"><span class="keyword">and</span></span> SC_trans <span class="keyword2"><span class="keyword">and</span></span> C_SC_equiv <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="free">x'</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">b</span> <span class="free">c</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="free">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">b</span> <span class="free">c</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">a</span> <span class="free">x'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> th2_11 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">x'</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">q</span> <span class="free">a</span> <span class="free">x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">q</span> <span class="free">a</span> <span class="free">x'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> SC_refl
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="free">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">q</span> <span class="free">x'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> OFS_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">x'</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
        <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">q</span> <span class="free">a</span> <span class="free">x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        SC_refl <span class="keyword2"><span class="keyword">and</span></span>
        <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="free">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">a</span> <span class="free">x'</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"OFS <span class="free">q</span> <span class="free">a</span> <span class="free">x</span> <span class="free">x</span> <span class="free">q</span> <span class="free">a</span> <span class="free">x</span> <span class="free">x'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> A5' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">x'</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">x</span> <span class="free">x'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> A3_reversed<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> th2_12<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span> <span class="free">q</span> <span class="free">a</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">a</span> <span class="bound">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">b</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="free">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> A4' <span class="keyword2"><span class="keyword">and</span></span> A4_unique
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Simple theorems about betweenness"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> tarski_first5<span class="main">)</span> th3_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A4 <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="skolem">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">b</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> A3 <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="skolem">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">b</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="skolem">x</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> tarski_absolute_space
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> A6'<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> A6 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">a</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
    
  <span class="keyword1"><span class="command">lemma</span></span> A7'<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">p</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">b</span> <span class="free">q</span> <span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span> <span class="free">p</span> <span class="bound">x</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">B</span> <span class="free">q</span> <span class="bound">x</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> A7 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">a</span> <span class="free">p</span> <span class="free">c</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">b</span> <span class="free">q</span> <span class="free">c</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> A11'<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">⟶</span> <span class="free">B</span> <span class="free">a</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">⟶</span> <span class="free">B</span> <span class="bound">x</span> <span class="bound">b</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">⟶</span> <span class="free">B</span> <span class="bound">a</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">⟶</span> <span class="free">B</span> <span class="bound">x</span> <span class="bound">b</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> A11 <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> th3_2<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">c</span> <span class="free">b</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> th3_1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">b</span> <span class="free">c</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> A7' <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">b</span> <span class="skolem">x</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">c</span> <span class="skolem">x</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> A6' <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">b</span> <span class="skolem">x</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">c</span> <span class="skolem">x</span> <span class="free">a</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">c</span> <span class="free">b</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> th3_4<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">b</span> <span class="free">a</span> <span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">b</span> <span class="free">a</span> <span class="free">c</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> A7' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">b</span> <span class="skolem">x</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="skolem">x</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A6'<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> th3_5_1<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">d</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> A7' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">b</span> <span class="skolem">x</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">c</span> <span class="skolem">x</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">b</span> <span class="skolem">x</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> A6'<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">c</span> <span class="skolem">x</span> <span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">c</span> <span class="free">b</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> th3_2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> th3_6_1<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">a</span> <span class="free">c</span> <span class="free">d</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> th3_2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">d</span> <span class="free">c</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">c</span> <span class="free">b</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">d</span> <span class="free">c</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> th3_5_1<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> th3_2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> th3_7_1<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> A4' <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">c</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="skolem">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">a</span> <span class="free">c</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">b</span> <span class="free">c</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> th3_6_1<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="free">d</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> th2_1<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">b</span> <span class="free">c</span> <span class="skolem">x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="skolem">x</span> <span class="main"><span class="free">\&lt;congruent&gt;</span></span> <span class="free">c</span> <span class="free">d</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> A4_unique<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">a</span> <span class="free">c</span> <span class="skolem">x</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> th3_7_2<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> th3_2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">d</span> <span class="free">c</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">c</span> <span class="free">b</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> th3_7_1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">d</span> <span class="free">b</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> th3_2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Simple theorems about congruence and betweenness"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> tarski_first5<span class="main">)</span> <span class="entity">Col</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Col</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> <span class="free">B</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∨</span> <span class="free">B</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∨</span> <span class="free">B</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Euclid_Tarski">
<div class="head">
<h1>Theory Euclid_Tarski</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Real Euclidean space and Tarski's axioms
    Author:      Tim Makarios &lt;tjm1983 at gmail.com&gt;, 2012
    Maintainer:  Tim Makarios &lt;tjm1983 at gmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Real Euclidean space and Tarski's axioms"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Euclid_Tarski
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Tarski.html">Tarski</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Real Euclidean space satisfies the first five axioms"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">real_euclid_C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>real<span class="main">^</span><span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>finite<span class="main">)</span><span class="main">,</span> real<span class="main">^</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span><span class="main">,</span> real<span class="main">^</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span><span class="main">,</span> real<span class="main">^</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span><span class="main">]</span> <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="quoted">"_ _ <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> _ _"</span> <span class="main">[</span>99<span class="main">,</span>99<span class="main">,</span>99<span class="main">,</span>99<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">real_euclid_C</span> <span class="main">≡</span> norm_metric.smC"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">real_euclid_B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>real<span class="main">^</span><span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>finite<span class="main">)</span><span class="main">,</span> real<span class="main">^</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span><span class="main">,</span> real<span class="main">^</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span><span class="main">]</span> <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> _ _ _"</span> <span class="main">[</span>99<span class="main">,</span>99<span class="main">,</span>99<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">B<span class="hidden">⇩</span><sub>ℝ</sub></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">l</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="bound">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> real_euclid<span class="main">:</span> tarski_first5 <span class="quoted">real_euclid_C</span> <span class="quoted">real_euclid_B</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹By virtue of being a semimetric space,
    real Euclidean space is already known to satisfy the first three axioms.›</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">q</span> <span class="skolem">a</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="bound">x</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">b</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">-</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">q</span> <span class="skolem">a</span> <span class="var">?x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">::</span> real"</span></span>
        <span class="keyword1"><span class="command">note</span></span> real_euclid_B_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="skolem">q</span> <span class="main">=</span> <span class="var">?l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="var">?x</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="var">?x</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">b</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm_dist <span class="skolem">q</span> <span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"norm_dist <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">/</span> norm_dist <span class="skolem">q</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">q</span> <span class="skolem">a</span> <span class="var">?x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?k</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_pos_nonneg<span class="main">)</span>
        <span class="keyword1"><span class="command">note</span></span> real_euclid_B_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_pos_nonneg<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">from</span></span> scaleR_left_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="skolem">q</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">-</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?l</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> scaleR_right_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="skolem">q</span> <span class="main">=</span> <span class="var">?l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">q</span> <span class="skolem">a</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="var">?x</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">b</span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> norm_scaleR <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="skolem">q</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
            <span class="quoted"><span class="quoted">"norm_dist <span class="skolem">a</span> <span class="var">?x</span> <span class="main">=</span> <span class="main">¦</span><span class="var">?k</span><span class="main">¦</span> <span class="main">*</span> norm <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?k</span> <span class="main">*</span> norm <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> norm_metric.symm <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?k</span> <span class="main">*</span> norm_dist <span class="skolem">q</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span>
            <span class="quoted"><span class="quoted">"norm_dist <span class="skolem">a</span> <span class="var">?x</span> <span class="main">=</span> norm_dist <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">/</span> norm_dist <span class="skolem">q</span> <span class="skolem">a</span> <span class="main">*</span> norm_dist <span class="skolem">q</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹norm_dist <span class="skolem">q</span> <span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="var">?x</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">b</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">q</span> <span class="bound">a</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">a</span> <span class="bound">x</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">b</span> <span class="bound">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">b</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a'</span> <span class="skolem">b'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">c</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">b'</span> <span class="skolem">c'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">d</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a'</span> <span class="skolem">d'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">d</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">b'</span> <span class="skolem">d'</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="skolem">d</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">c'</span> <span class="skolem">d'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>finite<span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            scaleR_right_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">r</span> <span class="main">-</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span> <span class="main">+</span> <span class="skolem">p</span> <span class="main">-</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">r</span> <span class="main">=</span>
            <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">r</span> <span class="main">-</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span> <span class="main">+</span> <span class="skolem">p</span> <span class="main">-</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">r</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> scaleR_left_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
            scaleR_left_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">q</span> <span class="main">-</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> scaleR_right_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
            scaleR_right_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">q</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> norm_scaleR <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> norm_scaleR <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">-</span> <span class="skolem">r</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">¦</span> <span class="main">*</span> norm <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">*</span> norm <span class="main">(</span><span class="skolem">q</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≤</span> <span class="main">1</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">q</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">m</span> <span class="main">*</span> norm <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">q</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">/</span> norm <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"norm_dist <span class="skolem">q</span> <span class="skolem">r</span> <span class="main">/</span> norm_dist <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">note</span></span> linelemma <span class="main">=</span> this
      <span class="keyword1"><span class="command">from</span></span> real_euclid_B_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>›</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> real_euclid_B_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a'</span></span> <span class="quoted"><span class="skolem">b'</span></span> <span class="quoted"><span class="skolem">c'</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span>›</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">l'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">-</span> <span class="skolem">a'</span> <span class="main">=</span> <span class="skolem">l'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c'</span> <span class="main">-</span> <span class="skolem">a'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="skolem">b</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a'</span> <span class="skolem">b'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">≠</span> <span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> linelemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">l</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">b</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">c</span></span></span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">l</span> <span class="main">=</span> norm_dist <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">/</span> norm_dist <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">l</span> <span class="main">=</span> norm_dist <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">/</span> norm_dist <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="skolem">b</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a'</span> <span class="skolem">b'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="skolem">c</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">b'</span> <span class="skolem">c'</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">l</span> <span class="main">=</span> norm_dist <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="main">/</span> norm_dist <span class="skolem">a'</span> <span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> linelemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">l'</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a'</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">b'</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">c'</span></span></span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">≠</span> <span class="skolem">b'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">-</span> <span class="skolem">a'</span> <span class="main">=</span> <span class="skolem">l'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c'</span> <span class="main">-</span> <span class="skolem">a'</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l'</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">l'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l'</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">l'</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">l</span> <span class="main">*</span> <span class="skolem">l</span> <span class="main">*</span> <span class="skolem">l'</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l'</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">l'</span> <span class="main">*</span> <span class="skolem">l</span> <span class="main">*</span> <span class="skolem">l'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">l'</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l'</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> left_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="skolem">l'</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> left_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">l'</span></span> <span class="quoted"><span class="skolem">l</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="skolem">l'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">r</span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>finite<span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> scaleR_scaleR <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> cosine_rule <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm_dist <span class="skolem">r</span> <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>norm_dist <span class="skolem">r</span> <span class="skolem">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>norm_dist <span class="skolem">p</span> <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span>
              <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> inner_scaleR_left <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">-</span> <span class="skolem">s</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
              <span class="main">(</span>norm_dist <span class="skolem">r</span> <span class="skolem">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>norm_dist <span class="skolem">p</span> <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span><span class="main">/</span><span class="skolem">m</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cosine_rule <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>norm_dist <span class="skolem">r</span> <span class="skolem">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>norm_dist <span class="skolem">p</span> <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span>
              <span class="main">1</span><span class="main">/</span><span class="skolem">m</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>norm_dist <span class="skolem">q</span> <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>norm_dist <span class="skolem">q</span> <span class="skolem">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>norm_dist <span class="skolem">p</span> <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm_dist <span class="skolem">r</span> <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>norm_dist <span class="skolem">r</span> <span class="skolem">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>norm_dist <span class="skolem">p</span> <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span>
          <span class="main">1</span><span class="main">/</span><span class="skolem">m</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>norm_dist <span class="skolem">q</span> <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>norm_dist <span class="skolem">q</span> <span class="skolem">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>norm_dist <span class="skolem">p</span> <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword1"><span class="command">from</span></span> norm_dist_dot <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm_dist <span class="skolem">r</span> <span class="skolem">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> inner_scaleR_left <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
              inner_scaleR_right <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="skolem">m</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> norm_dist_dot <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="skolem">m</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>norm_dist <span class="skolem">q</span> <span class="skolem">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm_dist <span class="skolem">r</span> <span class="skolem">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="skolem">m</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>norm_dist <span class="skolem">q</span> <span class="skolem">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span>norm_dist <span class="skolem">r</span> <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="skolem">m</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>norm_dist <span class="skolem">q</span> <span class="skolem">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>norm_dist <span class="skolem">p</span> <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span>
            <span class="main">1</span><span class="main">/</span><span class="skolem">m</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>norm_dist <span class="skolem">q</span> <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>norm_dist <span class="skolem">q</span> <span class="skolem">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>norm_dist <span class="skolem">p</span> <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> norm_metric.symm <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm_dist <span class="skolem">r</span> <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="skolem">m</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>norm_dist <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>norm_dist <span class="skolem">p</span> <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span>
              <span class="main">1</span><span class="main">/</span><span class="skolem">m</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>norm_dist <span class="skolem">q</span> <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>norm_dist <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>norm_dist <span class="skolem">p</span> <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">note</span></span> fiveseglemma <span class="main">=</span> this
      <span class="keyword1"><span class="command">from</span></span> fiveseglemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">d</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm_dist <span class="skolem">c</span> <span class="skolem">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="skolem">l</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>norm_dist <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>norm_dist <span class="skolem">a</span> <span class="skolem">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span>
            <span class="main">1</span><span class="main">/</span><span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>norm_dist <span class="skolem">b</span> <span class="skolem">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>norm_dist <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>norm_dist <span class="skolem">a</span> <span class="skolem">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="skolem">l'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="skolem">b</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a'</span> <span class="skolem">b'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="skolem">d</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a'</span> <span class="skolem">d'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="skolem">d</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">b'</span> <span class="skolem">d'</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="skolem">l'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>norm_dist <span class="skolem">a'</span> <span class="skolem">b'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>norm_dist <span class="skolem">a'</span> <span class="skolem">d'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span>
            <span class="main">1</span><span class="main">/</span><span class="skolem">l'</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>norm_dist <span class="skolem">b'</span> <span class="skolem">d'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>norm_dist <span class="skolem">a'</span> <span class="skolem">b'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>norm_dist <span class="skolem">a'</span> <span class="skolem">d'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> fiveseglemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l'</span></span> <span class="quoted"><span class="skolem">b'</span></span> <span class="quoted"><span class="skolem">a'</span></span> <span class="quoted"><span class="skolem">c'</span></span> <span class="quoted"><span class="skolem">d'</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">-</span> <span class="skolem">a'</span> <span class="main">=</span> <span class="skolem">l'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c'</span> <span class="main">-</span> <span class="skolem">a'</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>norm_dist <span class="skolem">c'</span> <span class="skolem">d'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm_dist <span class="skolem">c</span> <span class="skolem">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>norm_dist <span class="skolem">c'</span> <span class="skolem">d'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">(</span>norm_dist <span class="skolem">c</span> <span class="skolem">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="main">(</span>norm_dist <span class="skolem">c'</span> <span class="skolem">d'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> real_sqrt_abs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="skolem">d</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">c'</span> <span class="skolem">d'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">a'</span> <span class="bound">b'</span> <span class="bound">c'</span> <span class="bound">d'</span><span class="main">.</span>
          <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">a'</span> <span class="bound">b'</span> <span class="bound">c'</span> <span class="main">∧</span>
          <span class="bound">a</span> <span class="bound">b</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">a'</span> <span class="bound">b'</span> <span class="main">∧</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">b'</span> <span class="bound">c'</span> <span class="main">∧</span> <span class="bound">a</span> <span class="bound">d</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">a'</span> <span class="bound">d'</span> <span class="main">∧</span> <span class="bound">b</span> <span class="bound">d</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">b'</span> <span class="bound">d'</span> <span class="main">⟶</span>
            <span class="bound">c</span> <span class="bound">d</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">c'</span> <span class="bound">d'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Real Euclidean space also satisfies axioms 6, 7, and 11"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rearrange_real_euclid_B<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">w</span> <span class="free">y</span> <span class="free">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">h</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">-</span> <span class="free">w</span> <span class="main">=</span> <span class="free">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="free">w</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">=</span> <span class="free">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">z</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">h</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">-</span> <span class="free">w</span> <span class="main">=</span> <span class="free">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">-</span> <span class="free">w</span> <span class="main">+</span> <span class="free">w</span> <span class="main">=</span> <span class="free">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="free">w</span><span class="main">)</span> <span class="main">+</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="free">w</span><span class="main">)</span> <span class="main">+</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> scaleR_right_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">h</span></span> <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">z</span> <span class="main">+</span> <span class="free">w</span> <span class="main">-</span> <span class="free">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> scaleR_left_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">h</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">z</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">h</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">z</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">h</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> scaleR_left_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">h</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">z</span> <span class="main">+</span> <span class="free">w</span> <span class="main">-</span> <span class="free">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> scaleR_right_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">h</span></span> <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="free">w</span><span class="main">)</span> <span class="main">+</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">-</span> <span class="free">w</span> <span class="main">+</span> <span class="free">w</span> <span class="main">=</span> <span class="free">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="free">w</span><span class="main">)</span> <span class="main">+</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">-</span> <span class="free">w</span> <span class="main">=</span> <span class="free">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> real_euclid<span class="main">:</span> tarski_absolute_space <span class="quoted">real_euclid_C</span> <span class="quoted">real_euclid_B</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> real_euclid_B_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">a</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">p</span> <span class="skolem">q</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="skolem">p</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">b</span> <span class="skolem">q</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> real_euclid_B_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="skolem">p</span> <span class="skolem">c</span>›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">p</span> <span class="bound">x</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">q</span> <span class="bound">x</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> real_euclid_B_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">p</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> real_euclid_B_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">q</span> <span class="skolem">a</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">p</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">q</span> <span class="skolem">a</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">p</span> <span class="bound">x</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">q</span> <span class="bound">x</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> real_euclid_B_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">b</span> <span class="skolem">q</span> <span class="skolem">c</span>›</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≤</span> <span class="main">1</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> diff_divide_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="var">?l</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> right_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          right_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          mult.commute <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          add.commute <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> diff_divide_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="var">?k</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">-</span> <span class="var">?l</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          times_divide_eq_left <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          mult.commute <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">-</span> <span class="var">?k</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">-</span> <span class="var">?l</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="var">?k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">c</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span> <span class="main">=</span>
            <span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">c</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> scaleR_scaleR
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">c</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span> <span class="main">=</span>
            <span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">c</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> scaleR_right_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          scaleR_right_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?k</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          add.assoc <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          add.assoc <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">c</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span>
            <span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">c</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">c</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span>
            <span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">c</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          rearrange_real_euclid_B <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          rearrange_real_euclid_B <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">q</span> <span class="main">=</span> <span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> rearrange_real_euclid_B <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">-</span> <span class="skolem">q</span> <span class="main">=</span> <span class="var">?l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?x</span> <span class="main">=</span> <span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          rearrange_real_euclid_B <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">=</span> <span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          zero_le_divide_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          zero_le_divide_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">-</span> <span class="var">?l</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="var">?l</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?l</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="var">?x</span> <span class="main">-</span> <span class="skolem">q</span> <span class="main">=</span> <span class="var">?l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          real_euclid_B_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">q</span> <span class="var">?x</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">-</span> <span class="var">?l</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="var">?k</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          zero_le_mult_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="var">?l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?l</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="var">?l</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          mult_mono <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="var">?l</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="var">?k</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?k</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">‹<span class="var">?x</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">=</span> <span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          real_euclid_B_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">p</span> <span class="var">?x</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">q</span> <span class="var">?x</span> <span class="skolem">a</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">a</span> <span class="bound">p</span> <span class="bound">c</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">b</span> <span class="bound">q</span> <span class="bound">c</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">p</span> <span class="bound">x</span> <span class="bound">b</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">q</span> <span class="bound">x</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">a</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">x</span> <span class="bound">b</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∨</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="skolem">a</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∨</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="bound">x</span> <span class="bound">y</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">x</span> <span class="var">?b</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">x</span> <span class="var">?b</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">X</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∨</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="bound">x</span> <span class="bound">y</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> real_euclid_B_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">l</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">note</span></span> ylemma <span class="main">=</span> this
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Y</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> ylemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">d</span></span><span class="main">]</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted">"<span class="skolem"><span class="skolem">jd</span></span>"</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">jd</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">jd</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="bound">x</span> <span class="bound">y</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">∈</span> <span class="skolem">Y</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> real_euclid_B_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">d</span></span><span class="main">]</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">jd</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            scaleR_scaleR
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">*</span> <span class="skolem">jd</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">note</span></span> xlemma <span class="main">=</span> this
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">Y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">∈</span> <span class="skolem">Y</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">jd</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">jd</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Inf <span class="var">?S</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">c</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> rearrange_real_euclid_B <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> xlemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> ylemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>›</span></span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cInf_lower<span class="main">)</span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">∈</span> <span class="var">?S</span>›</span></span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="bound">x</span> <span class="bound">y</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Y</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> real_euclid_B_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">z</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> scaleR_scaleR
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">*</span> <span class="skolem">h</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">*</span> <span class="skolem">h</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> scaleR_cancel_right <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">*</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cInf_greatest <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="var">?k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> scaleR_left_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="var">?b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?b</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> scaleR_left_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="var">?k</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">x</span> <span class="var">?b</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≤</span> <span class="var">?k</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?k</span> <span class="main">≤</span> <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?b</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="var">?k</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> real_euclid_B_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">x</span> <span class="var">?b</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≤</span> <span class="var">?k</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?k</span> <span class="main">≤</span> <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> scaleR_scaleR
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?b</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="var">?k</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> scaleR_scaleR
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="var">?k</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?k</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?k</span> <span class="main">≤</span> <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≤</span> <span class="var">?k</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> pos_le_divide_eq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">-</span> <span class="skolem">i</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> real_euclid_B_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
              <span class="quoted"><span class="quoted">‹<span class="var">?l</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              <span class="quoted"><span class="quoted">‹<span class="var">?b</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span>›</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">x</span> <span class="var">?b</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">x</span> <span class="bound">b</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">a</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟶</span>
          <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">x</span> <span class="bound">b</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Real Euclidean space satisfies the Euclidean axiom"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rearrange_real_euclid_B_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>finite<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> scaleR_right_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">l</span>"</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">b</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="free">a</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> scaleR_left_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">l</span>"</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">⟷</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">-</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">-</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> real_euclid<span class="main">:</span> tarski_space <span class="quoted">real_euclid_C</span> <span class="quoted">real_euclid_B</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">b</span> <span class="skolem">d</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> real_euclid_B_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">d</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="skolem">d</span> <span class="skolem">t</span>›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> rearrange_real_euclid_B_2
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">d</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">c</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> rearrange_real_euclid_B_2 <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?y</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> real_euclid_B_def <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="var">?x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="skolem">c</span> <span class="var">?y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> real_euclid_B_def <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">b</span> <span class="skolem">d</span> <span class="skolem">c</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">d</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">-</span> <span class="var">?x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">d</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> scaleR_right_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">j</span>"</span></span> <span class="quoted"><span class="skolem">d</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> scaleR_right_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">j</span>"</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?y</span> <span class="main">-</span> <span class="var">?x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">-</span> <span class="var">?x</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?y</span> <span class="main">-</span> <span class="var">?x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> real_euclid_B_def <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?x</span> <span class="skolem">t</span> <span class="var">?y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="var">?x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="skolem">c</span> <span class="var">?y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="bound">x</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="skolem">c</span> <span class="bound">y</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">x</span> <span class="skolem">t</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">t</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">a</span> <span class="bound">d</span> <span class="bound">t</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">b</span> <span class="bound">d</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">⟶</span>
            <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">x</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">a</span> <span class="bound">c</span> <span class="bound">y</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">x</span> <span class="bound">t</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"The real Euclidean plane"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Col_dep2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"real_euclid.Col <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">⟷</span> dep2 <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> real_euclid.Col_def <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"real_euclid.Col <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">⟷</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">b</span> <span class="free">c</span> <span class="free">a</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">c</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> dep2_def <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"dep2 <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">w</span> <span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">b</span> <span class="free">c</span> <span class="free">a</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">c</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> real_euclid_B_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">b</span> <span class="free">c</span> <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> real_euclid_B_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> scaleR_left_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> scaleR_minus_left <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">c</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> real_euclid_B_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">c</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> scaleR_minus_left <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> scaleR_left_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">c</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">r</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">b</span> <span class="free">c</span> <span class="free">a</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">c</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> real_euclid.th3_1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">b</span> <span class="free">c</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">r</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> real_euclid_B_def <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s</span><span class="main">/</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> le_imp_inverse_le <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">/</span><span class="skolem">r</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> inverse_positive_iff_positive <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">/</span><span class="skolem">r</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> real_euclid_B_def
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s</span><span class="main">/</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">/</span><span class="skolem">r</span> <span class="main">≤</span> <span class="main">1</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">c</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> real_euclid.th3_2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">b</span> <span class="free">c</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> scaleR_minus_right <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">c</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">-</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">c</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> scaleR_left_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">c</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> le_imp_inverse_le <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> inverse_positive_iff_positive <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">s</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> real_euclid_B_def <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?l</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">-</span> <span class="free">c</span> <span class="main">=</span> <span class="var">?l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">c</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> non_Col_example<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>real_euclid.Col <span class="main">0</span> <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>real_euclid.Col <span class="var">?a</span> <span class="var">?b</span> <span class="var">?c</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"dep2 <span class="main">(</span><span class="var">?b</span> <span class="main">-</span> <span class="var">?a</span><span class="main">)</span> <span class="main">(</span><span class="var">?c</span> <span class="main">-</span> <span class="var">?a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> dep2_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">-</span> <span class="var">?a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">-</span> <span class="var">?a</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">-</span> <span class="var">?a</span> <span class="main">=</span> <span class="skolem">r</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">-</span> <span class="var">?a</span> <span class="main">=</span> <span class="skolem">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?b</span> <span class="main">-</span> <span class="var">?a</span> <span class="main">=</span> <span class="skolem">r</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">w</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">$</span><span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?c</span> <span class="main">-</span> <span class="var">?a</span> <span class="main">=</span> <span class="skolem">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">w</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span><span class="main">$</span><span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?c</span> <span class="main">-</span> <span class="var">?a</span> <span class="main">=</span> <span class="skolem">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">w</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>dep2 <span class="main">(</span><span class="var">?b</span> <span class="main">-</span> <span class="var">?a</span><span class="main">)</span> <span class="main">(</span><span class="var">?c</span> <span class="main">-</span> <span class="var">?a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> Col_dep2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>real_euclid.Col <span class="var">?a</span> <span class="var">?b</span> <span class="var">?c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> real_euclid<span class="main">:</span>
  tarski <span class="quoted"><span class="quoted">"real_euclid_C<span class="main">::</span><span class="main">(</span><span class="main">[</span>real<span class="main">^</span><span class="numeral">2</span><span class="main">,</span> real<span class="main">^</span><span class="numeral">2</span><span class="main">,</span> real<span class="main">^</span><span class="numeral">2</span><span class="main">,</span> real<span class="main">^</span><span class="numeral">2</span><span class="main">]</span> <span class="main">⇒</span> bool<span class="main">)</span>"</span></span> <span class="quoted">real_euclid_B</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> non_Col_example <span class="keyword2"><span class="keyword">and</span></span> real_euclid.Col_def <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?a</span> <span class="var">?b</span> <span class="var">?c</span> <span class="main">∧</span> <span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?b</span> <span class="var">?c</span> <span class="var">?a</span> <span class="main">∧</span> <span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?c</span> <span class="var">?a</span> <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">2</span><span class="main">.</span> <span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">∧</span> <span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">a</span> <span class="main">∧</span> <span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">c</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">p</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span>  <span class="skolem">a</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">p</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">b</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="skolem">p</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">c</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> scaleR_right_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
      scaleR_right_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
      scaleR_left_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> scaleR_right_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
      scaleR_right_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
      scaleR_left_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">-</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> scaleR_minus_right <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">-</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> norm_minus_cancel <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>norm <span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>norm <span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> norm_minus_cancel<span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">p</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">d</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>norm <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="var">?m</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">-</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">-</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> dot_norm <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">-</span> <span class="var">?m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="var">?m</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">(</span>norm <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>norm <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="var">?m</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>norm<span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>norm <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>norm <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>norm <span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>norm <span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>norm <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>norm <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="var">?m</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>norm<span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> dot_norm <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">-</span> <span class="var">?m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">-</span> <span class="skolem">q</span>"</span></span><span class="main">]</span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">-</span> <span class="skolem">q</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="var">?m</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> inner_minus_right <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">-</span> <span class="var">?m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span>"</span></span><span class="main">]</span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?m</span> <span class="main">-</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="var">?m</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> inner_minus_left<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="var">?m</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="var">?m</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="var">?m</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">note</span></span> m_lemma <span class="main">=</span> this
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="skolem">p</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="var">?m</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">p</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">d</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> m_lemma <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="var">?m</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> dot_left_diff_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">-</span> <span class="var">?m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="var">?m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span>"</span></span><span class="main">]</span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="var">?m</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_diff_left inner_diff_right<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="skolem">p</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">b</span> <span class="skolem">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="skolem">p</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">c</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">with</span></span> real2_orthogonal_dep2 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?m</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dep2 <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> Col_dep2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_euclid.Col <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> real_euclid.Col_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">a</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="skolem">c</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="bound">q</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">2</span><span class="main">.</span>
          <span class="bound">p</span> <span class="main">≠</span> <span class="bound">q</span> <span class="main">∧</span> <span class="bound">a</span> <span class="bound">p</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">a</span> <span class="bound">q</span> <span class="main">∧</span> <span class="bound">b</span> <span class="bound">p</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">b</span> <span class="bound">q</span> <span class="main">∧</span> <span class="bound">c</span> <span class="bound">p</span> <span class="main">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">c</span> <span class="bound">q</span> <span class="main">⟶</span>
            <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">a</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">c</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Special cases of theorems of Tarski's geometry›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_euclid_B_disjunction<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">c</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_euclid_B_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">c</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">l</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">l</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">l</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="free">l</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">l</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">l</span> <span class="main">≤</span> <span class="main">1</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">c</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_euclid_B_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">l</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">c</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following are true in Tarski's geometry,
  but to prove this would require much more development of it,
  so only the Euclidean case is proven here.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> real_euclid_th5_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">c</span> <span class="free">d</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">d</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">d</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_euclid_B_def<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">/</span><span class="skolem">m</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_le_divide_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span><span class="main">/</span><span class="skolem">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">/</span><span class="skolem">m</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> real_euclid_B_disjunction
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">c</span> <span class="free">d</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">d</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> real_euclid_th5_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">c</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">d</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">c</span> <span class="free">d</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_euclid_B_def<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">c</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_euclid_B_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">l</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">c</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">/</span><span class="skolem">l</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_le_divide_iff<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">m</span><span class="main">/</span><span class="skolem">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span><span class="main">/</span><span class="skolem">l</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> real_euclid_B_disjunction
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="free">a</span> <span class="free">c</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Linear_Algebra2">
<div class="head">
<h1>Theory Linear_Algebra2</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Some extra results about linear algebra
    Author:      Tim Makarios &lt;tjm1983 at gmail.com&gt;, 2012
    Maintainer:  Tim Makarios &lt;tjm1983 at gmail.com&gt;
*)</span>

<span class="comment1">(* Some of these theorems previously here have been moved to the Isabelle repository *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Linear algebra"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Linear_Algebra2
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Miscellany.html">Miscellany</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exhaust_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="numeral">4</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>of_int <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">&lt;</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">z</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="skolem">z</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> forall_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">i</span><span class="main">::</span><span class="numeral">4</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">P</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">P</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="free">P</span> <span class="numeral">3</span> <span class="main">∧</span> <span class="free">P</span> <span class="numeral">4</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> exhaust_4<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> UNIV_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV<span class="main">::</span><span class="main">(</span><span class="numeral">4</span> set<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> exhaust_4
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> vector_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">w</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>zero"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="free">w</span><span class="main">,</span> <span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">]</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="free">w</span><span class="main">,</span> <span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">]</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="free">w</span><span class="main">,</span> <span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">]</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="free">w</span><span class="main">,</span> <span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">]</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">$</span><span class="numeral">4</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vector_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">is_basis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real<span class="main">^</span><span class="tfree">'n</span><span class="main">)</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_basis</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> independent <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> span <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> UNIV"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>finite<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">S</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> card_eq_0_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> independent_is_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real<span class="main">^</span><span class="tfree">'n</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"independent <span class="free">B</span> <span class="main">∧</span> card <span class="free">B</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span> <span class="main">⟷</span> is_basis <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"independent <span class="free">B</span> <span class="main">∧</span> card <span class="free">B</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>Basis<span class="main">::</span><span class="main">(</span>real<span class="main">^</span><span class="tfree">'n</span><span class="main">)</span> set<span class="main">)</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> L <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_basis <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> card_eq_dim dim_UNIV independent_bound is_basis_def subset_antisym top_greatest<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_basis <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"independent <span class="free">B</span> <span class="main">∧</span> card <span class="free">B</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DIM_cart DIM_real basis_card_eq_dim dim_UNIV is_basis_def mult.right_neutral top.extremum<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basis_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real<span class="main">^</span><span class="tfree">'n</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_basis <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> independent_is_basis <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_basis <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">B</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> card_finite <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'n</span> <span class="main"><span class="main">=</span></span> <span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basis_expand<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_basis <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">w</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_basis <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> span <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_basis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> basis_finite <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_basis <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> span_finite <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> span <span class="free">B</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">w</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_equiv<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> not_span_independent_insert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"independent <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> span <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"independent <span class="main">(</span>insert <span class="free">v</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms independent_insert<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> orthogonal_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span><span class="main">∈</span><span class="free">S</span> <span class="main">⟹</span> orthogonal <span class="free">v</span> <span class="bound">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"orthogonal <span class="free">v</span> <span class="main">(</span><span class="main">∑</span><span class="bound">w</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="free">c</span> <span class="bound">w</span> <span class="keyword1">*s</span> <span class="bound">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms orthogonal_clauses<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> orthogonal_rvsum scalar_equiv sum.infinite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> orthogonal_self_eq_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_inner<span class="main">)</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orthogonal <span class="free">v</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inner_eq_zero_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> orthogonal_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> orthogonal_in_span_eq_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> span <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span><span class="main">∈</span><span class="free">S</span> <span class="main">⟹</span> orthogonal <span class="free">v</span> <span class="bound">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms orthogonal_self orthogonal_to_span <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> orthogonal_independent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"independent <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span><span class="main">∈</span><span class="free">S</span> <span class="main">⟹</span> orthogonal <span class="free">v</span> <span class="bound">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"independent <span class="main">(</span>insert <span class="free">v</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms not_span_independent_insert orthogonal_in_span_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> dot_scaleR_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">=</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> dependent_explicit_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>real_vector<span class="main">,</span>field<span class="main">}</span><span class="main">)</span><span class="main">^</span><span class="tfree">'n</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dependent <span class="free">S</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">u</span> <span class="bound">v</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">u</span> <span class="bound">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms dependent_finite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dependent_explicit_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="free">w</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">,</span>real_vector<span class="main">}</span><span class="main">)</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dependent <span class="main">{</span><span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">}</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span> <span class="main">+</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"dependent <span class="var">?S</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> dependent_explicit_finite <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="free">w</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span> <span class="main">+</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span> <span class="main">+</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="skolem">i</span> <span class="keyword1">else</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="free">w</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">∈</span><span class="var">?S</span><span class="main">.</span> <span class="var">?u</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="free">w</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span> <span class="bound">x</span><span class="main">∈</span><span class="var">?S</span><span class="main">.</span> <span class="var">?u</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> dependent_explicit_finite <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span><span class="main">]</span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span> <span class="bound">x</span><span class="main">∈</span><span class="var">?S</span><span class="main">.</span> <span class="var">?u</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dependent <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Matrices"</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> zero_not_invertible<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>invertible <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> invertible_times_eq_zero matrix_vector_mult_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Based on matrix-vector-column in
  HOL/Multivariate\_Analysis/Euclidean\_Space.thy in Isabelle 2009-1:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> vector_matrix_row<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>comm_semiring_1<span class="main">)</span><span class="main">^</span><span class="tfree">'m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">v*</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="main">(</span><span class="free">A</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vector_matrix_mult_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff mult.commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> matrix_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_inv <span class="free">M</span> <span class="main">**</span> <span class="free">M</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">**</span> matrix_inv <span class="free">M</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">M</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> someI_ex <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">N</span><span class="main">.</span> <span class="free">M</span> <span class="main">**</span> <span class="bound">N</span> <span class="main">=</span> mat <span class="main">1</span> <span class="main">∧</span> <span class="bound">N</span> <span class="main">**</span> <span class="free">M</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> invertible_def <span class="keyword2"><span class="keyword">and</span></span> matrix_inv_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> matrix_inv_invertible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>matrix_inv <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">M</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> matrix_inv
  <span class="keyword1"><span class="command">unfolding</span></span> invertible_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"matrix_inv <span class="free">M</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> invertible_times_non_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="keyword1">*v</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">M</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> invertible_times_eq_zero <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> matrix_right_invertible_ker<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="main">(</span><span class="tfree">'m</span><span class="main">::</span>finite<span class="main">)</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">M'</span><span class="main">.</span> <span class="free">M</span> <span class="main">**</span> <span class="bound">M'</span> <span class="main">=</span> mat <span class="main">1</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">v*</span> <span class="free">M</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> left_invertible_transpose matrix_left_invertible_ker <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> left_invertible_iff_invertible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">N</span><span class="main">.</span> <span class="bound">N</span> <span class="main">**</span> <span class="free">M</span> <span class="main">=</span> mat <span class="main">1</span><span class="main">)</span> <span class="main">⟷</span> invertible <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invertible_def matrix_left_right_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> right_invertible_iff_invertible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">N</span><span class="main">.</span> <span class="free">M</span> <span class="main">**</span> <span class="bound">N</span> <span class="main">=</span> mat <span class="main">1</span><span class="main">)</span> <span class="main">⟷</span> invertible <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invertible_def matrix_left_right_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">symmatrix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">symmatrix</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> transpose <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> symmatrix_preserve<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M</span> <span class="free">N</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>comm_semiring_1<span class="main">)</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symmatrix <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"symmatrix <span class="main">(</span><span class="free">N</span> <span class="main">**</span> <span class="free">M</span> <span class="main">**</span> transpose <span class="free">N</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transpose <span class="main">(</span><span class="free">N</span> <span class="main">**</span> <span class="free">M</span> <span class="main">**</span> transpose <span class="free">N</span><span class="main">)</span> <span class="main">=</span> <span class="free">N</span> <span class="main">**</span> <span class="main">(</span><span class="free">M</span> <span class="main">**</span> transpose <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> transpose_transpose assms matrix_transpose_mul symmatrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_mul_assoc symmatrix_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> non_zero_mult_invertible_non_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">v*</span> <span class="free">M</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">M</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> times_invertible_eq_zero
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Action">
<div class="head">
<h1>Theory Action</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Right group actions
    Author:      Tim Makarios &lt;tjm1983 at gmail.com&gt;, 2012
    Maintainer:  Tim Makarios &lt;tjm1983 at gmail.com&gt;
*)</span>

<span class="comment1">(* After Isabelle 2012, this may be moved to ~~/src/HOL/Algebra *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Right group actions"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Action
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Algebra/Group.html">HOL-Algebra.Group</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> action <span class="main">=</span> group <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">act</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">&lt;o</span>"</span> 69<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> id_act <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="main">𝟭</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> act_act'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span> <span class="main">∧</span> <span class="free">h</span> <span class="main">∈</span> carrier <span class="free">G</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="free">g</span><span class="main">)</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="free">h</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="main">(</span><span class="free">g</span> <span class="main">⊗</span> <span class="free">h</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> act_act<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="free">g</span><span class="main">)</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="free">h</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="main">(</span><span class="free">g</span> <span class="main">⊗</span> <span class="free">h</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">∈</span> carrier <span class="free">G</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> act_act'
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="free">g</span><span class="main">)</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="free">h</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="main">(</span><span class="free">g</span> <span class="main">⊗</span> <span class="free">h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> act_act_inv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="free">g</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="keyword1">inv</span> <span class="free">g</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inv_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="free">g</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="keyword1">inv</span> <span class="free">g</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="free">g</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> act_act<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="free">g</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="keyword1">inv</span> <span class="free">g</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> act_inv_act <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="keyword1">inv</span> <span class="free">g</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="free">g</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> act_act_inv <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">g</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> act_inv_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="keyword1">inv</span> <span class="free">g</span> <span class="main">=</span> <span class="free">c</span> <span class="main">⟷</span> <span class="free">b</span> <span class="main">=</span> <span class="free">c</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="keyword1">inv</span> <span class="free">g</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="keyword1">inv</span> <span class="free">g</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="free">g</span> <span class="main">=</span> <span class="free">c</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">c</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">c</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="keyword1">inv</span> <span class="free">g</span> <span class="main">=</span> <span class="free">c</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="free">g</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="keyword1">inv</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1"><span class="free">&lt;o</span></span> <span class="keyword1">inv</span> <span class="free">g</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Projective">
<div class="head">
<h1>Theory Projective</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Projective geometry
    Author:      Tim Makarios &lt;tjm1983 at gmail.com&gt;, 2012
    Maintainer:  Tim Makarios &lt;tjm1983 at gmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Projective geometry"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Projective
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Linear_Algebra2.html">Linear_Algebra2</a>
  <a href="Euclid_Tarski.html">Euclid_Tarski</a>
  <a href="Action.html">Action</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Proportionality on non-zero vectors"</span></span>

<span class="keyword1"><span class="command">context</span></span> vector_space
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">proportionality</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">proportionality</span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">scale</span> <span class="bound">k</span> <span class="bound">y</span><span class="main">)</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">non_zero_vectors</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">non_zero_vectors</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> proportionality_refl_on<span class="main">:</span> <span class="quoted"><span class="quoted">"refl_on local.non_zero_vectors local.proportionality"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"local.proportionality <span class="main">⊆</span> local.non_zero_vectors <span class="main">×</span> local.non_zero_vectors"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> proportionality_def non_zero_vectors_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>local.non_zero_vectors<span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> local.proportionality"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> local.non_zero_vectors"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> non_zero_vectors_def <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">scale</span> <span class="main">1</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> local.proportionality"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> proportionality_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"refl_on local.non_zero_vectors local.proportionality"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> refl_on_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> proportionality_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"sym local.proportionality"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> local.proportionality"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">scale</span> <span class="bound">k</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> proportionality_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">scale</span> <span class="bound">k</span> <span class="skolem">y</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">scale</span> <span class="skolem">k</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="free">scale</span> <span class="skolem">k</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">scale</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">k</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> local.proportionality"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> proportionality_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sym local.proportionality"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sym_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> proportionality_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"trans local.proportionality"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> local.proportionality"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> local.proportionality"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">scale</span> <span class="bound">j</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">scale</span> <span class="bound">k</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> proportionality_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">scale</span> <span class="bound">j</span> <span class="skolem">y</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">scale</span> <span class="bound">k</span> <span class="skolem">z</span>›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">scale</span> <span class="skolem">j</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">scale</span> <span class="skolem">k</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">scale</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> local.proportionality"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> proportionality_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"trans local.proportionality"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> trans_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> proportionality_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"equiv local.non_zero_vectors local.proportionality"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> equiv_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>
      proportionality_refl_on
      proportionality_sym
      proportionality_trans<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">invertible_proportionality</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>real<span class="main">^</span><span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>finite<span class="main">)</span><span class="main">^</span><span class="tfree">'n</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span>real<span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span><span class="main">)</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">invertible_proportionality</span> <span class="main">≡</span>
  real_vector.proportionality <span class="main">∩</span> <span class="main">(</span>Collect invertible <span class="main">×</span> Collect invertible<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> invertible_proportionality_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"equiv <span class="main">(</span>Collect invertible <span class="main">::</span> <span class="main">(</span>real<span class="main">^</span><span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>finite<span class="main">)</span><span class="main">^</span><span class="tfree">'n</span><span class="main">)</span> set<span class="main">)</span>
  invertible_proportionality"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"equiv <span class="var">?invs</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> zero_not_invertible
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_vector.non_zero_vectors <span class="main">∩</span> <span class="var">?invs</span> <span class="main">=</span> <span class="var">?invs</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> real_vector.non_zero_vectors_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> equiv_restrict <span class="keyword2"><span class="keyword">and</span></span> real_vector.proportionality_equiv
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"equiv <span class="main">(</span>real_vector.non_zero_vectors <span class="main">∩</span> <span class="var">?invs</span><span class="main">)</span> invertible_proportionality"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> invertible_proportionality_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹real_vector.non_zero_vectors <span class="main">∩</span> <span class="var">?invs</span> <span class="main">=</span> <span class="var">?invs</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"equiv <span class="var">?invs</span> invertible_proportionality"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Points of the real projective plane"</span></span>

<span class="keyword1"><span class="command">typedef</span></span> proj2 <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real_vector.non_zero_vectors <span class="main">::</span> <span class="main">(</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> set<span class="main">)</span><span class="main">//</span>real_vector.proportionality"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>axis <span class="main">1</span> <span class="main">1</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">∈</span> real_vector.non_zero_vectors"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> real_vector.non_zero_vectors_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> axis_def vec_eq_iff<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"real"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"real_vector.proportionality <span class="main">``</span> <span class="main">{</span>axis <span class="main">1</span> <span class="main">1</span><span class="main">}</span> <span class="main">∈</span> <span class="main">(</span>real_vector.non_zero_vectors <span class="main">::</span> <span class="main">(</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> set<span class="main">)</span><span class="main">//</span>real_vector.proportionality"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> quotient_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proj2_rep</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> real<span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proj2_rep</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">ϵ</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> Rep_proj2 <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proj2_abs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">3</span> <span class="main">⇒</span> proj2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proj2_abs</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> Abs_proj2 <span class="main">(</span>real_vector.proportionality <span class="main">``</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_rep_in<span class="main">:</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">x</span> <span class="main">∈</span> Rep_proj2 <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> quotient_element_nonempty <span class="keyword2"><span class="keyword">and</span></span>
    real_vector.proportionality_equiv <span class="keyword2"><span class="keyword">and</span></span>
    Rep_proj2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> Rep_proj2 <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> someI_ex <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> Rep_proj2 <span class="free">x</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∈</span> Rep_proj2 <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_rep_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_rep_non_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span>
    Union_quotient <span class="main">[</span><span class="operator">of</span> <span class="quoted">real_vector.non_zero_vectors</span> <span class="quoted">real_vector.proportionality</span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> real_vector.proportionality_equiv
    <span class="keyword2"><span class="keyword">and</span></span> Rep_proj2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_in <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">x</span> <span class="main">∈</span> real_vector.non_zero_vectors"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> quotient_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> real_vector.non_zero_vectors_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_rep_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> real_vector.non_zero_vectors"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span> proj2_rep <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> real_vector.proportionality"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> real_vector.non_zero_vectors›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_vector.proportionality <span class="main">``</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span> <span class="main">∈</span> <span class="main">(</span>real_vector.non_zero_vectors <span class="main">::</span> <span class="main">(</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> set<span class="main">)</span><span class="main">//</span>real_vector.proportionality"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> quotient_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">with</span></span> Abs_proj2_inverse
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_proj2 <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> real_vector.proportionality <span class="main">``</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_abs_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> proj2_rep_in
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> real_vector.proportionality <span class="main">``</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span> proj2_rep <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> real_vector.proportionality"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_abs_rep<span class="main">:</span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span>proj2_rep <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> partition_Image_element
  <span class="main">[</span><span class="operator">of</span> <span class="quoted">real_vector.non_zero_vectors</span>
    <span class="quoted">real_vector.proportionality</span>
    <span class="quoted"><span class="quoted">"Rep_proj2 <span class="free">x</span>"</span></span>
    <span class="quoted"><span class="quoted">"proj2_rep <span class="free">x</span>"</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> real_vector.proportionality_equiv
    <span class="keyword2"><span class="keyword">and</span></span> Rep_proj2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_in <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_vector.proportionality <span class="main">``</span> <span class="main">{</span>proj2_rep <span class="free">x</span><span class="main">}</span> <span class="main">=</span> Rep_proj2 <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> Rep_proj2_inverse <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span>proj2_rep <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_abs_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_abs_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span><span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span><span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> real_vector.proportionality"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span> <span class="main">∈</span> real_vector.non_zero_vectors"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> real_vector.non_zero_vectors"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> real_vector.proportionality_def
      <span class="keyword2"><span class="keyword">and</span></span> real_vector.non_zero_vectors_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> eq_equiv_class_iff
  <span class="main">[</span><span class="operator">of</span> <span class="quoted">real_vector.non_zero_vectors</span>
    <span class="quoted">real_vector.proportionality</span>
    <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span>"</span></span>
    <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> real_vector.proportionality_equiv
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_vector.proportionality <span class="main">``</span> <span class="main">{</span><span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span><span class="main">}</span> <span class="main">=</span>
    real_vector.proportionality <span class="main">``</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span><span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_abs_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_abs_mult_rep<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span><span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> proj2_abs_mult <span class="keyword2"><span class="keyword">and</span></span> proj2_abs_rep <span class="keyword2"><span class="keyword">and</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_rep_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj proj2_rep"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_inverseI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">UNIV</span> <span class="quoted">proj2_abs</span> <span class="quoted">proj2_rep</span><span class="main"><span class="main">]</span></span> proj2_abs_rep<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_rep_abs2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> proj2_rep <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> proj2_rep_abs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span> proj2_rep <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> real_vector.proportionality"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> real_vector.non_zero_vectors_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> real_vector.proportionality_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">=</span> <span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> proj2_rep <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_abs_abs_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">v</span> <span class="main">=</span> proj2_abs <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c</span><span class="main">.</span> <span class="free">v</span> <span class="main">=</span> <span class="bound">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c</span><span class="main">.</span> <span class="free">v</span> <span class="main">=</span> <span class="bound">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="free">v</span> <span class="main">=</span> proj2_abs <span class="free">w</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> proj2_rep <span class="main">(</span>proj2_abs <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> proj2_rep_abs2 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> proj2_rep_abs2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c</span><span class="main">.</span> <span class="free">v</span> <span class="main">=</span> <span class="bound">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dependent_proj2_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">p</span> <span class="main">+</span> <span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">p</span> <span class="main">=</span> proj2_abs <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">p</span> <span class="main">+</span> <span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">p</span> <span class="main">+</span> <span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">p</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_abs_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">p</span> <span class="main">+</span> <span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_abs_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">q</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> proj2_abs <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_abs_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">p</span> <span class="main">=</span> proj2_abs <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_rep_dependent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">v</span> <span class="main">+</span> <span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?p</span> <span class="main">+</span> <span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_rep_non_zero<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?p</span> <span class="main">+</span> <span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?q</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?p</span> <span class="main">=</span> proj2_abs <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dependent_proj2_abs<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_rep_independent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"independent <span class="main">{</span>proj2_rep <span class="free">p</span><span class="main">,</span> proj2_rep <span class="free">q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="var">?p'</span><span class="main">,</span> <span class="var">?q'</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"dependent <span class="var">?S</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> proj2_rep_inj <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p'</span> <span class="main">≠</span> <span class="var">?q'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> dependent_explicit_2 <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?p'</span></span></span> <span class="var"><span class="quoted"><span class="var">?q'</span></span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹dependent <span class="var">?S</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?p'</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?q'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_equiv<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> proj2_rep_dependent <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Lines of the real projective plane"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proj2_Col</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>proj2<span class="main">,</span> proj2<span class="main">,</span> proj2<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proj2_Col</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span>
  <span class="main">(</span><span class="main">∃</span> <span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">+</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">+</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">0</span>
  <span class="main">∧</span> <span class="main">(</span><span class="bound">i</span><span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> <span class="bound">j</span><span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> <span class="bound">k</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_Col_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">p</span> <span class="main">+</span> <span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">q</span> <span class="main">+</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="main">(</span>proj2_abs <span class="free">p</span><span class="main">)</span> <span class="main">(</span>proj2_abs <span class="free">q</span><span class="main">)</span> <span class="main">(</span>proj2_abs <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="var">?pp</span> <span class="var">?pq</span> <span class="var">?pr</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_abs2
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="var">?pp</span> <span class="main">=</span> <span class="skolem">i'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rp</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_abs2
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="var">?pq</span> <span class="main">=</span> <span class="skolem">j'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">q</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rq</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_abs2
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="var">?pr</span> <span class="main">=</span> <span class="skolem">k'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">r</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rr</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">p</span> <span class="main">+</span> <span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">q</span> <span class="main">+</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="var">?pp</span> <span class="main">=</span> <span class="skolem">i'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">p</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="var">?pq</span> <span class="main">=</span> <span class="skolem">j'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span><span class="main">/</span><span class="skolem">i'</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?rp</span> <span class="main">+</span> <span class="main">(</span><span class="free">j</span><span class="main">/</span><span class="skolem">j'</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?rq</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span><span class="main">/</span><span class="skolem">k'</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?rr</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">/</span><span class="skolem">i'</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">j</span><span class="main">/</span><span class="skolem">j'</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">k</span><span class="main">/</span><span class="skolem">k'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">i</span><span class="main">/</span><span class="skolem">i'</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?rp</span> <span class="main">+</span> <span class="main">(</span><span class="free">j</span><span class="main">/</span><span class="skolem">j'</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?rq</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span><span class="main">/</span><span class="skolem">k'</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?rr</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="var">?pp</span> <span class="var">?pq</span> <span class="var">?pr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_Col_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">best</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_Col_permute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">a</span> <span class="free">c</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">b</span> <span class="free">a</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_Col <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b'</span> <span class="main">+</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_Col_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b'</span> <span class="main">+</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c'</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c'</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b'</span> <span class="main">+</span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">a</span> <span class="free">c</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">b</span> <span class="free">a</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_Col_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_Col_coincide<span class="main">:</span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">a</span> <span class="free">a</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">a</span> <span class="main">+</span> <span class="main">0</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">a</span> <span class="free">a</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_Col_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_Col_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">a</span> <span class="free">r</span> <span class="free">t</span> <span class="main">⟷</span>
  <span class="free">t</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="free">t</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="bound">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>proj2_rep <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>proj2_rep <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">t</span>"</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">a</span> <span class="free">r</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?r'</span> <span class="main">+</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?t'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> proj2_Col_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="free">t</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="bound">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="var">?r'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> proj2_rep_dependent
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?r'</span> <span class="main">+</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?t'</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="free">t</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="bound">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="var">?r'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> proj2_rep_dependent
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?r'</span> <span class="main">+</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?t'</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">r</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?r'</span> <span class="main">+</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?t'</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?r'</span> <span class="main">+</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?t'</span> <span class="main">-</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?t'</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?t'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?r'</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?t'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> proj2_abs_mult_rep <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">k</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span><span class="skolem">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?r'</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> proj2_abs_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?r'</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span><span class="main">(</span><span class="skolem">h</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="var">?r'</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_right_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="free">t</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="bound">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="var">?r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="free">t</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="bound">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="var">?r'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="free">t</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="bound">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="var">?r'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">a</span> <span class="free">r</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> proj2_Col_coincide <span class="keyword2"><span class="keyword">and</span></span> proj2_Col_permute
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">a</span> <span class="free">r</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="free">t</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="bound">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="var">?r'</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="var">?r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> proj2_rep_dependent <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">r</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="var">?r'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> proj2_rep_abs2 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="var">?r'</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t'</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="var">?r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t'</span> <span class="main">-</span> <span class="var">?t'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?r'</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?t'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_right_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?r'</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?t'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">h</span> <span class="bound">j</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?r'</span> <span class="main">+</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?t'</span> <span class="main">=</span> <span class="main">0</span>
        <span class="main">∧</span> <span class="main">(</span><span class="bound">h</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">standard</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">j</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?r'</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?t'</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?r'</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?t'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">*</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">a</span> <span class="free">r</span> <span class="free">t</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> proj2_Col_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proj2_Col_coeff</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> proj2 <span class="main">⇒</span> proj2 <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proj2_Col_coeff</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≡</span> <span class="main">ϵ</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="bound">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span> proj2_rep <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_Col_coeff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">a</span> <span class="free">r</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="main">(</span>proj2_Col_coeff <span class="free">a</span> <span class="free">r</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">a</span> <span class="main">+</span> proj2_rep <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_Col <span class="free">a</span> <span class="free">r</span> <span class="free">t</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">≠</span> <span class="free">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_Col_iff
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="free">t</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="bound">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">a</span> <span class="main">+</span> proj2_rep <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="main">(</span>proj2_Col_coeff <span class="free">a</span> <span class="free">r</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">a</span> <span class="main">+</span> proj2_rep <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_Col_coeff_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_Col_coeff_unique'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">a</span> <span class="main">≠</span> proj2_abs <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span><span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="free">a</span> <span class="main">≠</span> proj2_abs <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> dependent_proj2_abs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">r</span></span> <span class="main">_</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> proj2_rep_abs2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="free">r</span>"</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_abs2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="free">r</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">(</span>proj2_abs <span class="main">(</span><span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">(</span>proj2_abs <span class="main">(</span><span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="main">(</span><span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">*</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_right_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> <span class="free">i</span> <span class="main">-</span> <span class="skolem">l</span> <span class="main">*</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> vec_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="free">a</span> <span class="main">≠</span> proj2_abs <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> dependent_proj2_abs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="free">i</span> <span class="main">-</span> <span class="skolem">l</span> <span class="main">*</span> <span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">-</span> <span class="skolem">l</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="free">i</span> <span class="main">-</span> <span class="skolem">l</span> <span class="main">*</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">-</span> <span class="skolem">l</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">-</span> <span class="skolem">l</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">*</span> <span class="free">i</span> <span class="main">-</span> <span class="skolem">l</span> <span class="main">*</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_Col_coeff_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span><span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">a</span> <span class="main">+</span> proj2_rep <span class="free">r</span><span class="main">)</span>
  <span class="main">=</span> proj2_abs <span class="main">(</span><span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">a</span> <span class="main">+</span> proj2_rep <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_rep_non_zero<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?a'</span> <span class="main">≠</span> proj2_abs <span class="var">?r'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="main">(</span><span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="var">?r'</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="var">?r'</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_Col_coeff_unique'
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">datatype</span></span> proj2_line <span class="main">=</span> P2L <span class="quoted">proj2</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">L2P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2_line <span class="main">⇒</span> proj2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">L2P</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">of</span> P2L <span class="bound">p</span> <span class="main">⇒</span> <span class="bound">p</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L2P_P2L <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"L2P <span class="main">(</span>P2L <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> L2P_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> P2L_L2P <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"P2L <span class="main">(</span>L2P <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> L2P_inj <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"L2P <span class="free">l</span> <span class="main">=</span> L2P <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> P2L_L2P <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> P2L_to_L2P<span class="main">:</span> <span class="quoted"><span class="quoted">"P2L <span class="free">p</span> <span class="main">=</span> <span class="free">l</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> L2P <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"P2L <span class="free">p</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"L2P <span class="main">(</span>P2L <span class="free">p</span><span class="main">)</span> <span class="main">=</span> L2P <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> L2P <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> L2P <span class="free">l</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"P2L <span class="free">p</span> <span class="main">=</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proj2_line_abs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">3</span> <span class="main">⇒</span> proj2_line"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proj2_line_abs</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> P2L <span class="main">(</span>proj2_abs <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proj2_line_rep</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2_line <span class="main">⇒</span> real<span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proj2_line_rep</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≡</span> proj2_rep <span class="main">(</span>L2P <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_line_rep_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> proj2_line_rep <span class="main">(</span>proj2_line_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proj2_line_rep_def <span class="keyword2"><span class="keyword">and</span></span> proj2_line_abs_def
  <span class="keyword1"><span class="command">using</span></span> proj2_rep_abs2 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_line_abs_rep <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"proj2_line_abs <span class="main">(</span>proj2_line_rep <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proj2_line_abs_def <span class="keyword2"><span class="keyword">and</span></span> proj2_line_rep_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_line_rep_non_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"proj2_line_rep <span class="free">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proj2_line_rep_def
  <span class="keyword1"><span class="command">using</span></span> proj2_rep_non_zero
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_line_rep_dependent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_line_rep <span class="free">l</span> <span class="main">+</span> <span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_line_rep <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> proj2_rep_dependent <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="quoted">"L2P <span class="free">l</span>"</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quoted"><span class="quoted">"L2P <span class="free">m</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> proj2_line_rep_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_line_abs_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_line_abs <span class="main">(</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> proj2_line_abs <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proj2_line_abs_def
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> proj2_abs_mult<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_line_abs_abs_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_line_abs <span class="free">v</span> <span class="main">=</span> proj2_line_abs <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="free">v</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_line_abs_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_abs_mult<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proj2_incident</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> proj2_line <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proj2_incident</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≡</span> <span class="main">(</span>proj2_rep <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span>proj2_line_rep <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_points_define_line<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">l</span><span class="main">.</span> proj2_incident <span class="free">p</span> <span class="bound">l</span> <span class="main">∧</span> proj2_incident <span class="free">q</span> <span class="bound">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="var">?p'</span><span class="main">,</span> <span class="var">?q'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> card_suc_ge_insert <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?p'</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="var">?q'</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?B</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> dim_le_card' <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim <span class="var">?B</span> <span class="main">&lt;</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> lowdim_subset_hyperplane <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"span <span class="var">?B</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">l'</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_line_abs <span class="skolem">l'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_line_rep <span class="var">?l</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> proj2_line_rep_abs <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l''</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">l'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p'</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q'</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> span_superset <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹span <span class="var">?B</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">l'</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">∙</span> <span class="var">?p'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">∙</span> <span class="var">?q'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p'</span> <span class="main">∙</span> <span class="skolem">l'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q'</span> <span class="main">∙</span> <span class="skolem">l'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> dot_scaleR_mult<span class="main">(</span>2<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">l'</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?l''</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">l'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="var">?l</span> <span class="main">∧</span> proj2_incident <span class="free">q</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_incident_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">l</span><span class="main">.</span> proj2_incident <span class="free">p</span> <span class="bound">l</span> <span class="main">∧</span> proj2_incident <span class="free">q</span> <span class="bound">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proj2_line_through</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> proj2 <span class="main">⇒</span> proj2_line"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proj2_line_through</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> <span class="main">ϵ</span> <span class="bound">l</span><span class="main">.</span> proj2_incident <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">l</span> <span class="main">∧</span> proj2_incident <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">l</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_line_through_incident<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="main">(</span>proj2_line_through <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="main">(</span>proj2_line_through <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proj2_line_through_def
  <span class="keyword1"><span class="command">using</span></span> proj2_points_define_line
    <span class="keyword2"><span class="keyword">and</span></span> someI_ex <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> proj2_incident <span class="free">p</span> <span class="bound">l</span> <span class="main">∧</span> proj2_incident <span class="free">q</span> <span class="bound">l</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_line_through_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> proj2_line_through <span class="free">p</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_line_rep <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_line_through <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_line_rep <span class="var">?m</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="var">?p'</span><span class="main">,</span> <span class="var">?q'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="var">?m'</span> <span class="var">?A</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> proj2_line_through_incident
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="var">?m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> ortho<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span><span class="main">∈</span><span class="var">?A</span> <span class="main">⟹</span> orthogonal <span class="var">?m'</span> <span class="bound">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span><span class="main">∈</span><span class="var">?A</span> <span class="main">⟹</span> orthogonal <span class="var">?l'</span> <span class="bound">w</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_incident_def <span class="keyword2"><span class="keyword">and</span></span> orthogonal_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_iff inner_commute insert_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> proj2_rep_independent <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"independent <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> proj2_line_rep_non_zero <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> orthogonal_independent <span class="quoted"><span class="quoted">‹independent <span class="var">?A</span>›</span></span> ortho
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"independent <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> proj2_rep_inj <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p'</span> <span class="main">≠</span> <span class="var">?q'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?A</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m'</span> <span class="main">∉</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ortho<span class="main">(</span>1<span class="main">)</span> orthogonal_self proj2_line_rep_non_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?B</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> independent_is_basis <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹independent <span class="var">?B</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_basis <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> basis_expand <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l'</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">v</span><span class="main">∈</span><span class="var">?B</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?l'</span> <span class="main">-</span> <span class="skolem">c</span> <span class="var">?m'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?m'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?l'</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">v</span><span class="main">∈</span><span class="var">?B</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">v</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?m'</span> <span class="main">∉</span> <span class="var">?A</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l''</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">v</span><span class="main">∈</span><span class="var">?A</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> orthogonal_sum <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span><span class="main">]</span> ortho
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orthogonal <span class="var">?l'</span> <span class="var">?l''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"orthogonal <span class="var">?m'</span> <span class="var">?l''</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_equiv<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹orthogonal <span class="var">?m'</span> <span class="var">?l''</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orthogonal <span class="main">(</span><span class="skolem">c</span> <span class="var">?m'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?m'</span><span class="main">)</span> <span class="var">?l''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> orthogonal_clauses<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹orthogonal <span class="var">?l'</span> <span class="var">?l''</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orthogonal <span class="var">?l''</span> <span class="var">?l''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> orthogonal_clauses<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> orthogonal_self_eq_0 <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?l''</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l''</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> proj2_line_rep_dependent <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">c</span> <span class="var">?m'</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_incident_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">∨</span> <span class="free">l</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">∨</span> <span class="free">l</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_line_through_unique
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> proj2_line_through <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="free">m</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> proj2_line_through <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_line_through_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">∨</span> <span class="free">l</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_lines_define_point<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span><span class="main">.</span> proj2_incident <span class="bound">p</span> <span class="free">l</span> <span class="main">∧</span> proj2_incident <span class="bound">p</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"L2P <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"L2P <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> proj2_points_define_line <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?l'</span></span></span> <span class="var"><span class="quoted"><span class="var">?m'</span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?l'</span> <span class="skolem">p'</span> <span class="main">∧</span> proj2_incident <span class="var">?m'</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>L2P <span class="skolem">p'</span><span class="main">)</span> <span class="free">l</span> <span class="main">∧</span> proj2_incident <span class="main">(</span>L2P <span class="skolem">p'</span><span class="main">)</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_incident_def <span class="keyword2"><span class="keyword">and</span></span> proj2_line_rep_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span><span class="main">.</span> proj2_incident <span class="bound">p</span> <span class="free">l</span> <span class="main">∧</span> proj2_incident <span class="bound">p</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proj2_intersection</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2_line <span class="main">⇒</span> proj2_line <span class="main">⇒</span> proj2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proj2_intersection</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≡</span> L2P <span class="main">(</span>proj2_line_through <span class="main">(</span>L2P <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">(</span>L2P <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_incident_switch<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>L2P <span class="free">l</span><span class="main">)</span> <span class="main">(</span>P2L <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> proj2_incident_def <span class="keyword2"><span class="keyword">and</span></span> proj2_line_rep_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_intersection_incident<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>proj2_intersection <span class="free">l</span> <span class="free">m</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>proj2_intersection <span class="free">l</span> <span class="free">m</span><span class="main">)</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> proj2_line_through_incident<span class="main">(</span>1<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"L2P <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"L2P <span class="free">m</span>"</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_line_through_incident<span class="main">(</span>2<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"L2P <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"L2P <span class="free">l</span>"</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_switch <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"L2P <span class="free">l</span>"</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_switch <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"L2P <span class="free">m</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> proj2_intersection_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_intersection_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≠</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> proj2_intersection <span class="free">l</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">≠</span> <span class="free">m</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"L2P <span class="free">l</span> <span class="main">≠</span> L2P <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">m</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_switch
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>L2P <span class="free">l</span><span class="main">)</span> <span class="main">(</span>P2L <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>L2P <span class="free">m</span><span class="main">)</span> <span class="main">(</span>P2L <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹L2P <span class="free">l</span> <span class="main">≠</span> L2P <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_line_through_unique
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"P2L <span class="free">p</span> <span class="main">=</span> proj2_line_through <span class="main">(</span>L2P <span class="free">l</span><span class="main">)</span> <span class="main">(</span>L2P <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> proj2_intersection <span class="free">l</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_intersection_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P2L_to_L2P<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_not_self_incident<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>proj2_incident <span class="free">p</span> <span class="main">(</span>P2L <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proj2_incident_def <span class="keyword2"><span class="keyword">and</span></span> proj2_line_rep_def
  <span class="keyword1"><span class="command">using</span></span> proj2_rep_non_zero <span class="keyword2"><span class="keyword">and</span></span> inner_eq_zero_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_another_point_on_line<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">≠</span> <span class="free">p</span> <span class="main">∧</span> proj2_incident <span class="bound">q</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"P2L <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_intersection <span class="free">l</span> <span class="var">?m</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> proj2_intersection_incident
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?q</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?q</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?q</span> <span class="var">?m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_not_self_incident <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?q</span> <span class="free">l</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">≠</span> <span class="free">p</span> <span class="main">∧</span> proj2_incident <span class="bound">q</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_another_line_through_point<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≠</span> <span class="free">l</span> <span class="main">∧</span> proj2_incident <span class="free">p</span> <span class="bound">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> proj2_another_point_on_line
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> L2P <span class="free">l</span> <span class="main">∧</span> proj2_incident <span class="skolem">q</span> <span class="main">(</span>P2L <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> proj2_incident_switch <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="quoted">"P2L <span class="free">p</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"P2L <span class="skolem">q</span> <span class="main">≠</span> <span class="free">l</span> <span class="main">∧</span> proj2_incident <span class="free">p</span> <span class="main">(</span>P2L <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≠</span> <span class="free">l</span> <span class="main">∧</span> proj2_incident <span class="free">p</span> <span class="bound">m</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_incident_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">(</span>proj2_line_abs <span class="free">w</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">v</span> <span class="main">∙</span> <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_abs2
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_line_rep_abs
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_line_rep <span class="main">(</span>proj2_line_abs <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">(</span>proj2_line_abs <span class="free">w</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">v</span> <span class="main">∙</span> <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_incident_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dot_scaleR_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_incident_left_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟷</span> <span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>proj2_line_rep <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_line_rep <span class="free">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_line_rep_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_abs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="quoted">"proj2_line_rep <span class="free">l</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟷</span> <span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>proj2_line_rep <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_incident_right_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="main">(</span>proj2_line_abs <span class="free">v</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span> <span class="main">∙</span> <span class="free">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_rep_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_abs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span>"</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="main">(</span>proj2_line_abs <span class="free">v</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span> <span class="main">∙</span> <span class="free">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proj2_set_Col</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proj2_set_Col</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">∃</span> <span class="bound">l</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">p</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> proj2_incident <span class="bound">p</span> <span class="bound">l</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_subset_Col<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">T</span> <span class="main">⊆</span> <span class="free">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="free">S</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_set_Col_def<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proj2_no_3_Col</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proj2_no_3_Col</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> card <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="numeral">4</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">p</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="main">¬</span> proj2_set_Col <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_Col_iff_not_invertible<span class="main">:</span>
  <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>
  <span class="main">⟷</span> <span class="main">¬</span> invertible <span class="main">(</span>vector <span class="main">[</span>proj2_rep <span class="free">p</span><span class="main">,</span> proj2_rep <span class="free">q</span><span class="main">,</span> proj2_rep <span class="free">r</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟷</span> <span class="main">¬</span> invertible <span class="main">(</span>vector <span class="main">[</span><span class="var">?u</span><span class="main">,</span> <span class="var">?v</span><span class="main">,</span> <span class="var">?w</span><span class="main">]</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="var">?u</span><span class="main">,</span><span class="var">?v</span><span class="main">,</span><span class="var">?w</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span> <span class="keyword1">v*</span> <span class="var">?M</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">k</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?v</span> <span class="main">+</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> proj2_Col_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">k</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> vector_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?v</span> <span class="main">+</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?w</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="keyword1">v*</span> <span class="var">?M</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> vector_def <span class="keyword2"><span class="keyword">and</span></span> vector_matrix_mult_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_3 vec_eq_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span> <span class="keyword1">v*</span> <span class="var">?M</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span> <span class="keyword1">v*</span> <span class="var">?M</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">v*</span> <span class="var">?M</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">$</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?j</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">$</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">$</span><span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="keyword1">v*</span> <span class="var">?M</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?v</span> <span class="main">+</span> <span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> vector_matrix_mult_def <span class="keyword2"><span class="keyword">and</span></span> sum_3 <span class="keyword2"><span class="keyword">and</span></span> vector_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> proj2_Col_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> matrix_right_invertible_ker <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">M'</span><span class="main">.</span> <span class="var">?M</span> <span class="main">**</span> <span class="bound">M'</span> <span class="main">=</span> mat <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> matrix_left_right_inverse
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">¬</span> invertible <span class="var">?M</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> invertible_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="main">⟷</span> <span class="main">¬</span> invertible <span class="var">?M</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> not_invertible_iff_proj2_set_Col<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> invertible <span class="main">(</span>vector <span class="main">[</span>proj2_rep <span class="free">p</span><span class="main">,</span> proj2_rep <span class="free">q</span><span class="main">,</span> proj2_rep <span class="free">r</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>
  <span class="main">⟷</span> proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> invertible <span class="var">?M</span> <span class="main">⟷</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> left_invertible_iff_invertible
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> invertible <span class="var">?M</span>  <span class="main">⟷</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">M'</span><span class="main">.</span> <span class="bound">M'</span> <span class="main">**</span> <span class="var">?M</span> <span class="main">=</span> mat <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> matrix_left_invertible_ker <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="var">?M</span> <span class="keyword1">*v</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">l</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">s</span><span class="main">∈</span><span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span><span class="main">.</span> proj2_incident <span class="bound">s</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="var">?M</span> <span class="keyword1">*v</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="keyword1">*v</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_line_abs <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M</span> <span class="keyword1">*v</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span><span class="main">∈</span><span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span><span class="main">.</span> proj2_rep <span class="bound">s</span> <span class="main">∙</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> vector_def
        <span class="keyword2"><span class="keyword">and</span></span> matrix_vector_mult_def
        <span class="keyword2"><span class="keyword">and</span></span> inner_vec_def
        <span class="keyword2"><span class="keyword">and</span></span> sum_3
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_right_abs
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span><span class="main">∈</span><span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span><span class="main">.</span> proj2_incident <span class="bound">s</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">l</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">s</span><span class="main">∈</span><span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span><span class="main">.</span> proj2_incident <span class="bound">s</span> <span class="bound">l</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">l</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">s</span><span class="main">∈</span><span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span><span class="main">.</span> proj2_incident <span class="bound">s</span> <span class="bound">l</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span><span class="main">∈</span><span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span><span class="main">.</span> proj2_incident <span class="bound">s</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_line_rep <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_line_rep_non_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">s</span><span class="main">∈</span><span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span><span class="main">.</span> proj2_incident <span class="bound">s</span> <span class="skolem">l</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="keyword1">*v</span> <span class="var">?y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> vector_def
          <span class="keyword2"><span class="keyword">and</span></span> matrix_vector_mult_def
          <span class="keyword2"><span class="keyword">and</span></span> inner_vec_def
          <span class="keyword2"><span class="keyword">and</span></span> sum_3
          <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="var">?M</span> <span class="keyword1">*v</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> invertible <span class="var">?M</span> <span class="main">⟷</span> proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_set_Col_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_Col_iff_set_Col<span class="main">:</span>
  <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="main">⟷</span> proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_Col_iff_not_invertible
    not_invertible_iff_proj2_set_Col<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_incident_Col<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">r</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">r</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_set_Col_def<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> proj2_Col_iff_set_Col<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_incident_iff_Col<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">r</span> <span class="free">l</span> <span class="main">⟷</span> proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">r</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="free">l</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_incident_Col<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_Col_iff_set_Col<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span><span class="main">∈</span><span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span><span class="main">.</span> proj2_incident <span class="bound">s</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_set_Col_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">r</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="skolem">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="skolem">m</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_unique
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">r</span> <span class="skolem">m</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">r</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_incident_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">r</span> <span class="free">l</span>
  <span class="main">⟷</span> <span class="free">r</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">r</span> <span class="free">l</span> <span class="main">⟷</span> proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_incident_iff_Col<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_Col_iff
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">r</span> <span class="free">l</span>
    <span class="main">⟷</span> <span class="free">r</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> not_proj2_set_Col_iff_span<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_set_Col <span class="free">S</span> <span class="main">⟷</span> span <span class="main">(</span>proj2_rep <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">S</span> <span class="main">=</span> <span class="numeral">3</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> choose_3 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">r</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="skolem">r</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="var">?u</span><span class="main">,</span> <span class="var">?v</span><span class="main">,</span> <span class="var">?w</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">r</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> not_invertible_iff_proj2_set_Col <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_set_Col <span class="free">S</span> <span class="main">⟷</span> invertible <span class="var">?M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> left_invertible_iff_invertible
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">N</span><span class="main">.</span> <span class="bound">N</span> <span class="main">**</span> <span class="var">?M</span> <span class="main">=</span> mat <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> matrix_left_invertible_span_rows
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> span <span class="main">(</span>rows <span class="var">?M</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_set_Col <span class="free">S</span> <span class="main">⟷</span> span <span class="main">(</span>rows <span class="var">?M</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rows <span class="var">?M</span> <span class="main">=</span> <span class="main">{</span><span class="var">?u</span><span class="main">,</span> <span class="var">?v</span><span class="main">,</span> <span class="var">?w</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> rows <span class="var">?M</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="main">::</span> <span class="quoted"><span class="numeral">3</span></span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="var">?M</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> rows_def <span class="keyword2"><span class="keyword">and</span></span> row_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_lambda_beta vec_lambda_eta<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> exhaust_3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="var">?u</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?v</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?w</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> vector_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="var">?u</span><span class="main">,</span> <span class="var">?v</span><span class="main">,</span> <span class="var">?w</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"rows <span class="var">?M</span> <span class="main">⊆</span> <span class="main">{</span><span class="var">?u</span><span class="main">,</span> <span class="var">?v</span><span class="main">,</span> <span class="var">?w</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="var">?u</span><span class="main">,</span> <span class="var">?v</span><span class="main">,</span> <span class="var">?w</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="var">?u</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?v</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="var">?M</span> <span class="main">$</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?M</span> <span class="main">$</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?M</span> <span class="main">$</span> <span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> vector_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> rows <span class="var">?M</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> rows_def row_def vec_lambda_eta
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="var">?u</span><span class="main">,</span> <span class="var">?v</span><span class="main">,</span> <span class="var">?w</span><span class="main">}</span> <span class="main">⊆</span> rows <span class="var">?M</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">r</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rows <span class="var">?M</span> <span class="main">=</span> proj2_rep <span class="main">`</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> image_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> proj2_set_Col <span class="free">S</span> <span class="main">⟷</span> span <span class="main">(</span>rows <span class="var">?M</span><span class="main">)</span> <span class="main">=</span> UNIV›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_set_Col <span class="free">S</span> <span class="main">⟷</span> span <span class="main">(</span>proj2_rep <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_no_3_Col_span<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_no_3_Col <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>proj2_rep <span class="main">`</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_no_3_Col <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> proj2_no_3_Col_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">S</span> <span class="main">=</span> <span class="numeral">4</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> card_gt_0_diff_singleton <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_no_3_Col <span class="free">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> <span class="free">S</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_set_Col <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_no_3_Col_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">3</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> not_proj2_set_Col_iff_span
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>proj2_rep <span class="main">`</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fourth_proj2_no_3_Col<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">s</span><span class="main">.</span> proj2_no_3_Col <span class="main">{</span><span class="bound">s</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_Col_coincide <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_Col_coincide <span class="keyword2"><span class="keyword">and</span></span> proj2_Col_permute
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∉</span> <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">.</span> proj2_rep <span class="bound">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">.</span> proj2_rep <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="var">?s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">.</span> proj2_rep <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">.</span> proj2_rep <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="var">?s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">.</span> proj2_rep <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="var">?s</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">.</span> proj2_rep <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> proj2_rep_abs2
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="var">?s</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">.</span> proj2_rep <span class="bound">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="var">?s</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">.</span> proj2_rep <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">.</span> proj2_rep <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="var">?s</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">.</span> proj2_rep <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="var">?s</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">t</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">t</span> <span class="main">=</span> <span class="var">?s</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span> <span class="keyword1">else</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?c</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">t</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">t</span> <span class="main">=</span> <span class="var">?s</span> <span class="keyword1">then</span> <span class="skolem">j</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span>"</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="var">?s</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∉</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∈</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∉</span> <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="free">r</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">r</span> <span class="main">+</span> <span class="var">?c</span> <span class="free">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> <span class="var">?c</span> <span class="free">q</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">q</span>
      <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">.</span> <span class="var">?c</span> <span class="bound">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="bound">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.insert <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">t</span><span class="main">.</span> <span class="var">?c</span> <span class="bound">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="bound">t</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?s</span> <span class="main">∈</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?c</span> <span class="var">?s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="var">?s</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="var">?s</span><span class="main">}</span><span class="main">.</span> <span class="var">?c</span> <span class="bound">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="bound">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>
        sum.remove <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">t</span><span class="main">.</span> <span class="var">?c</span> <span class="bound">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="bound">t</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span>
      <span class="main">=</span> <span class="main">-</span><span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="var">?s</span> <span class="main">+</span> <span class="main">(</span>proj2_rep <span class="var">?s</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="var">?s</span><span class="main">}</span><span class="main">.</span> proj2_rep <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?s</span> <span class="main">∈</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="var">?s</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">.</span> proj2_rep <span class="bound">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>
        sum.remove <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">t</span><span class="main">.</span> proj2_rep <span class="bound">t</span>"</span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">.</span> proj2_rep <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="var">?s</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="free">r</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">r</span> <span class="main">+</span> <span class="var">?c</span> <span class="free">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> <span class="var">?c</span> <span class="free">q</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?c</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?c</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_Col_def<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">3</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?S</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_Col_permute
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_Col <span class="free">r</span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_set_Col <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> proj2_Col_iff_set_Col <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">u</span><span class="main">∈</span><span class="var">?S</span><span class="main">.</span> <span class="main">¬</span> proj2_set_Col <span class="main">(</span><span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="bound">u</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹card <span class="var">?S</span> <span class="main">=</span> <span class="numeral">4</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_set_Col <span class="main">(</span><span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="var">?s</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?s</span> <span class="main">∉</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> proj2_set_Col <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_set_Col <span class="main">(</span><span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="var">?s</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"insert <span class="var">?s</span> <span class="main">(</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?s</span> <span class="main">∉</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∉</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">.</span> <span class="var">?d</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="var">?s</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="var">?S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">.</span> proj2_rep <span class="bound">t</span><span class="main">)</span>
        <span class="main">=</span> proj2_rep <span class="skolem">u</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">.</span> proj2_rep <span class="bound">t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.remove<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">.</span> proj2_rep <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="var">?s</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="skolem">u</span>
        <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="var">?s</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">.</span> proj2_rep <span class="bound">t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">.</span> <span class="var">?d</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="var">?s</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">.</span> <span class="var">?d</span> <span class="bound">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="bound">t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_negf<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span>›</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?s</span> <span class="main">∉</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span>insert <span class="var">?s</span> <span class="main">(</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="var">?d</span> <span class="bound">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="bound">t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.insert<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹insert <span class="var">?s</span> <span class="main">(</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="var">?S</span><span class="main">-</span><span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">.</span> <span class="var">?d</span> <span class="bound">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">t</span><span class="main">∈</span><span class="var">?S</span><span class="main">-</span><span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">.</span> <span class="var">?d</span> <span class="bound">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span><span class="main">∈</span><span class="var">?S</span><span class="main">-</span><span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">.</span> <span class="var">?d</span> <span class="bound">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="bound">t</span> <span class="main">∈</span> span <span class="main">(</span>proj2_rep <span class="main">`</span> <span class="main">(</span><span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> span_clauses<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="skolem">u</span> <span class="main">∈</span> span <span class="main">(</span>proj2_rep <span class="main">`</span> <span class="main">(</span><span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> span_sum<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">.</span> proj2_rep <span class="bound">t</span> <span class="main">∈</span> span <span class="main">(</span>proj2_rep <span class="main">`</span> <span class="main">(</span><span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="skolem">t</span> <span class="main">∈</span> span <span class="main">(</span>proj2_rep <span class="main">`</span> <span class="main">(</span><span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="skolem">u</span> <span class="main">∈</span> span <span class="main">(</span>image proj2_rep <span class="main">(</span><span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="skolem">t</span> <span class="main">∈</span> span <span class="main">(</span>proj2_rep <span class="main">`</span> <span class="main">(</span><span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">u</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="skolem">t</span> <span class="main">∈</span> proj2_rep <span class="main">`</span> <span class="main">(</span><span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> span_superset <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">`</span> <span class="main">(</span><span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span>"</span></span><span class="main">]</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="skolem">t</span> <span class="main">∈</span> span <span class="main">(</span>proj2_rep <span class="main">`</span> <span class="main">(</span><span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">`</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">⊆</span> span <span class="main">(</span>proj2_rep <span class="main">`</span> <span class="main">(</span><span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> image_subset_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span>
        <span class="quoted"><span class="quoted">"span <span class="main">(</span>proj2_rep <span class="main">`</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> span <span class="main">(</span>span <span class="main">(</span>proj2_rep <span class="main">`</span> <span class="main">(</span><span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> span_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>proj2_rep <span class="main">`</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> span <span class="main">(</span>proj2_rep <span class="main">`</span> <span class="main">(</span><span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> span_span<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> proj2_set_Col <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">3</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> not_proj2_set_Col_iff_span
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>proj2_rep <span class="main">`</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>proj2_rep <span class="main">`</span> <span class="main">(</span><span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span><span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">3</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> not_proj2_set_Col_iff_span
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_set_Col <span class="main">(</span><span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹card <span class="var">?S</span> <span class="main">=</span> <span class="numeral">4</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_no_3_Col <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_no_3_Col_def<span class="main">)</span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">s</span><span class="main">.</span> proj2_no_3_Col <span class="main">{</span><span class="bound">s</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_set_Col_expand<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="free">S</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> proj2_incident <span class="bound">t</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> proj2_set_Col_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Collineations of the real projective plane"</span></span>

<span class="keyword1"><span class="command">typedef</span></span> cltn2 <span class="main">=</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>Collect invertible <span class="main">::</span> <span class="main">(</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> set<span class="main">)</span><span class="main">//</span>invertible_proportionality"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> matrix_id_invertible <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat <span class="main">1</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">∈</span> Collect invertible"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"invertible_proportionality <span class="main">``</span> <span class="main">{</span>mat <span class="main">1</span><span class="main">}</span> <span class="main">∈</span>
    <span class="main">(</span>Collect invertible <span class="main">::</span> <span class="main">(</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> set<span class="main">)</span><span class="main">//</span>invertible_proportionality"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> quotient_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cltn2_rep</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cltn2 <span class="main">⇒</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cltn2_rep</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="main">ϵ</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">∈</span> Rep_cltn2 <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cltn2_abs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span> <span class="main">⇒</span> cltn2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cltn2_abs</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> Abs_cltn2 <span class="main">(</span>invertible_proportionality <span class="main">``</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cltn2_independent</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cltn2 set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cltn2_independent</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> independent <span class="main">{</span>cltn2_rep <span class="bound">A</span> <span class="main">|</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">apply_cltn2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> cltn2 <span class="main">⇒</span> proj2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">apply_cltn2</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> proj2_abs <span class="main">(</span>proj2_rep <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">v*</span> cltn2_rep <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_rep_in<span class="main">:</span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="free">B</span> <span class="main">∈</span> Rep_cltn2 <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> quotient_element_nonempty <span class="keyword2"><span class="keyword">and</span></span>
    invertible_proportionality_equiv <span class="keyword2"><span class="keyword">and</span></span>
    Rep_cltn2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">C</span><span class="main">.</span> <span class="bound">C</span> <span class="main">∈</span> Rep_cltn2 <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> someI_ex <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">C</span><span class="main">.</span> <span class="bound">C</span> <span class="main">∈</span> Rep_cltn2 <span class="free">B</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">∈</span> Rep_cltn2 <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cltn2_rep_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_rep_invertible<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>cltn2_rep <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span>
    Union_quotient <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Collect invertible"</span></span> <span class="quoted">invertible_proportionality</span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> invertible_proportionality_equiv
    <span class="keyword2"><span class="keyword">and</span></span> Rep_cltn2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> cltn2_rep_in <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="free">A</span> <span class="main">∈</span> Collect invertible"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> quotient_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>cltn2_rep <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> invertible_proportionality_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_rep_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">,</span> cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> invertible_proportionality"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">A</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible_proportionality <span class="main">``</span> <span class="main">{</span><span class="free">A</span><span class="main">}</span> <span class="main">∈</span> <span class="main">(</span>Collect invertible <span class="main">::</span> <span class="main">(</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> set<span class="main">)</span><span class="main">//</span>invertible_proportionality"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> quotient_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">with</span></span> Abs_cltn2_inverse
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_cltn2 <span class="main">(</span>cltn2_abs <span class="free">A</span><span class="main">)</span> <span class="main">=</span> invertible_proportionality <span class="main">``</span> <span class="main">{</span><span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cltn2_abs_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> cltn2_rep_in
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> invertible_proportionality <span class="main">``</span> <span class="main">{</span><span class="free">A</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">,</span> cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> invertible_proportionality"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_rep_abs2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">A</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cltn2_rep_abs
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">,</span> cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> invertible_proportionality"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> invertible_proportionality_def <span class="keyword2"><span class="keyword">and</span></span> real_vector.proportionality_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">A</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> zero_not_invertible <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">c</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">=</span> <span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">A</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">A</span> <span class="main">=</span> <span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_abs_rep<span class="main">:</span> <span class="quoted"><span class="quoted">"cltn2_abs <span class="main">(</span>cltn2_rep <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> partition_Image_element
  <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Collect invertible"</span></span>
    <span class="quoted">invertible_proportionality</span>
    <span class="quoted"><span class="quoted">"Rep_cltn2 <span class="free">A</span>"</span></span>
    <span class="quoted"><span class="quoted">"cltn2_rep <span class="free">A</span>"</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> invertible_proportionality_equiv
    <span class="keyword2"><span class="keyword">and</span></span> Rep_cltn2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> cltn2_rep_in <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible_proportionality <span class="main">``</span> <span class="main">{</span>cltn2_rep <span class="free">A</span><span class="main">}</span> <span class="main">=</span> Rep_cltn2 <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> Rep_cltn2_inverse
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cltn2_abs <span class="main">(</span>cltn2_rep <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cltn2_abs_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_abs_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cltn2_abs <span class="main">(</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> cltn2_abs <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">A</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> scalar_invertible
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">A</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">A</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> invertible_proportionality"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> invertible_proportionality_def
      <span class="keyword2"><span class="keyword">and</span></span> real_vector.proportionality_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_not_invertible<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> eq_equiv_class_iff
  <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Collect invertible"</span></span> <span class="quoted">invertible_proportionality</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> invertible_proportionality_equiv
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">A</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="main">(</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">A</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible_proportionality <span class="main">``</span> <span class="main">{</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">A</span><span class="main">}</span>
    <span class="main">=</span> invertible_proportionality <span class="main">``</span> <span class="main">{</span><span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cltn2_abs <span class="main">(</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> cltn2_abs <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cltn2_abs_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_abs_mult_rep<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cltn2_abs <span class="main">(</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cltn2_rep <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cltn2_rep_invertible <span class="keyword2"><span class="keyword">and</span></span> cltn2_abs_mult <span class="keyword2"><span class="keyword">and</span></span> cltn2_abs_rep <span class="keyword2"><span class="keyword">and</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="free">x</span><span class="main">)</span> <span class="main">(</span>cltn2_abs <span class="free">A</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="free">x</span> <span class="keyword1">v*</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> proj2_rep_abs2 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">(</span>proj2_abs <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> cltn2_rep_abs2 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">A</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="main">(</span>proj2_abs <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">A</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">(</span>proj2_abs <span class="free">x</span><span class="main">)</span> <span class="keyword1">v*</span> cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="skolem">c</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">v*</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_vector_matrix_assoc vector_scaleR_matrix_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="free">x</span><span class="main">)</span> <span class="main">(</span>cltn2_abs <span class="free">A</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="free">x</span> <span class="keyword1">v*</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> apply_cltn2_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_left_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="free">C</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="free">v</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cltn2_abs <span class="main">(</span>cltn2_rep <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cltn2_abs_rep<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cltn2_rep_invertible <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_abs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="free">C</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="free">C</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="free">v</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_right_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> <span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> proj2_rep_non_zero <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">M</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_abs
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span>
    <span class="main">=</span> proj2_abs <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> non_zero_mult_rep_non_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cltn2_rep_invertible <span class="keyword2"><span class="keyword">and</span></span> times_invertible_eq_zero
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rep_mult_rep_non_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> proj2_rep_non_zero
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> non_zero_mult_rep_non_zero<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cltn2_image</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 set <span class="main">⇒</span> cltn2 <span class="main">⇒</span> proj2 set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cltn2_image</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="main">{</span>apply_cltn2 <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">|</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"As a group"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cltn2_id</span> <span class="main">::</span> <span class="quoted">cltn2</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cltn2_id</span> <span class="main">≡</span> cltn2_abs <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cltn2_compose</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cltn2 <span class="main">⇒</span> cltn2 <span class="main">⇒</span> cltn2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cltn2_compose</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> cltn2_abs <span class="main">(</span>cltn2_rep <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">**</span> cltn2_rep <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cltn2_inverse</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cltn2 <span class="main">⇒</span> cltn2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cltn2_inverse</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> cltn2_abs <span class="main">(</span>matrix_inv <span class="main">(</span>cltn2_rep <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_compose_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cltn2_compose <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="main">(</span>cltn2_abs <span class="free">N</span><span class="main">)</span> <span class="main">=</span> cltn2_abs <span class="main">(</span><span class="free">M</span> <span class="main">**</span> <span class="free">N</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">M</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">N</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> invertible_mult
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span><span class="free">M</span> <span class="main">**</span> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">M</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">N</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cltn2_rep_abs2
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">N</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">M</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">N</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">N</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="main">**</span> cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">N</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">M</span> <span class="main">**</span> <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_scalar_ac scalar_matrix_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="main">(</span><span class="free">M</span> <span class="main">**</span> <span class="free">N</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cltn2_compose <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="main">(</span>cltn2_abs <span class="free">N</span><span class="main">)</span> <span class="main">=</span> cltn2_abs <span class="main">(</span><span class="free">M</span> <span class="main">**</span> <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cltn2_compose_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2_abs_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_compose_left_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cltn2_compose <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> cltn2_abs <span class="main">(</span><span class="free">M</span> <span class="main">**</span> cltn2_rep <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">M</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cltn2_rep_invertible <span class="keyword2"><span class="keyword">and</span></span> cltn2_compose_abs
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cltn2_compose <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="main">(</span>cltn2_abs <span class="main">(</span>cltn2_rep <span class="free">A</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> cltn2_abs <span class="main">(</span><span class="free">M</span> <span class="main">**</span> cltn2_rep <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cltn2_compose <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> cltn2_abs <span class="main">(</span><span class="free">M</span> <span class="main">**</span> cltn2_rep <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2_abs_rep<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_compose_right_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cltn2_compose <span class="free">A</span> <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="main">=</span> cltn2_abs <span class="main">(</span>cltn2_rep <span class="free">A</span> <span class="main">**</span> <span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">M</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cltn2_rep_invertible <span class="keyword2"><span class="keyword">and</span></span> cltn2_compose_abs
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cltn2_compose <span class="main">(</span>cltn2_abs <span class="main">(</span>cltn2_rep <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span>
    <span class="main">=</span> cltn2_abs <span class="main">(</span>cltn2_rep <span class="free">A</span> <span class="main">**</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cltn2_compose <span class="free">A</span> <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="main">=</span> cltn2_abs <span class="main">(</span>cltn2_rep <span class="free">A</span> <span class="main">**</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2_abs_rep<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_abs_rep_abs_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cltn2_abs <span class="main">(</span>cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="main">**</span> <span class="free">N</span><span class="main">)</span> <span class="main">=</span> cltn2_abs <span class="main">(</span><span class="free">M</span> <span class="main">**</span> <span class="free">N</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">M</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">N</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span><span class="free">M</span> <span class="main">**</span> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invertible_mult<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">M</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cltn2_rep_abs2
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">M</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="main">**</span> <span class="free">N</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">M</span> <span class="main">**</span> <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="main">(</span><span class="free">M</span> <span class="main">**</span> <span class="free">N</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cltn2_abs_mult
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cltn2_abs <span class="main">(</span>cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="main">**</span> <span class="free">N</span><span class="main">)</span> <span class="main">=</span> cltn2_abs <span class="main">(</span><span class="free">M</span> <span class="main">**</span> <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_matrix_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_assoc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"cltn2_compose <span class="main">(</span>cltn2_compose <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="free">C</span> <span class="main">=</span> cltn2_compose <span class="free">A</span> <span class="main">(</span>cltn2_compose <span class="free">B</span> <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> cltn2_rep_invertible
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="var">?A'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"invertible <span class="var">?B'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"invertible <span class="var">?C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> invertible_mult
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span><span class="var">?A'</span> <span class="main">**</span> <span class="var">?B'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span><span class="var">?B'</span> <span class="main">**</span> <span class="var">?C'</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span><span class="var">?A'</span> <span class="main">**</span> <span class="var">?B'</span> <span class="main">**</span> <span class="var">?C'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="main">(</span><span class="var">?A'</span> <span class="main">**</span> <span class="var">?B'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="var">?C'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cltn2_abs_rep_abs_mult
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cltn2_abs <span class="main">(</span>cltn2_rep <span class="main">(</span>cltn2_abs <span class="main">(</span><span class="var">?A'</span> <span class="main">**</span> <span class="var">?B'</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> <span class="var">?C'</span><span class="main">)</span>
    <span class="main">=</span> cltn2_abs <span class="main">(</span><span class="var">?A'</span> <span class="main">**</span> <span class="var">?B'</span> <span class="main">**</span> <span class="var">?C'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="main">(</span><span class="var">?B'</span> <span class="main">**</span> <span class="var">?C'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cltn2_rep_abs2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?B'</span> <span class="main">**</span> <span class="var">?C'</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="main">(</span>cltn2_abs <span class="main">(</span><span class="var">?B'</span> <span class="main">**</span> <span class="var">?C'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?B'</span> <span class="main">**</span> <span class="var">?C'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cltn2_rep <span class="main">(</span>cltn2_abs <span class="main">(</span><span class="var">?B'</span> <span class="main">**</span> <span class="var">?C'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?B'</span> <span class="main">**</span> <span class="var">?C'</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A'</span> <span class="main">**</span> cltn2_rep <span class="main">(</span>cltn2_abs <span class="main">(</span><span class="var">?B'</span> <span class="main">**</span> <span class="var">?C'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?A'</span> <span class="main">**</span> <span class="var">?B'</span> <span class="main">**</span> <span class="var">?C'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_scalar_ac matrix_mul_assoc scalar_matrix_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="main">(</span><span class="var">?A'</span> <span class="main">**</span> <span class="var">?B'</span> <span class="main">**</span> <span class="var">?C'</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cltn2_abs_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A'</span> <span class="main">**</span> <span class="var">?B'</span> <span class="main">**</span> <span class="var">?C'</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cltn2_abs <span class="main">(</span><span class="var">?A'</span> <span class="main">**</span> cltn2_rep <span class="main">(</span>cltn2_abs <span class="main">(</span><span class="var">?B'</span> <span class="main">**</span> <span class="var">?C'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> cltn2_abs <span class="main">(</span><span class="var">?A'</span> <span class="main">**</span> <span class="var">?B'</span> <span class="main">**</span> <span class="var">?C'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cltn2_abs <span class="main">(</span>cltn2_rep <span class="main">(</span>cltn2_abs <span class="main">(</span><span class="var">?A'</span> <span class="main">**</span> <span class="var">?B'</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> <span class="var">?C'</span><span class="main">)</span>
    <span class="main">=</span> cltn2_abs <span class="main">(</span><span class="var">?A'</span> <span class="main">**</span> <span class="var">?B'</span> <span class="main">**</span> <span class="var">?C'</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span>
    <span class="quoted"><span class="quoted">"cltn2_compose <span class="main">(</span>cltn2_compose <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="free">C</span> <span class="main">=</span> cltn2_compose <span class="free">A</span> <span class="main">(</span>cltn2_compose <span class="free">B</span> <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cltn2_compose_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_left_id<span class="main">:</span> <span class="quoted"><span class="quoted">"cltn2_compose cltn2_id <span class="free">A</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> cltn2_rep_invertible <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="var">?A'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> matrix_id_invertible <span class="keyword2"><span class="keyword">and</span></span> cltn2_abs_rep_abs_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"mat <span class="main">1</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?A'</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cltn2_compose cltn2_id <span class="free">A</span> <span class="main">=</span> cltn2_abs <span class="main">(</span>cltn2_rep <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cltn2_compose_def <span class="keyword2"><span class="keyword">and</span></span> cltn2_id_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_mul_lid<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> cltn2_abs_rep <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cltn2_compose cltn2_id <span class="free">A</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_left_inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"cltn2_compose <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> cltn2_id"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"matrix_inv <span class="var">?M</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> cltn2_rep_invertible <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="var">?M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> matrix_inv_invertible <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="var">?M'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="var">?M</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cltn2_abs_rep_abs_mult
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cltn2_compose <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> cltn2_abs <span class="main">(</span><span class="var">?M'</span> <span class="main">**</span> <span class="var">?M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cltn2_compose_def <span class="keyword2"><span class="keyword">and</span></span> cltn2_inverse_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="var">?M</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cltn2_compose <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> cltn2_id"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cltn2_id_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_inv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_left_inverse_ex<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">B</span><span class="main">.</span> cltn2_compose <span class="bound">B</span> <span class="free">A</span> <span class="main">=</span> cltn2_id"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cltn2_left_inverse <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> cltn2<span class="main">:</span>
  group <span class="quoted"><span class="quoted">"<span class="main">(|</span>carrier <span class="main">=</span> UNIV<span class="main">,</span> mult <span class="main">=</span> cltn2_compose<span class="main">,</span> one <span class="main">=</span> cltn2_id<span class="main">|)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cltn2_assoc <span class="keyword2"><span class="keyword">and</span></span> cltn2_left_id <span class="keyword2"><span class="keyword">and</span></span> cltn2_left_inverse_ex
    <span class="keyword2"><span class="keyword">and</span></span> groupI <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(|</span>carrier <span class="main">=</span> UNIV<span class="main">,</span> mult <span class="main">=</span> cltn2_compose<span class="main">,</span> one <span class="main">=</span> cltn2_id<span class="main">|)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_inverse_inv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="main">(|</span>carrier <span class="main">=</span> UNIV<span class="main">,</span> mult <span class="main">=</span> cltn2_compose<span class="main">,</span> one <span class="main">=</span> cltn2_id<span class="main">|)</span></sub><span class="hidden">⇙</span> <span class="free">A</span>
  <span class="main">=</span> cltn2_inverse <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cltn2_left_inverse <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> cltn2.inv_equality
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemmas</span></span> cltn2_inverse_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> cltn2.inv_one <span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> cltn2_inverse_compose <span class="main">=</span> cltn2.inv_mult_group <span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"As a group action"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> cltn2_id <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> matrix_id_invertible <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_right_abs
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> cltn2_id <span class="main">=</span> proj2_abs <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> mat <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cltn2_id_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> cltn2_id <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_compose<span class="main">:</span>
  <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">A</span><span class="main">)</span> <span class="free">B</span> <span class="main">=</span> apply_cltn2 <span class="free">p</span> <span class="main">(</span>cltn2_compose <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> rep_mult_rep_non_zero <span class="keyword2"><span class="keyword">and</span></span> cltn2_rep_invertible <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_abs
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>cltn2_abs <span class="main">(</span>cltn2_rep <span class="free">B</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> proj2_abs <span class="main">(</span><span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">A</span><span class="main">)</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> apply_cltn2_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">A</span><span class="main">)</span> <span class="free">B</span>
    <span class="main">=</span> proj2_abs <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> <span class="main">(</span>cltn2_rep <span class="free">A</span> <span class="main">**</span> cltn2_rep <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2_abs_rep vector_matrix_mul_assoc<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> cltn2_rep_invertible <span class="keyword2"><span class="keyword">and</span></span> invertible_mult
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>cltn2_rep <span class="free">A</span> <span class="main">**</span> cltn2_rep <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> apply_cltn2_right_abs
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="main">(</span>cltn2_compose <span class="free">A</span> <span class="free">B</span><span class="main">)</span>
    <span class="main">=</span> proj2_abs <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> <span class="main">(</span>cltn2_rep <span class="free">A</span> <span class="main">**</span> cltn2_rep <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cltn2_compose_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">A</span><span class="main">)</span> <span class="free">B</span>
    <span class="main">=</span> proj2_abs <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> <span class="main">(</span>cltn2_rep <span class="free">A</span> <span class="main">**</span> cltn2_rep <span class="free">B</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">A</span><span class="main">)</span> <span class="free">B</span> <span class="main">=</span> apply_cltn2 <span class="free">p</span> <span class="main">(</span>cltn2_compose <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> cltn2<span class="main">:</span>
  action <span class="quoted"><span class="quoted">"<span class="main">(|</span>carrier <span class="main">=</span> UNIV<span class="main">,</span> mult <span class="main">=</span> cltn2_compose<span class="main">,</span> one <span class="main">=</span> cltn2_id<span class="main">|)</span>"</span></span> <span class="quoted">apply_cltn2</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(|</span>carrier <span class="main">=</span> UNIV<span class="main">,</span> mult <span class="main">=</span> cltn2_compose<span class="main">,</span> one <span class="main">=</span> cltn2_id<span class="main">|)</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">p</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="var">?G</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>apply_cltn2 <span class="skolem">p</span> <span class="skolem">A</span><span class="main">)</span> <span class="skolem">B</span> <span class="main">=</span> apply_cltn2 <span class="skolem">p</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?G</span></sub><span class="hidden">⇙</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">rule</span> apply_cltn2_compose<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> carrier <span class="var">?G</span> <span class="main">∧</span> <span class="skolem">B</span> <span class="main">∈</span> carrier <span class="var">?G</span>
    <span class="main">⟶</span> apply_cltn2 <span class="main">(</span>apply_cltn2 <span class="skolem">p</span> <span class="skolem">A</span><span class="main">)</span> <span class="skolem">B</span> <span class="main">=</span> apply_cltn2 <span class="skolem">p</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?G</span></sub><span class="hidden">⇙</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cltn2_transpose</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cltn2 <span class="main">⇒</span> cltn2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cltn2_transpose</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> cltn2_abs <span class="main">(</span>transpose <span class="main">(</span>cltn2_rep <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">apply_cltn2_line</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2_line <span class="main">⇒</span> cltn2 <span class="main">⇒</span> proj2_line"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">apply_cltn2_line</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>
  <span class="main">≡</span> P2L <span class="main">(</span>apply_cltn2 <span class="main">(</span>L2P <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">(</span>cltn2_transpose <span class="main">(</span>cltn2_inverse <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_transpose_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cltn2_transpose <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="main">=</span> cltn2_abs <span class="main">(</span>transpose <span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">M</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> transpose_invertible <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>transpose <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">M</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cltn2_rep_abs2
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">M</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transpose <span class="main">(</span>cltn2_rep <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> transpose <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> transpose_scalar<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="main">(</span>transpose <span class="free">M</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cltn2_transpose <span class="main">(</span>cltn2_abs <span class="free">M</span><span class="main">)</span> <span class="main">=</span> cltn2_abs <span class="main">(</span>transpose <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cltn2_transpose_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2_abs_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_transpose_compose<span class="main">:</span>
  <span class="quoted"><span class="quoted">"cltn2_transpose <span class="main">(</span>cltn2_compose <span class="free">A</span> <span class="free">B</span><span class="main">)</span>
  <span class="main">=</span> cltn2_compose <span class="main">(</span>cltn2_transpose <span class="free">B</span><span class="main">)</span> <span class="main">(</span>cltn2_transpose <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> cltn2_rep_invertible
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>cltn2_rep <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>cltn2_rep <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> transpose_invertible
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>transpose <span class="main">(</span>cltn2_rep <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>transpose <span class="main">(</span>cltn2_rep <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="main">(</span>cltn2_rep <span class="free">A</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="main">(</span>cltn2_rep <span class="free">B</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> invertible_mult
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>cltn2_rep <span class="free">A</span> <span class="main">**</span> cltn2_rep <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="main">(</span>cltn2_rep <span class="free">A</span> <span class="main">**</span> cltn2_rep <span class="free">B</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cltn2_transpose_abs
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cltn2_transpose <span class="main">(</span>cltn2_compose <span class="free">A</span> <span class="free">B</span><span class="main">)</span>
    <span class="main">=</span> cltn2_abs <span class="main">(</span>transpose <span class="main">(</span>cltn2_rep <span class="free">A</span> <span class="main">**</span> cltn2_rep <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cltn2_compose_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cltn2_abs <span class="main">(</span>transpose <span class="main">(</span>cltn2_rep <span class="free">B</span><span class="main">)</span> <span class="main">**</span> transpose <span class="main">(</span>cltn2_rep <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_transpose_mul<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="main">(</span>transpose <span class="main">(</span>cltn2_rep <span class="free">B</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="main">(</span>transpose <span class="main">(</span>cltn2_rep <span class="free">A</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cltn2_compose_abs
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cltn2_compose <span class="main">(</span>cltn2_transpose <span class="free">B</span><span class="main">)</span> <span class="main">(</span>cltn2_transpose <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cltn2_transpose_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cltn2_transpose <span class="main">(</span>cltn2_compose <span class="free">A</span> <span class="free">B</span><span class="main">)</span>
    <span class="main">=</span> cltn2_compose <span class="main">(</span>cltn2_transpose <span class="free">B</span><span class="main">)</span> <span class="main">(</span>cltn2_transpose <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_transpose_transpose<span class="main">:</span> <span class="quoted"><span class="quoted">"cltn2_transpose <span class="main">(</span>cltn2_transpose <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> cltn2_rep_invertible <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>cltn2_rep <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> transpose_invertible <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>transpose <span class="main">(</span>cltn2_rep <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> cltn2_transpose_abs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"transpose <span class="main">(</span>cltn2_rep <span class="free">A</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"cltn2_transpose <span class="main">(</span>cltn2_transpose <span class="free">A</span><span class="main">)</span> <span class="main">=</span> cltn2_abs <span class="main">(</span>transpose <span class="main">(</span>transpose <span class="main">(</span>cltn2_rep <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cltn2_transpose_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> cltn2_abs_rep <span class="keyword2"><span class="keyword">and</span></span> transpose_transpose <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="free">A</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cltn2_transpose <span class="main">(</span>cltn2_transpose <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_transpose_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cltn2_transpose cltn2_id <span class="main">=</span> cltn2_id"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cltn2_transpose_abs
  <span class="keyword1"><span class="command">unfolding</span></span> cltn2_id_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> transpose_mat matrix_id_invertible<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_line_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"apply_cltn2_line <span class="free">l</span> cltn2_id <span class="main">=</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> apply_cltn2_line_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_line_compose<span class="main">:</span>
  <span class="quoted"><span class="quoted">"apply_cltn2_line <span class="main">(</span>apply_cltn2_line <span class="free">l</span> <span class="free">A</span><span class="main">)</span> <span class="free">B</span>
  <span class="main">=</span> apply_cltn2_line <span class="free">l</span> <span class="main">(</span>cltn2_compose <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cltn2_compose
    <span class="main">(</span>cltn2_transpose <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cltn2_transpose <span class="main">(</span>cltn2_inverse <span class="free">B</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> cltn2_transpose <span class="main">(</span>cltn2_inverse <span class="main">(</span>cltn2_compose <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2_transpose_compose cltn2_inverse_compose<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line <span class="main">(</span>apply_cltn2_line <span class="free">l</span> <span class="free">A</span><span class="main">)</span> <span class="free">B</span>
    <span class="main">=</span> apply_cltn2_line <span class="free">l</span> <span class="main">(</span>cltn2_compose <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> apply_cltn2_line_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apply_cltn2_compose<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> cltn2_line<span class="main">:</span>
  action
  <span class="quoted"><span class="quoted">"<span class="main">(|</span>carrier <span class="main">=</span> UNIV<span class="main">,</span> mult <span class="main">=</span> cltn2_compose<span class="main">,</span> one <span class="main">=</span> cltn2_id<span class="main">|)</span>"</span></span>
  <span class="quoted">apply_cltn2_line</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(|</span>carrier <span class="main">=</span> UNIV<span class="main">,</span> mult <span class="main">=</span> cltn2_compose<span class="main">,</span> one <span class="main">=</span> cltn2_id<span class="main">|)</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line <span class="skolem">l</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="var">?G</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line <span class="main">(</span>apply_cltn2_line <span class="skolem">l</span> <span class="skolem">A</span><span class="main">)</span> <span class="skolem">B</span>
    <span class="main">=</span> apply_cltn2_line <span class="skolem">l</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?G</span></sub><span class="hidden">⇙</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">rule</span> apply_cltn2_line_compose<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> carrier <span class="var">?G</span> <span class="main">∧</span> <span class="skolem">B</span> <span class="main">∈</span> carrier <span class="var">?G</span>
    <span class="main">⟶</span> apply_cltn2_line <span class="main">(</span>apply_cltn2_line <span class="skolem">l</span> <span class="skolem">A</span><span class="main">)</span> <span class="skolem">B</span>
    <span class="main">=</span> apply_cltn2_line <span class="skolem">l</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?G</span></sub><span class="hidden">⇙</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> apply_cltn2_inv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> cltn2.act_act_inv <span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> apply_cltn2_line_inv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> cltn2_line.act_act_inv <span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_line_alt_def<span class="main">:</span>
  <span class="quoted"><span class="quoted">"apply_cltn2_line <span class="free">l</span> <span class="free">A</span>
  <span class="main">=</span> proj2_line_abs <span class="main">(</span>cltn2_rep <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> proj2_line_rep <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>cltn2_rep <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cltn2_rep_invertible<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>transpose <span class="main">(</span>cltn2_rep <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> transpose_invertible<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span>
    <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>L2P <span class="free">l</span><span class="main">)</span> <span class="main">(</span>cltn2_transpose <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> proj2_abs <span class="main">(</span>proj2_rep <span class="main">(</span>L2P <span class="free">l</span><span class="main">)</span> <span class="keyword1">v*</span> transpose <span class="main">(</span>cltn2_rep <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cltn2_transpose_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> apply_cltn2_right_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>L2P <span class="free">l</span><span class="main">)</span> <span class="main">(</span>cltn2_transpose <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> proj2_abs <span class="main">(</span>cltn2_rep <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> proj2_line_rep <span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_line_rep_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line <span class="free">l</span> <span class="free">A</span>
    <span class="main">=</span> proj2_line_abs <span class="main">(</span>cltn2_rep <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> proj2_line_rep <span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> apply_cltn2_line_def <span class="keyword2"><span class="keyword">and</span></span> proj2_line_abs_def <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rep_mult_line_rep_non_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="free">A</span> <span class="keyword1">*v</span> proj2_line_rep <span class="free">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> proj2_line_rep_non_zero <span class="keyword2"><span class="keyword">and</span></span> cltn2_rep_invertible
    <span class="keyword2"><span class="keyword">and</span></span> invertible_times_eq_zero
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_incident<span class="main">:</span>
  <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="main">(</span>apply_cltn2_line <span class="free">l</span> <span class="free">A</span><span class="main">)</span>
  <span class="main">⟷</span> proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rep_mult_rep_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> proj2_rep_abs2
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">(</span>proj2_abs <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> proj2_line_rep <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rep_mult_line_rep_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> proj2_line_rep_abs <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_line_rep <span class="main">(</span>proj2_line_abs <span class="var">?v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="main">(</span>apply_cltn2_line <span class="free">l</span> <span class="free">A</span><span class="main">)</span>
    <span class="main">⟷</span> proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>cltn2_rep <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> proj2_line_rep <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_incident_def <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_line_alt_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dot_scaleR_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> dot_lmul_matrix <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> proj2_line_rep <span class="free">l</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="main">(</span>proj2_abs <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="main">(</span>cltn2_inverse <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_incident_def <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dot_scaleR_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_preserve_incident <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>apply_cltn2_line <span class="free">l</span> <span class="free">A</span><span class="main">)</span>
  <span class="main">⟷</span> proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apply_cltn2_incident<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_preserve_set_Col<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span>apply_cltn2 <span class="bound">p</span> <span class="free">C</span> <span class="main">|</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="free">S</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> proj2_incident <span class="bound">p</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> proj2_set_Col_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">q</span> <span class="main">∈</span> <span class="main">{</span>apply_cltn2 <span class="bound">p</span> <span class="free">C</span> <span class="main">|</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span><span class="main">}</span><span class="main">.</span>
    proj2_incident <span class="bound">q</span> <span class="main">(</span>apply_cltn2_line <span class="skolem">l</span> <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span>apply_cltn2 <span class="bound">p</span> <span class="free">C</span> <span class="main">|</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_set_Col_def <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_injective<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="free">C</span> <span class="main">=</span> apply_cltn2 <span class="free">q</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">p</span> <span class="free">C</span> <span class="main">=</span> apply_cltn2 <span class="free">q</span> <span class="free">C</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>cltn2_inverse <span class="free">C</span><span class="main">)</span>
    <span class="main">=</span> apply_cltn2 <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>cltn2_inverse <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_line_injective<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line <span class="free">l</span> <span class="free">C</span> <span class="main">=</span> apply_cltn2_line <span class="free">m</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2_line <span class="free">l</span> <span class="free">C</span> <span class="main">=</span> apply_cltn2_line <span class="free">m</span> <span class="free">C</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line <span class="main">(</span>apply_cltn2_line <span class="free">l</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>cltn2_inverse <span class="free">C</span><span class="main">)</span>
    <span class="main">=</span> apply_cltn2_line <span class="main">(</span>apply_cltn2_line <span class="free">m</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>cltn2_inverse <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_line_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">C</span><span class="main">)</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="free">C</span><span class="main">)</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line <span class="free">l</span> <span class="free">C</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>apply_cltn2_line <span class="free">l</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>apply_cltn2_line <span class="free">l</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_injective <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="free">C</span> <span class="main">≠</span> apply_cltn2 <span class="free">q</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>apply_cltn2_line <span class="free">l</span> <span class="free">C</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>apply_cltn2_line <span class="free">l</span> <span class="free">C</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">C</span><span class="main">)</span> <span class="free">m</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="free">C</span><span class="main">)</span> <span class="free">m</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_unique
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line <span class="free">l</span> <span class="free">C</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≠</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="main">(</span>apply_cltn2_line <span class="free">l</span> <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="main">(</span>apply_cltn2_line <span class="free">m</span> <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="free">C</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>apply_cltn2_line <span class="free">l</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">m</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>apply_cltn2_line <span class="free">m</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">≠</span> <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_line_injective <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line <span class="free">l</span> <span class="free">C</span> <span class="main">≠</span> apply_cltn2_line <span class="free">m</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>apply_cltn2_line <span class="free">l</span> <span class="free">C</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>apply_cltn2_line <span class="free">m</span> <span class="free">C</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="main">(</span>apply_cltn2_line <span class="free">l</span> <span class="free">C</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="main">(</span>apply_cltn2_line <span class="free">m</span> <span class="free">C</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_unique
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="free">C</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Parts of some Statements from \cite{borsuk}›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹All theorems with names beginning with \emph{statement} are based
  on corresponding theorems in \cite{borsuk}.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> statement52_existence<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2<span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_no_3_Col <span class="main">(</span>insert <span class="free">a3</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">A</span><span class="main">.</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="bound">A</span> <span class="main">=</span> <span class="free">a3</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span> <span class="bound">j</span><span class="main">.</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>axis <span class="bound">j</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">A</span> <span class="main">=</span> <span class="free">a</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">a3</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">`</span> range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_no_3_Col <span class="main">(</span>insert <span class="free">a3</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="free">a3</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> proj2_no_3_Col_def <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1"><span class="command">from</span></span> card_image_le <span class="main">[</span><span class="operator">of</span> <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"<span class="main">($)</span> <span class="free">a</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> card_insert_if <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">a3</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span>insert <span class="free">a3</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a3</span> <span class="main">∉</span> range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>insert <span class="free">a3</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">a3</span><span class="main">}</span> <span class="main">=</span> range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_no_3_Col <span class="main">(</span>insert <span class="free">a3</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_no_3_Col_span <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"insert <span class="free">a3</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">a3</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"span <span class="var">?B</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> card_suc_ge_insert <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a3</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span>insert <span class="free">a3</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">3</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> card_image <span class="main">[</span><span class="operator">of</span> <span class="quoted">proj2_rep</span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_inj
    <span class="keyword2"><span class="keyword">and</span></span> subset_inj_on
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?B</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹span <span class="var">?B</span> <span class="main">=</span> UNIV›</span></span> <span class="keyword2"><span class="keyword">and</span></span> span_finite <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span> <span class="bound">w</span> <span class="main">∈</span> <span class="var">?B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span><span class="main">)</span> <span class="main">=</span> <span class="var">?v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_equiv<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> UNIV_I rangeE<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span>proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_abs <span class="var">?C</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> proj2_rep_inj <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a3</span> <span class="main">∉</span> range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∉</span> <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span>proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Bi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">`</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">$</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> insert <span class="free">a3</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> image_set_diff <span class="main">[</span><span class="operator">of</span> <span class="quoted">proj2_rep</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_inj
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Bi</span> <span class="main">=</span> <span class="var">?B</span> <span class="main">-</span> <span class="main">{</span>proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> sum_diff1 <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span>"</span></span><span class="main">]</span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?B</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?B</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span> <span class="bound">w</span> <span class="main">∈</span> <span class="var">?Bi</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">∑</span> <span class="bound">w</span> <span class="main">∈</span> <span class="var">?B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">c</span> <span class="main">(</span>proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a3</span> <span class="main">∉</span> range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a3</span> <span class="main">≠</span> <span class="free">a</span><span class="main">$</span><span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"insert <span class="free">a3</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">$</span><span class="skolem">i</span><span class="main">}</span> <span class="main">=</span>
      insert <span class="free">a3</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">$</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">`</span> <span class="main">(</span>insert <span class="free">a3</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">$</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> insert <span class="var">?v</span> <span class="var">?Bi</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_no_3_Col <span class="main">(</span>insert <span class="free">a3</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> insert <span class="free">a3</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>proj2_rep <span class="main">`</span> <span class="main">(</span>insert <span class="free">a3</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">$</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_no_3_Col_span<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>insert <span class="var">?v</span> <span class="var">?Bi</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Bi</span> <span class="main">=</span> <span class="var">?B</span> <span class="main">-</span> <span class="main">{</span>proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">}</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?B</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹card <span class="var">?B</span> <span class="main">=</span> <span class="numeral">3</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?Bi</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_gt_0_diff_singleton<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?Bi</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹card <span class="var">?Bi</span> <span class="main">=</span> <span class="numeral">2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> dim_le_card' <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?Bi</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim <span class="var">?Bi</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dim <span class="main">(</span>span <span class="var">?Bi</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> dim_span<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"span <span class="var">?Bi</span> <span class="main">≠</span> UNIV"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarify</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dim_UNIV<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹span <span class="main">(</span>insert <span class="var">?v</span> <span class="var">?Bi</span><span class="main">)</span> <span class="main">=</span> UNIV›</span></span> <span class="keyword2"><span class="keyword">and</span></span> span_redundant
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∉</span> span <span class="var">?Bi</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">(</span>proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∑</span> <span class="bound">w</span> <span class="main">∈</span> <span class="var">?Bi</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="main">∑</span> <span class="bound">w</span> <span class="main">∈</span> <span class="var">?B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">c</span> <span class="main">(</span>proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∑</span> <span class="bound">w</span> <span class="main">∈</span> <span class="var">?B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span><span class="main">)</span> <span class="main">=</span> <span class="var">?v</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">w</span> <span class="main">∈</span> <span class="var">?Bi</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> span_finite <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?Bi</span></span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?Bi</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∈</span> span <span class="var">?Bi</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_equiv<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?v</span> <span class="main">∉</span> span <span class="var">?Bi</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">(</span>proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">w</span><span class="main">∈</span><span class="var">?B</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">w</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> image_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rows <span class="var">?C</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span><span class="main">)</span> <span class="main">`</span> <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rows_def
      <span class="keyword2"><span class="keyword">and</span></span> row_def
      <span class="keyword2"><span class="keyword">and</span></span> image_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_lambda_eta<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> span <span class="main">(</span>rows <span class="var">?C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?B</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> span_finite <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹span <span class="var">?B</span> <span class="main">=</span> UNIV›</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span> <span class="bound">w</span><span class="main">∈</span><span class="var">?B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">ub</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_equiv<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> UNIV_I rangeE<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">w</span><span class="main">∈</span><span class="var">?B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">ub</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span> <span class="main">∈</span> span <span class="main">(</span>rows <span class="var">?C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> span_superset <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rows <span class="var">?C</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹rows <span class="var">?C</span> <span class="main">=</span> image <span class="main">(</span><span class="main">λ</span> <span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span><span class="main">)</span> <span class="var">?B</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">w</span> <span class="main">∈</span> span <span class="main">(</span>rows <span class="var">?C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> span_mul <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"rows <span class="var">?C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ub</span> <span class="skolem">w</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">c</span> <span class="skolem">w</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">ub</span> <span class="skolem">w</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">c</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">(</span><span class="skolem">c</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> span <span class="main">(</span>rows <span class="var">?C</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_equiv<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">w</span><span class="main">∈</span><span class="var">?B</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">w</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> <span class="var">?B</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ub</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">w</span> <span class="main">∈</span> span <span class="main">(</span>rows <span class="var">?C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> span_sum <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="skolem">ub</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?B</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span> <span class="bound">w</span><span class="main">∈</span><span class="var">?B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">ub</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span><span class="main">)</span> <span class="main">∈</span> span <span class="main">(</span>rows <span class="var">?C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∑</span> <span class="bound">w</span><span class="main">∈</span><span class="var">?B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">ub</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> span <span class="main">(</span>rows <span class="var">?C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>rows <span class="var">?C</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> matrix_left_invertible_span_rows <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">C'</span><span class="main">.</span> <span class="bound">C'</span> <span class="main">**</span> <span class="var">?C</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> left_invertible_iff_invertible
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vector_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> apply_cltn2_abs <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="var">?C</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="var">?A</span> <span class="main">=</span>
    proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> inj_on_iff_eq_card <span class="main">[</span><span class="operator">of</span> <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"<span class="main">($)</span> <span class="free">a</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">3</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> exhaust_3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">::</span><span class="numeral">3</span><span class="main">.</span> <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vector_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> vector_matrix_row <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">v*</span> <span class="var">?C</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">(</span>proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> sum.reindex
  <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">($)</span> <span class="free">a</span>"</span></span> <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">(</span>proj2_rep <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>proj2_rep <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹inj <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">x</span><span class="main">∈</span><span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">(</span>proj2_rep <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>proj2_rep <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> sum.reindex
  <span class="main">[</span><span class="operator">of</span> <span class="quoted">proj2_rep</span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span>"</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_inj <span class="keyword2"><span class="keyword">and</span></span> subset_inj_on <span class="main">[</span><span class="operator">of</span> <span class="quoted">proj2_rep</span> <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">($)</span> <span class="free">a</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">w</span><span class="main">∈</span><span class="var">?B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∑</span> <span class="bound">w</span> <span class="main">∈</span> <span class="var">?B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">w</span><span class="main">)</span> <span class="main">=</span> <span class="var">?v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">v*</span> <span class="var">?C</span> <span class="main">=</span> <span class="var">?v</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="var">?A</span> <span class="main">=</span>
    proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> <span class="var">?C</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="var">?A</span> <span class="main">=</span> proj2_abs <span class="var">?v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> proj2_abs_rep <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="var">?A</span> <span class="main">=</span> <span class="free">a3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">j</span><span class="main">.</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>axis <span class="bound">j</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="var">?A</span> <span class="main">=</span> <span class="free">a</span><span class="main">$</span><span class="bound">j</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>axis <span class="skolem">j</span> <span class="main">1</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff axis_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> apply_cltn2_abs <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="var">?C</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>axis <span class="skolem">j</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="var">?A</span> <span class="main">=</span> proj2_abs <span class="main">(</span>axis <span class="skolem">j</span> <span class="main">1</span> <span class="keyword1">v*</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span><span class="main">.</span>
      <span class="main">(</span><span class="main">(</span>axis <span class="skolem">j</span> <span class="main">1</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">(</span>proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> axis_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> sum.mono_neutral_left <span class="main">[</span><span class="operator">of</span> <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">j</span><span class="main">}</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>axis <span class="skolem">j</span> <span class="main">1</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">(</span>proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword2"><span class="keyword">and</span></span> vector_matrix_row <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"axis <span class="skolem">j</span> <span class="main">1</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>axis <span class="skolem">j</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">v*</span> <span class="var">?C</span> <span class="main">=</span> <span class="var">?C</span><span class="main">$</span><span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_equiv<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>axis <span class="skolem">j</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">v*</span> <span class="var">?C</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">(</span>proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> proj2_abs_mult_rep <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span>proj2_rep <span class="main">(</span><span class="free">a</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>axis <span class="skolem">j</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="var">?A</span> <span class="main">=</span> proj2_abs <span class="main">(</span>axis <span class="skolem">j</span> <span class="main">1</span> <span class="keyword1">v*</span> <span class="var">?C</span><span class="main">)</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>axis <span class="skolem">j</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="var">?A</span> <span class="main">=</span> <span class="free">a</span><span class="main">$</span><span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="var">?A</span> <span class="main">=</span> <span class="free">a3</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">A</span><span class="main">.</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="bound">A</span> <span class="main">=</span> <span class="free">a3</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span> <span class="bound">j</span><span class="main">.</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>axis <span class="bound">j</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">A</span> <span class="main">=</span> <span class="free">a</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> statement53_existence<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2<span class="main">^</span><span class="numeral">4</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> proj2_no_3_Col <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">C</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">j</span><span class="main">.</span> apply_cltn2 <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="main">0</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span> <span class="bound">C</span> <span class="main">=</span> <span class="free">p</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="bound">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> <span class="keyword1">χ</span> <span class="bound">j</span><span class="main">::</span><span class="numeral">3</span><span class="main">.</span> <span class="free">p</span><span class="main">$</span><span class="bound">i</span> <span class="main">$</span> <span class="main">(</span>of_int <span class="main">(</span>Rep_bit1 <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">ϵ</span> <span class="bound">D</span><span class="main">.</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="bound">D</span> <span class="main">=</span> <span class="free">p</span><span class="main">$</span><span class="bound">i</span><span class="main">$</span><span class="numeral">3</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">j'</span><span class="main">.</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>axis <span class="bound">j'</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">D</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="bound">i</span><span class="main">$</span><span class="bound">j'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span><span class="main">$</span><span class="bound">i</span><span class="main">$</span><span class="numeral">3</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">j'</span><span class="main">.</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>axis <span class="bound">j'</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="bound">i</span><span class="main">$</span><span class="bound">j'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">($)</span> <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="skolem">i</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="main">(</span><span class="var">?q</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">($)</span> <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⊇</span> insert <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="skolem">i</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="main">(</span><span class="var">?q</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">($)</span> <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="skolem">i</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="main">(</span><span class="var">?q</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> range <span class="main">(</span><span class="main">($)</span> <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="free">p</span><span class="main">$</span><span class="skolem">i</span><span class="main">$</span><span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> eq_3_or_of_3 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> insert <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="skolem">i</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="main">(</span><span class="var">?q</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> proj2_no_3_Col <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_no_3_Col <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_no_3_Col <span class="main">(</span>insert <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="skolem">i</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span> <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="main">(</span><span class="var">?q</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">D</span><span class="main">.</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="bound">D</span> <span class="main">=</span> <span class="free">p</span><span class="main">$</span><span class="skolem">i</span><span class="main">$</span><span class="numeral">3</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">j'</span><span class="main">.</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>axis <span class="bound">j'</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">D</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="skolem">i</span><span class="main">$</span><span class="bound">j'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> statement52_existence<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> someI_ex <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">D</span><span class="main">.</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="bound">D</span> <span class="main">=</span> <span class="free">p</span><span class="main">$</span><span class="skolem">i</span><span class="main">$</span><span class="numeral">3</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">j'</span><span class="main">.</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>axis <span class="bound">j'</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">D</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="skolem">i</span><span class="main">$</span><span class="bound">j'</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span><span class="main">$</span><span class="skolem">i</span><span class="main">$</span><span class="numeral">3</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">j'</span><span class="main">.</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>axis <span class="bound">j'</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="skolem">i</span><span class="main">$</span><span class="bound">j'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span><span class="main">$</span><span class="main">0</span><span class="main">$</span><span class="numeral">3</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">3</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">j'</span><span class="main">.</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>axis <span class="bound">j'</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="main">0</span><span class="main">$</span><span class="bound">j'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">j'</span><span class="main">.</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>axis <span class="bound">j'</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="bound">j'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_compose <span class="main">(</span>cltn2_inverse <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">j</span><span class="main">.</span> apply_cltn2 <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="main">0</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span> <span class="var">?C</span> <span class="main">=</span> <span class="free">p</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="bound">j</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="main">0</span><span class="main">$</span><span class="skolem">j</span><span class="main">)</span> <span class="var">?C</span> <span class="main">=</span> <span class="free">p</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span><span class="main">$</span><span class="main">0</span><span class="main">$</span><span class="numeral">3</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>  cltn2.act_inv_iff
      <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="main">0</span><span class="main">$</span><span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>cltn2_inverse <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">3</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">=</span> <span class="numeral">3</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> cltn2.act_act <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cltn2_inverse <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span><span class="main">$</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">$</span><span class="main">0</span><span class="main">$</span><span class="skolem">j</span>"</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="main">0</span><span class="main">$</span><span class="skolem">j</span><span class="main">)</span> <span class="var">?C</span> <span class="main">=</span> <span class="free">p</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> eq_3_or_of_3 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j'</span></span> <span class="main">::</span> <span class="quoted"><span class="numeral">3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> of_int <span class="main">(</span>Rep_bit1 <span class="skolem">j'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">j'</span><span class="main">.</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>axis <span class="bound">j'</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="main">0</span><span class="main">$</span><span class="bound">j'</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">j'</span><span class="main">.</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>axis <span class="bound">j'</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="bound">j'</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">$</span><span class="main">0</span><span class="main">$</span><span class="skolem">j</span> <span class="main">=</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>axis <span class="skolem">j'</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="skolem">j</span> <span class="main">=</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>axis <span class="skolem">j'</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">$</span><span class="main">0</span><span class="main">$</span><span class="skolem">j</span> <span class="main">=</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>axis <span class="skolem">j'</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="main">0</span><span class="main">)</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> cltn2.act_inv_iff
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="main">0</span><span class="main">$</span><span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>cltn2_inverse <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="main">(</span>axis <span class="skolem">j'</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="skolem">j</span> <span class="main">=</span> apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>axis <span class="skolem">j'</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> cltn2.act_act <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cltn2_inverse <span class="main">(</span><span class="var">?D</span><span class="main">$</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span><span class="main">$</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">$</span><span class="main">0</span><span class="main">$</span><span class="skolem">j</span>"</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="main">0</span><span class="main">$</span><span class="skolem">j</span><span class="main">)</span> <span class="var">?C</span> <span class="main">=</span> <span class="free">p</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">C</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">j</span><span class="main">.</span> apply_cltn2 <span class="main">(</span><span class="free">p</span><span class="main">$</span><span class="main">0</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span> <span class="bound">C</span> <span class="main">=</span> <span class="free">p</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="bound">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?C</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_linear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span> <span class="main">+</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">v</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span><span class="main">)</span> <span class="main">+</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">w</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span><span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span> <span class="main">+</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="free">C</span>
  <span class="main">=</span> proj2_abs <span class="main">(</span><span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">v</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span><span class="main">)</span> <span class="main">+</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">w</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">=</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span> <span class="main">+</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> vector_matrix_left_distrib scaleR_vector_matrix_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span> <span class="main">+</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> non_zero_mult_rep_non_zero
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?u</span> <span class="main">=</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span> <span class="main">+</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span> <span class="main">+</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_left_abs
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span><span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span> <span class="main">+</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="free">C</span> <span class="main">=</span> proj2_abs <span class="var">?u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_imp_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="free">C</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rep_mult_rep_non_zero<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">p</span> <span class="free">C</span> <span class="main">=</span> <span class="free">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> apply_cltn2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">(</span>proj2_abs <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> proj2_rep <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_abs2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> proj2_rep <span class="free">q</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">q</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">j</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> statement55<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="free">C</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">q</span> <span class="free">C</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">r</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>apply_cltn2 <span class="free">r</span> <span class="free">C</span><span class="main">)</span> <span class="free">C</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">p</span> <span class="free">C</span> <span class="main">=</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">q</span> <span class="free">C</span> <span class="main">=</span> <span class="free">p</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>apply_cltn2 <span class="free">r</span> <span class="free">C</span><span class="main">)</span> <span class="free">C</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">p</span> <span class="free">C</span> <span class="main">=</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_imp_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">q</span> <span class="free">C</span> <span class="main">=</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_imp_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">q</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">r</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_iff
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_dependent <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_linear <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"proj2_rep <span class="free"><span class="free">p</span></span>"</span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"proj2_rep <span class="free"><span class="free">q</span></span>"</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span><span class="main">)</span> <span class="main">+</span> proj2_rep <span class="free">q</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">r</span> <span class="free">C</span>
    <span class="main">=</span> proj2_abs
    <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span><span class="main">)</span> <span class="main">+</span> proj2_rep <span class="free">q</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">q</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="free">q</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">q</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">r</span> <span class="free">C</span>
    <span class="main">=</span> proj2_abs <span class="main">(</span><span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">q</span> <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> apply_cltn2_linear
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>apply_cltn2 <span class="free">r</span> <span class="free">C</span><span class="main">)</span> <span class="free">C</span>
    <span class="main">=</span> proj2_abs
    <span class="main">(</span><span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>proj2_rep <span class="free">q</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span><span class="main">)</span>
    <span class="main">+</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">q</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="free">q</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>apply_cltn2 <span class="free">r</span> <span class="free">C</span><span class="main">)</span> <span class="free">C</span>
    <span class="main">=</span> proj2_abs <span class="main">(</span><span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> <span class="skolem">i</span> <span class="main">*</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">*</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_abs_mult
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>apply_cltn2 <span class="free">r</span> <span class="free">C</span><span class="main">)</span> <span class="free">C</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Cross ratios"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cross_ratio</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> proj2 <span class="main">⇒</span> proj2 <span class="main">⇒</span> proj2 <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cross_ratio</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> proj2_Col_coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">/</span> proj2_Col_coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cross_ratio_correct</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> proj2 <span class="main">⇒</span> proj2 <span class="main">⇒</span> proj2 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cross_ratio_correct</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span>
  proj2_set_Col <span class="main">{</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">}</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_Col_coeff_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_Col_coeff <span class="free">p</span> <span class="free">q</span> <span class="main">(</span>proj2_abs <span class="main">(</span><span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> <span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">q</span><span class="main">)</span><span class="main">)</span>
  <span class="main">=</span> <span class="free">i</span><span class="main">/</span><span class="free">j</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"proj2_Col_coeff <span class="free">p</span> <span class="free">q</span> <span class="var">?r</span> <span class="main">=</span> <span class="free">i</span><span class="main">/</span><span class="free">j</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_abs_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> <span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">q</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="main">(</span><span class="free">i</span><span class="main">/</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_right_distrib<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_dependent <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span><span class="main">/</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="main">(</span><span class="free">i</span><span class="main">/</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_abs2
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="var">?r</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">i</span><span class="main">/</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="free">i</span><span class="main">/</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">q</span> <span class="main">-</span> proj2_rep <span class="var">?r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_right_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="free">i</span><span class="main">/</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">q</span> <span class="main">+</span> <span class="bound">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="var">?r</span> <span class="main">=</span> <span class="main">0</span>
    <span class="main">∧</span> <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="free">i</span><span class="main">/</span><span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">l</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_Col_def<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">≠</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="free">i</span><span class="main">/</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">q</span> <span class="main">-</span> proj2_rep <span class="var">?r</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="free">i</span><span class="main">/</span><span class="free">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_dependent <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="var">?r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> proj2_abs <span class="main">(</span>proj2_Col_coeff <span class="free">p</span> <span class="free">q</span> <span class="var">?r</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_Col_coeff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="main">(</span><span class="free">i</span><span class="main">/</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_Col_coeff_unique
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_Col_coeff <span class="free">p</span> <span class="free">q</span> <span class="var">?r</span> <span class="main">=</span> <span class="free">i</span><span class="main">/</span><span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_set_Col_coeff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span>proj2_Col_coeff <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="free">S</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_subset_Col<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> proj2_Col_iff_set_Col<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_Col_coeff
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cross_ratio_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">u</span> <span class="free">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">i</span> <span class="free">j</span> <span class="free">k</span> <span class="free">l</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">u</span> <span class="main">≠</span> proj2_abs <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="main">(</span>proj2_abs <span class="free">u</span><span class="main">)</span> <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span>
  <span class="main">(</span>proj2_abs <span class="main">(</span><span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">u</span> <span class="main">+</span> <span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>proj2_abs <span class="main">(</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">u</span> <span class="main">+</span> <span class="free">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>
  <span class="main">=</span> <span class="free">j</span> <span class="main">*</span> <span class="free">k</span> <span class="main">/</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?p</span> <span class="var">?q</span> <span class="var">?r</span> <span class="var">?s</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_abs2
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="var">?p</span> <span class="main">=</span> <span class="skolem">g</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_abs2
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="var">?q</span> <span class="main">=</span> <span class="skolem">h</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="var">?p</span> <span class="main">=</span> <span class="skolem">g</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">u</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="main">(</span><span class="free">i</span><span class="main">/</span><span class="skolem">g</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="var">?p</span> <span class="main">+</span> <span class="main">(</span><span class="free">j</span><span class="main">/</span><span class="skolem">h</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="var">?q</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="main">(</span><span class="free">k</span><span class="main">/</span><span class="skolem">g</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="var">?p</span> <span class="main">+</span> <span class="main">(</span><span class="free">l</span><span class="main">/</span><span class="skolem">h</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="var">?q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?p</span> <span class="main">≠</span> <span class="var">?q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_Col_coeff_abs
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_Col_coeff <span class="var">?p</span> <span class="var">?q</span> <span class="var">?r</span> <span class="main">=</span> <span class="skolem">h</span><span class="main">*</span><span class="free">i</span><span class="main">/</span><span class="main">(</span><span class="skolem">g</span><span class="main">*</span><span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_Col_coeff <span class="var">?p</span> <span class="var">?q</span> <span class="var">?s</span> <span class="main">=</span> <span class="skolem">h</span><span class="main">*</span><span class="free">k</span><span class="main">/</span><span class="main">(</span><span class="skolem">g</span><span class="main">*</span><span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?p</span> <span class="var">?q</span> <span class="var">?r</span> <span class="var">?s</span> <span class="main">=</span> <span class="free">j</span><span class="main">*</span><span class="free">k</span><span class="main">/</span><span class="main">(</span><span class="free">i</span><span class="main">*</span><span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cross_ratio_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cross_ratio_abs2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span>
  <span class="main">(</span>proj2_abs <span class="main">(</span><span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>proj2_abs <span class="main">(</span><span class="free">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span><span class="main">)</span>
  <span class="main">=</span> <span class="free">j</span><span class="main">/</span><span class="free">i</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="var">?r</span> <span class="var">?s</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_rep_non_zero<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?u</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?v</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_abs_rep<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?u</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cross_ratio_abs <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="var">?r</span> <span class="var">?s</span> <span class="main">=</span> <span class="free">j</span><span class="main">/</span><span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cross_ratio_correct_cltn2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="free">C</span><span class="main">)</span>
  <span class="main">(</span>apply_cltn2 <span class="free">r</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>apply_cltn2 <span class="free">s</span> <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="var">?pC</span> <span class="var">?qC</span> <span class="var">?rC</span> <span class="var">?sC</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cross_ratio_correct_def<span class="main">)</span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>apply_cltn2 <span class="bound">t</span> <span class="free">C</span> <span class="main">|</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="var">?pC</span><span class="main">,</span><span class="var">?qC</span><span class="main">,</span><span class="var">?rC</span><span class="main">,</span><span class="var">?sC</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_preserve_set_Col <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">C</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="var">?pC</span><span class="main">,</span><span class="var">?qC</span><span class="main">,</span><span class="var">?rC</span><span class="main">,</span><span class="var">?sC</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_injective
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pC</span> <span class="main">≠</span> <span class="var">?qC</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rC</span> <span class="main">≠</span> <span class="var">?pC</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?sC</span> <span class="main">≠</span> <span class="var">?pC</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rC</span> <span class="main">≠</span> <span class="var">?qC</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="var">?pC</span><span class="main">,</span><span class="var">?qC</span><span class="main">,</span><span class="var">?rC</span><span class="main">,</span><span class="var">?sC</span><span class="main">}</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="var">?pC</span> <span class="var">?qC</span> <span class="var">?rC</span> <span class="var">?sC</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cross_ratio_correct_def<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cross_ratio_cltn2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="free">C</span><span class="main">)</span>
  <span class="main">(</span>apply_cltn2 <span class="free">r</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>apply_cltn2 <span class="free">s</span> <span class="free">C</span><span class="main">)</span>
  <span class="main">=</span> cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?pC</span> <span class="var">?qC</span> <span class="var">?rC</span> <span class="var">?sC</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_Col_coeff <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?j</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_Col_coeff <span class="free">p</span> <span class="free">q</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">≠</span> <span class="free">p</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_set_Col_coeff
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uC</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vC</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?uC</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?vC</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rep_mult_rep_non_zero<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?uC</span> <span class="main">=</span> <span class="var">?pC</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?vC</span> <span class="main">=</span> <span class="var">?qC</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> apply_cltn2_def<span class="main">)</span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_injective <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pC</span> <span class="main">≠</span> <span class="var">?qC</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_dependent <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_linear <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?i</span></span></span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?u</span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?v</span></span></span></span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_linear <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?j</span></span></span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?u</span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?v</span></span></span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rC</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?uC</span> <span class="main">+</span> <span class="var">?vC</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?sC</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?uC</span> <span class="main">+</span> <span class="var">?vC</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?uC</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?vC</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="var">?uC</span> <span class="main">=</span> <span class="var">?pC</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="var">?vC</span> <span class="main">=</span> <span class="var">?qC</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pC</span> <span class="main">≠</span> <span class="var">?qC</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cross_ratio_abs <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?uC</span></span></span> <span class="var"><span class="quoted"><span class="var">?vC</span></span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">1</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="var"><span class="quoted"><span class="var">?j</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?pC</span> <span class="var">?qC</span> <span class="var">?rC</span> <span class="var">?sC</span> <span class="main">=</span> <span class="var">?j</span><span class="main">/</span><span class="var">?i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?pC</span> <span class="var">?qC</span> <span class="var">?rC</span> <span class="var">?sC</span> <span class="main">=</span> cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cross_ratio_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cross_ratio_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">t</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">t</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≠</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cross_ratio_correct_def<span class="main">)</span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_Col_coeff <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?j</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_Col_coeff <span class="free">p</span> <span class="free">q</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_Col_coeff <span class="free">p</span> <span class="free">q</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">t</span><span class="main">}</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_set_Col_coeff
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">t</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?j</span> <span class="main">=</span> <span class="var">?k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cross_ratio_def<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_three_point_line<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">r</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="free">C</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">q</span> <span class="free">C</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">r</span> <span class="free">C</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">s</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">s</span> <span class="free">C</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?sC</span> <span class="main">=</span> <span class="free">s</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">p</span> <span class="free">C</span> <span class="main">=</span> <span class="free">p</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?sC</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="free">p</span>"</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pC</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qC</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">q</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rC</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">r</span> <span class="free">C</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">r</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">s</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_set_Col_def<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cross_ratio_correct_def<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="var">?pC</span> <span class="var">?qC</span> <span class="var">?rC</span> <span class="var">?sC</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_correct_cltn2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pC</span> <span class="main">=</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?qC</span> <span class="main">=</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?rC</span> <span class="main">=</span> <span class="free">r</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="var">?sC</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">≠</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?pC</span> <span class="var">?qC</span> <span class="var">?rC</span> <span class="var">?sC</span> <span class="main">=</span> cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_cltn2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pC</span> <span class="main">=</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?qC</span> <span class="main">=</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?rC</span> <span class="main">=</span> <span class="free">r</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="var">?sC</span> <span class="main">=</span> cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="var">?sC</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?sC</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_unique<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cross_ratio_equal_cltn2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="free">C</span><span class="main">)</span>
  <span class="main">(</span>apply_cltn2 <span class="free">r</span> <span class="free">C</span><span class="main">)</span> <span class="free">t</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="var">?pC</span> <span class="var">?qC</span> <span class="var">?rC</span> <span class="free">t</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>apply_cltn2 <span class="free">r</span> <span class="free">C</span><span class="main">)</span> <span class="free">t</span>
    <span class="main">=</span> cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> apply_cltn2 <span class="free">s</span> <span class="free">C</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="var">?sC</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="var">?pC</span> <span class="var">?qC</span> <span class="var">?rC</span> <span class="var">?sC</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_correct_cltn2<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cross_ratio_correct_def<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?pC</span> <span class="var">?qC</span> <span class="var">?rC</span> <span class="var">?sC</span> <span class="main">=</span> cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_cltn2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cross_ratio <span class="var">?pC</span> <span class="var">?qC</span> <span class="var">?rC</span> <span class="free">t</span> <span class="main">=</span> cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?pC</span> <span class="var">?qC</span> <span class="var">?rC</span> <span class="free">t</span> <span class="main">=</span> cross_ratio <span class="var">?pC</span> <span class="var">?qC</span> <span class="var">?rC</span> <span class="var">?sC</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="var">?pC</span> <span class="var">?qC</span> <span class="var">?rC</span> <span class="free">t</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="var">?pC</span> <span class="var">?qC</span> <span class="var">?rC</span> <span class="var">?sC</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="var">?sC</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_unique<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_Col_distinct_coeff_non_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_Col_coeff <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proj2_Col_coeff <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="main">(</span>proj2_Col_coeff <span class="free">p</span> <span class="free">q</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_Col_coeff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_Col_coeff <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cross_ratio_product<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span> <span class="main">*</span> cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">s</span> <span class="free">t</span> <span class="main">=</span> cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">s</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">≠</span> <span class="free">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_Col_coeff <span class="free">p</span> <span class="free">q</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_Col_distinct_coeff_non_zero<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span> <span class="main">*</span> cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">s</span> <span class="free">t</span> <span class="main">=</span> cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cross_ratio_def<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cross_ratio_equal_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">r</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_Col_coeff <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_Col_distinct_coeff_non_zero<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">r</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cross_ratio_def<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cross_ratio_1_equal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cross_ratio_correct_def<span class="main">)</span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_subset_Col <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cross_ratio_correct_def<span class="main">)</span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> proj2_Col_iff_set_Col<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">r</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cross_ratio_equal_1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> <span class="main">1</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">r</span> <span class="main">=</span> cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_unique<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cross_ratio_swap_34<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">s</span> <span class="free">r</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cross_ratio_def<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> cross_ratio_swap_13_24<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">r</span> <span class="free">s</span> <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cross_ratio_correct_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_rep_non_zero<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> proj2_abs <span class="var">?u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> proj2_abs <span class="var">?v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?u</span> <span class="main">≠</span> proj2_abs <span class="var">?v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_Col_coeff <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?j</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_Col_coeff <span class="free">p</span> <span class="free">q</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">≠</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> proj2_abs <span class="var">?w</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> proj2_abs <span class="var">?x</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_set_Col_coeff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="main">≠</span> <span class="var">?j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?u</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="var">?u</span> <span class="main">≠</span> proj2_abs <span class="var">?v</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> dependent_proj2_abs <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">_</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="main">-</span> <span class="var">?x</span> <span class="main">=</span> <span class="main">(</span><span class="var">?i</span> <span class="main">-</span> <span class="var">?j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?i</span> <span class="main">≠</span> <span class="var">?j</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?w</span> <span class="main">-</span> <span class="var">?x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_mult_rep<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?w</span> <span class="main">-</span> <span class="var">?i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?x</span> <span class="main">=</span> <span class="main">(</span><span class="var">?j</span> <span class="main">-</span> <span class="var">?i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?i</span> <span class="main">≠</span> <span class="var">?j</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?w</span> <span class="main">-</span> <span class="var">?i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_mult_rep<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?w</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">s</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?i</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">=</span> proj2_abs <span class="var">?w</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">=</span> proj2_abs <span class="var">?x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="var">?w</span> <span class="main">-</span> <span class="var">?x</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cross_ratio_abs <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="var">?i</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="var"><span class="quoted"><span class="var">?j</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">r</span> <span class="free">s</span> <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> <span class="var">?j</span> <span class="main">/</span> <span class="var">?i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">r</span> <span class="free">s</span> <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cross_ratio_def <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">q</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">s</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cross_ratio_swap_12<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="free">q</span> <span class="free">p</span> <span class="free">r</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">q</span> <span class="free">p</span> <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">s</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cross_ratio_correct_def<span class="main">)</span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">=</span> <span class="free">s</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_Col_iff_set_Col<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">q</span> <span class="free">p</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_Col_permute<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">=</span> <span class="free">s</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">q</span> <span class="free">p</span> <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cross_ratio_equal_1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">q</span> <span class="free">p</span> <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="free">q</span> <span class="free">p</span> <span class="free">r</span> <span class="free">s</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">q</span> <span class="free">p</span> <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> cross_ratio <span class="free">r</span> <span class="free">s</span> <span class="free">q</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cross_ratio_swap_13_24<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>cross_ratio <span class="free">r</span> <span class="free">s</span> <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_swap_34<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">s</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cross_ratio_swap_13_24<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">q</span> <span class="free">p</span> <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Cartesian subspace of the real projective plane"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vector2_append1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">2</span> <span class="main">⇒</span> real<span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">vector2_append1</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> vector <span class="main">[</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">$</span><span class="main">1</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">$</span><span class="numeral">2</span><span class="main">,</span> <span class="main">1</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vector2_append1_non_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"vector2_append1 <span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector2_append1 <span class="free">v</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="main">≠</span> <span class="main">0</span><span class="main">$</span><span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vector2_append1_def <span class="keyword2"><span class="keyword">and</span></span> vector_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"vector2_append1 <span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proj2_pt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">2</span> <span class="main">⇒</span> proj2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proj2_pt</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> proj2_abs <span class="main">(</span>vector2_append1 <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_pt_scalar<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> proj2_rep <span class="main">(</span>proj2_pt <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector2_append1 <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proj2_pt_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_rep_abs2 vector2_append1_non_zero<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">z_non_zero</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">z_non_zero</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">(</span>proj2_rep <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cart2_pt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> real<span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cart2_pt</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span>
  vector <span class="main">[</span><span class="main">(</span>proj2_rep <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">$</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>proj2_rep <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span><span class="main">,</span> <span class="main">(</span>proj2_rep <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">$</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span>proj2_rep <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cart2_append1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> real<span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cart2_append1</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span>  <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span>proj2_rep <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cart2_append1_z<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cart2_append1 <span class="free">p</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cart2_append1_def<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> cart2_append1_non_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cart2_append1 <span class="free">p</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cart2_append1_z<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral">3</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_rep_cart2_append1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cart2_append1_def<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_abs_cart2_append1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span>cart2_append1 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span>cart2_append1 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cart2_append1_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_mult<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span>cart2_append1 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cart2_append1_inj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="free">p</span> <span class="main">=</span> cart2_append1 <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cart2_append1 <span class="free">p</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cart2_append1_z<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cart2_append1 <span class="free">p</span> <span class="main">=</span> cart2_append1 <span class="free">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cart2_append1 <span class="free">q</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cart2_append1_def<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cart2_append1 <span class="free">p</span> <span class="main">=</span> cart2_append1 <span class="free">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span>cart2_append1 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="main">(</span>cart2_append1 <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">q</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_cart2_append1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cart2_append1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vector2_append1 <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">=</span> cart2_append1 <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vector2_append1_def
    <span class="keyword2"><span class="keyword">and</span></span> cart2_append1_def
    <span class="keyword2"><span class="keyword">and</span></span> cart2_pt_def
    <span class="keyword2"><span class="keyword">and</span></span> vector_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cart2_proj2<span class="main">:</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="main">(</span>proj2_pt <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector2_append1 <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_pt <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> proj2_pt_scalar
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="var">?p</span> <span class="main">=</span> <span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cart2_pt <span class="var">?p</span><span class="main">)</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="free">v</span><span class="main">$</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cart2_pt <span class="var">?p</span><span class="main">)</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">v</span><span class="main">$</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cart2_pt_def <span class="keyword2"><span class="keyword">and</span></span> vector2_append1_def <span class="keyword2"><span class="keyword">and</span></span> vector_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?p</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> z_non_zero_proj2_pt<span class="main">:</span> <span class="quoted"><span class="quoted">"z_non_zero <span class="main">(</span>proj2_pt <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> proj2_pt_scalar
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">(</span>proj2_pt <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>vector2_append1 <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="main">(</span>proj2_pt <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>vector2_append1 <span class="free">v</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>proj2_rep <span class="main">(</span>proj2_pt <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vector2_append1_def <span class="keyword2"><span class="keyword">and</span></span> vector_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="main">(</span>proj2_pt <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cart2_append1_proj2<span class="main">:</span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="main">(</span>proj2_pt <span class="free">v</span><span class="main">)</span> <span class="main">=</span> vector2_append1 <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> z_non_zero_proj2_pt
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="main">(</span>proj2_pt <span class="free">v</span><span class="main">)</span> <span class="main">=</span> vector2_append1 <span class="main">(</span>cart2_pt <span class="main">(</span>proj2_pt <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cart2_append1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="main">(</span>proj2_pt <span class="free">v</span><span class="main">)</span> <span class="main">=</span> vector2_append1 <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cart2_proj2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_pt_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj proj2_pt"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_inverseI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">UNIV</span> <span class="quoted">cart2_pt</span> <span class="quoted">proj2_pt</span><span class="main"><span class="main">]</span></span> cart2_proj2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_cart2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector2_append1 <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">=</span> proj2_rep <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vector2_append1_def <span class="keyword2"><span class="keyword">and</span></span> cart2_pt_def <span class="keyword2"><span class="keyword">and</span></span> vector_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_abs_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span>"</span></span> <span class="quoted"><span class="quoted">"vector2_append1 <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span>vector2_append1 <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_pt_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cart2_injective<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">p</span> <span class="main">=</span> cart2_pt <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_cart2<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_pt <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹cart2_pt <span class="free">p</span> <span class="main">=</span> cart2_pt <span class="free">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_pt <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_Col_iff_euclid<span class="main">:</span>
  <span class="quoted"><span class="quoted">"proj2_Col <span class="main">(</span>proj2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>proj2_pt <span class="free">b</span><span class="main">)</span> <span class="main">(</span>proj2_pt <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> real_euclid.Col <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="var">?p</span> <span class="var">?q</span> <span class="var">?r</span> <span class="main">⟷</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector2_append1 <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector2_append1 <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector2_append1 <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="var">?p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="var">?q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="var">?r</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> proj2_pt_scalar <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a''</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b''</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c''</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a'</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a''</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b'</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b''</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c'</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c''</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="var">?p</span> <span class="var">?q</span> <span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">j'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a''</span> <span class="main">+</span> <span class="skolem">j'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b''</span> <span class="main">+</span> <span class="skolem">k'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c''</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span><span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">j'</span><span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">k'</span><span class="main">≠</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> proj2_Col_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">*</span> <span class="skolem">i'</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?j''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">*</span> <span class="skolem">j'</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="skolem">k'</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i'</span><span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">j'</span><span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">k'</span><span class="main">≠</span><span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i''</span><span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> <span class="var">?j''</span><span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> <span class="var">?k''</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a''</span> <span class="main">+</span> <span class="skolem">j'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b''</span> <span class="main">+</span> <span class="skolem">k'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c''</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a''</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?b''</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b'</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?c''</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c'</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="var">?j''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b'</span> <span class="main">+</span> <span class="var">?k''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?i''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="var">?j''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b'</span> <span class="main">+</span> <span class="var">?k''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c'</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i''</span> <span class="main">+</span> <span class="var">?j''</span> <span class="main">+</span> <span class="var">?k''</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> vector2_append1_def <span class="keyword2"><span class="keyword">and</span></span> vector_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?i''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="var">?j''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b'</span> <span class="main">+</span> <span class="var">?k''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c'</span><span class="main">)</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span>
      <span class="main">(</span><span class="var">?i''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="var">?j''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">b</span> <span class="main">+</span> <span class="var">?k''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">c</span><span class="main">)</span><span class="main">$</span><span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?i''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="var">?j''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b'</span> <span class="main">+</span> <span class="var">?k''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c'</span><span class="main">)</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span>
      <span class="main">(</span><span class="var">?i''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="var">?j''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">b</span> <span class="main">+</span> <span class="var">?k''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">c</span><span class="main">)</span><span class="main">$</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> vector2_append1_def <span class="keyword2"><span class="keyword">and</span></span> vector_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?i''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="var">?j''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b'</span> <span class="main">+</span> <span class="var">?k''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c'</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="var">?j''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">b</span> <span class="main">+</span> <span class="var">?k''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_2<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dep2 <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k''</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?i''</span> <span class="main">+</span> <span class="var">?j''</span> <span class="main">+</span> <span class="var">?k''</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?j''</span> <span class="main">=</span> <span class="main">-</span><span class="var">?i''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?i''</span><span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> <span class="var">?j''</span><span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> <span class="var">?k''</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?k''</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i''</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?i''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="var">?j''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">b</span> <span class="main">+</span> <span class="var">?k''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?k''</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?j''</span> <span class="main">=</span> <span class="main">-</span><span class="var">?i''</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="var">?i''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?i''</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span> <span class="bound">t</span> <span class="bound">s</span><span class="main">.</span> <span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"dep2 <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dep2_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k''</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?i''</span> <span class="main">+</span> <span class="var">?j''</span> <span class="main">+</span> <span class="var">?k''</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i''</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="var">?j''</span> <span class="main">+</span> <span class="var">?k''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?i''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="var">?j''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">b</span> <span class="main">+</span> <span class="var">?k''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="var">?j''</span> <span class="main">+</span> <span class="var">?k''</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="var">?j''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">b</span> <span class="main">+</span> <span class="var">?k''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="var">?j''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_left_distrib
          scaleR_right_diff_distrib
          scaleR_left_diff_distrib
          <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="var">?k''</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?k''</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="var">?j''</span> <span class="main">/</span> <span class="var">?k''</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?k''</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="var">?j''</span> <span class="main">/</span> <span class="var">?k''</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span> <span class="bound">t</span> <span class="bound">s</span><span class="main">.</span> <span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"dep2 <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dep2_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> Col_dep2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real_euclid.Col <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"real_euclid.Col <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> Col_dep2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dep2 <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> dep2_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="var">?p</span> <span class="var">?q</span> <span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> proj2_Col_coincide <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="var">?p</span> <span class="var">?q</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">b</span> <span class="main">+</span> <span class="skolem">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_right_diff_distrib
          scaleR_left_diff_distrib
          <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b'</span> <span class="main">+</span> <span class="skolem">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c'</span><span class="main">)</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b'</span> <span class="main">+</span> <span class="skolem">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c'</span><span class="main">)</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> vector2_append1_def <span class="keyword2"><span class="keyword">and</span></span> vector_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b'</span> <span class="main">+</span> <span class="skolem">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c'</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> vector2_append1_def <span class="keyword2"><span class="keyword">and</span></span> vector_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a'</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b'</span> <span class="main">+</span> <span class="skolem">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a'</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a''</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?b'</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b''</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?c'</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c''</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span><span class="main">/</span><span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?a''</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?b''</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">t</span><span class="main">/</span><span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?c''</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">/</span><span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="var">?p</span> <span class="var">?q</span> <span class="var">?r</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> proj2_Col_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_Col_iff_euclid_cart2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="main">⟷</span> real_euclid.Col <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟷</span> real_euclid.Col <span class="var">?a</span> <span class="var">?b</span> <span class="var">?c</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">r</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="var">?a</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="var">?b</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="var">?c</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_cart2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> proj2_Col_iff_euclid <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="main">⟷</span> real_euclid.Col <span class="var">?a</span> <span class="var">?b</span> <span class="var">?c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> euclid_Col_cart2_incident<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"real_euclid.Col <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"real_euclid.Col <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cr</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">r</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹real_euclid.Col <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cr</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> proj2_Col_iff_euclid_cart2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_Col_iff_set_Col<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">r</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_set_Col_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="skolem">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="skolem">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_unique
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">r</span> <span class="skolem">m</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">r</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> euclid_B_cart2_common_line<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cr</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">l</span><span class="main">.</span> proj2_incident <span class="free">p</span> <span class="bound">l</span> <span class="main">∧</span> proj2_incident <span class="free">q</span> <span class="bound">l</span> <span class="main">∧</span> proj2_incident <span class="free">r</span> <span class="bound">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cr</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_Col_iff_euclid_cart2
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_euclid.Col_def<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_Col_iff_set_Col<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">l</span><span class="main">.</span> proj2_incident <span class="free">p</span> <span class="bound">l</span> <span class="main">∧</span> proj2_incident <span class="free">q</span> <span class="bound">l</span> <span class="main">∧</span> proj2_incident <span class="free">r</span> <span class="bound">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_set_Col_def<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cart2_append1_between<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">r</span><span class="main">)</span>
  <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound"><span class="bound">k</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="main">1</span>
  <span class="main">∧</span> cart2_append1 <span class="free">q</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">r</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cp1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector2_append1 <span class="var">?cp</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cq1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector2_append1 <span class="var">?cq</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cr1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector2_append1 <span class="var">?cr</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">r</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cp1</span> <span class="main">=</span> cart2_append1 <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cq1</span> <span class="main">=</span> cart2_append1 <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cr1</span> <span class="main">=</span> cart2_append1 <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cart2_append1<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">k</span><span class="main">.</span> <span class="var">?cq</span> <span class="main">-</span> <span class="var">?cp</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?cr</span> <span class="main">-</span> <span class="var">?cp</span><span class="main">)</span> <span class="main">⟷</span> <span class="var">?cq</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cr</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">k</span><span class="main">.</span> <span class="var">?cq</span> <span class="main">-</span> <span class="var">?cp</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?cr</span> <span class="main">-</span> <span class="var">?cp</span><span class="main">)</span>
    <span class="main">⟷</span> <span class="var">?cq1</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cr1</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vector2_append1_def <span class="keyword2"><span class="keyword">and</span></span> vector_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_2 forall_3<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cp1</span> <span class="main">=</span> cart2_append1 <span class="free">p</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cq1</span> <span class="main">=</span> cart2_append1 <span class="free">q</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cr1</span> <span class="main">=</span> cart2_append1 <span class="free">r</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">k</span><span class="main">.</span> <span class="var">?cq</span> <span class="main">-</span> <span class="var">?cp</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?cr</span> <span class="main">-</span> <span class="var">?cp</span><span class="main">)</span>
    <span class="main">⟷</span> cart2_append1 <span class="free">q</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">r</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">r</span><span class="main">)</span>
    <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound"><span class="bound">k</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="main">1</span>
    <span class="main">∧</span> cart2_append1 <span class="free">q</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">r</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_euclid_B_def<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cart2_append1_between_right_strict<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">k</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="main">1</span>
  <span class="main">∧</span> cart2_append1 <span class="free">q</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">r</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">r</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cart2_append1_between
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="free">q</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">r</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cart2_append1 <span class="free">q</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">r</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="free">q</span> <span class="main">=</span> cart2_append1 <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cart2_append1_inj<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="free">r</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≥</span> <span class="main">0</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹cart2_append1 <span class="free">q</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">r</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">p</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">k</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="main">1</span>
    <span class="main">∧</span> cart2_append1 <span class="free">q</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">r</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cart2_append1_between_strict<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="main">1</span>
  <span class="main">∧</span> cart2_append1 <span class="free">q</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">r</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">r</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cart2_append1_between_right_strict <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="free">q</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">r</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cart2_append1 <span class="free">q</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">r</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="free">q</span> <span class="main">=</span> cart2_append1 <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cart2_append1_inj<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹cart2_append1 <span class="free">q</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">r</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">p</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="main">1</span>
    <span class="main">∧</span> cart2_append1 <span class="free">q</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">r</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Hyperbolic_Tarski">
<div class="head">
<h1>Theory Hyperbolic_Tarski</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       The hyperbolic plane and Tarski's axioms
    Author:      Tim Makarios &lt;tjm1983 at gmail.com&gt;, 2012
    Maintainer:  Tim Makarios &lt;tjm1983 at gmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"The hyperbolic plane and Tarski's axioms"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Hyperbolic_Tarski
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Euclid_Tarski.html">Euclid_Tarski</a>
  <a href="Projective.html">Projective</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Quadratic_Discriminant.html">HOL-Library.Quadratic_Discriminant</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Characterizing a specific conic in the projective plane›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">≡</span> vector <span class="main">[</span>
  vector <span class="main">[</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
  vector <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
  vector <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> M_symmatrix<span class="main">:</span> <span class="quoted"><span class="quoted">"symmatrix M"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symmatrix_def <span class="keyword2"><span class="keyword">and</span></span> transpose_def <span class="keyword2"><span class="keyword">and</span></span> M_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3 vector_3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> M_self_inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"M <span class="main">**</span> M <span class="main">=</span> mat <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> M_def <span class="keyword2"><span class="keyword">and</span></span> matrix_matrix_mult_def <span class="keyword2"><span class="keyword">and</span></span> mat_def <span class="keyword2"><span class="keyword">and</span></span> vector_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_3 vec_eq_iff forall_3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> M_invertible<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible M"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> invertible_def
  <span class="keyword1"><span class="command">using</span></span> M_self_inverse
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">polar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> proj2_line"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">polar</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> proj2_line_abs <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pole</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2_line <span class="main">⇒</span> proj2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pole</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≡</span> proj2_abs <span class="main">(</span>M <span class="keyword1">*v</span> proj2_line_rep <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> polar_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"polar <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> proj2_line_abs <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_abs2
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"polar <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> proj2_line_abs <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> polar_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_scaleR_vector_ac scaleR_matrix_vector_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_line_abs_mult
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"polar <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> proj2_line_abs <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pole_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pole <span class="main">(</span>proj2_line_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_line_rep_abs
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_line_rep <span class="main">(</span>proj2_line_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_line_rep <span class="main">(</span>proj2_line_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pole <span class="main">(</span>proj2_line_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pole_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_scaleR_vector_ac scaleR_matrix_vector_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_abs_mult
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pole <span class="main">(</span>proj2_line_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> polar_rep_non_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"M <span class="keyword1">*v</span> proj2_rep <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_rep_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> M_invertible
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"M <span class="keyword1">*v</span> proj2_rep <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> invertible_times_non_zero<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pole_polar<span class="main">:</span> <span class="quoted"><span class="quoted">"pole <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> polar_rep_non_zero
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pole <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="main">(</span>M <span class="keyword1">*v</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> polar_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pole_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> M_self_inverse
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pole <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_vector_mul_assoc proj2_abs_rep<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pole_rep_non_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"M <span class="keyword1">*v</span> proj2_line_rep <span class="free">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_line_rep <span class="free">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_line_rep_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> M_invertible
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"M <span class="keyword1">*v</span> proj2_line_rep <span class="free">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> invertible_times_non_zero<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> polar_pole<span class="main">:</span> <span class="quoted"><span class="quoted">"polar <span class="main">(</span>pole <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> pole_rep_non_zero
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"polar <span class="main">(</span>pole <span class="free">l</span><span class="main">)</span> <span class="main">=</span> proj2_line_abs <span class="main">(</span>M <span class="keyword1">*v</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_line_rep <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pole_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> polar_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> M_self_inverse
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"polar <span class="main">(</span>pole <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_vector_mul_assoc proj2_line_abs_rep
      matrix_vector_mul_lid<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> polar_inj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"polar <span class="free">p</span> <span class="main">=</span> polar <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹polar <span class="free">p</span> <span class="main">=</span> polar <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pole <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span> <span class="main">=</span> pole <span class="main">(</span>polar <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pole_polar<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">conic_sgn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">conic_sgn</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> sgn <span class="main">(</span>proj2_rep <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conic_sgn_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conic_sgn <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span><span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_abs2
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">v</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conic_sgn <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span><span class="skolem">j</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> conic_sgn_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>
      matrix_scaleR_vector_ac
      scaleR_matrix_vector_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
      dot_scaleR_mult
      power2_eq_square
      <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sgn <span class="main">(</span><span class="skolem">j</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> sgn <span class="main">(</span><span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sgn_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sgn <span class="main">(</span><span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square sgn_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"conic_sgn <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span><span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sgn_conic_sgn<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>conic_sgn <span class="free">p</span><span class="main">)</span> <span class="main">=</span> conic_sgn <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> conic_sgn_def<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> conic_sgn <span class="bound">p</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">K2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">K2</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> conic_sgn <span class="bound">p</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> S_K2_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"S <span class="main">∩</span> K2 <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword2"><span class="keyword">and</span></span> K2_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> K2_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">v</span> <span class="main">∈</span> K2 <span class="main">⟷</span> <span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">v</span> <span class="main">∈</span> K2 <span class="main">⟷</span> conic_sgn <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> K2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> conic_sgn_abs
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">v</span> <span class="main">∈</span> K2 <span class="main">⟷</span> <span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">K2_centre</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> K2_centre_non_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> vector_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> K2_centre_in_K2<span class="main">:</span> <span class="quoted"><span class="quoted">"K2_centre <span class="main">∈</span> K2"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> K2_centre_non_zero <span class="keyword2"><span class="keyword">and</span></span> proj2_rep_abs2
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep K2_centre <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> K2_centre_def<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_rep K2_centre <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"K2_centre <span class="main">∈</span> K2"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> K2_def
      <span class="keyword2"><span class="keyword">and</span></span> conic_sgn_def
      <span class="keyword2"><span class="keyword">and</span></span> M_def
      <span class="keyword2"><span class="keyword">and</span></span> matrix_vector_mult_def
      <span class="keyword2"><span class="keyword">and</span></span> inner_vec_def
      <span class="keyword2"><span class="keyword">and</span></span> vector_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff sum_3 power2_eq_square<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> K2_imp_M_neg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">v</span> <span class="main">∈</span> K2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> K2_abs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> M_neg_imp_z_squared_big<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">v</span><span class="main">$</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">v</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_mult_def <span class="keyword2"><span class="keyword">and</span></span> M_def <span class="keyword2"><span class="keyword">and</span></span> vector_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_vec_def sum_3 power2_eq_square<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> M_neg_imp_z_non_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">$</span><span class="numeral">3</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">$</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">v</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> M_neg_imp_z_squared_big <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">$</span><span class="numeral">3</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> M_neg_imp_K2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">v</span> <span class="main">∈</span> K2"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">$</span><span class="numeral">3</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M_neg_imp_z_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> K2_abs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">v</span> <span class="main">∈</span> K2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> M_reverse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_mult_def <span class="keyword2"><span class="keyword">and</span></span> M_def <span class="keyword2"><span class="keyword">and</span></span> vector_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_vec_def sum_3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> S_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">v</span> <span class="main">∈</span> S <span class="main">⟷</span> <span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">v</span> <span class="main">∈</span> S <span class="main">⟷</span> conic_sgn <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> S_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> conic_sgn_abs
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> sgn <span class="main">(</span><span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">v</span> <span class="main">∈</span> S <span class="main">⟷</span> <span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_0_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> S_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S <span class="main">⟷</span> proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_rep_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> S <span class="main">⟷</span> proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> S_abs<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S <span class="main">⟷</span> proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> incident_polar<span class="main">:</span>
  <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="main">(</span>polar <span class="free">q</span><span class="main">)</span> <span class="main">⟷</span> proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> polar_rep_non_zero
  <span class="keyword1"><span class="command">unfolding</span></span> polar_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_incident_right_abs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> incident_own_polar_in_S<span class="main">:</span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">∈</span> S"</span></span>
  <span class="keyword1"><span class="command">using</span></span> incident_polar <span class="keyword2"><span class="keyword">and</span></span> S_alt_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> incident_polar_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="main">(</span>polar <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="main">(</span>polar <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> incident_polar<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">q</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_reverse<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> incident_polar<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> incident_pole_polar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>pole <span class="free">l</span><span class="main">)</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="main">(</span>polar <span class="main">(</span>pole <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> polar_pole<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>pole <span class="free">l</span><span class="main">)</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> incident_polar_swap<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">z_zero</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2_line"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">z_zero</span> <span class="main">≡</span> proj2_line_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> z_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> z_zero"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> K2_centre_non_zero <span class="keyword2"><span class="keyword">and</span></span> proj2_line_rep_abs
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"proj2_line_rep z_zero <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> z_zero_def<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> z_zero"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj2_incident_def <span class="keyword2"><span class="keyword">and</span></span> inner_vec_def <span class="keyword2"><span class="keyword">and</span></span> vector_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> z_zero_conic_sgn_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> z_zero"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conic_sgn <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vector_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> z_zero›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∙</span> vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> z_zero_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_incident_right_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inner_vec_def <span class="keyword2"><span class="keyword">and</span></span> vector_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?v</span><span class="main">$</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="var">?v</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inner_vec_def
      <span class="keyword2"><span class="keyword">and</span></span> power2_eq_square
      <span class="keyword2"><span class="keyword">and</span></span> matrix_vector_mult_def
      <span class="keyword2"><span class="keyword">and</span></span> M_def
      <span class="keyword2"><span class="keyword">and</span></span> vector_def
      <span class="keyword2"><span class="keyword">and</span></span> sum_3
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_rep_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?v</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span><span class="main">$</span><span class="main">1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?v</span><span class="main">$</span><span class="numeral">2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?v</span><span class="main">$</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?v</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> add_sign_intros <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span></span><span class="var"><span class="var"><span class="var"><span class="var"><span class="var"><span class="var"><span class="var"><span class="var">?v</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">$</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">1</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="hidden">⇧</span><sup>2</sup></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span></span><span class="var"><span class="var"><span class="var"><span class="var"><span class="var"><span class="var"><span class="var"><span class="var">?v</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">$</span></span></span></span></span></span></span></span><span class="numeral"><span class="numeral"><span class="numeral"><span class="numeral"><span class="numeral"><span class="numeral"><span class="numeral"><span class="numeral">2</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="hidden">⇧</span><sup>2</sup></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?v</span><span class="main">$</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="var">?v</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?v</span><span class="main">$</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="var">?v</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?v</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"conic_sgn <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> conic_sgn_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conic_sgn_not_1_z_non_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"conic_sgn <span class="free">p</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹conic_sgn <span class="free">p</span> <span class="main">≠</span> <span class="main">1</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_incident <span class="free">p</span> z_zero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> z_zero_conic_sgn_1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> z_zero<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> z_zero_not_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> z_zero"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∉</span> S"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> z_zero›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conic_sgn <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> z_zero_conic_sgn_1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∉</span> S"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> S_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> line_incident_point_not_in_S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∉</span> S <span class="main">∧</span> proj2_incident <span class="bound">p</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_intersection <span class="free">l</span> z_zero"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?p</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?p</span> z_zero"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_intersection_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?p</span> z_zero›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∉</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> z_zero_not_in_S<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?p</span> <span class="free">l</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∉</span> S <span class="main">∧</span> proj2_incident <span class="bound">p</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_abs_abs_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">(</span>cltn2_abs <span class="free">J</span><span class="main">)</span> <span class="main">∈</span> S
  <span class="main">⟷</span> <span class="free">v</span> <span class="main">∙</span> <span class="main">(</span><span class="free">J</span> <span class="main">**</span> M <span class="main">**</span> transpose <span class="free">J</span> <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">v*</span> <span class="free">J</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> non_zero_mult_invertible_non_zero<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">(</span>cltn2_abs <span class="free">J</span><span class="main">)</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="free">v</span> <span class="keyword1">v*</span> <span class="free">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> apply_cltn2_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="keyword1">v*</span> <span class="free">J</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> S <span class="main">⟷</span> <span class="main">(</span><span class="free">v</span> <span class="keyword1">v*</span> <span class="free">J</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="main">(</span><span class="free">v</span> <span class="keyword1">v*</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> S_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">(</span>cltn2_abs <span class="free">J</span><span class="main">)</span> <span class="main">∈</span> S
    <span class="main">⟷</span> <span class="free">v</span> <span class="main">∙</span> <span class="main">(</span><span class="free">J</span> <span class="main">**</span> M <span class="main">**</span> transpose <span class="free">J</span> <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dot_lmul_matrix matrix_vector_mul_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_right_abs_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="main">(</span>cltn2_abs <span class="free">J</span><span class="main">)</span> <span class="main">∈</span> S
  <span class="main">⟷</span> <span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="free">J</span> <span class="main">**</span> M <span class="main">**</span> transpose <span class="free">J</span> <span class="keyword1">*v</span> <span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_rep_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cltn2_abs <span class="free">J</span><span class="main">)</span> <span class="main">∈</span> S
    <span class="main">⟷</span> proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span><span class="free">J</span> <span class="main">**</span> M <span class="main">**</span> transpose <span class="free">J</span> <span class="keyword1">*v</span> proj2_rep <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apply_cltn2_abs_abs_in_S<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="main">(</span>cltn2_abs <span class="free">J</span><span class="main">)</span> <span class="main">∈</span> S
    <span class="main">⟷</span> proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span><span class="free">J</span> <span class="main">**</span> M <span class="main">**</span> transpose <span class="free">J</span> <span class="keyword1">*v</span> proj2_rep <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_abs_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="free">C</span> <span class="main">∈</span> S
  <span class="main">⟷</span> <span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>cltn2_rep <span class="free">C</span> <span class="main">**</span> M <span class="main">**</span> transpose <span class="main">(</span>cltn2_rep <span class="free">C</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>cltn2_rep <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cltn2_rep_invertible<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="main">(</span>cltn2_abs <span class="main">(</span>cltn2_rep <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> S
    <span class="main">⟷</span> <span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>cltn2_rep <span class="free">C</span> <span class="main">**</span> M <span class="main">**</span> transpose <span class="main">(</span>cltn2_rep <span class="free">C</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> apply_cltn2_abs_abs_in_S<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="free">v</span><span class="main">)</span> <span class="free">C</span> <span class="main">∈</span> S
    <span class="main">⟷</span> <span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>cltn2_rep <span class="free">C</span> <span class="main">**</span> M <span class="main">**</span> transpose <span class="main">(</span>cltn2_rep <span class="free">C</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2_abs_rep<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_in_S<span class="main">:</span>
  <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="free">C</span> <span class="main">∈</span> S
  <span class="main">⟷</span> proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>cltn2_rep <span class="free">C</span> <span class="main">**</span> M <span class="main">**</span> transpose <span class="main">(</span>cltn2_rep <span class="free">C</span><span class="main">)</span> <span class="keyword1">*v</span> proj2_rep <span class="free">p</span><span class="main">)</span>
  <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_rep_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>proj2_abs <span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">C</span> <span class="main">∈</span> S
    <span class="main">⟷</span> proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>cltn2_rep <span class="free">C</span> <span class="main">**</span> M <span class="main">**</span> transpose <span class="main">(</span>cltn2_rep <span class="free">C</span><span class="main">)</span> <span class="keyword1">*v</span> proj2_rep <span class="free">p</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> apply_cltn2_abs_in_S<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="free">C</span> <span class="main">∈</span> S
    <span class="main">⟷</span> proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>cltn2_rep <span class="free">C</span> <span class="main">**</span> M <span class="main">**</span> transpose <span class="main">(</span>cltn2_rep <span class="free">C</span><span class="main">)</span> <span class="keyword1">*v</span> proj2_rep <span class="free">p</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> norm_M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector2_append1 <span class="free">v</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> vector2_append1 <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>norm <span class="free">v</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm <span class="free">v</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span><span class="main">$</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">v</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> norm_vec_def
      <span class="keyword2"><span class="keyword">and</span></span> L2_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector2_append1 <span class="free">v</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> vector2_append1 <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>norm <span class="free">v</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vector2_append1_def
      <span class="keyword2"><span class="keyword">and</span></span> inner_vec_def
      <span class="keyword2"><span class="keyword">and</span></span> matrix_vector_mult_def
      <span class="keyword2"><span class="keyword">and</span></span> vector_def
      <span class="keyword2"><span class="keyword">and</span></span> M_def
      <span class="keyword2"><span class="keyword">and</span></span> power2_norm_eq_inner
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_3 power2_eq_square<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Some specific points and lines of the projective plane›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">east</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">west</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">north</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">south</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">far_north</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> compass_defs <span class="main">=</span> east_def west_def north_def south_def

<span class="keyword1"><span class="command">lemma</span></span> compass_non_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vector_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> east_west_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"east <span class="main">≠</span> west"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"east <span class="main">=</span> west"</span></span>
  <span class="keyword1"><span class="command">with</span></span> compass_non_zero
    <span class="keyword2"><span class="keyword">and</span></span> proj2_abs_abs_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> compass_defs
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">unfolding</span></span> vector_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> north_south_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"north <span class="main">≠</span> south"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"north <span class="main">=</span> south"</span></span>
  <span class="keyword1"><span class="command">with</span></span> compass_non_zero
    <span class="keyword2"><span class="keyword">and</span></span> proj2_abs_abs_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> compass_defs
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">unfolding</span></span> vector_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> north_not_east_or_west<span class="main">:</span> <span class="quoted"><span class="quoted">"north <span class="main">∉</span> <span class="main">{</span>east<span class="main">,</span> west<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"north <span class="main">∈</span> <span class="main">{</span>east<span class="main">,</span> west<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"east <span class="main">=</span> north <span class="main">∨</span> west <span class="main">=</span> north"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> compass_non_zero
    <span class="keyword2"><span class="keyword">and</span></span> proj2_abs_abs_mult <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>
    <span class="main">∨</span> <span class="main">(</span>vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> compass_defs
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">unfolding</span></span> vector_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> compass_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"east <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"west <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"north <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"south <span class="main">∈</span> S"</span></span>
  <span class="keyword1"><span class="command">using</span></span> compass_non_zero <span class="keyword2"><span class="keyword">and</span></span> S_abs
  <span class="keyword1"><span class="command">unfolding</span></span> compass_defs
    <span class="keyword2"><span class="keyword">and</span></span> M_def
    <span class="keyword2"><span class="keyword">and</span></span> inner_vec_def
    <span class="keyword2"><span class="keyword">and</span></span> matrix_vector_mult_def
    <span class="keyword2"><span class="keyword">and</span></span> vector_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> east_west_tangents<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"polar east <span class="main">=</span> proj2_line_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"polar west <span class="main">=</span> proj2_line_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"M <span class="keyword1">*v</span> vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"M <span class="keyword1">*v</span> vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> M_def <span class="keyword2"><span class="keyword">and</span></span> matrix_vector_mult_def <span class="keyword2"><span class="keyword">and</span></span> vector_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff sum_3<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> compass_non_zero <span class="keyword2"><span class="keyword">and</span></span> polar_abs
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"polar east <span class="main">=</span> proj2_line_abs <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"polar west <span class="main">=</span> proj2_line_abs <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> compass_defs
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> proj2_line_abs_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"polar east <span class="main">=</span> proj2_line_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"polar west <span class="main">=</span> proj2_line_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> east_west_tangents_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"polar east <span class="main">≠</span> polar west"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"polar east <span class="main">=</span> polar west"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"east <span class="main">=</span> west"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> polar_inj<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> east_west_distinct <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> east_west_tangents_incident_far_north<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident far_north <span class="main">(</span>polar east<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident far_north <span class="main">(</span>polar west<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> compass_non_zero <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_abs
  <span class="keyword1"><span class="command">unfolding</span></span> far_north_def <span class="keyword2"><span class="keyword">and</span></span> east_west_tangents <span class="keyword2"><span class="keyword">and</span></span> inner_vec_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_3 vector_3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> east_west_tangents_far_north<span class="main">:</span>
  <span class="quoted"><span class="quoted">"proj2_intersection <span class="main">(</span>polar east<span class="main">)</span> <span class="main">(</span>polar west<span class="main">)</span> <span class="main">=</span> far_north"</span></span>
  <span class="keyword1"><span class="command">using</span></span> east_west_tangents_distinct <span class="keyword2"><span class="keyword">and</span></span> east_west_tangents_incident_far_north
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_intersection_unique <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> proj2 <span class="main">::</span> <span class="quoted">zero</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> proj2_zero_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> proj2_pt <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">equator</span> <span class="main">≡</span> proj2_line_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">meridian</span> <span class="main">≡</span> proj2_line_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equator_meridian_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"equator <span class="main">≠</span> meridian"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"equator <span class="main">=</span> meridian"</span></span>
  <span class="keyword1"><span class="command">with</span></span> compass_non_zero
    <span class="keyword2"><span class="keyword">and</span></span> proj2_line_abs_abs_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> equator_def meridian_def<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> vector_def<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> east_west_on_equator<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident east equator"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident west equator"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> east_def <span class="keyword2"><span class="keyword">and</span></span> west_def <span class="keyword2"><span class="keyword">and</span></span> equator_def
  <span class="keyword1"><span class="command">using</span></span> compass_non_zero
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_incident_abs inner_vec_def vector_def sum_3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> north_far_north_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"north <span class="main">≠</span> far_north"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"north <span class="main">=</span> far_north"</span></span>
  <span class="keyword1"><span class="command">with</span></span> compass_non_zero
    <span class="keyword2"><span class="keyword">and</span></span> proj2_abs_abs_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> north_def far_north_def<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">unfolding</span></span> vector_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> north_south_far_north_on_meridian<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident north meridian"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident south meridian"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident far_north meridian"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> compass_defs <span class="keyword2"><span class="keyword">and</span></span> far_north_def <span class="keyword2"><span class="keyword">and</span></span> meridian_def
  <span class="keyword1"><span class="command">using</span></span> compass_non_zero
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_incident_abs inner_vec_def vector_def sum_3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> K2_centre_on_equator_meridian<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident K2_centre equator"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident K2_centre meridian"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> K2_centre_def <span class="keyword2"><span class="keyword">and</span></span> equator_def <span class="keyword2"><span class="keyword">and</span></span> meridian_def
  <span class="keyword1"><span class="command">using</span></span> K2_centre_non_zero <span class="keyword2"><span class="keyword">and</span></span> compass_non_zero
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_incident_abs inner_vec_def vector_def sum_3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> on_equator_meridian_is_K2_centre<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> equator"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> meridian"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> K2_centre"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> K2_centre_on_equator_meridian <span class="keyword2"><span class="keyword">and</span></span> equator_meridian_distinct
    <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_unique
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rep_equator_reflect</span> <span class="main">≡</span> vector <span class="main">[</span>
  vector <span class="main">[</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
  vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
  vector <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rep_meridian_reflect</span> <span class="main">≡</span> vector <span class="main">[</span>
  vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
  vector <span class="main">[</span> <span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
  vector <span class="main">[</span> <span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">equator_reflect</span> <span class="main">≡</span> cltn2_abs rep_equator_reflect"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">meridian_reflect</span> <span class="main">≡</span> cltn2_abs rep_meridian_reflect"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> compass_reflect_defs <span class="main">=</span> equator_reflect_def meridian_reflect_def
  rep_equator_reflect_def rep_meridian_reflect_def

<span class="keyword1"><span class="command">lemma</span></span> compass_reflect_self_inverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rep_equator_reflect <span class="main">**</span> rep_equator_reflect <span class="main">=</span> mat <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_meridian_reflect <span class="main">**</span> rep_meridian_reflect <span class="main">=</span> mat <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> compass_reflect_defs matrix_matrix_mult_def mat_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3 sum_3 vector_3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> compass_reflect_invertible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible rep_equator_reflect"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"invertible rep_meridian_reflect"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> invertible_def
  <span class="keyword1"><span class="command">using</span></span> compass_reflect_self_inverse
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> compass_reflect_compass<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 east meridian_reflect <span class="main">=</span> west"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 west meridian_reflect <span class="main">=</span> east"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 north meridian_reflect <span class="main">=</span> north"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 south meridian_reflect <span class="main">=</span> south"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 K2_centre meridian_reflect <span class="main">=</span> K2_centre"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 east equator_reflect <span class="main">=</span> east"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 west equator_reflect <span class="main">=</span> west"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 north equator_reflect <span class="main">=</span> south"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 south equator_reflect <span class="main">=</span> north"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 K2_centre equator_reflect <span class="main">=</span> K2_centre"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="keyword1">v*</span> rep_meridian_reflect <span class="main">=</span> vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="keyword1">v*</span> rep_meridian_reflect <span class="main">=</span> vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="keyword1">v*</span> rep_meridian_reflect <span class="main">=</span> vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="keyword1">v*</span> rep_meridian_reflect <span class="main">=</span> vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="keyword1">v*</span> rep_meridian_reflect <span class="main">=</span> vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="keyword1">v*</span> rep_equator_reflect <span class="main">=</span> vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="keyword1">v*</span> rep_equator_reflect <span class="main">=</span> vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="keyword1">v*</span> rep_equator_reflect <span class="main">=</span> vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="keyword1">v*</span> rep_equator_reflect <span class="main">=</span> vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="keyword1">v*</span> rep_equator_reflect <span class="main">=</span> vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rep_meridian_reflect_def <span class="keyword2"><span class="keyword">and</span></span> rep_equator_reflect_def
      <span class="keyword2"><span class="keyword">and</span></span> vector_matrix_mult_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3 vector_3 sum_3<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> compass_reflect_invertible <span class="keyword2"><span class="keyword">and</span></span> compass_non_zero <span class="keyword2"><span class="keyword">and</span></span> K2_centre_non_zero
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 east meridian_reflect <span class="main">=</span> west"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 west meridian_reflect <span class="main">=</span> east"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 north meridian_reflect <span class="main">=</span> north"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 south meridian_reflect <span class="main">=</span> south"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 K2_centre meridian_reflect <span class="main">=</span> K2_centre"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 east equator_reflect <span class="main">=</span> east"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 west equator_reflect <span class="main">=</span> west"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 north equator_reflect <span class="main">=</span> south"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 south equator_reflect <span class="main">=</span> north"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 K2_centre equator_reflect <span class="main">=</span> K2_centre"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> compass_defs <span class="keyword2"><span class="keyword">and</span></span> K2_centre_def
      <span class="keyword2"><span class="keyword">and</span></span> meridian_reflect_def <span class="keyword2"><span class="keyword">and</span></span> equator_reflect_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apply_cltn2_abs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> on_equator_rep<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> equator"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="bound">x</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ra</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ca1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?ca1</span><span class="main">$</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> compass_non_zero <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> equator›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ra</span> <span class="main">∙</span> vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> equator_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_incident_right_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ra</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> inner_vec_def vector_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ca1</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cart2_append1_def<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ca1</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cart2_append1_z<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ca1</span> <span class="main">=</span> vector <span class="main">[</span><span class="var">?x</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> vector_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">a</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="var">?x</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_cart2_append1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="bound">x</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> on_meridian_rep<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> meridian"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">y</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="bound">y</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ra</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ca1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?ca1</span><span class="main">$</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> compass_non_zero <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> meridian›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ra</span> <span class="main">∙</span> vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> meridian_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_incident_right_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ra</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> inner_vec_def vector_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ca1</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cart2_append1_def<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ca1</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cart2_append1_z<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ca1</span> <span class="main">=</span> vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="var">?y</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> vector_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">a</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="var">?y</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_cart2_append1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">y</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="bound">y</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of the Klein--Beltrami model of the hyperbolic plane›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">hyp2</span> <span class="main">==</span> K2"</span></span>

<span class="keyword1"><span class="command">typedef</span></span> hyp2 <span class="main">=</span> <span class="quoted">K2</span>
  <span class="keyword1"><span class="command">using</span></span> K2_centre_in_K2
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hyp2_rep</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hyp2 <span class="main">⇒</span> real<span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">hyp2_rep</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> cart2_pt <span class="main">(</span>Rep_hyp2 <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hyp2_abs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">2</span> <span class="main">⇒</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">hyp2_abs</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Abs_hyp2 <span class="main">(</span>proj2_pt <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> norm_lt_1_iff_in_hyp2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">v</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">⟷</span> proj2_pt <span class="free">v</span> <span class="main">∈</span> hyp2"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector2_append1 <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> vector2_append1_non_zero<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> real_less_rsqrt <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"norm <span class="free">v</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> abs_square_less_1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"norm <span class="free">v</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">v</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">⟷</span> <span class="main">(</span>norm <span class="free">v</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">v</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">⟷</span> <span class="var">?v'</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?v'</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_M<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?v'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">v</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">⟷</span> proj2_abs <span class="var">?v'</span> <span class="main">∈</span> K2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> K2_abs<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">v</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">⟷</span> proj2_pt <span class="free">v</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_pt_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> norm_eq_1_iff_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">v</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> proj2_pt <span class="free">v</span> <span class="main">∈</span> S"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector2_append1 <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> vector2_append1_non_zero<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> real_sqrt_unique <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"norm <span class="free">v</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">v</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="main">(</span>norm <span class="free">v</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">v</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="var">?v'</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?v'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_M<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?v'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">v</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> proj2_abs <span class="var">?v'</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> S_abs<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">v</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> proj2_pt <span class="free">v</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_pt_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> norm_le_1_iff_in_hyp2_S<span class="main">:</span>
  <span class="quoted"><span class="quoted">"norm <span class="free">v</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟷</span> proj2_pt <span class="free">v</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span>
  <span class="keyword1"><span class="command">using</span></span> norm_lt_1_iff_in_hyp2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> norm_eq_1_iff_in_S <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_pt_hyp2_rep<span class="main">:</span> <span class="quoted"><span class="quoted">"proj2_pt <span class="main">(</span>hyp2_rep <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Rep_hyp2 <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="var">?p'</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_rep_non_zero<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?v</span> <span class="main">=</span> <span class="var">?p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_abs_rep<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p'</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Rep_hyp2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="var">?v</span> <span class="main">=</span> <span class="var">?p'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> K2_imp_M_neg<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span><span class="main">$</span><span class="numeral">3</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M_neg_imp_z_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="main">(</span>cart2_pt <span class="var">?p'</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_cart2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="main">(</span>hyp2_rep <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> hyp2_rep_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hyp2_rep_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">v</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="main">(</span>hyp2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹norm <span class="free">v</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="free">v</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_lt_1_iff_in_hyp2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="main">(</span>Abs_hyp2 <span class="main">(</span>proj2_pt <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> proj2_pt <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_hyp2_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="main">(</span>hyp2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> cart2_pt <span class="main">(</span>proj2_pt <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> hyp2_rep_def hyp2_abs_def<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="main">(</span>hyp2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cart2_proj2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hyp2_abs_rep<span class="main">:</span> <span class="quoted"><span class="quoted">"hyp2_abs <span class="main">(</span>hyp2_rep <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> hyp2_abs_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_pt_hyp2_rep Rep_hyp2_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> norm_hyp2_rep_lt_1<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>hyp2_rep <span class="free">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="main">(</span>hyp2_rep <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Rep_hyp2 <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_pt_hyp2_rep<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="main">(</span>hyp2_rep <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>hyp2_rep <span class="free">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_lt_1_iff_in_hyp2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hyp2_S_z_non_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conic_sgn <span class="free">p</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> K2_def S_def<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"conic_sgn <span class="free">p</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conic_sgn_not_1_z_non_zero<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hyp2_S_not_equal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> S_K2_empty
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> hyp2_S_cart2_inj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">p</span> <span class="main">=</span> cart2_pt <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_z_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_cart2<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cart2_pt <span class="free">p</span> <span class="main">=</span> cart2_pt <span class="free">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">=</span> proj2_pt <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_pt <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>›</span></span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_pt <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> on_equator_in_hyp2_rep<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> equator"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="bound">x</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_z_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> equator›</span></span> <span class="keyword2"><span class="keyword">and</span></span> on_equator_rep
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> proj2_abs <span class="var">?v</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3 vector_3<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">=</span> proj2_abs <span class="var">?v</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> K2_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> M_def matrix_vector_mult_def inner_vec_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_3 vector_3 power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> real_sqrt_abs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> real_sqrt_less_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">=</span> proj2_abs <span class="var">?v</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="bound">x</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> on_meridian_in_hyp2_rep<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> meridian"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¦</span><span class="bound">y</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="bound">y</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_z_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> meridian›</span></span> <span class="keyword2"><span class="keyword">and</span></span> on_meridian_rep
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="skolem">y</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> proj2_abs <span class="var">?v</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3 vector_3<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">=</span> proj2_abs <span class="var">?v</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> K2_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> M_def matrix_vector_mult_def inner_vec_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_3 vector_3 power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> real_sqrt_abs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> real_sqrt_less_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">y</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">=</span> proj2_abs <span class="var">?v</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¦</span><span class="bound">y</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="bound">y</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hyp2_cltn2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hyp2 <span class="main">⇒</span> cltn2 <span class="main">⇒</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">hyp2_cltn2</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> Abs_hyp2 <span class="main">(</span>apply_cltn2 <span class="main">(</span>Rep_hyp2 <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_K2_isometry</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cltn2 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_K2_isometry</span> <span class="free"><span class="bound"><span class="entity">J</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">p</span><span class="main">.</span> apply_cltn2 <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">J</span></span></span> <span class="main">∈</span> S <span class="main">⟷</span> <span class="bound">p</span> <span class="main">∈</span> S<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_id_is_K2_isometry<span class="main">:</span> <span class="quoted"><span class="quoted">"is_K2_isometry cltn2_id"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_K2_isometry_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> J_M_J_transpose_K2_isometry<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">repJ</span> <span class="main">**</span> M <span class="main">**</span> transpose <span class="free">repJ</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> M"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="main">(</span>cltn2_abs <span class="free">repJ</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="var">?J</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> M›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span> <span class="main">**</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> M<span class="main">)</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_scalar_ac <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> M_self_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> right_invertible_iff_invertible <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">repJ</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">repJ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_mul_assoc
      exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"M <span class="main">**</span> transpose <span class="free">repJ</span> <span class="main">**</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> M<span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span><span class="main">.</span> apply_cltn2 <span class="bound">t</span> <span class="var">?J</span> <span class="main">∈</span> S <span class="main">⟷</span> <span class="bound">t</span> <span class="main">∈</span> S"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted">proj2</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="skolem">t</span> <span class="main">∙</span> <span class="main">(</span><span class="main">(</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> M<span class="main">)</span> <span class="keyword1">*v</span> proj2_rep <span class="skolem">t</span><span class="main">)</span>
      <span class="main">=</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span>proj2_rep <span class="skolem">t</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_matrix_vector_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>  dot_scaleR_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> M›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="skolem">t</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?N</span> <span class="keyword1">*v</span> proj2_rep <span class="skolem">t</span><span class="main">)</span>
      <span class="main">=</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span>proj2_rep <span class="skolem">t</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="skolem">t</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?N</span> <span class="keyword1">*v</span> proj2_rep <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>
      <span class="main">⟷</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span>proj2_rep <span class="skolem">t</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="skolem">t</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?N</span> <span class="keyword1">*v</span> proj2_rep <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>
      <span class="main">⟷</span> proj2_rep <span class="skolem">t</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">repJ</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">t</span> <span class="var">?J</span> <span class="main">∈</span> S <span class="main">⟷</span> proj2_rep <span class="skolem">t</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apply_cltn2_right_abs_in_S<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">t</span> <span class="var">?J</span> <span class="main">∈</span> S <span class="main">⟷</span> <span class="skolem">t</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> S_alt_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="var">?J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_K2_isometry_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equator_reflect_K2_isometry<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry equator_reflect"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> compass_reflect_defs
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> J_M_J_transpose_K2_isometry <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_def matrix_matrix_mult_def transpose_def
       vec_eq_iff forall_3 sum_3 vector_3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> meridian_reflect_K2_isometry<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry meridian_reflect"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> compass_reflect_defs
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> J_M_J_transpose_K2_isometry <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_def matrix_matrix_mult_def transpose_def
       vec_eq_iff forall_3 sum_3 vector_3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_compose_is_K2_isometry<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="main">(</span>cltn2_compose <span class="free">H</span> <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_K2_isometry_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2.act_act <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cltn2_inverse_is_K2_isometry<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="main">(</span>cltn2_inverse <span class="free">J</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">p</span> <span class="main">(</span>cltn2_inverse <span class="free">J</span><span class="main">)</span> <span class="main">∈</span> S
      <span class="main">⟷</span> apply_cltn2 <span class="main">(</span>apply_cltn2 <span class="skolem">p</span> <span class="main">(</span>cltn2_inverse <span class="free">J</span><span class="main">)</span><span class="main">)</span> <span class="free">J</span> <span class="main">∈</span> S"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> is_K2_isometry_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">p</span> <span class="main">(</span>cltn2_inverse <span class="free">J</span><span class="main">)</span> <span class="main">∈</span> S <span class="main">⟷</span> <span class="skolem">p</span> <span class="main">∈</span> S"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2.act_inv_act <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="main">(</span>cltn2_inverse <span class="free">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_K2_isometry_def <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> K2_isometry_subgroup<span class="main">:</span> subgroup
  <span class="quoted"><span class="quoted">"Collect is_K2_isometry"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(|</span>carrier <span class="main">=</span> UNIV<span class="main">,</span> mult <span class="main">=</span> cltn2_compose<span class="main">,</span> one <span class="main">=</span> cltn2_id<span class="main">|)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> subgroup_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>
    cltn2_id_is_K2_isometry
    cltn2_compose_is_K2_isometry
    cltn2_inverse_is_K2_isometry<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> K2_isometry<span class="main">:</span> group
  <span class="quoted"><span class="quoted">"<span class="main">(|</span>carrier <span class="main">=</span> Collect is_K2_isometry<span class="main">,</span> mult <span class="main">=</span> cltn2_compose<span class="main">,</span> one <span class="main">=</span> cltn2_id<span class="main">|)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cltn2.is_group <span class="keyword2"><span class="keyword">and</span></span> K2_isometry_subgroup.subgroup_is_group
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> K2_isometry_inverse_inv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="main">(|</span>carrier <span class="main">=</span> Collect is_K2_isometry<span class="main">,</span> mult <span class="main">=</span> cltn2_compose<span class="main">,</span> one <span class="main">=</span> cltn2_id<span class="main">|)</span></sub><span class="hidden">⇙</span> <span class="free">J</span>
  <span class="main">=</span> cltn2_inverse <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cltn2_left_inverse
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cltn2_inverse_is_K2_isometry
    <span class="keyword2"><span class="keyword">and</span></span> K2_isometry.inv_equality
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">real_hyp2_C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>hyp2<span class="main">,</span> hyp2<span class="main">,</span> hyp2<span class="main">,</span> hyp2<span class="main">]</span> <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="quoted">"_ _ <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> _ _"</span> <span class="main">[</span>99<span class="main">,</span>99<span class="main">,</span>99<span class="main">,</span>99<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1"><span class="free">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="main">∃</span> <span class="bound">A</span><span class="main">.</span> is_K2_isometry <span class="bound">A</span> <span class="main">∧</span> hyp2_cltn2 <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">A</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> hyp2_cltn2 <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">A</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">real_hyp2_B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>hyp2<span class="main">,</span> hyp2<span class="main">,</span> hyp2<span class="main">]</span> <span class="main">⇒</span> bool"</span></span>
<span class="main">(</span><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> _ _ _"</span> <span class="main">[</span>99<span class="main">,</span>99<span class="main">,</span>99<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">B<span class="hidden">⇩</span><sub>K</sub></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>hyp2_rep <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span>hyp2_rep <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">(</span>hyp2_rep <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹$K$-isometries map the interior of the conic to itself›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> collinear_quadratic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">i</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">i</span> <span class="main">+</span> <span class="free">r</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> M_reverse <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="free">r</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">i</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">i</span> <span class="main">+</span> <span class="free">r</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>
      inner_add_left
      matrix_vector_right_distrib
      inner_add_right
      matrix_scaleR_vector_ac
      inner_scaleR_right
      scaleR_matrix_vector_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
      M_reverse
      power2_eq_square
      <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> S_quadratic'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">p</span> <span class="main">≠</span> proj2_abs <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">∈</span> S
  <span class="main">⟷</span> <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">q</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">p</span> <span class="main">+</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="free">p</span> <span class="main">≠</span> proj2_abs <span class="free">q</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> dependent_proj2_abs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?r</span> <span class="main">∈</span> S <span class="main">⟷</span> <span class="var">?r</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?r</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> S_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> collinear_quadratic <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?r</span> <span class="main">∈</span> S
    <span class="main">⟷</span> <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">q</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dot_lmul_matrix <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> S_quadratic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> S
  <span class="main">⟷</span> proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>
      <span class="main">+</span> proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">k</span>
      <span class="main">+</span> proj2_rep <span class="free">q</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="free">q</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_rep_non_zero<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?u</span> <span class="main">≠</span> proj2_abs <span class="var">?v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?u</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">=</span> proj2_abs <span class="var">?w</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> S
    <span class="main">⟷</span> <span class="var">?u</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?u</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="var">?u</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?v</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="var">?v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_quadratic'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">quarter_discrim</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">3</span> <span class="main">⇒</span> real<span class="main">^</span><span class="numeral">3</span> <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">quarter_discrim</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quarter_discrim_invariant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"quarter_discrim <span class="free">a</span> <span class="free">t</span> <span class="main">=</span> quarter_discrim <span class="free">a</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="free">r</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>
      matrix_vector_right_distrib
      inner_add_right
      matrix_scaleR_vector_ac
      scaleR_matrix_vector_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span>
    <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">i</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span>
    <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">i</span> <span class="main">+</span>
    <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> collinear_quadratic <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="free">r</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">t</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">i</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span>
    <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">i</span> <span class="main">+</span>
    <span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"quarter_discrim <span class="free">a</span> <span class="free">t</span> <span class="main">=</span> quarter_discrim <span class="free">a</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> quarter_discrim_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quarter_discrim_positive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">p</span> <span class="main">≠</span> proj2_abs <span class="free">q</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pp</span> <span class="main">≠</span> <span class="var">?pq</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">p</span> <span class="main">∈</span> K2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"quarter_discrim <span class="free">p</span> <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">q</span><span class="main">$</span><span class="numeral">3</span><span class="main">/</span><span class="free">p</span><span class="main">$</span><span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">p</span> <span class="main">+</span> <span class="free">q</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pp</span> <span class="main">∈</span> K2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> K2_abs <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">$</span><span class="numeral">3</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M_neg_imp_z_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_mult_def <span class="keyword2"><span class="keyword">and</span></span> M_def <span class="keyword2"><span class="keyword">and</span></span> vector_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_vec_def sum_3 power2_eq_square<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">$</span><span class="numeral">3</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pp</span> <span class="main">≠</span> <span class="var">?pq</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> dependent_proj2_abs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?t</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">$</span><span class="main">1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?t</span><span class="main">$</span><span class="numeral">2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?t</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?t</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> mult_neg_pos <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">p</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?t</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?t</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?t</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?t</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?t</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?t</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">with</span></span> quarter_discrim_invariant <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"quarter_discrim <span class="free">p</span> <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> quarter_discrim_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quarter_discrim_self_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">a</span> <span class="main">=</span> proj2_abs <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"quarter_discrim <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"quarter_discrim <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> quarter_discrim_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="free">a</span> <span class="main">=</span> proj2_abs <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_abs_abs_mult
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"quarter_discrim <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> quarter_discrim_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square
      matrix_scaleR_vector_ac
      scaleR_matrix_vector_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">S_intersection_coeff1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">3</span> <span class="main">⇒</span> real<span class="main">^</span><span class="numeral">3</span> <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">S_intersection_coeff1</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>
  <span class="main">≡</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">+</span> sqrt <span class="main">(</span>quarter_discrim <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">S_intersection_coeff2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">3</span> <span class="main">⇒</span> real<span class="main">^</span><span class="numeral">3</span> <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">S_intersection_coeff2</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>
  <span class="main">≡</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">-</span> sqrt <span class="main">(</span>quarter_discrim <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">S_intersection1_rep</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">3</span> <span class="main">⇒</span> real<span class="main">^</span><span class="numeral">3</span> <span class="main">⇒</span> real<span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">S_intersection1_rep</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> <span class="main">(</span>S_intersection_coeff1 <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">S_intersection2_rep</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">3</span> <span class="main">⇒</span> real<span class="main">^</span><span class="numeral">3</span> <span class="main">⇒</span> real<span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">S_intersection2_rep</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> <span class="main">(</span>S_intersection_coeff2 <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">S_intersection1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">3</span> <span class="main">⇒</span> real<span class="main">^</span><span class="numeral">3</span> <span class="main">⇒</span> proj2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">S_intersection1</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> proj2_abs <span class="main">(</span>S_intersection1_rep <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">S_intersection2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">3</span> <span class="main">⇒</span> real<span class="main">^</span><span class="numeral">3</span> <span class="main">⇒</span> proj2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">S_intersection2</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> proj2_abs <span class="main">(</span>S_intersection2_rep <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> S_intersection_coeffs_defs <span class="main">=</span>
  S_intersection_coeff1_def S_intersection_coeff2_def

<span class="keyword1"><span class="command">lemmas</span></span> S_intersections_defs <span class="main">=</span>
  S_intersection1_def S_intersection2_def
  S_intersection1_rep_def S_intersection2_rep_def

<span class="keyword1"><span class="command">lemma</span></span> S_intersection_coeffs_distinct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">p</span> <span class="main">≠</span> proj2_abs <span class="free">q</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pp</span> <span class="main">≠</span> <span class="var">?pq</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">p</span> <span class="main">∈</span> K2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"S_intersection_coeff1 <span class="free">p</span> <span class="free">q</span> <span class="main">≠</span> S_intersection_coeff2 <span class="free">p</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pp</span> <span class="main">∈</span> K2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> K2_abs <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"quarter_discrim <span class="free">p</span> <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> quarter_discrim_positive<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"S_intersection_coeff1 <span class="free">p</span> <span class="free">q</span> <span class="main">≠</span> S_intersection_coeff2 <span class="free">p</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> S_intersection_coeffs_defs<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> S_intersections_distinct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">p</span> <span class="main">≠</span> proj2_abs <span class="free">q</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pp</span> <span class="main">≠</span> <span class="var">?pq</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">p</span> <span class="main">∈</span> K2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"S_intersection1 <span class="free">p</span> <span class="free">q</span> <span class="main">≠</span> S_intersection2 <span class="free">p</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pp</span> <span class="main">≠</span> <span class="var">?pq</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pp</span> <span class="main">∈</span> K2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"S_intersection_coeff1 <span class="free">p</span> <span class="free">q</span> <span class="main">≠</span> S_intersection_coeff2 <span class="free">p</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> S_intersection_coeffs_distinct<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pp</span> <span class="main">≠</span> <span class="var">?pq</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_Col_coeff_unique'
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"S_intersection1 <span class="free">p</span> <span class="free">q</span> <span class="main">≠</span> S_intersection2 <span class="free">p</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> S_intersections_defs<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> S_intersections_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">p</span> <span class="main">≠</span> proj2_abs <span class="free">q</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pp</span> <span class="main">≠</span> <span class="var">?pq</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">p</span> <span class="main">∈</span> K2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"S_intersection1 <span class="free">p</span> <span class="free">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"S_intersection2 <span class="free">p</span> <span class="free">q</span> <span class="main">∈</span> S"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?j</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"S_intersection_coeff1 <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"S_intersection_coeff2 <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">q</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pp</span> <span class="main">∈</span> K2›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> K2_abs <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> qd<span class="main">:</span> <span class="quoted"><span class="quoted">"discrim <span class="var">?a</span> <span class="var">?b</span> <span class="var">?c</span> <span class="main">=</span> <span class="numeral">4</span> <span class="main">*</span> quarter_discrim <span class="free">p</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> discrim_def quarter_discrim_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> times_divide_times_eq <span class="main">[</span><span class="operator">of</span>
    <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span>quarter_discrim <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">-</span> <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> times_divide_times_eq <span class="main">[</span><span class="operator">of</span>
    <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">q</span><span class="main">)</span> <span class="main">-</span> sqrt <span class="main">(</span>quarter_discrim <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> real_sqrt_mult <span class="keyword2"><span class="keyword">and</span></span> real_sqrt_abs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?j</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="var">?b</span> <span class="main">+</span> sqrt <span class="main">(</span>discrim <span class="var">?a</span> <span class="var">?b</span> <span class="var">?c</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="var">?a</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="var">?b</span> <span class="main">-</span> sqrt <span class="main">(</span>discrim <span class="var">?a</span> <span class="var">?b</span> <span class="var">?c</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="var">?a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> S_intersection_coeffs_defs<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"quarter_discrim <span class="free">p</span> <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> quarter_discrim_positive<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> qd
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"discrim <span class="main">(</span><span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">q</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?j</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="var">?b</span> <span class="main">+</span> sqrt <span class="main">(</span>discrim <span class="var">?a</span> <span class="var">?b</span> <span class="var">?c</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="var">?a</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?k</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="var">?b</span> <span class="main">-</span> sqrt <span class="main">(</span>discrim <span class="var">?a</span> <span class="var">?b</span> <span class="var">?c</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="var">?a</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> discriminant_nonneg <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="var"><span class="quoted"><span class="var">?j</span></span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> discriminant_nonneg <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="var">?j</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="var">?j</span> <span class="main">+</span> <span class="free">q</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="var">?k</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="var">?k</span> <span class="main">+</span> <span class="free">q</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> S_intersection_coeffs_defs<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pp</span> <span class="main">≠</span> <span class="var">?pq</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> S_quadratic'
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"S_intersection1 <span class="free">p</span> <span class="free">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"S_intersection2 <span class="free">p</span> <span class="free">q</span> <span class="main">∈</span> S"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> S_intersections_defs<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> S_intersections_Col<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="main">(</span>proj2_abs <span class="free">p</span><span class="main">)</span> <span class="main">(</span>proj2_abs <span class="free">q</span><span class="main">)</span> <span class="main">(</span>S_intersection1 <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="var">?pp</span> <span class="var">?pq</span> <span class="var">?pr</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="main">(</span>proj2_abs <span class="free">p</span><span class="main">)</span> <span class="main">(</span>proj2_abs <span class="free">q</span><span class="main">)</span> <span class="main">(</span>S_intersection2 <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="var">?pp</span> <span class="var">?pq</span> <span class="var">?ps</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pp</span> <span class="main">=</span> <span class="var">?pq</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="var">?pp</span> <span class="var">?pq</span> <span class="var">?pr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="var">?pp</span> <span class="var">?pq</span> <span class="var">?ps</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_Col_coincide<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pp</span> <span class="main">≠</span> <span class="var">?pq</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> dependent_proj2_abs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="main">_</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"S_intersection1_rep <span class="free">p</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"S_intersection2_rep <span class="free">p</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> S_intersection1_rep_def S_intersection2_rep_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> proj2_Col_abs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="quoted"><span class="quoted">"S_intersection_coeff1 <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span>
      <span class="keyword2"><span class="keyword">and</span></span> proj2_Col_abs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="quoted"><span class="quoted">"S_intersection_coeff2 <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="var">?pp</span> <span class="var">?pq</span> <span class="var">?pr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="var">?pp</span> <span class="var">?pq</span> <span class="var">?ps</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> S_intersections_defs<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="var">?pp</span> <span class="var">?pq</span> <span class="var">?pr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="var">?pp</span> <span class="var">?pq</span> <span class="var">?ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> S_intersections_incident<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">p</span> <span class="main">≠</span> proj2_abs <span class="free">q</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pp</span> <span class="main">≠</span> <span class="var">?pq</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>proj2_abs <span class="free">p</span><span class="main">)</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>proj2_abs <span class="free">q</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>S_intersection1 <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">l</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pr</span> <span class="free">l</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>S_intersection2 <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">l</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?ps</span> <span class="free">l</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="var">?pp</span> <span class="var">?pq</span> <span class="var">?pr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="var">?pp</span> <span class="var">?pq</span> <span class="var">?ps</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> S_intersections_Col<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pp</span> <span class="main">≠</span> <span class="var">?pq</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pp</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pq</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_iff_Col
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pr</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?ps</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> K2_line_intersect_twice<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> K2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">s</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≠</span> <span class="bound">u</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_Col <span class="free">a</span> <span class="free">r</span> <span class="bound">s</span> <span class="main">∧</span> proj2_Col <span class="free">a</span> <span class="free">r</span> <span class="bound">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> proj2_rep_non_zero <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> K2_imp_M_neg <span class="keyword2"><span class="keyword">and</span></span> proj2_abs_rep <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> K2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a'</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?a'</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?a'</span> <span class="main">≠</span> proj2_abs <span class="var">?r'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> K2›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?a'</span> <span class="main">∈</span> K2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="var">?a'</span> <span class="main">≠</span> proj2_abs <span class="var">?r'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"S_intersection1 <span class="var">?a'</span> <span class="var">?r'</span> <span class="main">≠</span> S_intersection2 <span class="var">?a'</span> <span class="var">?r'</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">≠</span> <span class="var">?u</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> S_intersections_distinct<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="var">?a'</span> <span class="main">≠</span> proj2_abs <span class="var">?r'</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="var">?a'</span> <span class="main">∈</span> K2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> S_intersections_in_S<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="main">(</span>proj2_abs <span class="var">?a'</span><span class="main">)</span> <span class="main">(</span>proj2_abs <span class="var">?r'</span><span class="main">)</span> <span class="var">?s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="main">(</span>proj2_abs <span class="var">?a'</span><span class="main">)</span> <span class="main">(</span>proj2_abs <span class="var">?r'</span><span class="main">)</span> <span class="var">?u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> S_intersections_Col<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">a</span> <span class="free">r</span> <span class="var">?s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">a</span> <span class="free">r</span> <span class="var">?u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?s</span> <span class="main">≠</span> <span class="var">?u</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?s</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?u</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">s</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≠</span> <span class="bound">u</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_Col <span class="free">a</span> <span class="free">r</span> <span class="bound">s</span> <span class="main">∧</span> proj2_Col <span class="free">a</span> <span class="free">r</span> <span class="bound">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> point_in_S_polar_is_tangent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> incident_own_polar_in_S<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> line_incident_point_not_in_S
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∉</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">r</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="skolem">r</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∉</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">r</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"polar <span class="free">p</span>"</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> S_quadratic
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?u</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">k</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="var">?u</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?v</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">+</span> <span class="var">?v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> S_alt_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">r</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> incident_polar<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∉</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?u</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> S_alt_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_rep<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> line_through_K2_intersect_S_twice<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> K2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">q</span> <span class="main">≠</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">q</span> <span class="free">l</span> <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> proj2_another_point_on_line
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">s</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> K2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> K2_line_intersect_twice <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> S"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="skolem">s</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="skolem">s</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">s</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_iff_Col <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">q</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">r</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="skolem">r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">q</span> <span class="main">≠</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">q</span> <span class="free">l</span> <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> line_through_K2_intersect_S_again<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> K2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">≠</span> <span class="free">q</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> K2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> line_through_K2_intersect_S_twice <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> S"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">s</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">t</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">≠</span> <span class="free">q</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">t</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">s</span> <span class="free">l</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="free">q</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="skolem">s</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">≠</span> <span class="free">q</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">t</span> <span class="free">l</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≠</span> <span class="free">q</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="skolem">t</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">≠</span> <span class="free">q</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> line_through_K2_intersect_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> K2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">≠</span> <span class="free">p</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> line_through_K2_intersect_S_again<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> line_intersect_S_at_most_twice<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">r</span><span class="main">∈</span>S<span class="main">.</span> proj2_incident <span class="bound">r</span> <span class="free">l</span> <span class="main">⟶</span> <span class="bound">r</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">∨</span> <span class="bound">r</span> <span class="main">=</span> <span class="bound">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> line_incident_point_not_in_S
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∉</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">s</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> proj2_another_point_on_line
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≠</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">t</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_rep <span class="skolem">t</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_rep_non_zero<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="var">?v</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?w</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∉</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword2"><span class="keyword">and</span></span> conic_sgn_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?j</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="var">?b</span> <span class="main">+</span> sqrt <span class="main">(</span>discrim <span class="var">?a</span> <span class="var">?b</span> <span class="var">?c</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="var">?a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="var">?b</span> <span class="main">-</span> sqrt <span class="main">(</span>discrim <span class="var">?a</span> <span class="var">?b</span> <span class="var">?c</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="var">?a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span><span class="var">?j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?v</span> <span class="main">+</span> <span class="var">?w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span><span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?v</span> <span class="main">+</span> <span class="var">?w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">r</span><span class="main">∈</span>S<span class="main">.</span> proj2_incident <span class="bound">r</span> <span class="free">l</span> <span class="main">⟶</span> <span class="bound">r</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">∨</span> <span class="bound">r</span> <span class="main">=</span> <span class="var">?q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> S"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∉</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">r</span> <span class="free">l</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">≠</span> <span class="skolem">s</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">≠</span> <span class="skolem">s</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">s</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">t</span> <span class="free">l</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?v</span> <span class="main">+</span> <span class="var">?w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">≠</span> <span class="skolem">s</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> S_quadratic
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">*</span> <span class="skolem">i</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="var">?b</span> <span class="main">*</span> <span class="skolem">i</span> <span class="main">+</span> <span class="var">?c</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> discriminant_iff <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="var">?j</span> <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?v</span> <span class="main">+</span> <span class="var">?w</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">∨</span> <span class="skolem">r</span> <span class="main">=</span> <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">r</span> <span class="free">l</span> <span class="main">⟶</span> <span class="skolem">r</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">∨</span> <span class="skolem">r</span> <span class="main">=</span> <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">r</span><span class="main">∈</span>S<span class="main">.</span> proj2_incident <span class="bound">r</span> <span class="free">l</span> <span class="main">⟶</span> <span class="bound">r</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">∨</span> <span class="bound">r</span> <span class="main">=</span> <span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_line_intersect_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">⊆</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">T</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="free">T</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span><span class="main">∈</span><span class="free">T</span><span class="main">.</span> proj2_incident <span class="bound">p</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> proj2_set_Col_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> line_intersect_S_at_most_twice <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span><span class="main">∈</span>S<span class="main">.</span> proj2_incident <span class="bound">a</span> <span class="skolem">l</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∨</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">p</span><span class="main">∈</span><span class="free">T</span><span class="main">.</span> proj2_incident <span class="bound">p</span> <span class="skolem">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">T</span> <span class="main">⊆</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="free">T</span> <span class="main">≤</span> card <span class="main">{</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> card_suc_ge_insert <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">c</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="free">T</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> line_S_two_intersections_only<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> S"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">r</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∨</span> <span class="free">r</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">⊆</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">r</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_set_Col_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">⊆</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_line_intersect_S<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∨</span> <span class="free">r</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">r</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∨</span> <span class="free">r</span> <span class="main">=</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∉</span> <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> card_insert_disjoint <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">≤</span> <span class="numeral">2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> line_through_K2_intersect_S_exactly_twice<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> K2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">q</span> <span class="main">≠</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">q</span> <span class="free">l</span> <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="free">l</span>
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span><span class="main">∈</span>S<span class="main">.</span> proj2_incident <span class="bound">s</span> <span class="free">l</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">q</span> <span class="main">∨</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> K2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> line_through_K2_intersect_S_twice <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> S"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">q</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">r</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> line_S_two_intersections_only
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">q</span> <span class="main">≠</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">q</span> <span class="free">l</span> <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="free">l</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span><span class="main">∈</span>S<span class="main">.</span> proj2_incident <span class="bound">s</span> <span class="free">l</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">q</span> <span class="main">∨</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tangent_not_through_K2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> K2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_incident <span class="free">q</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> K2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> line_through_K2_intersect_S_again <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="quoted">"polar <span class="free">p</span>"</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">r</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">r</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> point_in_S_polar_is_tangent<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> outside_exists_line_not_intersect_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"conic_sgn <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">l</span><span class="main">.</span> proj2_incident <span class="free">p</span> <span class="bound">l</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">q</span><span class="main">.</span> proj2_incident <span class="bound">q</span> <span class="bound">l</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∉</span> S<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_intersection <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span> z_zero"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?r</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?r</span> z_zero"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_intersection_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?r</span> z_zero›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conic_sgn <span class="var">?r</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> z_zero_conic_sgn_1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹conic_sgn <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="free">p</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="var">?r</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="var">?r</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> conic_sgn_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_1_pos<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?r</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="main">(</span>polar <span class="var">?r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> incident_polar_swap<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="var">?r</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> incident_polar<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="var">?r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?r</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> incident_polar<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="free">p</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_line_through <span class="free">p</span> <span class="var">?r</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?r</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_line_through_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">q</span><span class="main">.</span> proj2_incident <span class="bound">q</span> <span class="var">?l</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∉</span> S"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">q</span> <span class="var">?l</span> <span class="main">⟶</span> <span class="skolem">q</span> <span class="main">∉</span> S"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">q</span> <span class="var">?l</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="var">?r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="var">?l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?r</span> <span class="var">?l</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="skolem">q</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="var">?r</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_incident_iff <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∉</span> S"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹conic_sgn <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∉</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> S_def<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="skolem">q</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="var">?r</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="var">?r</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="free">p</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">k</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="var">?r</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="var">?r</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="var">?r</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">k</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>
          <span class="main">+</span> proj2_rep <span class="free">p</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="var">?r</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span>
          <span class="main">+</span> proj2_rep <span class="var">?r</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> proj2_rep <span class="var">?r</span><span class="main">)</span>
          <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="var">?r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="free">p</span> <span class="main">+</span> proj2_rep <span class="var">?r</span><span class="main">)</span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∉</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_quadratic<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="var">?l</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">l</span><span class="main">.</span> proj2_incident <span class="free">p</span> <span class="bound">l</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">q</span><span class="main">.</span> proj2_incident <span class="bound">q</span> <span class="bound">l</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∉</span> S<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lines_through_intersect_S_twice_in_K2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">l</span><span class="main">.</span> proj2_incident <span class="free">p</span> <span class="bound">l</span>
  <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">q</span> <span class="main">≠</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">q</span> <span class="bound">l</span> <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> K2"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∉</span> K2"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"conic_sgn <span class="free">p</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> K2_def<span class="main">)</span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">l</span><span class="main">.</span> proj2_incident <span class="free">p</span> <span class="bound">l</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span>
    <span class="bound">q</span> <span class="main">≠</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">q</span> <span class="bound">l</span> <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"conic_sgn <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> incident_own_polar_in_S<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"polar <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span>
      <span class="bound">q</span> <span class="main">≠</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">q</span> <span class="var">?l</span> <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="var">?l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span>
        <span class="bound">q</span> <span class="main">≠</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">q</span> <span class="var">?l</span> <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="var">?l</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> S"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">q</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">r</span> <span class="var">?l</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">q</span> <span class="var">?l</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">r</span> <span class="var">?l</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> point_in_S_polar_is_tangent<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="skolem">r</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="var">?l</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">l</span><span class="main">.</span> proj2_incident <span class="free">p</span> <span class="bound">l</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span>
      <span class="bound">q</span> <span class="main">≠</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">q</span> <span class="bound">l</span> <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"conic_sgn <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹conic_sgn <span class="free">p</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conic_sgn <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>conic_sgn <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"conic_sgn <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_conic_sgn<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> outside_exists_line_not_intersect_S
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">q</span><span class="main">.</span> proj2_incident <span class="bound">q</span> <span class="skolem">l</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∉</span> S"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span>
      <span class="bound">q</span> <span class="main">≠</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">q</span> <span class="skolem">l</span> <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="skolem">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span>
        <span class="bound">q</span> <span class="main">≠</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">q</span> <span class="skolem">l</span> <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">q</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">q</span> <span class="skolem">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">q</span><span class="main">.</span> proj2_incident <span class="bound">q</span> <span class="skolem">l</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∉</span> S›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∉</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="skolem">l</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">l</span><span class="main">.</span> proj2_incident <span class="free">p</span> <span class="bound">l</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span>
      <span class="bound">q</span> <span class="main">≠</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">q</span> <span class="bound">l</span> <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">l</span><span class="main">.</span> proj2_incident <span class="free">p</span> <span class="bound">l</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span>
    <span class="bound">q</span> <span class="main">≠</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">q</span> <span class="bound">l</span> <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="bound">l</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> line_through_hyp2_pole_not_in_hyp2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pole <span class="free">l</span> <span class="main">∉</span> hyp2"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> line_through_K2_intersect_S
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">p</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">p</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>pole <span class="free">l</span><span class="main">)</span> <span class="main">(</span>polar <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> incident_pole_polar<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pole <span class="free">l</span> <span class="main">∉</span> hyp2"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tangent_not_through_K2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> statement60_one_way<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> K2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="free">J</span> <span class="main">∈</span> K2"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p'</span> <span class="main">∈</span> K2"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?J'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_inverse <span class="free">J</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">l'</span><span class="main">.</span> proj2_incident <span class="var">?p'</span> <span class="bound">l'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">q'</span> <span class="bound">r'</span><span class="main">.</span>
    <span class="bound">q'</span> <span class="main">≠</span> <span class="bound">r'</span> <span class="main">∧</span> <span class="bound">q'</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">r'</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">q'</span> <span class="bound">l'</span> <span class="main">∧</span> proj2_incident <span class="bound">r'</span> <span class="bound">l'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l'</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2_line <span class="skolem">l'</span> <span class="var">?J'</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?p'</span> <span class="skolem">l'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">q'</span> <span class="bound">r'</span><span class="main">.</span>
      <span class="bound">q'</span> <span class="main">≠</span> <span class="bound">r'</span> <span class="main">∧</span> <span class="bound">q'</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">r'</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">q'</span> <span class="skolem">l'</span> <span class="main">∧</span> proj2_incident <span class="bound">r'</span> <span class="skolem">l'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?p'</span> <span class="skolem">l'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="var">?l</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apply_cltn2_incident <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">l'</span></span> <span class="var"><span class="quoted"><span class="var">?J'</span></span></span><span class="main"><span class="main">]</span></span>
          cltn2.inv_inv <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> K2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> line_through_K2_intersect_S_twice <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> S"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">q</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">r</span> <span class="var">?l</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">q</span> <span class="free">J</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">r</span> <span class="free">J</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="skolem">r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_injective <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="free">J</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q'</span> <span class="main">≠</span> <span class="var">?r'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q'</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r'</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_K2_isometry_def<span class="main">)</span> <span class="operator">simp_all</span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">q</span> <span class="var">?l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">r</span> <span class="var">?l</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?q'</span> <span class="skolem">l'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?r'</span> <span class="skolem">l'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apply_cltn2_incident <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">l'</span></span> <span class="var"><span class="quoted"><span class="var">?J'</span></span></span><span class="main"><span class="main">]</span></span>
          cltn2.inv_inv <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?q'</span> <span class="main">≠</span> <span class="var">?r'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?q'</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r'</span> <span class="main">∈</span> S›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q'</span> <span class="bound">r'</span><span class="main">.</span>
        <span class="bound">q'</span> <span class="main">≠</span> <span class="bound">r'</span> <span class="main">∧</span> <span class="bound">q'</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">r'</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">q'</span> <span class="skolem">l'</span> <span class="main">∧</span> proj2_incident <span class="bound">r'</span> <span class="skolem">l'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p'</span> <span class="main">∈</span> K2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lines_through_intersect_S_twice_in_K2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_K2_isometry_hyp2_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="free">J</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> hyp2"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="free">J</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> statement60_one_way<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="free">J</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∉</span> hyp2"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="free">J</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_K2_isometry_def<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="free">J</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_K2_isometry_z_non_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="free">J</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_K2_isometry_hyp2_S<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2_S_z_non_zero<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cart2_append1_apply_cltn2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span>
  <span class="main">∧</span> cart2_append1 <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">J</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">J</span>
    <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cart2_append1_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_vector_matrix_assoc<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2_S_z_non_zero<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> apply_cltn2_imp_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">J</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_K2_isometry_z_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_rep <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">(</span>proj2_rep <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_rep_cart2_append1<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span>proj2_rep <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>proj2_rep <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cart2_append1 <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">J</span>
    <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">J</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">J</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">J</span>
    <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span><span class="main">$</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_rep <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">(</span>proj2_rep <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">(</span>proj2_rep <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span>
    <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cart2_append1 <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">J</span>
    <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>proj2_rep <span class="free">p</span><span class="main">)</span><span class="main">$</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> proj2_rep <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">J</span> <span class="main">=</span> <span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span>
    <span class="main">∧</span> cart2_append1 <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">J</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The $K$-isometries form a group action›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hyp2_cltn2_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="free">p</span> cltn2_id <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> hyp2_cltn2_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> apply_cltn2_Rep_hyp2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>Rep_hyp2 <span class="free">p</span><span class="main">)</span> <span class="free">J</span> <span class="main">∈</span> hyp2"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> Rep_hyp2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>Rep_hyp2 <span class="free">p</span><span class="main">)</span> <span class="free">J</span> <span class="main">∈</span> K2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> statement60_one_way<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_hyp2_cltn2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="main">(</span>hyp2_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> apply_cltn2 <span class="main">(</span>Rep_hyp2 <span class="free">p</span><span class="main">)</span> <span class="free">J</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>Rep_hyp2 <span class="free">p</span><span class="main">)</span> <span class="free">J</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> apply_cltn2_Rep_hyp2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="main">(</span>hyp2_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> apply_cltn2 <span class="main">(</span>Rep_hyp2 <span class="free">p</span><span class="main">)</span> <span class="free">J</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> hyp2_cltn2_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> Abs_hyp2_inverse<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hyp2_cltn2_compose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="main">(</span>hyp2_cltn2 <span class="free">p</span> <span class="free">H</span><span class="main">)</span> <span class="free">J</span> <span class="main">=</span> hyp2_cltn2 <span class="free">p</span> <span class="main">(</span>cltn2_compose <span class="free">H</span> <span class="free">J</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">H</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>Rep_hyp2 <span class="free">p</span><span class="main">)</span> <span class="free">H</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> apply_cltn2_Rep_hyp2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="main">(</span>hyp2_cltn2 <span class="free">p</span> <span class="free">H</span><span class="main">)</span> <span class="free">J</span> <span class="main">=</span> hyp2_cltn2 <span class="free">p</span> <span class="main">(</span>cltn2_compose <span class="free">H</span> <span class="free">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> hyp2_cltn2_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_hyp2_inverse apply_cltn2_compose<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> K2_isometry<span class="main">:</span> action
  <span class="quoted"><span class="quoted">"<span class="main">(|</span>carrier <span class="main">=</span> Collect is_K2_isometry<span class="main">,</span> mult <span class="main">=</span> cltn2_compose<span class="main">,</span> one <span class="main">=</span> cltn2_id<span class="main">|)</span>"</span></span>
  <span class="quoted">hyp2_cltn2</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span>
    <span class="quoted"><span class="quoted">"<span class="main">(|</span>carrier <span class="main">=</span> Collect is_K2_isometry<span class="main">,</span> mult <span class="main">=</span> cltn2_compose<span class="main">,</span> one <span class="main">=</span> cltn2_id<span class="main">|)</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">p</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="var">?G</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> hyp2_cltn2_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2_inverse<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H</span> <span class="skolem">J</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∈</span> carrier <span class="var">?G</span> <span class="main">∧</span> <span class="skolem">J</span> <span class="main">∈</span> carrier <span class="var">?G</span>
    <span class="main">⟶</span> hyp2_cltn2 <span class="main">(</span>hyp2_cltn2 <span class="skolem">p</span> <span class="skolem">H</span><span class="main">)</span> <span class="skolem">J</span> <span class="main">=</span> hyp2_cltn2 <span class="skolem">p</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?G</span></sub><span class="hidden">⇙</span> <span class="skolem">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_cltn2_compose<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Klein--Beltrami model satisfies Tarski's first three axioms›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> three_in_S_tangent_intersection_no_3_Col<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> S"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∉</span> <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_no_3_Col <span class="main">{</span>proj2_intersection <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span> <span class="main">(</span>polar <span class="free">q</span><span class="main">)</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"proj2_no_3_Col <span class="main">{</span><span class="var">?s</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="var">?s</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∉</span> <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">⊆</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?s</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?s</span> <span class="main">(</span>polar <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_intersection_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∉</span> S"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∈</span> S"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?s</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?s</span> <span class="main">(</span>polar <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> point_in_S_polar_is_tangent<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">⊆</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∉</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">3</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="var">?s</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span><span class="main">∈</span><span class="var">?T</span><span class="main">.</span> <span class="main">¬</span> proj2_set_Col <span class="main">(</span><span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="bound">t</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">standard</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?T</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">(</span><span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span> <span class="main">∈</span> <span class="main">(</span><span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> proj2_incident <span class="bound">a</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> proj2_set_Col_def <span class="keyword1"><span class="command">..</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">(</span><span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">(</span>S <span class="main">∩</span> <span class="main">(</span><span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_subset_Col <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>S <span class="main">∩</span> <span class="main">(</span><span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>S <span class="main">∩</span> <span class="main">(</span><span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_line_intersect_S<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="var">?s</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?s</span> <span class="main">∉</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">⊆</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"S <span class="main">∩</span> <span class="main">(</span><span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">3</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span>S <span class="main">∩</span> <span class="main">(</span><span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≠</span> <span class="var">?s</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∈</span> <span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">a</span> <span class="main">∈</span> <span class="main">(</span><span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> proj2_incident <span class="bound">a</span> <span class="skolem">l</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?s</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">∩</span> <span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">∈</span> <span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">a</span> <span class="main">∈</span> <span class="main">(</span><span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> proj2_incident <span class="bound">a</span> <span class="skolem">l</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">d</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">∈</span> <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?s</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?s</span> <span class="main">(</span>polar <span class="free">q</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?s</span> <span class="main">(</span>polar <span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">∈</span> <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">⊆</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">d</span> <span class="main">(</span>polar <span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> incident_own_polar_in_S<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?s</span> <span class="main">∉</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="var">?s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?s</span> <span class="skolem">l</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">d</span> <span class="skolem">l</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?s</span> <span class="main">(</span>polar <span class="skolem">d</span><span class="main">)</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">d</span> <span class="main">(</span>polar <span class="skolem">d</span><span class="main">)</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_unique
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> polar <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> point_in_S_polar_is_tangent
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span><span class="main">∈</span>S<span class="main">.</span> proj2_incident <span class="bound">a</span> <span class="skolem">l</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">a</span> <span class="main">∈</span> <span class="main">(</span><span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> proj2_incident <span class="bound">a</span> <span class="skolem">l</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"S <span class="main">∩</span> <span class="main">(</span><span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> card_mono <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">d</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>S <span class="main">∩</span> <span class="main">(</span><span class="var">?T</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span>S <span class="main">∩</span> <span class="var">?T</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_Diff<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"S <span class="main">∩</span> <span class="var">?T</span> <span class="main">⊆</span> insert <span class="skolem">t</span> <span class="main">(</span><span class="main">(</span>S <span class="main">∩</span> <span class="var">?T</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> card_suc_ge_insert <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>S <span class="main">∩</span> <span class="var">?T</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span><span class="main">]</span>
        <span class="keyword2"><span class="keyword">and</span></span> card_mono <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">t</span> <span class="main">(</span><span class="main">(</span>S <span class="main">∩</span> <span class="var">?T</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"S <span class="main">∩</span> <span class="var">?T</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>S <span class="main">∩</span> <span class="var">?T</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span><span class="main">(</span>S <span class="main">∩</span> <span class="var">?T</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span><span class="main">(</span>S <span class="main">∩</span> <span class="var">?T</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>S <span class="main">∩</span> <span class="var">?T</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">⊆</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">⊆</span> S <span class="main">∩</span> <span class="var">?T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">3</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> card_mono <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"S <span class="main">∩</span> <span class="var">?T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>S <span class="main">∩</span> <span class="var">?T</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span>S <span class="main">∩</span> <span class="var">?T</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹card <span class="var">?T</span> <span class="main">=</span> <span class="numeral">4</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_no_3_Col <span class="var">?T</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> proj2_no_3_Col_def <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> statement65_special_case<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∉</span> <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J</span><span class="main">.</span> is_K2_isometry <span class="bound">J</span>
  <span class="main">∧</span> apply_cltn2 east <span class="bound">J</span> <span class="main">=</span> <span class="free">p</span>
  <span class="main">∧</span> apply_cltn2 west <span class="bound">J</span> <span class="main">=</span> <span class="free">q</span>
  <span class="main">∧</span> apply_cltn2 north <span class="bound">J</span> <span class="main">=</span> <span class="free">r</span>
  <span class="main">∧</span> apply_cltn2 far_north <span class="bound">J</span> <span class="main">=</span> proj2_intersection <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span> <span class="main">(</span>polar <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_intersection <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span> <span class="main">(</span>polar <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span>vector <span class="main">[</span><span class="var">?s</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">]</span><span class="main">,</span> vector <span class="main">[</span>far_north<span class="main">,</span> north<span class="main">,</span> east<span class="main">,</span> west<span class="main">]</span><span class="main">]</span>
    <span class="main">::</span> proj2<span class="main">^</span><span class="numeral">4</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">($)</span> <span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="var">?s</span><span class="main">,</span> <span class="free">r</span><span class="main">,</span> <span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> image_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UNIV_4 vector_4<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∉</span> <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_no_3_Col <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> three_in_S_tangent_intersection_no_3_Col<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">($)</span> <span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>far_north<span class="main">,</span> north<span class="main">,</span> east<span class="main">,</span> west<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> image_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UNIV_4 vector_4<span class="main">)</span>
   <span class="keyword1"><span class="command">with</span></span> compass_in_S <span class="keyword2"><span class="keyword">and</span></span> east_west_distinct <span class="keyword2"><span class="keyword">and</span></span> north_not_east_or_west
     <span class="keyword2"><span class="keyword">and</span></span> east_west_tangents_far_north
     <span class="keyword2"><span class="keyword">and</span></span> three_in_S_tangent_intersection_no_3_Col <span class="main">[</span><span class="operator">of</span> <span class="quoted">east</span> <span class="quoted">west</span> <span class="quoted">north</span><span class="main">]</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_no_3_Col <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> proj2_no_3_Col <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> forall_2<span class="main">)</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">j</span><span class="main">.</span> apply_cltn2 <span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="main">0</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span> <span class="bound">J</span> <span class="main">=</span> <span class="var">?t</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="bound">j</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> statement53_existence<span class="main">)</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">j</span><span class="main">.</span> apply_cltn2 <span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?t</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="bound">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?t</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="main">1</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?t</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?t</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">3</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span><span class="var">?t</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">4</span><span class="main">)</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?t</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">4</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 east <span class="skolem">J</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 west <span class="skolem">J</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 north <span class="skolem">J</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 far_north <span class="skolem">J</span> <span class="main">=</span> <span class="var">?s</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_2 vector_4<span class="main">)</span>
   <span class="keyword1"><span class="command">with</span></span> compass_non_zero
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> compass_defs <span class="keyword2"><span class="keyword">and</span></span> far_north_def
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apply_cltn2_left_abs<span class="main">)</span>

   <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?N</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="skolem">J</span> <span class="main">**</span> M <span class="main">**</span> transpose <span class="main">(</span>cltn2_rep <span class="skolem">J</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">from</span></span> M_symmatrix <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"symmatrix <span class="var">?N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> symmatrix_preserve<span class="main">)</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">3</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> symmatrix_def <span class="keyword2"><span class="keyword">and</span></span> transpose_def
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff<span class="main">)</span>

   <span class="keyword1"><span class="command">from</span></span> compass_non_zero <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 east <span class="skolem">J</span> <span class="main">=</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_abs_in_S <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">J</span></span><span class="main">]</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?N</span> <span class="keyword1">*v</span> vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> east_def
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="main">1</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">3</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="main">1</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> inner_vec_def <span class="keyword2"><span class="keyword">and</span></span> matrix_vector_mult_def
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_3 vector_3<span class="main">)</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">3</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

   <span class="keyword1"><span class="command">from</span></span> compass_non_zero <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 west <span class="skolem">J</span> <span class="main">=</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_abs_in_S <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">J</span></span><span class="main">]</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?N</span> <span class="keyword1">*v</span> vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> west_def
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="main">1</span> <span class="main">-</span> <span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">3</span> <span class="main">-</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="main">1</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> inner_vec_def <span class="keyword2"><span class="keyword">and</span></span> matrix_vector_mult_def
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_3 vector_3<span class="main">)</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">3</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="numeral">3</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

   <span class="keyword1"><span class="command">from</span></span> compass_non_zero <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 north <span class="skolem">J</span> <span class="main">=</span> <span class="free">r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> S›</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_abs_in_S <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">J</span></span><span class="main">]</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?N</span> <span class="keyword1">*v</span> vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> north_def
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">2</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">3</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="numeral">2</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> inner_vec_def <span class="keyword2"><span class="keyword">and</span></span> matrix_vector_mult_def
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_3 vector_3<span class="main">)</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">3</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?s</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?s</span> <span class="main">(</span>polar <span class="free">q</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_intersection_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

   <span class="keyword1"><span class="command">from</span></span> compass_non_zero
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> non_zero_mult_rep_non_zero<span class="main">)</span>
   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span>›</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span>›</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"polar <span class="free">p</span> <span class="main">=</span> proj2_line_abs <span class="main">(</span>M <span class="keyword1">*v</span> <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"polar <span class="free">q</span> <span class="main">=</span> proj2_line_abs <span class="main">(</span>M <span class="keyword1">*v</span> <span class="main">(</span>vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> polar_abs<span class="main">)</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> M_invertible
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"M <span class="keyword1">*v</span> <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"M <span class="keyword1">*v</span> <span class="main">(</span>vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invertible_times_non_zero<span class="main">)</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹polar <span class="free">p</span> <span class="main">=</span> proj2_line_abs <span class="main">(</span>M <span class="keyword1">*v</span> <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span><span class="main">)</span>›</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹polar <span class="free">q</span> <span class="main">=</span> proj2_line_abs <span class="main">(</span>M <span class="keyword1">*v</span> <span class="main">(</span>vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span><span class="main">)</span>›</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?s</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span>›</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?s</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>
     <span class="main">⟷</span> <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span>
     <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?s</span> <span class="main">(</span>polar <span class="free">q</span><span class="main">)</span>
     <span class="main">⟷</span> <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span>
     <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="main">(</span>vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_incident_abs<span class="main">)</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?s</span> <span class="main">(</span>polar <span class="free">p</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?s</span> <span class="main">(</span>polar <span class="free">q</span><span class="main">)</span>›</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span>
     <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span>
     <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="main">(</span>vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="keyword1">v*</span> cltn2_rep <span class="skolem">J</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?N</span> <span class="keyword1">*v</span> vector <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?N</span> <span class="keyword1">*v</span> vector <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dot_lmul_matrix matrix_vector_mul_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="main">1</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> inner_vec_def <span class="keyword2"><span class="keyword">and</span></span> matrix_vector_mult_def
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_3 vector_3<span class="main">)</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="main">1</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="main">1</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>›</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="numeral">3</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="var">?N</span><span class="main">$</span><span class="numeral">2</span><span class="main">$</span><span class="numeral">3</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span><span class="main">$</span><span class="numeral">3</span><span class="main">$</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>›</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span> <span class="main">=</span> <span class="main">(</span><span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> M"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> M_def
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff vector_3 forall_3<span class="main">)</span>

   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>cltn2_rep <span class="skolem">J</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cltn2_rep_invertible<span class="main">)</span>
   <span class="keyword1"><span class="command">with</span></span> M_invertible
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="var">?N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invertible_mult transpose_invertible<span class="main">)</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_not_invertible<span class="main">)</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span> <span class="main">=</span> <span class="main">(</span><span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> M›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span> <span class="main">=</span> <span class="main">(</span><span class="var">?N</span><span class="main">$</span><span class="main">1</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> M›</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="main">(</span>cltn2_abs <span class="main">(</span>cltn2_rep <span class="skolem">J</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> J_M_J_transpose_K2_isometry<span class="main">)</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2_abs_rep<span class="main">)</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 east <span class="skolem">J</span> <span class="main">=</span> <span class="free">p</span>›</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 west <span class="skolem">J</span> <span class="main">=</span> <span class="free">q</span>›</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 north <span class="skolem">J</span> <span class="main">=</span> <span class="free">r</span>›</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 far_north <span class="skolem">J</span> <span class="main">=</span> <span class="var">?s</span>›</span></span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J</span><span class="main">.</span> is_K2_isometry <span class="bound">J</span>
     <span class="main">∧</span> apply_cltn2 east <span class="bound">J</span> <span class="main">=</span> <span class="free">p</span>
     <span class="main">∧</span> apply_cltn2 west <span class="bound">J</span> <span class="main">=</span> <span class="free">q</span>
     <span class="main">∧</span> apply_cltn2 north <span class="bound">J</span> <span class="main">=</span> <span class="free">r</span>
     <span class="main">∧</span> apply_cltn2 far_north <span class="bound">J</span> <span class="main">=</span> <span class="var">?s</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> statement66_existence<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a1</span> <span class="main">∈</span> K2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a2</span> <span class="main">∈</span> K2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p1</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p2</span> <span class="main">∈</span> S"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J</span><span class="main">.</span> is_K2_isometry <span class="bound">J</span> <span class="main">∧</span> apply_cltn2 <span class="free">a1</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">a2</span> <span class="main">∧</span> apply_cltn2 <span class="free">p1</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">p2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="free">a1</span><span class="main">,</span><span class="free">a2</span><span class="main">]</span> <span class="main">::</span> proj2<span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a1</span> <span class="main">∈</span> K2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a2</span> <span class="main">∈</span> K2›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?a</span><span class="main">$</span><span class="bound">i</span> <span class="main">∈</span> K2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> forall_2<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">]</span> <span class="main">::</span> proj2<span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p1</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p2</span> <span class="main">∈</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?p</span><span class="main">$</span><span class="bound">i</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> forall_2<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> proj2_line_through <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?p</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> proj2_incident <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_line_through_incident<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> proj2_incident <span class="main">(</span><span class="var">?p</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_line_through_incident<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?p</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?p</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">ϵ</span> <span class="bound">qi</span><span class="main">.</span> <span class="bound">qi</span> <span class="main">≠</span> <span class="var">?p</span><span class="main">$</span><span class="bound">i</span> <span class="main">∧</span> <span class="bound">qi</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">qi</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?q</span><span class="main">$</span><span class="bound">i</span> <span class="main">≠</span> <span class="var">?p</span><span class="main">$</span><span class="bound">i</span> <span class="main">∧</span> <span class="var">?q</span><span class="main">$</span><span class="bound">i</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="main">(</span><span class="var">?q</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?a</span><span class="main">$</span><span class="bound">i</span> <span class="main">∈</span> K2›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> K2"</span></span> <span class="keyword1"><span class="command">..</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> proj2_incident <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> K2›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">qi</span><span class="main">.</span> <span class="bound">qi</span> <span class="main">≠</span> <span class="var">?p</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∧</span> <span class="bound">qi</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">qi</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> line_through_K2_intersect_S_again<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> someI_ex <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">qi</span><span class="main">.</span> <span class="bound">qi</span> <span class="main">≠</span> <span class="var">?p</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∧</span> <span class="bound">qi</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">qi</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span><span class="main">$</span><span class="skolem">i</span> <span class="main">≠</span> <span class="var">?p</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∧</span> <span class="var">?q</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="main">(</span><span class="var">?q</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span><span class="main">$</span><span class="main">1</span> <span class="main">≠</span> <span class="var">?p</span><span class="main">$</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?q</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?q</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> proj2_intersection <span class="main">(</span>polar <span class="main">(</span><span class="var">?q</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>polar <span class="main">(</span><span class="var">?p</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> proj2_line_through <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?r</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> proj2_incident <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_line_through_incident<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> proj2_incident <span class="main">(</span><span class="var">?r</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_line_through_incident<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?r</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?r</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">ϵ</span> <span class="bound">si</span><span class="main">.</span> <span class="bound">si</span> <span class="main">≠</span> <span class="var">?r</span><span class="main">$</span><span class="bound">i</span> <span class="main">∧</span> <span class="bound">si</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">si</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?s</span><span class="main">$</span><span class="bound">i</span> <span class="main">≠</span> <span class="var">?r</span><span class="main">$</span><span class="bound">i</span> <span class="main">∧</span> <span class="var">?s</span><span class="main">$</span><span class="bound">i</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="main">(</span><span class="var">?s</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?a</span><span class="main">$</span><span class="bound">i</span> <span class="main">∈</span> K2›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> K2"</span></span> <span class="keyword1"><span class="command">..</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> proj2_incident <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> K2›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">si</span><span class="main">.</span> <span class="bound">si</span> <span class="main">≠</span> <span class="var">?r</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∧</span> <span class="bound">si</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">si</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> line_through_K2_intersect_S_again<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> someI_ex <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">si</span><span class="main">.</span> <span class="bound">si</span> <span class="main">≠</span> <span class="var">?r</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∧</span> <span class="bound">si</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">si</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span><span class="main">$</span><span class="skolem">i</span> <span class="main">≠</span> <span class="var">?r</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∧</span> <span class="var">?s</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="main">(</span><span class="var">?s</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span><span class="main">$</span><span class="main">1</span> <span class="main">≠</span> <span class="var">?r</span><span class="main">$</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?s</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?s</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">u</span><span class="main">.</span> proj2_incident <span class="bound">u</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">u</span> <span class="main">=</span> <span class="var">?p</span><span class="main">$</span><span class="bound">i</span> <span class="main">∨</span> <span class="bound">u</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">standard</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted"><span class="numeral">2</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="main">::</span> <span class="quoted">proj2</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">u</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="var">?p</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∨</span> <span class="skolem">u</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="skolem">i</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?p</span><span class="main">$</span><span class="bound">i</span> <span class="main">∈</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">..</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?q</span><span class="main">$</span><span class="bound">i</span> <span class="main">≠</span> <span class="var">?p</span><span class="main">$</span><span class="bound">i</span> <span class="main">∧</span> <span class="var">?q</span><span class="main">$</span><span class="bound">i</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="main">(</span><span class="var">?q</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span><span class="main">$</span><span class="skolem">i</span> <span class="main">≠</span> <span class="var">?p</span><span class="main">$</span><span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> S"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?p</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?q</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="var">?p</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∨</span> <span class="skolem">u</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="skolem">i</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">u</span> <span class="main">(</span>polar <span class="skolem">u</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> incident_own_polar_in_S<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?r</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>polar <span class="main">(</span><span class="var">?p</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?r</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>polar <span class="main">(</span><span class="var">?q</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_intersection_incident<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="var">?p</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∨</span> <span class="skolem">u</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="skolem">i</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?r</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>polar <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> proj2_incident <span class="main">(</span><span class="var">?r</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?r</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> proj2_incident <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?a</span><span class="main">$</span><span class="bound">i</span> <span class="main">∈</span> K2›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> K2"</span></span> <span class="keyword1"><span class="command">..</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="var">?r</span><span class="main">$</span><span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="var">?r</span><span class="main">$</span><span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="var">?r</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>polar <span class="main">(</span><span class="var">?p</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="var">?r</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>polar <span class="main">(</span><span class="var">?q</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">u</span> <span class="main">(</span>polar <span class="main">(</span><span class="var">?p</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">u</span> <span class="main">(</span>polar <span class="main">(</span><span class="var">?q</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?p</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?q</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> S›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="var">?p</span><span class="main">$</span><span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> point_in_S_polar_is_tangent<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?q</span><span class="main">$</span><span class="skolem">i</span> <span class="main">≠</span> <span class="var">?p</span><span class="main">$</span><span class="skolem">i</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>polar <span class="skolem">u</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="var">?r</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>polar <span class="skolem">u</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">u</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="var">?r</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_unique
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span><span class="main">$</span><span class="skolem">i</span> <span class="main">=</span> polar <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>polar <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> K2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> tangent_not_through_K2
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">ϵ</span> <span class="bound">Hi</span><span class="main">.</span> is_K2_isometry <span class="bound">Hi</span>
    <span class="main">∧</span> apply_cltn2 east <span class="bound">Hi</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="bound">i</span>
    <span class="main">∧</span> apply_cltn2 west <span class="bound">Hi</span> <span class="main">=</span> <span class="var">?p</span><span class="main">$</span><span class="bound">i</span>
    <span class="main">∧</span> apply_cltn2 north <span class="bound">Hi</span> <span class="main">=</span> <span class="var">?s</span><span class="main">$</span><span class="bound">i</span>
    <span class="main">∧</span> apply_cltn2 far_north <span class="bound">Hi</span> <span class="main">=</span> <span class="var">?r</span><span class="main">$</span><span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> is_K2_isometry <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>
    <span class="main">∧</span> apply_cltn2 east <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="bound">i</span>
    <span class="main">∧</span> apply_cltn2 west <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p</span><span class="main">$</span><span class="bound">i</span>
    <span class="main">∧</span> apply_cltn2 north <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?s</span><span class="main">$</span><span class="bound">i</span>
    <span class="main">∧</span> apply_cltn2 far_north <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?r</span><span class="main">$</span><span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted"><span class="numeral">2</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?p</span><span class="main">$</span><span class="bound">i</span> <span class="main">∈</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">..</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?q</span><span class="main">$</span><span class="bound">i</span> <span class="main">≠</span> <span class="var">?p</span><span class="main">$</span><span class="bound">i</span> <span class="main">∧</span> <span class="var">?q</span><span class="main">$</span><span class="bound">i</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="main">(</span><span class="var">?q</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span><span class="main">$</span><span class="skolem">i</span> <span class="main">≠</span> <span class="var">?p</span><span class="main">$</span><span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> S"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?s</span><span class="main">$</span><span class="bound">i</span> <span class="main">≠</span> <span class="var">?r</span><span class="main">$</span><span class="bound">i</span> <span class="main">∧</span> <span class="var">?s</span><span class="main">$</span><span class="bound">i</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="main">(</span><span class="var">?s</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span><span class="var">?s</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="var">?s</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">u</span><span class="main">.</span>  proj2_incident <span class="bound">u</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">u</span> <span class="main">=</span> <span class="var">?p</span><span class="main">$</span><span class="bound">i</span> <span class="main">∨</span> <span class="bound">u</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∉</span> <span class="main">{</span><span class="var">?q</span><span class="main">$</span><span class="skolem">i</span><span class="main">,</span> <span class="var">?p</span><span class="main">$</span><span class="skolem">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?q</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?p</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?s</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?q</span><span class="main">$</span><span class="skolem">i</span> <span class="main">≠</span> <span class="var">?p</span><span class="main">$</span><span class="skolem">i</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">Hi</span><span class="main">.</span> is_K2_isometry <span class="bound">Hi</span>
      <span class="main">∧</span> apply_cltn2 east <span class="bound">Hi</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="skolem">i</span>
      <span class="main">∧</span> apply_cltn2 west <span class="bound">Hi</span> <span class="main">=</span> <span class="var">?p</span><span class="main">$</span><span class="skolem">i</span>
      <span class="main">∧</span> apply_cltn2 north <span class="bound">Hi</span> <span class="main">=</span> <span class="var">?s</span><span class="main">$</span><span class="skolem">i</span>
      <span class="main">∧</span> apply_cltn2 far_north <span class="bound">Hi</span> <span class="main">=</span> <span class="var">?r</span><span class="main">$</span><span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> statement65_special_case<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> someI_ex <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">Hi</span><span class="main">.</span> is_K2_isometry <span class="bound">Hi</span>
      <span class="main">∧</span> apply_cltn2 east <span class="bound">Hi</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="skolem">i</span>
      <span class="main">∧</span> apply_cltn2 west <span class="bound">Hi</span> <span class="main">=</span> <span class="var">?p</span><span class="main">$</span><span class="skolem">i</span>
      <span class="main">∧</span> apply_cltn2 north <span class="bound">Hi</span> <span class="main">=</span> <span class="var">?s</span><span class="main">$</span><span class="skolem">i</span>
      <span class="main">∧</span> apply_cltn2 far_north <span class="bound">Hi</span> <span class="main">=</span> <span class="var">?r</span><span class="main">$</span><span class="skolem">i</span>"</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>
      <span class="main">∧</span> apply_cltn2 east <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="skolem">i</span>
      <span class="main">∧</span> apply_cltn2 west <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p</span><span class="main">$</span><span class="skolem">i</span>
      <span class="main">∧</span> apply_cltn2 north <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?s</span><span class="main">$</span><span class="skolem">i</span>
      <span class="main">∧</span> apply_cltn2 far_north <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?r</span><span class="main">$</span><span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 east <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 west <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p</span><span class="main">$</span><span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 north <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="var">?s</span><span class="main">$</span><span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 far_north <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="var">?r</span><span class="main">$</span><span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"is_K2_isometry <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 east <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 west <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p</span><span class="main">$</span><span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 north <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?s</span><span class="main">$</span><span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 far_north <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?r</span><span class="main">$</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?J</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_compose <span class="main">(</span>cltn2_inverse <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="var">?J</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> cltn2_inverse_is_K2_isometry cltn2_compose_is_K2_isometry<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 west <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p</span><span class="main">$</span><span class="main">1</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p1</span> <span class="main">(</span>cltn2_inverse <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> west"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2.act_inv_iff <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 west <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p</span><span class="main">$</span><span class="numeral">2</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p1</span> <span class="var">?J</span> <span class="main">=</span> <span class="free">p2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2.act_act <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 east <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="main">1</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span><span class="var">?q</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>cltn2_inverse <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> east"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2.act_inv_iff <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 east <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="numeral">2</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span><span class="var">?q</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="var">?J</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2.act_act <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?q</span><span class="main">$</span><span class="main">1</span> <span class="main">≠</span> <span class="var">?p</span><span class="main">$</span><span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">p1</span> <span class="var">?J</span> <span class="main">=</span> <span class="free">p2</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="var">?p</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="var">?q</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="var">?p</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="var">?q</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="var">?J</span> <span class="main">=</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apply_cltn2_line_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="var">?J</span><span class="main">)</span> <span class="main">(</span>apply_cltn2_line <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="var">?J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="var">?J</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 north <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="var">?s</span><span class="main">$</span><span class="main">1</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span><span class="var">?s</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>cltn2_inverse <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> north"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2.act_inv_iff <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 north <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?s</span><span class="main">$</span><span class="numeral">2</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span><span class="var">?s</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="var">?J</span> <span class="main">=</span> <span class="var">?s</span><span class="main">$</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2.act_act <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 far_north <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="var">?r</span><span class="main">$</span><span class="main">1</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span><span class="var">?r</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>cltn2_inverse <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> far_north"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2.act_inv_iff <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 far_north <span class="main">(</span><span class="var">?H</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?r</span><span class="main">$</span><span class="numeral">2</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span><span class="var">?r</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="var">?J</span> <span class="main">=</span> <span class="var">?r</span><span class="main">$</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2.act_act <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?s</span><span class="main">$</span><span class="main">1</span> <span class="main">≠</span> <span class="var">?r</span><span class="main">$</span><span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="main">(</span><span class="var">?s</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="var">?J</span> <span class="main">=</span> <span class="main">(</span><span class="var">?s</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="var">?r</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="var">?s</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="var">?r</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="var">?s</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="var">?J</span> <span class="main">=</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apply_cltn2_line_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="var">?J</span><span class="main">)</span> <span class="main">(</span>apply_cltn2_line <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="var">?J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="var">?J</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">u</span><span class="main">.</span> proj2_incident <span class="bound">u</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">u</span> <span class="main">=</span> <span class="var">?p</span><span class="main">$</span><span class="bound">i</span> <span class="main">∨</span> <span class="bound">u</span> <span class="main">=</span> <span class="var">?q</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_incident <span class="main">(</span><span class="var">?p</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="var">?p</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span><span class="main">$</span><span class="numeral">2</span> <span class="main">≠</span> <span class="var">?l</span><span class="main">$</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span>apply_cltn2 <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="var">?J</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span>apply_cltn2 <span class="main">(</span><span class="var">?a</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="var">?J</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_unique
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">a1</span> <span class="var">?J</span> <span class="main">=</span> <span class="free">a2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="var">?J</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">p1</span> <span class="var">?J</span> <span class="main">=</span> <span class="free">p2</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J</span><span class="main">.</span> is_K2_isometry <span class="bound">J</span> <span class="main">∧</span> apply_cltn2 <span class="free">a1</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">a2</span> <span class="main">∧</span> apply_cltn2 <span class="free">p1</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">p2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> K2_isometry_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J</span><span class="main">.</span> is_K2_isometry <span class="bound">J</span> <span class="main">∧</span> apply_cltn2 <span class="free">a</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> apply_cltn2 <span class="free">b</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> K2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> K2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_line_through <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_line_through_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> K2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="var">?l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> line_through_K2_intersect_S_exactly_twice <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> S"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">p</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">q</span> <span class="var">?l</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">r</span><span class="main">∈</span>S<span class="main">.</span> proj2_incident <span class="bound">r</span> <span class="var">?l</span> <span class="main">⟶</span> <span class="bound">r</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">∨</span> <span class="bound">r</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> K2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> K2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> S›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> statement66_existence <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">a</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">p</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">a</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="skolem">p</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">q</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="var">?l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">q</span> <span class="var">?l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">a</span> <span class="skolem">J</span><span class="main">)</span> <span class="var">?l</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 <span class="skolem">p</span> <span class="skolem">J</span><span class="main">)</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> K2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword2"><span class="keyword">and</span></span> K2_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="var">?l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">p</span> <span class="var">?l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">a</span> <span class="skolem">J</span><span class="main">)</span> <span class="var">?l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span>apply_cltn2 <span class="skolem">p</span> <span class="skolem">J</span><span class="main">)</span> <span class="var">?l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line <span class="var">?l</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apply_cltn2_line_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">q</span> <span class="var">?l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_preserve_incident <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">J</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 <span class="skolem">q</span> <span class="skolem">J</span><span class="main">)</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">q</span> <span class="skolem">J</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_K2_isometry_def<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span>apply_cltn2 <span class="skolem">q</span> <span class="skolem">J</span><span class="main">)</span> <span class="var">?l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">r</span><span class="main">∈</span>S<span class="main">.</span> proj2_incident <span class="bound">r</span> <span class="var">?l</span> <span class="main">⟶</span> <span class="bound">r</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">∨</span> <span class="bound">r</span> <span class="main">=</span> <span class="skolem">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">q</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">∨</span> apply_cltn2 <span class="skolem">q</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">q</span> <span class="skolem">J</span> <span class="main">≠</span> <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">q</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="skolem">p</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">q</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">p</span> <span class="skolem">J</span> <span class="main">=</span> apply_cltn2 <span class="skolem">q</span> <span class="skolem">J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> apply_cltn2_injective <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">J</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="skolem">q</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">∨</span> apply_cltn2 <span class="skolem">q</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">q</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="skolem">p</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">q</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">p</span> <span class="var">?l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">q</span> <span class="var">?l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="var">?l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> statement55
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>apply_cltn2 <span class="free">a</span> <span class="skolem">J</span><span class="main">)</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">a</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">b</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">a</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">b</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J</span><span class="main">.</span> is_K2_isometry <span class="bound">J</span> <span class="main">∧</span> apply_cltn2 <span class="free">a</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> apply_cltn2 <span class="free">b</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">J</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hyp2_axiom1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="bound">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">b</span> <span class="bound">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">standard</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> Rep_hyp2 <span class="keyword2"><span class="keyword">and</span></span> K2_isometry_swap <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a'</span></span></span> <span class="var"><span class="quoted"><span class="var">?b'</span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?a'</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?b'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?b'</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?a'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="var">?a'</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?b'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="var">?b'</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?a'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">a</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">b</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> hyp2_cltn2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">b</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_hyp2_C_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">J</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hyp2_axiom2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">p</span> <span class="bound">q</span> <span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">a</span> <span class="bound">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">p</span> <span class="bound">q</span> <span class="main">∧</span> <span class="bound">a</span> <span class="bound">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">r</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="bound">p</span> <span class="bound">q</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">r</span> <span class="bound">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">standard</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">r</span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">r</span> <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">H</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">a</span> <span class="skolem">G</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">b</span> <span class="skolem">G</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">a</span> <span class="skolem">H</span> <span class="main">=</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">b</span> <span class="skolem">H</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_hyp2_C_def<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?J</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_compose <span class="main">(</span>cltn2_inverse <span class="skolem">G</span><span class="main">)</span> <span class="skolem">H</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="main">(</span>cltn2_inverse <span class="skolem">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cltn2_inverse_is_K2_isometry<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">H</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="var">?J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> cltn2_compose_is_K2_isometry<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">G</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹hyp2_cltn2 <span class="skolem">a</span> <span class="skolem">G</span> <span class="main">=</span> <span class="skolem">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹hyp2_cltn2 <span class="skolem">b</span> <span class="skolem">G</span> <span class="main">=</span> <span class="skolem">q</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> K2_isometry.act_inv_iff
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">p</span> <span class="main">(</span>cltn2_inverse <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">q</span> <span class="main">(</span>cltn2_inverse <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹hyp2_cltn2 <span class="skolem">a</span> <span class="skolem">H</span> <span class="main">=</span> <span class="skolem">r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹hyp2_cltn2 <span class="skolem">b</span> <span class="skolem">H</span> <span class="main">=</span> <span class="skolem">s</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="main">(</span>cltn2_inverse <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">H</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> K2_isometry.act_act <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">p</span> <span class="var">?J</span> <span class="main">=</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">q</span> <span class="var">?J</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="var">?J</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">q</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">r</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_hyp2_C_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?J</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hyp2_axiom3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">a</span> <span class="bound">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">c</span> <span class="bound">c</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">standard</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">c</span> <span class="skolem">c</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">a</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">b</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_hyp2_C_def<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹hyp2_cltn2 <span class="skolem">a</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹hyp2_cltn2 <span class="skolem">b</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">a</span> <span class="skolem">J</span> <span class="main">=</span> hyp2_cltn2 <span class="skolem">b</span> <span class="skolem">J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>Rep_hyp2 <span class="skolem">a</span><span class="main">)</span> <span class="skolem">J</span> <span class="main">∈</span> hyp2"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>Rep_hyp2 <span class="skolem">b</span><span class="main">)</span> <span class="skolem">J</span> <span class="main">∈</span> hyp2"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> apply_cltn2_Rep_hyp2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹hyp2_cltn2 <span class="skolem">a</span> <span class="skolem">J</span> <span class="main">=</span> hyp2_cltn2 <span class="skolem">b</span> <span class="skolem">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>Rep_hyp2 <span class="skolem">a</span><span class="main">)</span> <span class="skolem">J</span> <span class="main">=</span> apply_cltn2 <span class="main">(</span>Rep_hyp2 <span class="skolem">b</span><span class="main">)</span> <span class="skolem">J</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> hyp2_cltn2_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_hyp2_inject<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="skolem">a</span> <span class="main">=</span> Rep_hyp2 <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> apply_cltn2_injective<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> hyp2<span class="main">:</span> tarski_first3 <span class="quoted">real_hyp2_C</span>
  <span class="keyword1"><span class="command">using</span></span> hyp2_axiom1 <span class="keyword2"><span class="keyword">and</span></span> hyp2_axiom2 <span class="keyword2"><span class="keyword">and</span></span> hyp2_axiom3
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Some lemmas about betweenness›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> S_at_edge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">r</span><span class="main">)</span>
  <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">r</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cr</span> <span class="main">∨</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_z_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_euclid.Col <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_Col_iff_euclid_cart2<span class="main">)</span>

  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">r</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="var">?cp</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="var">?cq</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="var">?cr</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_cart2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_pt <span class="var">?cp</span> <span class="main">=</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?cp</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_eq_1_iff_in_S<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_pt <span class="var">?cq</span> <span class="main">=</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_pt <span class="var">?cr</span> <span class="main">=</span> <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?cq</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?cr</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_le_1_iff_in_hyp2_S<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cr</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cr</span> <span class="var">?cq</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cr</span> <span class="var">?cp</span> <span class="var">?cq</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cp</span> <span class="main">-</span> <span class="var">?cr</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?cq</span> <span class="main">-</span> <span class="var">?cr</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_euclid_B_def<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cp</span> <span class="main">-</span> <span class="var">?cr</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?cq</span> <span class="main">-</span> <span class="var">?cr</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cp</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹norm <span class="var">?cp</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cr</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> norm_triangle_ineq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cr</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq</span><span class="main">)</span> <span class="main">+</span> norm <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cr</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≤</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq</span><span class="main">)</span> <span class="main">+</span> norm <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cr</span><span class="main">)</span>
      <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> norm <span class="var">?cq</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> norm <span class="var">?cr</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹norm <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq</span><span class="main">)</span> <span class="main">+</span> norm <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cr</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> norm <span class="var">?cq</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> norm <span class="var">?cr</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹norm <span class="var">?cq</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> mult_mono <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?cq</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> norm <span class="var">?cq</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹norm <span class="var">?cr</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≤</span> <span class="main">1</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> mult_mono <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?cr</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> norm <span class="var">?cr</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">*</span> norm <span class="var">?cq</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> norm <span class="var">?cq</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> norm <span class="var">?cr</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">*</span> norm <span class="var">?cq</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> norm <span class="var">?cr</span> <span class="main">≥</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> norm <span class="var">?cq</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> norm <span class="var">?cr</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">*</span> norm <span class="var">?cq</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> norm <span class="var">?cr</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> norm <span class="var">?cr</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> norm <span class="var">?cr</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">*</span> norm <span class="var">?cq</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> norm <span class="var">?cr</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> norm <span class="var">?cq</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cp</span> <span class="main">=</span> <span class="var">?cq</span> <span class="main">∨</span> <span class="var">?cq</span> <span class="main">=</span> <span class="var">?cr</span> <span class="main">∨</span> <span class="var">?cr</span> <span class="main">=</span> <span class="var">?cp</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cp</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cr</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cp</span> <span class="main">=</span> <span class="var">?cq</span> <span class="main">∨</span> <span class="var">?cq</span> <span class="main">=</span> <span class="var">?cr</span> <span class="main">∨</span> <span class="var">?cr</span> <span class="main">=</span> <span class="var">?cp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">*</span> norm <span class="var">?cq</span> <span class="main">=</span> <span class="skolem">k</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> norm <span class="var">?cr</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?cq</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?cr</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_pt <span class="var">?cq</span> <span class="main">=</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_pt <span class="var">?cr</span> <span class="main">=</span> <span class="free">r</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_eq_1_iff_in_S<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span> <span class="main">⊆</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_Col_iff_set_Col<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span> <span class="main">⊆</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_line_intersect_S<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">∨</span> <span class="free">q</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∨</span> <span class="free">r</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">∨</span> <span class="free">q</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∨</span> <span class="free">r</span> <span class="main">=</span> <span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">}</span> <span class="main">≤</span> <span class="numeral">2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cp</span> <span class="main">=</span> <span class="var">?cq</span> <span class="main">∨</span> <span class="var">?cq</span> <span class="main">=</span> <span class="var">?cr</span> <span class="main">∨</span> <span class="var">?cr</span> <span class="main">=</span> <span class="var">?cp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cr</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cr</span> <span class="var">?cq</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_euclid.th3_1 real_euclid.th3_2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cr</span> <span class="var">?cp</span> <span class="var">?cq</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹real_euclid.Col <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cr</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cr</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cr</span> <span class="var">?cq</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> real_euclid.Col_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_euclid.th3_1 real_euclid.th3_2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hyp2_in_middle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">r</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cr</span> <span class="var">?cq</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cr</span> <span class="var">?cq</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?cr</span> <span class="var">?cp</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_euclid.th3_2 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?cq</span></span></span> <span class="var"><span class="quoted"><span class="var">?cr</span></span></span> <span class="var"><span class="quoted"><span class="var">?cp</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cr</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cr</span> <span class="var">?cq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_at_edge<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cr</span> <span class="var">?cq</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_Col_permute <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">q</span> <span class="free">p</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?cp</span> <span class="var">?cr</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?cr</span> <span class="var">?cp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_at_edge<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?cr</span> <span class="var">?cp</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?cp</span> <span class="var">?cr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cr</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cp</span> <span class="main">=</span> <span class="var">?cq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_euclid.th3_4<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="var">?cp</span> <span class="main">=</span> proj2_pt <span class="var">?cq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_z_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="var">?cp</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="var">?cq</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_cart2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_pt <span class="var">?cp</span> <span class="main">=</span> proj2_pt <span class="var">?cq</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hyp2_incident_in_middle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_incident_Col<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2_in_middle<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> extend_to_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">r</span><span class="main">∈</span>S<span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="bound">r</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">r</span><span class="main">∈</span>S<span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="main">(</span>cart2_pt <span class="bound">r</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> S"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_euclid.th3_1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">r</span><span class="main">∈</span>S<span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="main">(</span>cart2_pt <span class="bound">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∉</span> S"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> K2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_line_through <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_line_through_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> K2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="var">?l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> line_through_K2_intersect_S_twice <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> S"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">s</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">t</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ct</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="skolem">t</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">s</span> <span class="var">?l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">t</span> <span class="var">?l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="var">?l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="var">?l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="skolem">s</span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="skolem">t</span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="skolem">s</span> <span class="skolem">t</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_incident_Col<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_Col <span class="skolem">s</span> <span class="free">p</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_Col <span class="skolem">t</span> <span class="free">p</span> <span class="free">q</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cs</span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cs</span> <span class="var">?cq</span> <span class="var">?cp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ct</span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ct</span> <span class="var">?cq</span> <span class="var">?cp</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_at_edge<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> real_euclid.th3_2
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?cp</span> <span class="var">?cs</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?cp</span> <span class="var">?ct</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?ct</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_Col <span class="skolem">s</span> <span class="skolem">t</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">t</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cs</span> <span class="var">?cq</span> <span class="var">?ct</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2_in_middle<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ct</span> <span class="var">?cq</span> <span class="var">?cs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_euclid.th3_2<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cs</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?ct</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cs</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?ct</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?ct</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?cp</span> <span class="var">?cs</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cs</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?cp</span> <span class="var">?ct</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?ct</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?cp</span> <span class="var">?cs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?cp</span> <span class="var">?ct</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cs</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?cp</span> <span class="var">?cs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cp</span> <span class="main">≠</span> <span class="var">?cq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?cp</span> <span class="var">?cs</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?cp</span> <span class="var">?ct</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?cs</span> <span class="var">?ct</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?ct</span> <span class="var">?cs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_euclid_th5_1 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?cq</span></span></span> <span class="var"><span class="quoted"><span class="var">?cp</span></span></span> <span class="var"><span class="quoted"><span class="var">?cs</span></span></span> <span class="var"><span class="quoted"><span class="var">?ct</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cs</span> <span class="var">?cq</span> <span class="var">?ct</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ct</span> <span class="var">?cq</span> <span class="var">?cs</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cq</span> <span class="main">=</span> <span class="var">?cs</span> <span class="main">∨</span> <span class="var">?cq</span> <span class="main">=</span> <span class="var">?ct</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_euclid.th3_4<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> S›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">∨</span> <span class="free">q</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_cart2_inj<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∉</span> S›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> S›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">r</span><span class="main">∈</span>S<span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="main">(</span>cart2_pt <span class="bound">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">endpoint_in_S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> proj2 <span class="main">⇒</span> proj2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">endpoint_in_S</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>
  <span class="main">≡</span> <span class="main">ϵ</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span><span class="main">∈</span>S <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="bound">p</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> endpoint_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="free">a</span> <span class="free">b</span> <span class="main">∈</span> S"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> S"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">b</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="main">(</span>endpoint_in_S <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> extend_to_S
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="main">(</span>cart2_pt <span class="bound">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> endpoint_in_S_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> endpoint_in_S_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="free">a</span> <span class="free">b</span> <span class="main">≠</span> endpoint_in_S <span class="free">b</span> <span class="free">a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="var">?q</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ca</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?q</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cb</span> <span class="var">?ca</span> <span class="var">?cq</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S<span class="main">)</span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="var">?q</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cb</span> <span class="var">?ca</span> <span class="var">?cq</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cb</span> <span class="var">?ca</span> <span class="var">?cp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ca</span> <span class="main">=</span> <span class="var">?cb</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_euclid.th3_4<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2_S_cart2_inj<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> endpoint_in_S_incident<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>endpoint_in_S <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">l</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?p</span> <span class="free">l</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">b</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="var">?p</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> endpoint_in_S<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?p</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_z_non_zero<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_euclid.Col <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> real_euclid.Col_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="var">?p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">l</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?p</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> euclid_Col_cart2_incident<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> endpoints_in_S_incident_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> endpoint_in_S <span class="free">a</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">=</span> endpoint_in_S <span class="free">b</span> <span class="free">a</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="var">?q</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">≠</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> endpoint_in_S_swap<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?q</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?r</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S_incident<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?q</span> <span class="main">≠</span> <span class="var">?r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="var">?q</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_S_two_intersections_only<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> endpoint_in_S_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">b</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> endpoint_in_S <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="var">?q</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_z_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> euclid_B_cart2_common_line <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="var">?q</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">=</span> endpoint_in_S <span class="free">b</span> <span class="free">a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="var">?q</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> endpoints_in_S_incident_unique<span class="main">)</span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="var">?q</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="var">?q</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">=</span> <span class="var">?r</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cb</span> <span class="var">?ca</span> <span class="var">?cp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ca</span> <span class="main">=</span> <span class="var">?cb</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_euclid.th3_4<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2_S_cart2_inj<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> between_hyp2_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="main">(</span><span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>cart2_pt <span class="free">r</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="var">?cq</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_pt <span class="var">?cq</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_z_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="var">?cp</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_pt <span class="var">?cr</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_cart2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?cp</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?cr</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_le_1_iff_in_hyp2_S<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≤</span> <span class="main">1</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> norm_triangle_ineq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cr</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?cq</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">*</span> norm <span class="var">?cr</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> norm <span class="var">?cp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹norm <span class="var">?cr</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> mult_mono <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?cr</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">*</span> norm <span class="var">?cr</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹norm <span class="var">?cp</span> <span class="main">≤</span> <span class="main">1</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mult_mono <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?cp</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> norm <span class="var">?cp</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">-</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹norm <span class="var">?cq</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">*</span> norm <span class="var">?cr</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> norm <span class="var">?cp</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">*</span> norm <span class="var">?cr</span> <span class="main">≤</span> <span class="free">k</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?cq</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_le_1_iff_in_hyp2_S<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Klein--Beltrami model satisfies axiom 4›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">expansion_factor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> cltn2 <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">expansion_factor</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">J</span></span></span> <span class="main">≡</span> <span class="main">(</span>cart2_append1 <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">v*</span> cltn2_rep <span class="free"><span class="bound"><span class="entity">J</span></span></span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> expansion_factor<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"expansion_factor <span class="free">p</span> <span class="free">J</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">J</span>
  <span class="main">=</span> expansion_factor <span class="free">p</span> <span class="free">J</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_K2_isometry_z_non_zero<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> cart2_append1_apply_cltn2
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">J</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cart2_append1 <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">J</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"expansion_factor <span class="free">p</span> <span class="free">J</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> expansion_factor_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cart2_append1_z<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹cart2_append1 <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">J</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"expansion_factor <span class="free">p</span> <span class="free">J</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="free">p</span> <span class="keyword1">v*</span> cltn2_rep <span class="free">J</span>
    <span class="main">=</span> expansion_factor <span class="free">p</span> <span class="free">J</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> expansion_factor_linear_apply_cltn2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">r</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_pt <span class="free">p</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_pt <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"expansion_factor <span class="free">r</span> <span class="free">J</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">r</span> <span class="free">J</span><span class="main">)</span>
  <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> expansion_factor <span class="free">p</span> <span class="free">J</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>
  <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> expansion_factor <span class="free">q</span> <span class="free">J</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?er</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">_</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="var">?ep</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">_</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="var">?eq</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cp1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cq1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cr1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?repJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_rep <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_z_non_zero<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cr</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vector2_append1 <span class="var">?cr</span>
    <span class="main">=</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector2_append1 <span class="var">?cp</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector2_append1 <span class="var">?cq</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> vector2_append1_def vector_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">r</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cr1</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp1</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cart2_append1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cr1</span> <span class="keyword1">v*</span> <span class="var">?repJ</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?cp1</span> <span class="keyword1">v*</span> <span class="var">?repJ</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?cq1</span> <span class="keyword1">v*</span> <span class="var">?repJ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_matrix_left_distrib scaleR_vector_matrix_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?er</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">r</span> <span class="free">J</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="var">?ep</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>
    <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="var">?eq</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="free">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> expansion_factor<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> expansion_factor_linear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">r</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_pt <span class="free">p</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_pt <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"expansion_factor <span class="free">r</span> <span class="free">J</span>
  <span class="main">=</span> <span class="free">k</span> <span class="main">*</span> expansion_factor <span class="free">p</span> <span class="free">J</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> expansion_factor <span class="free">q</span> <span class="free">J</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?er</span> <span class="main">=</span> <span class="free">k</span> <span class="main">*</span> <span class="var">?ep</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="var">?eq</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="free">J</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="main">(</span>apply_cltn2 <span class="free">r</span> <span class="free">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_K2_isometry_z_non_zero<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹cart2_pt <span class="free">r</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_pt <span class="free">p</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_pt <span class="free">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?er</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">r</span> <span class="free">J</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="var">?ep</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>
    <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="var">?eq</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="free">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> expansion_factor_linear_apply_cltn2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?er</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">r</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span>
    <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="var">?ep</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>
    <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="var">?eq</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">$</span><span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="free">J</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="main">(</span>apply_cltn2 <span class="free">r</span> <span class="free">J</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?er</span> <span class="main">=</span> <span class="free">k</span> <span class="main">*</span> <span class="var">?ep</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="var">?eq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cart2_append1_z<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> expansion_factor_sgn_invariant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>expansion_factor <span class="free">p</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>expansion_factor <span class="free">q</span> <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"sgn <span class="var">?ep</span> <span class="main">=</span> sgn <span class="var">?eq</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sgn <span class="var">?ep</span> <span class="main">≠</span> sgn <span class="var">?eq</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ep</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?eq</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> expansion_factor<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sgn <span class="var">?ep</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sgn <span class="var">?eq</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_real_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹sgn <span class="var">?ep</span> <span class="main">≠</span> sgn <span class="var">?eq</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="var">?ep</span> <span class="main">=</span> <span class="main">-</span> sgn <span class="var">?eq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sgn <span class="var">?ep</span> <span class="main">=</span> sgn <span class="main">(</span><span class="main">-</span><span class="var">?eq</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sgn_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> sgn_plus <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?ep</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="var">?eq</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="var">?ep</span> <span class="main">-</span> <span class="var">?eq</span><span class="main">)</span> <span class="main">=</span> sgn <span class="var">?ep</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹sgn <span class="var">?ep</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ep</span> <span class="main">-</span> <span class="var">?eq</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_real_def<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="var">?eq</span> <span class="main">/</span> <span class="main">(</span><span class="var">?ep</span> <span class="main">-</span> <span class="var">?eq</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹sgn <span class="main">(</span><span class="var">?ep</span> <span class="main">-</span> <span class="var">?eq</span><span class="main">)</span> <span class="main">=</span> sgn <span class="var">?ep</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹sgn <span class="var">?ep</span> <span class="main">=</span> sgn <span class="main">(</span><span class="main">-</span><span class="var">?eq</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="var">?ep</span> <span class="main">-</span> <span class="var">?eq</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span><span class="main">-</span><span class="var">?eq</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ep</span> <span class="main">-</span> <span class="var">?eq</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> sgn_div <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?ep</span> <span class="main">-</span> <span class="var">?eq</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="var">?eq</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ep</span> <span class="main">-</span> <span class="var">?eq</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="var">?k</span> <span class="main">=</span> <span class="var">?ep</span> <span class="main">/</span> <span class="main">(</span><span class="var">?ep</span> <span class="main">-</span> <span class="var">?eq</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹sgn <span class="main">(</span><span class="var">?ep</span> <span class="main">-</span> <span class="var">?eq</span><span class="main">)</span> <span class="main">=</span> sgn <span class="var">?ep</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ep</span> <span class="main">-</span> <span class="var">?eq</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="var">?k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_div<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_pt <span class="var">?cr</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?er</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"expansion_factor <span class="var">?r</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?r</span> <span class="main">=</span> <span class="var">?cr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cart2_proj2<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?k</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?k</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> between_hyp2_S <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">p</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹cart2_pt <span class="var">?r</span> <span class="main">=</span> <span class="var">?cr</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> expansion_factor_linear <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="quoted"><span class="free">J</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?er</span> <span class="main">=</span> <span class="var">?k</span> <span class="main">*</span> <span class="var">?ep</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?k</span><span class="main">)</span> <span class="main">*</span> <span class="var">?eq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ep</span> <span class="main">-</span> <span class="var">?eq</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?er</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> expansion_factor<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> statement_63<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span>
  <span class="main">(</span>cart2_pt <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>cart2_pt <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>cart2_pt <span class="main">(</span>apply_cltn2 <span class="free">r</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ep</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"expansion_factor <span class="free">p</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?eq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"expansion_factor <span class="free">q</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?er</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"expansion_factor <span class="free">r</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?eq</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> expansion_factor<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> expansion_factor_sgn_invariant
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="var">?ep</span> <span class="main">=</span> sgn <span class="var">?eq</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sgn <span class="var">?er</span> <span class="main">=</span> sgn <span class="var">?eq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eq</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ep</span> <span class="main">/</span> <span class="var">?eq</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?er</span> <span class="main">/</span> <span class="var">?eq</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_div<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cq</span> <span class="var">?cr</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cq</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cr</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_euclid_B_def<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="var">?er</span> <span class="main">/</span> <span class="var">?eq</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?er</span> <span class="main">/</span> <span class="var">?eq</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> mult_nonneg_nonneg <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="quoted">"<span class="var">?er</span> <span class="main">/</span> <span class="var">?eq</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cq</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cr</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?eq</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="var">?er</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="var">?ep</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> expansion_factor_linear<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eq</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="var">?c</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="var">?ep</span> <span class="main">/</span> <span class="var">?eq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ep</span> <span class="main">/</span> <span class="var">?eq</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mult_nonneg_nonneg <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ep</span> <span class="main">/</span> <span class="var">?eq</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">q</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">r</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cpJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?pJ</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cqJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?qJ</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?crJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?rJ</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cpJ1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="var">?pJ</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cqJ1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="var">?qJ</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?crJ1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_append1 <span class="var">?rJ</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="var">?pJ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="var">?qJ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="var">?rJ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_K2_isometry_z_non_zero<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cq</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cr</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?eq</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cqJ1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> <span class="var">?er</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?crJ1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="var">?ep</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cpJ1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> expansion_factor_linear_apply_cltn2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="var">?eq</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?eq</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cqJ1</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="var">?eq</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> <span class="var">?er</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?crJ1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="var">?ep</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cpJ1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">-</span> <span class="var">?c</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="var">?ep</span> <span class="main">/</span> <span class="var">?eq</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eq</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cqJ1</span> <span class="main">=</span> <span class="var">?c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?crJ1</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?c</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cpJ1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_right_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="var">?pJ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="var">?qJ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="var">?rJ</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vector2_append1 <span class="var">?cqJ</span>
    <span class="main">=</span> <span class="var">?c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector2_append1 <span class="var">?crJ</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?c</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector2_append1 <span class="var">?cpJ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cart2_append1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cqJ</span> <span class="main">=</span> <span class="var">?c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?crJ</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?c</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cpJ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vector2_append1_def <span class="keyword2"><span class="keyword">and</span></span> vector_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_2 forall_3<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?c</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?c</span> <span class="main">≤</span> <span class="main">1</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cpJ</span> <span class="var">?cqJ</span> <span class="var">?crJ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_euclid_B_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hyp2_axiom4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">q</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">q</span> <span class="bound">a</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">a</span> <span class="bound">x</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">b</span> <span class="bound">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted">hyp2</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pa</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="skolem">c</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pq</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pa</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pb</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pc</span> <span class="main">∈</span> hyp2"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Rep_hyp2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?pq</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ca</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?pa</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?pb</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?pc</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">ϵ</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cb</span> <span class="var">?cc</span> <span class="main">(</span>cart2_pt <span class="bound">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?pp</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pb</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pc</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> extend_to_S <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?pb</span></span></span> <span class="var"><span class="quoted"><span class="var">?pc</span></span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> someI_ex <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cb</span> <span class="var">?cc</span> <span class="main">(</span>cart2_pt <span class="bound">p</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pp</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cb</span> <span class="var">?cc</span> <span class="var">?cp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">ϵ</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?ca</span> <span class="main">(</span>cart2_pt <span class="bound">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?pr</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pq</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> extend_to_S <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?pq</span></span></span> <span class="var"><span class="quoted"><span class="var">?pa</span></span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> someI_ex <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?ca</span> <span class="main">(</span>cart2_pt <span class="bound">r</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pr</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?ca</span> <span class="var">?cr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pb</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pp</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pr</span> <span class="main">∈</span> S›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> statement66_existence <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?pb</span></span></span> <span class="var"><span class="quoted"><span class="var">?pa</span></span></span> <span class="var"><span class="quoted"><span class="var">?pp</span></span></span> <span class="var"><span class="quoted"><span class="var">?pr</span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?pb</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?pa</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?pp</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?pr</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?px</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?pc</span> <span class="skolem">J</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?px</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Abs_hyp2 <span class="var">?px</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pc</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?px</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> statement60_one_way<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="var">?x</span> <span class="main">=</span> <span class="var">?px</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Abs_hyp2_inverse<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pb</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pc</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pp</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cb</span> <span class="var">?cc</span> <span class="var">?cp</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> statement_63
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="main">(</span>apply_cltn2 <span class="var">?pb</span> <span class="skolem">J</span><span class="main">)</span><span class="main">)</span> <span class="var">?cx</span> <span class="main">(</span>cart2_pt <span class="main">(</span>apply_cltn2 <span class="var">?pp</span> <span class="skolem">J</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="var">?pb</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?pa</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="var">?pp</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?pr</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cx</span> <span class="var">?cr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?ca</span> <span class="var">?cr</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="var">?ca</span> <span class="var">?cx</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_euclid.th3_5_1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Rep_hyp2 <span class="var">?x</span> <span class="main">=</span> <span class="var">?px</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">q</span> <span class="skolem">a</span> <span class="var">?x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> real_hyp2_B_def <span class="keyword2"><span class="keyword">and</span></span> hyp2_rep_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Abs_hyp2 <span class="var">?pa</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Rep_hyp2_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="var">?pb</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?pa</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">b</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> hyp2_cltn2_def<span class="main">)</span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">c</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hyp2_cltn2_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹hyp2_cltn2 <span class="skolem">b</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">c</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a</span> <span class="var">?x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_hyp2_C_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">J</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="var">?x</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">b</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2.th2_2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">q</span> <span class="skolem">a</span> <span class="var">?x</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">q</span> <span class="skolem">a</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="bound">x</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">b</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More betweenness theorems›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hyp2_S_points_fix_line<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">a</span> <span class="free">J</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aJ</span> <span class="main">=</span> <span class="free">a</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="free">J</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pJ</span> <span class="main">=</span> <span class="free">p</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">b</span> <span class="free">J</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bJ</span> <span class="main">=</span> <span class="free">b</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2_line <span class="free">l</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?aJ</span> <span class="var">?lJ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pJ</span> <span class="var">?lJ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?aJ</span> <span class="main">=</span> <span class="free">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pJ</span> <span class="main">=</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="var">?lJ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="var">?lJ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> line_through_K2_intersect_S_again <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">q</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">q</span> <span class="free">J</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_not_equal<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="var">?lJ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="var">?lJ</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_unique
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lJ</span> <span class="main">=</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">q</span> <span class="free">l</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?qJ</span> <span class="var">?lJ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?lJ</span> <span class="main">=</span> <span class="free">l</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?qJ</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qJ</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_K2_isometry_def<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">q</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?qJ</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> line_S_two_intersections_only
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qJ</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∨</span> <span class="var">?qJ</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qJ</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qJ</span> <span class="main">≠</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?qJ</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∨</span> <span class="var">?qJ</span> <span class="main">=</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qJ</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pJ</span> <span class="main">=</span> <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qJ</span> <span class="main">=</span> <span class="var">?pJ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> apply_cltn2_injective <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="skolem">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">q</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pJ</span> <span class="main">=</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?aJ</span> <span class="main">=</span> <span class="free">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cltn2_three_point_line <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="free">J</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bJ</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> K2_isometry_endpoint_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>endpoint_in_S <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">J</span>
  <span class="main">=</span> endpoint_in_S <span class="main">(</span>apply_cltn2 <span class="free">a</span> <span class="free">J</span><span class="main">)</span> <span class="main">(</span>apply_cltn2 <span class="free">b</span> <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pJ</span> <span class="main">=</span> endpoint_in_S <span class="var">?aJ</span> <span class="var">?bJ</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="free">a</span> <span class="free">b</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_injective <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aJ</span> <span class="main">≠</span> <span class="var">?bJ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> is_K2_isometry_hyp2_S
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aJ</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bJ</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ca</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?p</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> endpoint_in_S<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pJ</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_K2_isometry_def<span class="main">)</span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?caJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?aJ</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cbJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?bJ</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cpJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?pJ</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> statement_63
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?caJ</span> <span class="var">?cbJ</span> <span class="var">?cpJ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?aJ</span> <span class="main">≠</span> <span class="var">?bJ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?aJ</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?bJ</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pJ</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pJ</span> <span class="main">=</span> endpoint_in_S <span class="var">?aJ</span> <span class="var">?bJ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> endpoint_in_S_unique<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> between_endpoint_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">b</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">c</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cc</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> endpoint_in_S <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="var">?q</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> hyp2_S_cart2_inj
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cb</span> <span class="main">≠</span> <span class="var">?cc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?q</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cb</span> <span class="var">?cc</span> <span class="var">?cq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> endpoint_in_S<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cb</span> <span class="main">≠</span> <span class="var">?cc</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cc</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cb</span> <span class="var">?cc</span> <span class="var">?cq</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_euclid.th3_7_2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?q</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">=</span> <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> endpoint_in_S_unique<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hyp2_extend_segment_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="free">c</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">b</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="free">c</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">b</span> <span class="free">d</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2.A3_reversed<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="free">c</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">b</span> <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="free">c</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">b</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2.A3'<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="free">a</span> <span class="main">≠</span> Rep_hyp2 <span class="free">b</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="free">b</span> <span class="main">≠</span> Rep_hyp2 <span class="free">c</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pb</span> <span class="main">≠</span> <span class="var">?pc</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="free">b</span> <span class="main">≠</span> Rep_hyp2 <span class="free">d</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pb</span> <span class="main">≠</span> <span class="var">?pd</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2_inject<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pa</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pb</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pc</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pd</span> <span class="main">∈</span> hyp2"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Rep_hyp2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="var">?pb</span> <span class="var">?pc</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ca</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?pa</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?pb</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?pc</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?pd</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?pp</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pb</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pc</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pp</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cb</span> <span class="var">?cc</span> <span class="var">?cp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="free">c</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">b</span> <span class="free">d</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="free">b</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="free">c</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_hyp2_C_def<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹hyp2_cltn2 <span class="free">b</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹hyp2_cltn2 <span class="free">c</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">d</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="main">(</span>hyp2_cltn2 <span class="free">b</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">=</span> <span class="var">?pb</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="main">(</span>hyp2_cltn2 <span class="free">c</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">=</span> <span class="var">?pd</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?pb</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?pb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?pc</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?pd</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2_cltn2<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">d</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cd</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> real_hyp2_B_def <span class="keyword2"><span class="keyword">and</span></span> hyp2_rep_def <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pb</span> <span class="main">≠</span> <span class="var">?pc</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pb</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pc</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?pp</span> <span class="skolem">J</span>
    <span class="main">=</span> endpoint_in_S <span class="main">(</span>apply_cltn2 <span class="var">?pb</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">(</span>apply_cltn2 <span class="var">?pc</span> <span class="skolem">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> K2_isometry_endpoint_in_S<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="var">?pb</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?pb</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="var">?pc</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?pd</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> endpoint_in_S <span class="var">?pb</span> <span class="var">?pd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pb</span> <span class="main">≠</span> <span class="var">?pd</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pb</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pd</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cd</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> endpoint_in_S <span class="var">?pa</span> <span class="var">?pb</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> between_endpoint_in_S<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pb</span> <span class="main">≠</span> <span class="var">?pc</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pb</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pc</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cc</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> endpoint_in_S <span class="var">?pb</span> <span class="var">?pc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> between_endpoint_in_S<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?pp</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?pp</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pb</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pc</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pp</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="var">?pb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="var">?pc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="var">?pp</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_z_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cb</span> <span class="var">?cc</span> <span class="var">?cp</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> euclid_B_cart2_common_line <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?pb</span></span></span> <span class="var"><span class="quoted"><span class="var">?pc</span></span></span> <span class="var"><span class="quoted"><span class="var">?pp</span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pb</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pp</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pc</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pb</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pp</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="var">?pb</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?pb</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="var">?pp</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?pp</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?pc</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?pc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2_S_points_fix_line<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="var">?pc</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?pd</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pc</span> <span class="main">=</span> <span class="var">?pd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Rep_hyp2_inject <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> line_S_match_intersections<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> S"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">q</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">}</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">r</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">s</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_set_Col_def<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="free">s</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∨</span> <span class="free">q</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_S_two_intersections_only<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">q</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∨</span> <span class="free">q</span> <span class="main">=</span> <span class="free">s</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">q</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">=</span> <span class="free">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∨</span> <span class="free">q</span> <span class="main">=</span> <span class="free">s</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> <span class="free">s</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">q</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">are_endpoints_in_S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>proj2<span class="main">,</span> proj2<span class="main">,</span> proj2<span class="main">,</span> proj2<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">are_endpoints_in_S</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>
  <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∈</span> S <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∈</span> S <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> hyp2 <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∈</span> hyp2 <span class="main">∧</span> proj2_set_Col <span class="main">{</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> are_endpoints_in_S'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">=</span> endpoint_in_S <span class="free">a</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> endpoint_in_S <span class="free">b</span> <span class="free">a</span><span class="main">)</span>
  <span class="main">∨</span> <span class="main">(</span><span class="free">q</span> <span class="main">=</span> endpoint_in_S <span class="free">a</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> endpoint_in_S <span class="free">b</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> <span class="var">?s</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">q</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> <span class="var">?s</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">≠</span> <span class="var">?s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S_swap<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_set_Col_def<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="skolem">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="skolem">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?r</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?s</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S_incident<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="skolem">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="skolem">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="var">?r</span><span class="main">,</span><span class="var">?s</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_set_Col_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">l</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r</span> <span class="main">≠</span> <span class="var">?s</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?s</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> <span class="var">?s</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">q</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> <span class="var">?s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> line_S_match_intersections<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> are_endpoints_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">=</span> endpoint_in_S <span class="free">a</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> endpoint_in_S <span class="free">b</span> <span class="free">a</span><span class="main">)</span>
  <span class="main">∨</span> <span class="main">(</span><span class="free">q</span> <span class="main">=</span> endpoint_in_S <span class="free">a</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> endpoint_in_S <span class="free">b</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> are_endpoints_in_S_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> are_endpoints_in_S'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> S_intersections_endpoints_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">a</span> <span class="main">≠</span> proj2_abs <span class="free">b</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>S_intersection1 <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> endpoint_in_S <span class="var">?pa</span> <span class="var">?pb</span>
      <span class="main">∧</span> S_intersection2 <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> endpoint_in_S <span class="var">?pb</span> <span class="var">?pa</span><span class="main">)</span>
    <span class="main">∨</span> <span class="main">(</span>S_intersection2 <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> endpoint_in_S <span class="var">?pa</span> <span class="var">?pb</span>
      <span class="main">∧</span> S_intersection1 <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> endpoint_in_S <span class="var">?pb</span> <span class="var">?pa</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?pp</span> <span class="main">=</span> <span class="var">?pr</span> <span class="main">∧</span> <span class="var">?pq</span> <span class="main">=</span> <span class="var">?ps</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?pq</span> <span class="main">=</span> <span class="var">?pr</span> <span class="main">∧</span> <span class="var">?pp</span> <span class="main">=</span> <span class="var">?ps</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pp</span> <span class="main">≠</span> <span class="var">?pq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_intersections_distinct<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pp</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pq</span> <span class="main">∈</span> S"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_intersections_in_S<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_line_through <span class="var">?pa</span> <span class="var">?pb</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pa</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pb</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_line_through_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pp</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pq</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> S_intersections_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pa</span> <span class="var">?l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pb</span> <span class="var">?l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="var">?pp</span><span class="main">,</span><span class="var">?pq</span><span class="main">,</span><span class="var">?pa</span><span class="main">,</span><span class="var">?pb</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_set_Col_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pp</span> <span class="main">≠</span> <span class="var">?pq</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pp</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pq</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">∈</span> hyp2›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pb</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?pp</span> <span class="main">=</span> <span class="var">?pr</span> <span class="main">∧</span> <span class="var">?pq</span> <span class="main">=</span> <span class="var">?ps</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?pq</span> <span class="main">=</span> <span class="var">?pr</span> <span class="main">∧</span> <span class="var">?pp</span> <span class="main">=</span> <span class="var">?ps</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> are_endpoints_in_S'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> between_endpoints_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span>
  <span class="main">(</span>cart2_pt <span class="main">(</span>endpoint_in_S <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="main">(</span>endpoint_in_S <span class="free">b</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?ca</span> <span class="var">?cq</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cb</span> <span class="main">≠</span> <span class="var">?ca</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_cart2_inj<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cb</span> <span class="var">?ca</span> <span class="var">?cq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cb</span> <span class="var">?ca</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_euclid.th3_2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cb</span> <span class="main">≠</span> <span class="var">?ca</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cb</span> <span class="var">?ca</span> <span class="var">?cq</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?ca</span> <span class="var">?cq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_euclid.th3_7_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> S_hyp2_S_cart2_append1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="main">1</span>
  <span class="main">∧</span> cart2_append1 <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">q</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_z_non_zero<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">q</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?ca</span> <span class="var">?cq</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_incident_in_middle<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_not_equal<span class="main">)</span>

  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">q</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?ca</span> <span class="var">?cq</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="main">1</span>
    <span class="main">∧</span> cart2_append1 <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">q</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> cart2_append1 <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cart2_append1_between_strict<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> are_endpoints_in_S_swap_34<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">b</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">b</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> are_endpoints_in_S_def<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> proj2_set_Col_endpoints_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span>endpoint_in_S <span class="free">a</span> <span class="free">b</span><span class="main">,</span> endpoint_in_S <span class="free">b</span> <span class="free">a</span><span class="main">,</span> <span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="var">?p</span><span class="main">,</span><span class="var">?q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_line_through <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_line_through_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?p</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?q</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S_incident<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="var">?l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="var">?l</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="var">?p</span><span class="main">,</span><span class="var">?q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_set_Col_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> endpoints_in_S_are_endpoints_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="main">(</span>endpoint_in_S <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>endpoint_in_S <span class="free">b</span> <span class="free">a</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="var">?p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S_swap<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="var">?p</span><span class="main">,</span><span class="var">?q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_set_Col_endpoints_in_S<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?p</span> <span class="main">≠</span> <span class="var">?q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="var">?p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> are_endpoints_in_S_def<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> endpoint_in_S_S_hyp2_distinct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="main">(</span>endpoint_in_S <span class="free">p</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S<span class="main">)</span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="main">(</span>endpoint_in_S <span class="free">p</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cart2_pt <span class="free">p</span> <span class="main">=</span> cart2_pt <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_euclid.A6'<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2 <span class="main">∪</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_cart2_inj<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">a</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> endpoint_in_S_S_strict_hyp2_distinct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2_S_not_equal <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S_S_hyp2_distinct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_and_opposite_are_endpoints_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="main">(</span>endpoint_in_S <span class="free">p</span> <span class="free">b</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> endpoint_in_S_S_strict_hyp2_distinct <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2_S_not_equal <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?q</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S_incident<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="var">?q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_set_Col_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="var">?q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> are_endpoints_in_S_def<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_hyp2_B_hyp2_cltn2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="main">(</span>hyp2_cltn2 <span class="free">a</span> <span class="free">J</span><span class="main">)</span> <span class="main">(</span>hyp2_cltn2 <span class="free">b</span> <span class="free">J</span><span class="main">)</span> <span class="main">(</span>hyp2_cltn2 <span class="free">c</span> <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="var">?aJ</span> <span class="var">?bJ</span> <span class="var">?cJ</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>hyp2_rep <span class="free">a</span><span class="main">)</span> <span class="main">(</span>hyp2_rep <span class="free">b</span><span class="main">)</span> <span class="main">(</span>hyp2_rep <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_hyp2_B_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="main">(</span>apply_cltn2 <span class="main">(</span>Rep_hyp2 <span class="free">a</span><span class="main">)</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>cart2_pt <span class="main">(</span>apply_cltn2 <span class="main">(</span>Rep_hyp2 <span class="free">b</span><span class="main">)</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>cart2_pt <span class="main">(</span>apply_cltn2 <span class="main">(</span>Rep_hyp2 <span class="free">c</span><span class="main">)</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> hyp2_rep_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 statement_63<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>Rep_hyp2 <span class="free">a</span><span class="main">)</span> <span class="free">J</span> <span class="main">∈</span> hyp2"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>Rep_hyp2 <span class="free">b</span><span class="main">)</span> <span class="free">J</span> <span class="main">∈</span> hyp2"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="main">(</span>Rep_hyp2 <span class="free">c</span><span class="main">)</span> <span class="free">J</span> <span class="main">∈</span> hyp2"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> apply_cltn2_Rep_hyp2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="main">(</span>hyp2_cltn2 <span class="free">a</span> <span class="free">J</span><span class="main">)</span> <span class="main">(</span>hyp2_cltn2 <span class="free">b</span> <span class="free">J</span><span class="main">)</span> <span class="main">(</span>hyp2_cltn2 <span class="free">c</span> <span class="free">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> hyp2_cltn2_def <span class="keyword2"><span class="keyword">and</span></span> real_hyp2_B_def <span class="keyword2"><span class="keyword">and</span></span> hyp2_rep_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_hyp2_inverse<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_hyp2_C_hyp2_cltn2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="main">(</span>hyp2_cltn2 <span class="free">a</span> <span class="free">J</span><span class="main">)</span> <span class="main">(</span>hyp2_cltn2 <span class="free">b</span> <span class="free">J</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="var">?aJ</span> <span class="var">?bJ</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_hyp2_C_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">J</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Perpendicularity›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">M_perp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2_line <span class="main">⇒</span> proj2_line <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">M_perp</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≡</span> proj2_incident <span class="main">(</span>pole <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> M_perp_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"M_perp <span class="free">l</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"M_perp <span class="free">m</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹M_perp <span class="free">l</span> <span class="free">m</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>pole <span class="free">l</span><span class="main">)</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> M_perp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>pole <span class="free">m</span><span class="main">)</span> <span class="main">(</span>polar <span class="main">(</span>pole <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> incident_pole_polar<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>pole <span class="free">m</span><span class="main">)</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> polar_pole<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"M_perp <span class="free">m</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> M_perp_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> M_perp_to_compass<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"M_perp <span class="free">l</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J</span><span class="main">.</span> is_K2_isometry <span class="bound">J</span>
  <span class="main">∧</span> apply_cltn2_line equator <span class="bound">J</span> <span class="main">=</span> <span class="free">l</span> <span class="main">∧</span> apply_cltn2_line meridian <span class="bound">J</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> K2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> line_through_K2_intersect_S_twice <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> S"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">p</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">q</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">r</span> <span class="main">∉</span> <span class="main">{</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">}</span> <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">p</span> <span class="free">m</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> K2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">m</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> line_through_K2_intersect_S_again <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">r</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∉</span> <span class="main">{</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">≠</span> <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">r</span> <span class="free">m</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">q</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">q</span> <span class="free">l</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">p</span> <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">q</span> <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_unique <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹M_perp <span class="free">l</span> <span class="free">m</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"M_perp <span class="free">l</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>pole <span class="free">l</span><span class="main">)</span> <span class="free">l</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?s</span> <span class="free">l</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> M_perp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?s</span> <span class="main">(</span>polar <span class="var">?s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> polar_pole<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> incident_own_polar_in_S<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">q</span> <span class="free">l</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> point_in_S_polar_is_tangent <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="var">?s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="var">?s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> polar_pole<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">r</span> <span class="free">m</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">r</span> <span class="main">∉</span> <span class="main">{</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">}</span> <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_incident <span class="skolem">p</span> <span class="free">m</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> K2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">m</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> line_through_K2_intersect_S_again <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">r</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> proj2_incident <span class="skolem">p</span> <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">r</span> <span class="free">m</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">≠</span> <span class="skolem">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">r</span> <span class="free">m</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> S <span class="main">∧</span> <span class="bound">r</span> <span class="main">∉</span> <span class="main">{</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">}</span> <span class="main">∧</span> proj2_incident <span class="bound">r</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∉</span> <span class="main">{</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">r</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∉</span> <span class="main">{</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">}</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> statement65_special_case <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 east <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 west <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 north <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 far_north <span class="skolem">J</span> <span class="main">=</span> proj2_intersection <span class="main">(</span>polar <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>polar <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 east <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 west <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">q</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">q</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 east <span class="skolem">J</span><span class="main">)</span> <span class="free">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 west <span class="skolem">J</span><span class="main">)</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> east_west_distinct <span class="keyword2"><span class="keyword">and</span></span> east_west_on_equator
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line equator <span class="skolem">J</span> <span class="main">=</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> apply_cltn2_line_unique<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 north <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">r</span> <span class="free">m</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 north <span class="skolem">J</span><span class="main">)</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> polar_inj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"polar <span class="skolem">p</span> <span class="main">≠</span> polar <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">q</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>pole <span class="free">l</span><span class="main">)</span> <span class="main">(</span>polar <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>pole <span class="free">l</span><span class="main">)</span> <span class="main">(</span>polar <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> incident_pole_polar<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹polar <span class="skolem">p</span> <span class="main">≠</span> polar <span class="skolem">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pole <span class="free">l</span> <span class="main">=</span> proj2_intersection <span class="main">(</span>polar <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>polar <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_intersection_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 far_north <span class="skolem">J</span> <span class="main">=</span> proj2_intersection <span class="main">(</span>polar <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>polar <span class="skolem">q</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 far_north <span class="skolem">J</span> <span class="main">=</span> pole <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹M_perp <span class="free">l</span> <span class="free">m</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 far_north <span class="skolem">J</span><span class="main">)</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> M_perp_def<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> north_far_north_distinct <span class="keyword2"><span class="keyword">and</span></span> north_south_far_north_on_meridian
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span>apply_cltn2 north <span class="skolem">J</span><span class="main">)</span> <span class="free">m</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line meridian <span class="skolem">J</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apply_cltn2_line_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2_line equator <span class="skolem">J</span> <span class="main">=</span> <span class="free">l</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J</span><span class="main">.</span> is_K2_isometry <span class="bound">J</span>
    <span class="main">∧</span> apply_cltn2_line equator <span class="bound">J</span> <span class="main">=</span> <span class="free">l</span> <span class="main">∧</span> apply_cltn2_line meridian <span class="bound">J</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">J</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">drop_perp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> proj2_line <span class="main">⇒</span> proj2_line"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">drop_perp</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≡</span> proj2_line_through <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>pole <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> drop_perp_incident<span class="main">:</span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="main">(</span>drop_perp <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> drop_perp_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> proj2_line_through_incident<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> drop_perp_perp<span class="main">:</span> <span class="quoted"><span class="quoted">"M_perp <span class="free">l</span> <span class="main">(</span>drop_perp <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> drop_perp_def M_perp_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> proj2_line_through_incident<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">perp_foot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> proj2_line <span class="main">⇒</span> proj2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">perp_foot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≡</span> proj2_intersection <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">(</span>drop_perp <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> perp_foot_incident<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>perp_foot <span class="free">p</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>perp_foot <span class="free">p</span> <span class="free">l</span><span class="main">)</span> <span class="main">(</span>drop_perp <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> perp_foot_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> proj2_intersection_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> M_perp_hyp2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"M_perp <span class="free">l</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">c</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">c</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> hyp2"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹M_perp <span class="free">l</span> <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> M_perp_to_compass <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line equator <span class="skolem">J</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line meridian <span class="skolem">J</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> K2_centre_in_K2
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 K2_centre <span class="skolem">J</span> <span class="main">∈</span> hyp2"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> statement60_one_way<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">c</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2_line equator <span class="skolem">J</span> <span class="main">=</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">c</span> <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2_line meridian <span class="skolem">J</span> <span class="main">=</span> <span class="free">m</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">c</span> <span class="main">(</span>apply_cltn2_line equator <span class="skolem">J</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">c</span> <span class="main">(</span>apply_cltn2_line meridian <span class="skolem">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> equator_meridian_distinct <span class="keyword2"><span class="keyword">and</span></span> K2_centre_on_equator_meridian
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 K2_centre <span class="skolem">J</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> apply_cltn2_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 K2_centre <span class="skolem">J</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> perp_foot_hyp2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"perp_foot <span class="free">b</span> <span class="free">l</span> <span class="main">∈</span> hyp2"</span></span>
  <span class="keyword1"><span class="command">using</span></span> drop_perp_perp <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> drop_perp_incident <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> perp_foot_incident <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">l</span></span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M_perp_hyp2<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">perp_up</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> proj2_line <span class="main">⇒</span> proj2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">perp_up</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span>
  <span class="main">≡</span> <span class="keyword1">if</span> proj2_incident <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">then</span> <span class="main">ϵ</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">p</span> <span class="main">(</span>drop_perp <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>
  <span class="keyword1">else</span> endpoint_in_S <span class="main">(</span>perp_foot <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> perp_up_degenerate_in_S_incident<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"perp_up <span class="free">a</span> <span class="free">l</span> <span class="main">∈</span> S"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> S"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>perp_up <span class="free">a</span> <span class="free">l</span><span class="main">)</span> <span class="main">(</span>drop_perp <span class="free">a</span> <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="main">(</span><span class="main">ϵ</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">p</span> <span class="main">(</span>drop_perp <span class="free">a</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> perp_up_def<span class="main">)</span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> drop_perp_incident <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">p</span> <span class="main">(</span>drop_perp <span class="free">a</span> <span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> line_through_K2_intersect_S<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="var">?p</span> <span class="main">(</span>drop_perp <span class="free">a</span> <span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?p</span> <span class="main">=</span> <span class="main">(</span><span class="main">ϵ</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> S <span class="main">∧</span> proj2_incident <span class="bound">p</span> <span class="main">(</span>drop_perp <span class="free">a</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?p</span> <span class="main">(</span>drop_perp <span class="free">a</span> <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> perp_up_non_degenerate_in_S_at_end<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"perp_up <span class="free">a</span> <span class="free">l</span> <span class="main">∈</span> S"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="main">(</span>perp_foot <span class="free">a</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="main">(</span>perp_up <span class="free">a</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perp_up <span class="free">a</span> <span class="free">l</span> <span class="main">=</span> endpoint_in_S <span class="main">(</span>perp_foot <span class="free">a</span> <span class="free">l</span><span class="main">)</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> perp_up_def<span class="main">)</span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perp_foot <span class="free">a</span> <span class="free">l</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perp_foot_hyp2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"perp_up <span class="free">a</span> <span class="free">l</span> <span class="main">∈</span> S"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="main">(</span>perp_foot <span class="free">a</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="main">(</span>perp_up <span class="free">a</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹perp_up <span class="free">a</span> <span class="free">l</span> <span class="main">=</span> endpoint_in_S <span class="main">(</span>perp_foot <span class="free">a</span> <span class="free">l</span><span class="main">)</span> <span class="free">a</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> perp_up_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"perp_up <span class="free">a</span> <span class="free">l</span> <span class="main">∈</span> S"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"perp_up <span class="free">a</span> <span class="free">l</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perp_up_degenerate_in_S_incident<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"perp_up <span class="free">a</span> <span class="free">l</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perp_up_non_degenerate_in_S_at_end<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> perp_up_incident<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>perp_up <span class="free">a</span> <span class="free">l</span><span class="main">)</span> <span class="main">(</span>drop_perp <span class="free">a</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?p</span> <span class="var">?m</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?p</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perp_up_degenerate_in_S_incident<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> endpoint_in_S <span class="main">(</span>perp_foot <span class="free">a</span> <span class="free">l</span><span class="main">)</span> <span class="free">a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> endpoint_in_S <span class="var">?c</span> <span class="free">a</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> perp_up_def<span class="main">)</span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> perp_foot_incident <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">l</span></span></span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perp_foot_hyp2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?c</span> <span class="main">≠</span> <span class="free">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> drop_perp_incident <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> perp_foot_incident <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">l</span></span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?p</span> <span class="var">?m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> <span class="quoted"><span class="quoted">‹<span class="var">?p</span> <span class="main">=</span> endpoint_in_S <span class="var">?c</span> <span class="free">a</span>›</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S_incident<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> drop_perp_same_line_pole_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"drop_perp <span class="free">p</span> <span class="free">l</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pole <span class="free">l</span> <span class="main">∈</span> S"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹drop_perp <span class="free">p</span> <span class="free">l</span> <span class="main">=</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> proj2_line_through <span class="free">p</span> <span class="main">(</span>pole <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> drop_perp_def<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> proj2_line_through_incident <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"pole <span class="free"><span class="free">l</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>pole <span class="free">l</span><span class="main">)</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>pole <span class="free">l</span><span class="main">)</span> <span class="main">(</span>polar <span class="main">(</span>pole <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> polar_pole<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"pole <span class="free">l</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> incident_own_polar_in_S<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hyp2_drop_perp_not_same_line<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"drop_perp <span class="free">a</span> <span class="free">l</span> <span class="main">≠</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"drop_perp <span class="free">a</span> <span class="free">l</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pole <span class="free">l</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> drop_perp_same_line_pole_in_S<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_incident <span class="free">a</span> <span class="main">(</span>polar <span class="main">(</span>pole <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tangent_not_through_K2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹drop_perp <span class="free">a</span> <span class="free">l</span> <span class="main">=</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_incident <span class="free">a</span> <span class="main">(</span>drop_perp <span class="free">a</span> <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> polar_pole<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> drop_perp_incident <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hyp2_incident_perp_foot_same_point<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"perp_foot <span class="free">a</span> <span class="free">l</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"drop_perp <span class="free">a</span> <span class="free">l</span> <span class="main">≠</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2_drop_perp_not_same_line<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> perp_foot_incident <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">l</span></span></span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> drop_perp_incident <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_unique
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"perp_foot <span class="free">a</span> <span class="free">l</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> perp_up_at_end<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="main">(</span>perp_foot <span class="free">a</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="main">(</span>perp_up <span class="free">a</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perp_foot <span class="free">a</span> <span class="free">l</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2_incident_perp_foot_same_point<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="main">(</span>perp_foot <span class="free">a</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="main">(</span>perp_up <span class="free">a</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_euclid.th3_1 real_euclid.th3_2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="main">(</span>perp_foot <span class="free">a</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="main">(</span>perp_up <span class="free">a</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perp_up_non_degenerate_in_S_at_end<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">perp_down</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> proj2_line <span class="main">⇒</span> proj2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">perp_down</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≡</span> endpoint_in_S <span class="main">(</span>perp_up <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> perp_down_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"perp_down <span class="free">a</span> <span class="free">l</span> <span class="main">∈</span> S"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perp_up <span class="free">a</span> <span class="free">l</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perp_up_in_S<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"perp_down <span class="free">a</span> <span class="free">l</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> perp_down_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> perp_down_incident<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>perp_down <span class="free">a</span> <span class="free">l</span><span class="main">)</span> <span class="main">(</span>drop_perp <span class="free">a</span> <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perp_up <span class="free">a</span> <span class="free">l</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perp_up_in_S<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perp_up <span class="free">a</span> <span class="free">l</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2_S_not_equal <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>perp_up <span class="free">a</span> <span class="free">l</span><span class="main">)</span> <span class="main">(</span>drop_perp <span class="free">a</span> <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perp_up_incident<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹perp_up <span class="free">a</span> <span class="free">l</span> <span class="main">≠</span> <span class="free">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹perp_up <span class="free">a</span> <span class="free">l</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> drop_perp_incident <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>perp_down <span class="free">a</span> <span class="free">l</span><span class="main">)</span> <span class="main">(</span>drop_perp <span class="free">a</span> <span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> perp_down_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S_incident<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> perp_up_down_distinct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"perp_up <span class="free">a</span> <span class="free">l</span> <span class="main">≠</span> perp_down <span class="free">a</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perp_up <span class="free">a</span> <span class="free">l</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perp_up_in_S<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"perp_up <span class="free">a</span> <span class="free">l</span> <span class="main">≠</span> perp_down <span class="free">a</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> perp_down_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S_S_strict_hyp2_distinct <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> perp_up_down_foot_are_endpoints_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="main">(</span>perp_up <span class="free">a</span> <span class="free">l</span><span class="main">)</span> <span class="main">(</span>perp_down <span class="free">a</span> <span class="free">l</span><span class="main">)</span> <span class="main">(</span>perp_foot <span class="free">a</span> <span class="free">l</span><span class="main">)</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perp_foot <span class="free">a</span> <span class="free">l</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perp_foot_hyp2<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perp_up <span class="free">a</span> <span class="free">l</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perp_up_in_S<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>perp_up <span class="free">a</span> <span class="free">l</span><span class="main">)</span> <span class="main">(</span>drop_perp <span class="free">a</span> <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perp_up_incident<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹perp_foot <span class="free">a</span> <span class="free">l</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹perp_up <span class="free">a</span> <span class="free">l</span> <span class="main">∈</span> S›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> perp_foot_incident<span class="main">(</span>2<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> drop_perp_incident <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="main">(</span>perp_up <span class="free">a</span> <span class="free">l</span><span class="main">)</span> <span class="main">(</span>perp_down <span class="free">a</span> <span class="free">l</span><span class="main">)</span> <span class="main">(</span>perp_foot <span class="free">a</span> <span class="free">l</span><span class="main">)</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> perp_down_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> end_and_opposite_are_endpoints_in_S<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> perp_foot_opposite_endpoint_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"endpoint_in_S <span class="main">(</span>endpoint_in_S <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>perp_foot <span class="free">c</span> <span class="main">(</span>proj2_line_through <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>
  <span class="main">=</span> endpoint_in_S <span class="free">b</span> <span class="free">a</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="var">?p</span> <span class="var">?d</span> <span class="main">=</span> endpoint_in_S <span class="free">b</span> <span class="free">a</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="var">?p</span> <span class="var">?d</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_line_through <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_line_through_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?p</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S_incident<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="var">?l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perp_foot_hyp2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?p</span> <span class="main">∈</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">≠</span> <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> endpoint_in_S_S_strict_hyp2_distinct<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?d</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?d</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?p</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="var">?d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2_S_not_equal <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?d</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?p</span> <span class="var">?l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> perp_foot_incident<span class="main">(</span>1<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?q</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S_incident<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?q</span> <span class="main">∈</span> S›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="var">?l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="var">?l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">∨</span> <span class="var">?q</span> <span class="main">=</span> endpoint_in_S <span class="free">b</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoints_in_S_incident_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?q</span> <span class="main">≠</span> <span class="var">?p</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">=</span> endpoint_in_S <span class="free">b</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> endpoints_in_S_perp_foot_are_endpoints_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S
  <span class="main">(</span>endpoint_in_S <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>endpoint_in_S <span class="free">b</span> <span class="free">a</span><span class="main">)</span> <span class="free">a</span> <span class="main">(</span>perp_foot <span class="free">c</span> <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">d</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> endpoint_in_S <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> endpoint_in_S <span class="free">b</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> perp_foot <span class="free">c</span> <span class="free">l</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> p_def q_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S_swap<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> p_def q_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> d_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> perp_foot_hyp2<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">p</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">q</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> p_def q_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S_incident<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> perp_foot_incident<span class="main">(</span>1<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="skolem">d</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> d_def proj2_set_Col_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="skolem">p</span> <span class="skolem">q</span> <span class="free">a</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> are_endpoints_in_S_def<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">right_angle</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> proj2 <span class="main">⇒</span> proj2 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">right_angle</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>
  <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∈</span> S <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∈</span> S <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> hyp2
  <span class="main">∧</span> M_perp <span class="main">(</span>proj2_line_through <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span>proj2_line_through <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> perp_foot_up_right_angle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"right_angle <span class="free">p</span> <span class="main">(</span>perp_foot <span class="free">a</span> <span class="free">l</span><span class="main">)</span> <span class="main">(</span>perp_up <span class="free">a</span> <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> perp_foot <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> perp_up <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> q_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> perp_up_in_S<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> c_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> perp_foot_hyp2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_not_equal<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> perp_foot_incident<span class="main">(</span>1<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> proj2_line_through <span class="free">p</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> c_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> proj2_line_through_unique<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> drop_perp <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">q</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> q_def m_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> perp_up_incident<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> perp_foot_incident<span class="main">(</span>2<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> proj2_line_through <span class="skolem">c</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> c_def m_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> proj2_line_through_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> drop_perp_perp <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">=</span> proj2_line_through <span class="free">p</span> <span class="skolem">c</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"right_angle <span class="free">p</span> <span class="main">(</span>perp_foot <span class="free">a</span> <span class="free">l</span><span class="main">)</span> <span class="main">(</span>perp_up <span class="free">a</span> <span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> right_angle_def q_def c_def m_def<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> M_perp_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"M_perp <span class="free">l</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"M_perp <span class="free">l</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pole <span class="free">l</span> <span class="main">∉</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> line_through_hyp2_pole_not_in_hyp2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> pole <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹M_perp <span class="free">l</span> <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">n</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹M_perp <span class="free">l</span> <span class="free">n</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_unique
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> M_perp_def<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> perp_foot_eq_implies_drop_perp_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"perp_foot <span class="free">b</span> <span class="free">l</span> <span class="main">=</span> perp_foot <span class="free">c</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"drop_perp <span class="free">b</span> <span class="free">l</span> <span class="main">=</span> drop_perp <span class="free">c</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perp_foot <span class="free">b</span> <span class="free">l</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perp_foot_hyp2<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹perp_foot <span class="free">b</span> <span class="free">l</span> <span class="main">=</span> perp_foot <span class="free">c</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>perp_foot <span class="free">b</span> <span class="free">l</span><span class="main">)</span> <span class="main">(</span>drop_perp <span class="free">c</span> <span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perp_foot_incident<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹perp_foot <span class="free">b</span> <span class="free">l</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> perp_foot_incident<span class="main">(</span>2<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> drop_perp_perp <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"drop_perp <span class="free">b</span> <span class="free">l</span> <span class="main">=</span> drop_perp <span class="free">c</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_perp_unique<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> right_angle_to_compass<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"right_angle <span class="free">p</span> <span class="free">a</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J</span><span class="main">.</span> is_K2_isometry <span class="bound">J</span> <span class="main">∧</span> apply_cltn2 <span class="free">p</span> <span class="bound">J</span> <span class="main">=</span> east
  <span class="main">∧</span> apply_cltn2 <span class="free">a</span> <span class="bound">J</span> <span class="main">=</span> K2_centre <span class="main">∧</span> apply_cltn2 <span class="free">q</span> <span class="bound">J</span> <span class="main">=</span> north"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹right_angle <span class="free">p</span> <span class="free">a</span> <span class="free">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"M_perp <span class="main">(</span>proj2_line_through <span class="free">p</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span>proj2_line_through <span class="free">a</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"M_perp <span class="var">?l</span> <span class="var">?m</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> right_angle_def<span class="main">)</span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="var">?l</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="var">?m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="var">?m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_line_through_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹M_perp <span class="var">?l</span> <span class="var">?m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="var">?l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="var">?m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> M_perp_to_compass <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">J''i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">J''i</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line equator <span class="skolem">J''i</span> <span class="main">=</span> <span class="var">?l</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line meridian <span class="skolem">J''i</span> <span class="main">=</span> <span class="var">?m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?J''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_inverse <span class="skolem">J''i</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2_line equator <span class="skolem">J''i</span> <span class="main">=</span> <span class="var">?l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2_line meridian <span class="skolem">J''i</span> <span class="main">=</span> <span class="var">?m</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="var">?l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="var">?l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="var">?m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="var">?m</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="var">?J''</span><span class="main">)</span> equator"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">a</span> <span class="var">?J''</span><span class="main">)</span> equator"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="var">?J''</span><span class="main">)</span> meridian"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">a</span> <span class="var">?J''</span><span class="main">)</span> meridian"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apply_cltn2_incident <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">a</span> <span class="var">?J''</span><span class="main">)</span> equator›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">a</span> <span class="var">?J''</span><span class="main">)</span> meridian›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">a</span> <span class="var">?J''</span> <span class="main">=</span> K2_centre"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> on_equator_meridian_is_K2_centre<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J''i</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="var">?J''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cltn2_inverse_is_K2_isometry<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="var">?J''</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">q</span> <span class="var">?J''</span> <span class="main">∈</span> S"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_K2_isometry_def<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> east_west_distinct <span class="keyword2"><span class="keyword">and</span></span> north_south_distinct <span class="keyword2"><span class="keyword">and</span></span> compass_in_S
    <span class="keyword2"><span class="keyword">and</span></span> east_west_on_equator <span class="keyword2"><span class="keyword">and</span></span> north_south_far_north_on_meridian
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">p</span> <span class="var">?J''</span><span class="main">)</span> equator›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="var">?J''</span><span class="main">)</span> meridian›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="var">?J''</span> <span class="main">=</span> east <span class="main">∨</span> apply_cltn2 <span class="free">p</span> <span class="var">?J''</span> <span class="main">=</span> west"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">q</span> <span class="var">?J''</span> <span class="main">=</span> north <span class="main">∨</span> apply_cltn2 <span class="free">q</span> <span class="var">?J''</span> <span class="main">=</span> south"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_S_two_intersections_only<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J'</span><span class="main">.</span> is_K2_isometry <span class="bound">J'</span> <span class="main">∧</span> apply_cltn2 <span class="free">p</span> <span class="bound">J'</span> <span class="main">=</span> east
    <span class="main">∧</span> apply_cltn2 <span class="free">a</span> <span class="bound">J'</span> <span class="main">=</span> K2_centre
    <span class="main">∧</span> <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="bound">J'</span> <span class="main">=</span> north <span class="main">∨</span> apply_cltn2 <span class="free">q</span> <span class="bound">J'</span> <span class="main">=</span> south<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="var">?J''</span> <span class="main">=</span> east"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="var">?J''</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">a</span> <span class="var">?J''</span> <span class="main">=</span> K2_centre›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">q</span> <span class="var">?J''</span> <span class="main">=</span> north <span class="main">∨</span> apply_cltn2 <span class="free">q</span> <span class="var">?J''</span> <span class="main">=</span> south›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J'</span><span class="main">.</span> is_K2_isometry <span class="bound">J'</span> <span class="main">∧</span> apply_cltn2 <span class="free">p</span> <span class="bound">J'</span> <span class="main">=</span> east
      <span class="main">∧</span> apply_cltn2 <span class="free">a</span> <span class="bound">J'</span> <span class="main">=</span> K2_centre
      <span class="main">∧</span> <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="bound">J'</span> <span class="main">=</span> north <span class="main">∨</span> apply_cltn2 <span class="free">q</span> <span class="bound">J'</span> <span class="main">=</span> south<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?J''</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="var">?J''</span> <span class="main">≠</span> east"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">p</span> <span class="var">?J''</span> <span class="main">=</span> east <span class="main">∨</span> apply_cltn2 <span class="free">p</span> <span class="var">?J''</span> <span class="main">=</span> west›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="var">?J''</span> <span class="main">=</span> west"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?J'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_compose <span class="var">?J''</span> meridian_reflect"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="var">?J''</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> meridian_reflect_K2_isometry
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="var">?J'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cltn2_compose_is_K2_isometry<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">p</span> <span class="var">?J''</span> <span class="main">=</span> west›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">a</span> <span class="var">?J''</span> <span class="main">=</span> K2_centre›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">q</span> <span class="var">?J''</span> <span class="main">=</span> north <span class="main">∨</span> apply_cltn2 <span class="free">q</span> <span class="var">?J''</span> <span class="main">=</span> south›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> compass_reflect_compass
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="var">?J'</span> <span class="main">=</span> east"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">a</span> <span class="var">?J'</span> <span class="main">=</span> K2_centre"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">q</span> <span class="var">?J'</span> <span class="main">=</span> north <span class="main">∨</span> apply_cltn2 <span class="free">q</span> <span class="var">?J'</span> <span class="main">=</span> south"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2.act_act <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J'</span><span class="main">.</span> is_K2_isometry <span class="bound">J'</span> <span class="main">∧</span> apply_cltn2 <span class="free">p</span> <span class="bound">J'</span> <span class="main">=</span> east
      <span class="main">∧</span> apply_cltn2 <span class="free">a</span> <span class="bound">J'</span> <span class="main">=</span> K2_centre
      <span class="main">∧</span> <span class="main">(</span>apply_cltn2 <span class="free">q</span> <span class="bound">J'</span> <span class="main">=</span> north <span class="main">∨</span> apply_cltn2 <span class="free">q</span> <span class="bound">J'</span> <span class="main">=</span> south<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?J'</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">J'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">J'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="skolem">J'</span> <span class="main">=</span> east"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">a</span> <span class="skolem">J'</span> <span class="main">=</span> K2_centre"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">q</span> <span class="skolem">J'</span> <span class="main">=</span> north <span class="main">∨</span> apply_cltn2 <span class="free">q</span> <span class="skolem">J'</span> <span class="main">=</span> south"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J</span><span class="main">.</span> is_K2_isometry <span class="bound">J</span> <span class="main">∧</span> apply_cltn2 <span class="free">p</span> <span class="bound">J</span> <span class="main">=</span> east
    <span class="main">∧</span> apply_cltn2 <span class="free">a</span> <span class="bound">J</span> <span class="main">=</span> K2_centre <span class="main">∧</span> apply_cltn2 <span class="free">q</span> <span class="bound">J</span> <span class="main">=</span> north"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">q</span> <span class="skolem">J'</span> <span class="main">=</span> north"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">p</span> <span class="skolem">J'</span> <span class="main">=</span> east›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">a</span> <span class="skolem">J'</span> <span class="main">=</span> K2_centre›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J</span><span class="main">.</span> is_K2_isometry <span class="bound">J</span> <span class="main">∧</span> apply_cltn2 <span class="free">p</span> <span class="bound">J</span> <span class="main">=</span> east
      <span class="main">∧</span> apply_cltn2 <span class="free">a</span> <span class="bound">J</span> <span class="main">=</span> K2_centre <span class="main">∧</span> apply_cltn2 <span class="free">q</span> <span class="bound">J</span> <span class="main">=</span> north"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">J'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">q</span> <span class="skolem">J'</span> <span class="main">≠</span> north"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">q</span> <span class="skolem">J'</span> <span class="main">=</span> north <span class="main">∨</span> apply_cltn2 <span class="free">q</span> <span class="skolem">J'</span> <span class="main">=</span> south›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">q</span> <span class="skolem">J'</span> <span class="main">=</span> south"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?J</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_compose <span class="skolem">J'</span> equator_reflect"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> equator_reflect_K2_isometry
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="var">?J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cltn2_compose_is_K2_isometry<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">p</span> <span class="skolem">J'</span> <span class="main">=</span> east›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">a</span> <span class="skolem">J'</span> <span class="main">=</span> K2_centre›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">q</span> <span class="skolem">J'</span> <span class="main">=</span> south›</span></span> <span class="keyword2"><span class="keyword">and</span></span> compass_reflect_compass
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="var">?J</span> <span class="main">=</span> east"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">a</span> <span class="var">?J</span> <span class="main">=</span> K2_centre"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">q</span> <span class="var">?J</span> <span class="main">=</span> north"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2.act_act <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J</span><span class="main">.</span> is_K2_isometry <span class="bound">J</span> <span class="main">∧</span> apply_cltn2 <span class="free">p</span> <span class="bound">J</span> <span class="main">=</span> east
      <span class="main">∧</span> apply_cltn2 <span class="free">a</span> <span class="bound">J</span> <span class="main">=</span> K2_centre <span class="main">∧</span> apply_cltn2 <span class="free">q</span> <span class="bound">J</span> <span class="main">=</span> north"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?J</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> right_angle_to_right_angle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"right_angle <span class="free">p</span> <span class="free">a</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"right_angle <span class="free">r</span> <span class="free">b</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J</span><span class="main">.</span> is_K2_isometry <span class="bound">J</span>
  <span class="main">∧</span> apply_cltn2 <span class="free">p</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∧</span> apply_cltn2 <span class="free">a</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> apply_cltn2 <span class="free">q</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹right_angle <span class="free">p</span> <span class="free">a</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> right_angle_to_compass <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="skolem">H</span> <span class="main">=</span> east"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">a</span> <span class="skolem">H</span> <span class="main">=</span> K2_centre"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">q</span> <span class="skolem">H</span> <span class="main">=</span> north"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹right_angle <span class="free">r</span> <span class="free">b</span> <span class="free">s</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> right_angle_to_compass <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">K</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">K</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">r</span> <span class="skolem">K</span> <span class="main">=</span> east"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">b</span> <span class="skolem">K</span> <span class="main">=</span> K2_centre"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">s</span> <span class="skolem">K</span> <span class="main">=</span> north"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ki</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_inverse <span class="skolem">K</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?J</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_compose <span class="skolem">H</span> <span class="var">?Ki</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">K</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="var">?J</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2_inverse_is_K2_isometry cltn2_compose_is_K2_isometry<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">r</span> <span class="skolem">K</span> <span class="main">=</span> east›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">b</span> <span class="skolem">K</span> <span class="main">=</span> K2_centre›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">s</span> <span class="skolem">K</span> <span class="main">=</span> north›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 east <span class="var">?Ki</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 K2_centre <span class="var">?Ki</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 north <span class="var">?Ki</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2.act_inv_iff <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">p</span> <span class="skolem">H</span> <span class="main">=</span> east›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">a</span> <span class="skolem">H</span> <span class="main">=</span> K2_centre›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">q</span> <span class="skolem">H</span> <span class="main">=</span> north›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">p</span> <span class="var">?J</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">a</span> <span class="var">?J</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">q</span> <span class="var">?J</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cltn2.act_act <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="var">?J</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J</span><span class="main">.</span> is_K2_isometry <span class="bound">J</span>
    <span class="main">∧</span> apply_cltn2 <span class="free">p</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∧</span> apply_cltn2 <span class="free">a</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> apply_cltn2 <span class="free">q</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?J</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Functions of distance›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">exp_2dist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> proj2 <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">exp_2dist</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>
  <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>
  <span class="keyword1">then</span> <span class="main">1</span>
  <span class="keyword1">else</span> cross_ratio <span class="main">(</span>endpoint_in_S <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">(</span>endpoint_in_S <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cosh_dist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proj2 <span class="main">⇒</span> proj2 <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cosh_dist</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">(</span>sqrt <span class="main">(</span>exp_2dist <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>exp_2dist <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exp_2dist_formula<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pa</span> <span class="main">∈</span> hyp2"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pb</span> <span class="main">∈</span> hyp2"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exp_2dist <span class="main">(</span>proj2_abs <span class="free">a</span><span class="main">)</span> <span class="main">(</span>proj2_abs <span class="free">b</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> sqrt <span class="main">(</span>quarter_discrim <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>
      <span class="main">/</span> <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">-</span> sqrt <span class="main">(</span>quarter_discrim <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>
  <span class="main">∨</span> exp_2dist <span class="main">(</span>proj2_abs <span class="free">a</span><span class="main">)</span> <span class="main">(</span>proj2_abs <span class="free">b</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">-</span> sqrt <span class="main">(</span>quarter_discrim <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>
      <span class="main">/</span> <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> sqrt <span class="main">(</span>quarter_discrim <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e2d</span> <span class="main">=</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span>
    <span class="main">∨</span> <span class="var">?e2d</span> <span class="main">=</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pa</span> <span class="main">=</span> <span class="var">?pb</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e2d</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> exp_2dist_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">=</span> <span class="var">?pb</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"quarter_discrim <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> quarter_discrim_self_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?sqd</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="free">a</span> <span class="main">=</span> proj2_abs <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_abs_abs_mult
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> K2_abs <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aMb</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?e2d</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?sqd</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e2d</span> <span class="main">=</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span>
    <span class="main">∨</span> <span class="var">?e2d</span> <span class="main">=</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_line_through <span class="var">?pa</span> <span class="var">?pb</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pa</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pb</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_line_through_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>S_intersection1 <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="var">?l</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?Si1</span> <span class="var">?l</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="main">(</span>S_intersection2 <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="var">?l</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?Si2</span> <span class="var">?l</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> S_intersections_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pa</span> <span class="var">?l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pb</span> <span class="var">?l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="var">?pa</span><span class="main">,</span><span class="var">?pb</span><span class="main">,</span><span class="var">?Si1</span><span class="main">,</span><span class="var">?Si2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_set_Col_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="var">?pa</span><span class="main">,</span><span class="var">?pb</span><span class="main">,</span><span class="var">?Si2</span><span class="main">,</span><span class="var">?Si1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="var">?pa</span><span class="main">,</span><span class="var">?pb</span><span class="main">,</span><span class="var">?Si1</span><span class="main">,</span><span class="var">?Si2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Si1</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Si2</span> <span class="main">∈</span> S"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_intersections_in_S<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pb</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Si1</span> <span class="main">≠</span> <span class="var">?pa</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Si2</span> <span class="main">≠</span> <span class="var">?pa</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Si1</span> <span class="main">≠</span> <span class="var">?pb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Si2</span> <span class="main">≠</span> <span class="var">?pb</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_not_equal <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="var">?pa</span><span class="main">,</span><span class="var">?pb</span><span class="main">,</span><span class="var">?Si1</span><span class="main">,</span><span class="var">?Si2</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="var">?pa</span> <span class="var">?pb</span> <span class="var">?Si1</span> <span class="var">?Si2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="var">?pa</span> <span class="var">?pb</span> <span class="var">?Si2</span> <span class="var">?Si1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cross_ratio_correct_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="var">?pa</span><span class="main">,</span><span class="var">?pb</span><span class="main">,</span><span class="var">?Si2</span><span class="main">,</span><span class="var">?Si1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="var">?pa</span><span class="main">,</span><span class="var">?pb</span><span class="main">,</span><span class="var">?Si1</span><span class="main">,</span><span class="var">?Si2</span><span class="main">}</span>›</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Si1</span> <span class="main">≠</span> <span class="var">?Si2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_intersections_distinct<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="var">?pa</span> <span class="var">?pb</span> <span class="var">?Si1</span> <span class="var">?Si2</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="var">?pa</span> <span class="var">?pb</span> <span class="var">?Si2</span> <span class="var">?Si1</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?Si1</span> <span class="var">?Si2</span> <span class="var">?pa</span> <span class="var">?pb</span> <span class="main">=</span> cross_ratio <span class="var">?pa</span> <span class="var">?pb</span> <span class="var">?Si1</span> <span class="var">?Si2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?Si2</span> <span class="var">?Si1</span> <span class="var">?pa</span> <span class="var">?pb</span> <span class="main">=</span> cross_ratio <span class="var">?pa</span> <span class="var">?pb</span> <span class="var">?Si2</span> <span class="var">?Si1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cross_ratio_swap_13_24<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> K2_abs <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cross_ratio_abs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?pa</span> <span class="var">?pb</span> <span class="var">?Si1</span> <span class="var">?Si2</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">-</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> S_intersections_defs S_intersection_coeffs_defs<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> times_divide_times_eq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?pa</span> <span class="var">?pb</span> <span class="var">?Si1</span> <span class="var">?Si2</span> <span class="main">=</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cross_ratio <span class="var">?Si1</span> <span class="var">?Si2</span> <span class="var">?pa</span> <span class="var">?pb</span> <span class="main">=</span> cross_ratio <span class="var">?pa</span> <span class="var">?pb</span> <span class="var">?Si1</span> <span class="var">?Si2</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?Si1</span> <span class="var">?Si2</span> <span class="var">?pa</span> <span class="var">?pb</span> <span class="main">=</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cross_ratio <span class="var">?pa</span> <span class="var">?pb</span> <span class="var">?Si1</span> <span class="var">?Si2</span> <span class="main">=</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cross_ratio_swap_34 <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?pa</span></span></span> <span class="var"><span class="quoted"><span class="var">?pb</span></span></span> <span class="var"><span class="quoted"><span class="var">?Si2</span></span></span> <span class="var"><span class="quoted"><span class="var">?Si1</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?pa</span> <span class="var">?pb</span> <span class="var">?Si2</span> <span class="var">?Si1</span> <span class="main">=</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cross_ratio <span class="var">?Si2</span> <span class="var">?Si1</span> <span class="var">?pa</span> <span class="var">?pb</span> <span class="main">=</span> cross_ratio <span class="var">?pa</span> <span class="var">?pb</span> <span class="var">?Si2</span> <span class="var">?Si1</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?Si2</span> <span class="var">?Si1</span> <span class="var">?pa</span> <span class="var">?pb</span> <span class="main">=</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pb</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?Si1</span> <span class="main">=</span> endpoint_in_S <span class="var">?pa</span> <span class="var">?pb</span> <span class="main">∧</span> <span class="var">?Si2</span> <span class="main">=</span> endpoint_in_S <span class="var">?pb</span> <span class="var">?pa</span><span class="main">)</span>
    <span class="main">∨</span> <span class="main">(</span><span class="var">?Si2</span> <span class="main">=</span> endpoint_in_S <span class="var">?pa</span> <span class="var">?pb</span> <span class="main">∧</span> <span class="var">?Si1</span> <span class="main">=</span> endpoint_in_S <span class="var">?pb</span> <span class="var">?pa</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_intersections_endpoints_in_S<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cross_ratio <span class="var">?Si1</span> <span class="var">?Si2</span> <span class="var">?pa</span> <span class="var">?pb</span> <span class="main">=</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹cross_ratio <span class="var">?Si2</span> <span class="var">?Si1</span> <span class="var">?pa</span> <span class="var">?pb</span> <span class="main">=</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e2d</span> <span class="main">=</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span>
    <span class="main">∨</span> <span class="var">?e2d</span> <span class="main">=</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> exp_2dist_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cosh_dist_formula<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pa</span> <span class="main">∈</span> hyp2"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pb</span> <span class="main">∈</span> hyp2"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="main">(</span>proj2_abs <span class="free">a</span><span class="main">)</span> <span class="main">(</span>proj2_abs <span class="free">b</span><span class="main">)</span>
  <span class="main">=</span> <span class="main">¦</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span><span class="main">¦</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="var">?pa</span> <span class="var">?pb</span> <span class="main">=</span> <span class="main">¦</span><span class="var">?aMb</span><span class="main">¦</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="var">?aMa</span> <span class="main">*</span> <span class="var">?bMb</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"quarter_discrim <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sqd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sqrt <span class="var">?qd</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e2d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"exp_2dist <span class="var">?pa</span> <span class="var">?pb</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e2d</span> <span class="main">=</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span>
    <span class="main">∨</span> <span class="var">?e2d</span> <span class="main">=</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exp_2dist_formula<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="var">?pa</span> <span class="var">?pb</span>
    <span class="main">=</span> <span class="main">(</span>sqrt <span class="main">(</span><span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span><span class="main">)</span>
    <span class="main">+</span> sqrt <span class="main">(</span><span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cosh_dist_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qd</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pa</span> <span class="main">=</span> <span class="var">?pb</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qd</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quarter_discrim_self_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">∈</span> hyp2›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qd</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quarter_discrim_positive<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qd</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> real_sqrt_pow2 <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?qd</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?sqd</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="var">?qd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">=</span> <span class="var">?aMa</span> <span class="main">*</span> <span class="var">?bMb</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> quarter_discrim_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> times_divide_times_eq <span class="main">[</span><span class="operator">of</span>
    <span class="quoted"><span class="quoted">"<span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">=</span> <span class="var">?aMa</span> <span class="main">*</span> <span class="var">?bMb</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMa</span> <span class="main">*</span> <span class="var">?bMb</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">¦</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">¦</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="var">?aMa</span> <span class="main">*</span> <span class="var">?bMb</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_divide<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> times_divide_times_eq <span class="main">[</span><span class="operator">of</span>
    <span class="quoted"><span class="quoted">"<span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">=</span> <span class="var">?aMa</span> <span class="main">*</span> <span class="var">?bMb</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMa</span> <span class="main">*</span> <span class="var">?bMb</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">¦</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">¦</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="var">?aMa</span> <span class="main">*</span> <span class="var">?bMb</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_divide<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pb</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aMa</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bMb</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> K2_imp_M_neg<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">=</span> <span class="var">?aMa</span> <span class="main">*</span> <span class="var">?bMb</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_neg_neg<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_real_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">*</span> sgn <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹sgn <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹sgn <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> abs_plus <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">¦</span> <span class="main">+</span> <span class="main">¦</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">¦</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">¦</span><span class="var">?aMb</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹sqrt <span class="main">(</span><span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">¦</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">¦</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="var">?aMa</span> <span class="main">*</span> <span class="var">?bMb</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹sqrt <span class="main">(</span><span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">¦</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">¦</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="var">?aMa</span> <span class="main">*</span> <span class="var">?bMb</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> add_divide_distrib <span class="main">[</span><span class="operator">of</span>
    <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="var">?aMa</span> <span class="main">*</span> <span class="var">?bMb</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span><span class="main">)</span>
    <span class="main">+</span> sqrt <span class="main">(</span><span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">¦</span><span class="var">?aMb</span><span class="main">¦</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="var">?aMa</span> <span class="main">*</span> <span class="var">?bMb</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cosh_dist <span class="var">?pa</span> <span class="var">?pb</span>
    <span class="main">=</span> <span class="main">(</span>sqrt <span class="main">(</span><span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span><span class="main">)</span>
    <span class="main">+</span> sqrt <span class="main">(</span><span class="main">(</span><span class="var">?aMb</span> <span class="main">-</span> <span class="var">?sqd</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?aMb</span> <span class="main">+</span> <span class="var">?sqd</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">/</span> <span class="numeral">2</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="var">?pa</span> <span class="var">?pb</span> <span class="main">=</span> <span class="main">¦</span><span class="var">?aMb</span><span class="main">¦</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="var">?aMa</span> <span class="main">*</span> <span class="var">?bMb</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cosh_dist_perp_special_case<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">y</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
  <span class="main">=</span> <span class="main">(</span>cosh_dist K2_centre <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">*</span> <span class="main">(</span>cosh_dist K2_centre <span class="main">(</span>proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="var">?pa</span> <span class="var">?pb</span> <span class="main">=</span> <span class="main">(</span>cosh_dist <span class="var">?po</span> <span class="var">?pa</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cosh_dist <span class="var">?po</span> <span class="var">?pb</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> vector_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_3<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?a</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aMa</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?b</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bMb</span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> vector_def <span class="keyword2"><span class="keyword">and</span></span> M_def <span class="keyword2"><span class="keyword">and</span></span> inner_vec_def
      <span class="keyword2"><span class="keyword">and</span></span> matrix_vector_mult_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_3 power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¦</span><span class="free">y</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aMa</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bMb</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_square_less_1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pa</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pb</span> <span class="main">∈</span> hyp2"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_neg_imp_K2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="var">?pa</span> <span class="var">?pb</span> <span class="main">=</span> <span class="main">¦</span><span class="var">?a</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?b</span><span class="main">)</span><span class="main">¦</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="var">?aMa</span> <span class="main">*</span> <span class="var">?bMb</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="var">?pa</span> <span class="var">?pb</span> <span class="main">=</span> <span class="main">¦</span><span class="var">?aMb</span><span class="main">¦</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="var">?aMa</span> <span class="main">*</span> <span class="var">?bMb</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cosh_dist_formula<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?aMa</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?bMb</span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">¦</span><span class="var">?aMb</span><span class="main">¦</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="var">?pa</span> <span class="var">?pb</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vector_def <span class="keyword2"><span class="keyword">and</span></span> M_def <span class="keyword2"><span class="keyword">and</span></span> inner_vec_def
      <span class="keyword2"><span class="keyword">and</span></span> matrix_vector_mult_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_3 <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?o</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?oMa</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?o</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?oMb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?o</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?oMo</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?o</span> <span class="main">∙</span> <span class="main">(</span>M <span class="keyword1">*v</span> <span class="var">?o</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> K2_centre_non_zero <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> K2_centre_in_K2 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pb</span> <span class="main">∈</span> hyp2›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cosh_dist_formula <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?o</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="var">?po</span> <span class="var">?pa</span> <span class="main">=</span> <span class="main">¦</span><span class="var">?oMa</span><span class="main">¦</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="var">?oMo</span> <span class="main">*</span> <span class="var">?aMa</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="var">?po</span> <span class="var">?pb</span> <span class="main">=</span> <span class="main">¦</span><span class="var">?oMb</span><span class="main">¦</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="var">?oMo</span> <span class="main">*</span> <span class="var">?bMb</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> K2_centre_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="var">?po</span> <span class="var">?pa</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="var">?po</span> <span class="var">?pb</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vector_def <span class="keyword2"><span class="keyword">and</span></span> M_def <span class="keyword2"><span class="keyword">and</span></span> inner_vec_def
      <span class="keyword2"><span class="keyword">and</span></span> matrix_vector_mult_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_3 power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cosh_dist <span class="var">?pa</span> <span class="var">?pb</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="var">?pa</span> <span class="var">?pb</span> <span class="main">=</span> cosh_dist <span class="var">?po</span> <span class="var">?pa</span> <span class="main">*</span> cosh_dist <span class="var">?po</span> <span class="var">?pb</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> K2_isometry_cross_ratio_endpoints_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="main">(</span>apply_cltn2 <span class="main">(</span>endpoint_in_S <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">J</span><span class="main">)</span>
  <span class="main">(</span>apply_cltn2 <span class="main">(</span>endpoint_in_S <span class="free">b</span> <span class="free">a</span><span class="main">)</span> <span class="free">J</span><span class="main">)</span> <span class="main">(</span>apply_cltn2 <span class="free">a</span> <span class="free">J</span><span class="main">)</span> <span class="main">(</span>apply_cltn2 <span class="free">b</span> <span class="free">J</span><span class="main">)</span>
  <span class="main">=</span> cross_ratio <span class="main">(</span>endpoint_in_S <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>endpoint_in_S <span class="free">b</span> <span class="free">a</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?pJ</span> <span class="var">?qJ</span> <span class="var">?aJ</span> <span class="var">?bJ</span> <span class="main">=</span> cross_ratio <span class="var">?p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_line_through <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_line_through_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?p</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?q</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S_incident<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="var">?l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="var">?l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="var">?p</span><span class="main">,</span><span class="var">?q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_set_Col_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S_swap<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="var">?p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_not_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="var">?p</span><span class="main">,</span><span class="var">?q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?p</span> <span class="main">≠</span> <span class="var">?q</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?pJ</span> <span class="var">?qJ</span> <span class="var">?aJ</span> <span class="var">?bJ</span> <span class="main">=</span> cross_ratio <span class="var">?p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_cltn2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> K2_isometry_exp_2dist<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exp_2dist <span class="main">(</span>apply_cltn2 <span class="free">a</span> <span class="free">J</span><span class="main">)</span> <span class="main">(</span>apply_cltn2 <span class="free">b</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> exp_2dist <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"exp_2dist <span class="var">?aJ</span> <span class="var">?bJ</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"exp_2dist <span class="var">?aJ</span> <span class="var">?bJ</span> <span class="main">=</span> exp_2dist <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> exp_2dist_def<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> apply_cltn2_injective <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aJ</span> <span class="main">≠</span> <span class="var">?bJ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="free">b</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?aJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">a</span> <span class="free">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?bJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">b</span> <span class="free">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?pJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?p</span> <span class="free">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?qJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?q</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="free">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="var">?aJ</span> <span class="var">?bJ</span> <span class="main">=</span> <span class="var">?pJ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="var">?bJ</span> <span class="var">?aJ</span> <span class="main">=</span> <span class="var">?qJ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> K2_isometry_endpoint_in_S<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?pJ</span> <span class="var">?qJ</span> <span class="var">?aJ</span> <span class="var">?bJ</span> <span class="main">=</span> cross_ratio <span class="var">?p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> K2_isometry_cross_ratio_endpoints_in_S<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹endpoint_in_S <span class="var">?aJ</span> <span class="var">?bJ</span> <span class="main">=</span> <span class="var">?pJ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹endpoint_in_S <span class="var">?bJ</span> <span class="var">?aJ</span> <span class="main">=</span> <span class="var">?qJ</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?aJ</span> <span class="main">≠</span> <span class="var">?bJ</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"exp_2dist <span class="var">?aJ</span> <span class="var">?bJ</span> <span class="main">=</span> exp_2dist <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> exp_2dist_def<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> K2_isometry_cosh_dist<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="main">(</span>apply_cltn2 <span class="free">a</span> <span class="free">J</span><span class="main">)</span> <span class="main">(</span>apply_cltn2 <span class="free">b</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> cosh_dist <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cosh_dist_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> K2_isometry_exp_2dist<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cosh_dist_perp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"M_perp <span class="free">l</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> hyp2"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">c</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">a</span> <span class="free">c</span> <span class="main">=</span> cosh_dist <span class="free">b</span> <span class="free">a</span> <span class="main">*</span> cosh_dist <span class="free">b</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹M_perp <span class="free">l</span> <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> M_perp_to_compass <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line equator <span class="skolem">J</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2_line meridian <span class="skolem">J</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ji</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cltn2_inverse <span class="skolem">J</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?aJi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">a</span> <span class="var">?Ji</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bJi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">b</span> <span class="var">?Ji</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cJi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">c</span> <span class="var">?Ji</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2_line equator <span class="skolem">J</span> <span class="main">=</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2_line meridian <span class="skolem">J</span> <span class="main">=</span> <span class="free">m</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">c</span> <span class="free">m</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?aJi</span> equator"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?bJi</span> equator"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?bJi</span> meridian"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?cJi</span> meridian"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apply_cltn2_incident<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="var">?Ji</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cltn2_inverse_is_K2_isometry<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aJi</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cJi</span> <span class="main">∈</span> hyp2"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> statement60_one_way<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?aJi</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?aJi</span> equator›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> on_equator_in_hyp2_rep
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?aJi</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cJi</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?cJi</span> meridian›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> on_meridian_in_hyp2_rep
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">y</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cJi</span> <span class="main">=</span> proj2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="skolem">y</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?bJi</span> equator›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?bJi</span> meridian›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bJi</span> <span class="main">=</span> K2_centre"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> on_equator_meridian_is_K2_centre<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="var">?aJi</span> <span class="var">?cJi</span> <span class="main">=</span> cosh_dist <span class="var">?bJi</span> <span class="var">?aJi</span> <span class="main">*</span> cosh_dist <span class="var">?bJi</span> <span class="var">?cJi</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cosh_dist_perp_special_case<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="var">?Ji</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">a</span> <span class="free">c</span> <span class="main">=</span> cosh_dist <span class="free">b</span> <span class="free">a</span> <span class="main">*</span> cosh_dist <span class="free">b</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> K2_isometry_cosh_dist<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> are_endpoints_in_S_ordered_cross_ratio<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">b</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> are_endpoints_in_S_def<span class="main">)</span> <span class="operator">simp_all</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_z_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span>cart2_append1 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?cp1</span> <span class="main">=</span> <span class="free">p</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span>cart2_append1 <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?cq1</span> <span class="main">=</span> <span class="free">q</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span>cart2_append1 <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?ca1</span> <span class="main">=</span> <span class="free">a</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="main">(</span>cart2_append1 <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?cb1</span> <span class="main">=</span> <span class="free">b</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_abs_cart2_append1<span class="main">)</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2_S_not_equal<span class="main">)</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cart2_append1_between_right_strict <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cb1</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp1</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?ca1</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>›</span></span>
   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="skolem">l</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="skolem">l</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_set_Col_def<span class="main">)</span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> S_hyp2_S_cart2_append1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="skolem">l</span></span><span class="main">]</span>
   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ca1</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp1</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq1</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="free">q</span>›</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cp1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cq1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cart2_append1_non_zero<span class="main">)</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="var">?cp1</span> <span class="main">=</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="var">?cq1</span> <span class="main">=</span> <span class="free">q</span>›</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?cp1</span> <span class="main">≠</span> proj2_abs <span class="var">?cq1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">-</span><span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span><span class="main">*</span><span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cb1</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp1</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?ca1</span>›</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cb1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">j</span><span class="main">+</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq1</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> <span class="quoted"><span class="quoted">‹<span class="var">?ca1</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp1</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq1</span>›</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ca1</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp1</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq1</span>›</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?ca1</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp1</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq1</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_abs <span class="var">?cb1</span>
     <span class="main">=</span> proj2_abs <span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">+</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq1</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="var">?ca1</span> <span class="main">=</span> <span class="free">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="var">?cb1</span> <span class="main">=</span> <span class="free">b</span>›</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp1</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq1</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> proj2_abs <span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">+</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq1</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="var">?cp1</span> <span class="main">=</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="var">?cq1</span> <span class="main">=</span> <span class="free">q</span>›</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>
     <span class="main">=</span> cross_ratio <span class="main">(</span>proj2_abs <span class="var">?cp1</span><span class="main">)</span> <span class="main">(</span>proj2_abs <span class="var">?cq1</span><span class="main">)</span>
     <span class="main">(</span>proj2_abs <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp1</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq1</span><span class="main">)</span><span class="main">)</span>
     <span class="main">(</span>proj2_abs <span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">+</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cp1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cq1</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cp1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cq1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_abs <span class="var">?cp1</span> <span class="main">≠</span> proj2_abs <span class="var">?cq1</span>›</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">-</span><span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">j</span><span class="main">+</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_abs<span class="main">)</span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">-</span><span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">j</span><span class="main">+</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span><span class="main">*</span><span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cross_ratio_S_S_hyp2_hyp2_positive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">b</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">b</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_euclid.th3_2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> are_endpoints_in_S_ordered_cross_ratio<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">b</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cb</span> <span class="var">?ca</span>"</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">b</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> are_endpoints_in_S_swap_34<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> are_endpoints_in_S_def<span class="main">)</span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_subset_Col <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> proj2_Col_iff_set_Col<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cb</span> <span class="var">?ca</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_at_edge<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?cb</span> <span class="var">?ca</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="var">?ca</span> <span class="var">?cb</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cb</span> <span class="var">?ca</span> <span class="var">?cp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_euclid.th3_2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">b</span> <span class="free">a</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">b</span> <span class="free">a</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> are_endpoints_in_S_ordered_cross_ratio<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> cross_ratio_swap_34<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cosh_dist_general<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">a</span> <span class="free">b</span>
  <span class="main">=</span> <span class="main">(</span>sqrt <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> are_endpoints_in_S_def<span class="main">)</span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_not_equal<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">a</span> <span class="free">b</span>
    <span class="main">=</span> <span class="main">(</span>sqrt <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cosh_dist_def exp_2dist_def<span class="main">)</span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>›</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_Col_iff_set_Col<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">q</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>›</span></span> cross_ratio_equal_1<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sqrt <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>
      <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cosh_dist <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">1</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">a</span> <span class="free">b</span>
      <span class="main">=</span> <span class="main">(</span>sqrt <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="free">b</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp_2dist <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> cross_ratio <span class="var">?r</span> <span class="var">?s</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> exp_2dist_def<span class="main">)</span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> <span class="var">?s</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">q</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> <span class="var">?s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> are_endpoints_in_S<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">a</span> <span class="free">b</span>
      <span class="main">=</span> <span class="main">(</span>sqrt <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> <span class="var">?s</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹exp_2dist <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> cross_ratio <span class="var">?r</span> <span class="var">?s</span> <span class="free">a</span> <span class="free">b</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp_2dist <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">a</span> <span class="free">b</span>
        <span class="main">=</span> <span class="main">(</span>sqrt <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cosh_dist_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> <span class="var">?s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> <span class="var">?s</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">q</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> <span class="var">?s</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="var">?s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹exp_2dist <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> cross_ratio <span class="var">?r</span> <span class="var">?s</span> <span class="free">a</span> <span class="free">b</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp_2dist <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> cross_ratio <span class="free">q</span> <span class="free">p</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">q</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="free">p</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="free">q</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="free">q</span> <span class="free">p</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cross_ratio_correct_def<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">q</span> <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_swap_12<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹exp_2dist <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> cross_ratio <span class="free">q</span> <span class="free">p</span> <span class="free">a</span> <span class="free">b</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp_2dist <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">a</span> <span class="free">b</span>
        <span class="main">=</span> <span class="main">(</span>sqrt <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cosh_dist_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exp_2dist_positive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exp_2dist <span class="free">a</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"exp_2dist <span class="free">a</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> exp_2dist_def<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="free">b</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="var">?p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> endpoints_in_S_are_endpoints_in_S<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_S_S_hyp2_hyp2_positive<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"exp_2dist <span class="free">a</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> exp_2dist_def<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cosh_dist_at_least_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">a</span> <span class="free">b</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp_2dist <span class="free">a</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exp_2dist_positive<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> am_gm2<span class="main">(</span>1<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span>exp_2dist <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">1</span> <span class="main">/</span> exp_2dist <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">a</span> <span class="free">b</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cosh_dist_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cosh_dist_positive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">a</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">a</span> <span class="free">b</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cosh_dist_at_least_1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">a</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cosh_dist_perp_divide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"M_perp <span class="free">l</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> hyp2"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">c</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> cosh_dist <span class="free">a</span> <span class="free">c</span> <span class="main">/</span> cosh_dist <span class="free">b</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">b</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cosh_dist_positive<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">a</span> <span class="free">c</span> <span class="main">=</span> cosh_dist <span class="free">b</span> <span class="free">a</span> <span class="main">*</span> cosh_dist <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cosh_dist_perp<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cosh_dist <span class="free">b</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> cosh_dist <span class="free">a</span> <span class="free">c</span> <span class="main">/</span> cosh_dist <span class="free">b</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_hyp2_C_cross_ratio_endpoints_in_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="main">(</span>endpoint_in_S <span class="main">(</span>Rep_hyp2 <span class="free">a</span><span class="main">)</span> <span class="main">(</span>Rep_hyp2 <span class="free">b</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>endpoint_in_S <span class="main">(</span>Rep_hyp2 <span class="free">b</span><span class="main">)</span> <span class="main">(</span>Rep_hyp2 <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Rep_hyp2 <span class="free">a</span><span class="main">)</span> <span class="main">(</span>Rep_hyp2 <span class="free">b</span><span class="main">)</span>
  <span class="main">=</span> cross_ratio <span class="main">(</span>endpoint_in_S <span class="main">(</span>Rep_hyp2 <span class="free">c</span><span class="main">)</span> <span class="main">(</span>Rep_hyp2 <span class="free">d</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>endpoint_in_S <span class="main">(</span>Rep_hyp2 <span class="free">d</span><span class="main">)</span> <span class="main">(</span>Rep_hyp2 <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Rep_hyp2 <span class="free">c</span><span class="main">)</span> <span class="main">(</span>Rep_hyp2 <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?p</span> <span class="var">?q</span> <span class="var">?a'</span> <span class="var">?b'</span> <span class="main">=</span> cross_ratio <span class="var">?r</span> <span class="var">?s</span> <span class="var">?c'</span> <span class="var">?d'</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="free">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">c</span> <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2.A3'<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a'</span> <span class="main">≠</span> <span class="var">?b'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c'</span> <span class="main">≠</span> <span class="var">?d'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Rep_hyp2_inject<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="free">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">c</span> <span class="free">d</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="free">a</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="free">b</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_hyp2_C_def<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?a'</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?c'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?b'</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?d'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2_cltn2 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a'</span> <span class="main">≠</span> <span class="var">?b'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?p</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?q</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 K2_isometry_endpoint_in_S<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a'</span> <span class="main">≠</span> <span class="var">?b'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="var">?p</span><span class="main">,</span><span class="var">?q</span><span class="main">,</span><span class="var">?a'</span><span class="main">,</span><span class="var">?b'</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 proj2_set_Col_endpoints_in_S<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a'</span> <span class="main">≠</span> <span class="var">?b'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 endpoint_in_S_swap<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 endpoint_in_S<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a'</span> <span class="main">≠</span> <span class="var">?p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b'</span> <span class="main">≠</span> <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 hyp2_S_not_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="var">?p</span><span class="main">,</span><span class="var">?q</span><span class="main">,</span><span class="var">?a'</span><span class="main">,</span><span class="var">?b'</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?p</span> <span class="main">≠</span> <span class="var">?q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?p</span> <span class="var">?q</span> <span class="var">?a'</span> <span class="var">?b'</span>
    <span class="main">=</span> cross_ratio <span class="main">(</span>apply_cltn2 <span class="var">?p</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">(</span>apply_cltn2 <span class="var">?q</span> <span class="skolem">J</span><span class="main">)</span>
    <span class="main">(</span>apply_cltn2 <span class="var">?a'</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">(</span>apply_cltn2 <span class="var">?b'</span> <span class="skolem">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_cltn2 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="var">?p</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?r</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="var">?q</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?s</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="var">?a'</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?c'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="var">?b'</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?d'</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?p</span> <span class="var">?q</span> <span class="var">?a'</span> <span class="var">?b'</span> <span class="main">=</span> cross_ratio <span class="var">?r</span> <span class="var">?s</span> <span class="var">?c'</span> <span class="var">?d'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_hyp2_C_exp_2dist<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exp_2dist <span class="main">(</span>Rep_hyp2 <span class="free">a</span><span class="main">)</span> <span class="main">(</span>Rep_hyp2 <span class="free">b</span><span class="main">)</span>
  <span class="main">=</span> exp_2dist <span class="main">(</span>Rep_hyp2 <span class="free">c</span><span class="main">)</span> <span class="main">(</span>Rep_hyp2 <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"exp_2dist <span class="var">?a'</span> <span class="var">?b'</span> <span class="main">=</span> exp_2dist <span class="var">?c'</span> <span class="var">?d'</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="free">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">c</span> <span class="free">d</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="free">a</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="free">b</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_hyp2_C_def<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?a'</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?c'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?b'</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?d'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2_cltn2 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> Rep_hyp2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> Rep_hyp2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp_2dist <span class="main">(</span>apply_cltn2 <span class="var">?a'</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">(</span>apply_cltn2 <span class="var">?b'</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">=</span> exp_2dist <span class="var">?a'</span> <span class="var">?b'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> K2_isometry_exp_2dist<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="var">?a'</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?c'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="var">?b'</span> <span class="skolem">J</span> <span class="main">=</span> <span class="var">?d'</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"exp_2dist <span class="var">?a'</span> <span class="var">?b'</span> <span class="main">=</span> exp_2dist <span class="var">?c'</span> <span class="var">?d'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_hyp2_C_cosh_dist<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="main">(</span>Rep_hyp2 <span class="free">a</span><span class="main">)</span> <span class="main">(</span>Rep_hyp2 <span class="free">b</span><span class="main">)</span>
  <span class="main">=</span> cosh_dist <span class="main">(</span>Rep_hyp2 <span class="free">c</span><span class="main">)</span> <span class="main">(</span>Rep_hyp2 <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cosh_dist_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_hyp2_C_exp_2dist<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cross_ratio_in_terms_of_cosh_dist<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">b</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>
  <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>cosh_dist <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> cosh_dist <span class="free">a</span> <span class="free">b</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">(</span>cosh_dist <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqab</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?ab</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ab</span> <span class="main">=</span> <span class="main">(</span>sqrt <span class="var">?pqab</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="var">?pqab</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cosh_dist_general<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="var">?pqab</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?ab</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="var">?pqab</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="var">?pqab</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="var">?pqab</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?ab</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="var">?pqab</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqab</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> are_endpoints_in_S_ordered_cross_ratio<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqab</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?ab</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="var">?pqab</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> real_sqrt_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pqab</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> discriminant_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="var">?pqab</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?ab</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="var">?pqab</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="var">?ab</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>
    <span class="main">∨</span> sqrt <span class="var">?pqab</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="var">?ab</span> <span class="main">-</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> discrim_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_sqrt_mult<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="var">?pqab</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="var">?ab</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>
    <span class="main">∨</span> sqrt <span class="var">?pqab</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="var">?ab</span> <span class="main">-</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="var">?pqab</span> <span class="main">=</span> <span class="var">?ab</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>
    <span class="main">∨</span> sqrt <span class="var">?pqab</span> <span class="main">=</span> <span class="var">?ab</span> <span class="main">-</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nonzero_mult_div_cancel_left <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> are_endpoints_in_S_def<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ab</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cosh_dist_at_least_1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?ab</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?ab</span> <span class="main">-</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ab</span> <span class="main">-</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="var">?ab</span> <span class="main">-</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="var">?ab</span> <span class="main">-</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="var">?ab</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="var">?ab</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="var">?ab</span> <span class="main">-</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> mult_strict_mono' <span class="main">[</span><span class="operator">of</span>
      <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ab</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ab</span> <span class="main">-</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="main">(</span><span class="var">?ab</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?ab</span> <span class="main">-</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?ab</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?ab</span> <span class="main">-</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="var">?pqab</span> <span class="main">=</span> <span class="var">?ab</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="var">?pqab</span> <span class="main">≠</span> <span class="var">?ab</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹sqrt <span class="var">?pqab</span> <span class="main">=</span> <span class="var">?ab</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>
      <span class="main">∨</span> sqrt <span class="var">?pqab</span> <span class="main">=</span> <span class="var">?ab</span> <span class="main">-</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="var">?pqab</span> <span class="main">=</span> <span class="var">?ab</span> <span class="main">-</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ab</span> <span class="main">-</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="var">?pqab</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pqab</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="var">?pqab</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹sqrt <span class="var">?pqab</span> <span class="main">=</span> <span class="var">?ab</span> <span class="main">-</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?ab</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?ab</span> <span class="main">-</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ab</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹sqrt <span class="var">?pqab</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="var">?pqab</span> <span class="main">=</span> <span class="var">?ab</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹sqrt <span class="var">?pqab</span> <span class="main">≠</span> <span class="var">?ab</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pqab</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqab</span> <span class="main">=</span> <span class="main">(</span>sqrt <span class="var">?pqab</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqab</span> <span class="main">=</span> <span class="main">(</span><span class="var">?ab</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqab</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?ab</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> are_endpoints_in_S_cross_ratio_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> are_endpoints_in_S_def<span class="main">)</span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_not_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cross_ratio_correct_def<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> endpoints_in_S_cross_ratio_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="main">(</span>endpoint_in_S <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>endpoint_in_S <span class="free">b</span> <span class="free">a</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="main">(</span>endpoint_in_S <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>endpoint_in_S <span class="free">b</span> <span class="free">a</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> endpoints_in_S_are_endpoints_in_S<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="main">(</span>endpoint_in_S <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>endpoint_in_S <span class="free">b</span> <span class="free">a</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> are_endpoints_in_S_cross_ratio_correct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> endpoints_in_S_perp_foot_cross_ratio_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct
  <span class="main">(</span>endpoint_in_S <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>endpoint_in_S <span class="free">b</span> <span class="free">a</span><span class="main">)</span> <span class="free">a</span> <span class="main">(</span>perp_foot <span class="free">c</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="var">?p</span> <span class="var">?q</span> <span class="free">a</span> <span class="var">?d</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="var">?p</span> <span class="var">?q</span> <span class="free">a</span> <span class="var">?d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> endpoints_in_S_perp_foot_are_endpoints_in_S<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="var">?p</span> <span class="var">?q</span> <span class="free">a</span> <span class="var">?d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> are_endpoints_in_S_cross_ratio_correct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cosh_dist_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">b</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>cart2_pt <span class="free">a</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">c</span><span class="main">)</span> <span class="main">(</span>cart2_pt <span class="free">p</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cc</span> <span class="var">?cp</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> cosh_dist <span class="free">a</span> <span class="free">c</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ab</span> <span class="main">=</span> <span class="var">?ac</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"endpoint_in_S <span class="free">p</span> <span class="free">a</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_z_non_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cc</span> <span class="var">?cp</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">l</span><span class="main">.</span> proj2_incident <span class="free">a</span> <span class="bound">l</span> <span class="main">∧</span> proj2_incident <span class="free">b</span> <span class="bound">l</span> <span class="main">∧</span> proj2_incident <span class="free">p</span> <span class="bound">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">m</span><span class="main">.</span> proj2_incident <span class="free">a</span> <span class="bound">m</span> <span class="main">∧</span> proj2_incident <span class="free">c</span> <span class="bound">m</span> <span class="main">∧</span> proj2_incident <span class="free">p</span> <span class="bound">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> euclid_B_cart2_common_line<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">c</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2_S_not_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="skolem">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="skolem">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="skolem">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="skolem">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_unique
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">c</span> <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">c</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="skolem">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="skolem">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="skolem">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="var">?q</span> <span class="free">b</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="var">?q</span> <span class="free">c</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> end_and_opposite_are_endpoints_in_S<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> are_endpoints_in_S_swap_34
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="free">p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="free">p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> are_endpoints_in_S_cross_ratio_correct<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹are_endpoints_in_S <span class="free">p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹are_endpoints_in_S <span class="free">p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">c</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cp</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cc</span> <span class="var">?cp</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?ab</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="var">?ab</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">c</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?ac</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?ac</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="var">?ac</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cross_ratio_in_terms_of_cosh_dist<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ab</span> <span class="main">=</span> <span class="var">?ac</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> cross_ratio <span class="free">p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_unique<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cosh_dist_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> cosh_dist <span class="free">b</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> K2_isometry_swap
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">a</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="free">b</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="main">(</span>apply_cltn2 <span class="free">b</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">(</span>apply_cltn2 <span class="free">a</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">=</span> cosh_dist <span class="free">b</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> K2_isometry_cosh_dist<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">a</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹apply_cltn2 <span class="free">b</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">a</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> cosh_dist <span class="free">b</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exp_2dist_1_equal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exp_2dist <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="main">(</span>endpoint_in_S <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>endpoint_in_S <span class="free">b</span> <span class="free">a</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="var">?p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoints_in_S_cross_ratio_correct<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp_2dist <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> cross_ratio <span class="var">?p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> exp_2dist_def<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹exp_2dist <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_1_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹A formula for a cross ratio involving a perpendicular foot›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> described_perp_foot_cross_ratio_formula<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"M_perp <span class="free">l</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">d</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">d</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">c</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">d</span> <span class="free">a</span>
    <span class="main">=</span> <span class="main">(</span>cosh_dist <span class="free">b</span> <span class="free">c</span> <span class="main">*</span> sqrt <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">-</span> cosh_dist <span class="free">a</span> <span class="free">c</span><span class="main">)</span>
      <span class="main">/</span> <span class="main">(</span>cosh_dist <span class="free">a</span> <span class="free">c</span> <span class="main">*</span> cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>
        <span class="main">-</span> cosh_dist <span class="free">b</span> <span class="free">c</span> <span class="main">*</span> sqrt <span class="main">(</span>cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqda</span> <span class="main">=</span> <span class="main">(</span><span class="var">?bc</span> <span class="main">*</span> sqrt <span class="var">?pqab</span> <span class="main">-</span> <span class="var">?ac</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?ac</span> <span class="main">*</span> <span class="var">?pqab</span> <span class="main">-</span> <span class="var">?bc</span> <span class="main">*</span> sqrt <span class="var">?pqab</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?da</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">d</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?db</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">d</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?dc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">d</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pqdb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">p</span> <span class="free">q</span> <span class="free">d</span> <span class="free">b</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> are_endpoints_in_S_def<span class="main">)</span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">p</span> <span class="skolem">l'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">q</span> <span class="skolem">l'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="skolem">l'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="skolem">l'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_set_Col_def<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="skolem">l'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="skolem">l'</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_incident_unique
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">=</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="skolem">l'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="skolem">l'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹M_perp <span class="free">l</span> <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> hyp2›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">c</span> <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">d</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">d</span> <span class="free">m</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M_perp_hyp2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bc</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?da</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ac</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cosh_dist_positive<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">d</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_set_Col_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">d</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">d</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> are_endpoints_in_S_def<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqda</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqdb</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqab</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cross_ratio_S_S_hyp2_hyp2_positive<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">p</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">q</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_incident_Col<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_S_not_equal<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_Col <span class="free">p</span> <span class="free">q</span> <span class="free">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">q</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqdb</span> <span class="main">=</span> <span class="var">?pqda</span> <span class="main">*</span> <span class="var">?pqab</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_product <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹M_perp <span class="free">l</span> <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">∈</span> hyp2›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">a</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">b</span> <span class="free">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">d</span> <span class="free">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">d</span> <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="free">c</span> <span class="free">m</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cosh_dist_perp_divide <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="free">m</span></span> <span class="main">_</span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?dc</span> <span class="main">=</span> <span class="var">?ac</span> <span class="main">/</span> <span class="var">?da</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?dc</span> <span class="main">=</span> <span class="var">?bc</span> <span class="main">/</span> <span class="var">?db</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ac</span> <span class="main">/</span> <span class="var">?da</span> <span class="main">=</span> <span class="var">?bc</span> <span class="main">/</span> <span class="var">?db</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?bc</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?da</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ac</span> <span class="main">/</span> <span class="var">?bc</span> <span class="main">=</span> <span class="var">?da</span> <span class="main">/</span> <span class="var">?db</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">d</span> <span class="free">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹are_endpoints_in_S <span class="free">p</span> <span class="free">q</span> <span class="free">d</span> <span class="free">b</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span>
    <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="var">?pqda</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="var">?pqda</span><span class="main">)</span><span class="main">)</span>
    <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="var">?pqdb</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="var">?pqdb</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cosh_dist_general<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>sqrt <span class="var">?pqda</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="var">?pqda</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="var">?pqdb</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="var">?pqdb</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult_divide_mult_cancel_left_if<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span>
    <span class="main">=</span> sqrt <span class="var">?pqdb</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="var">?pqda</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="var">?pqda</span><span class="main">)</span><span class="main">)</span>
    <span class="main">/</span> <span class="main">(</span>sqrt <span class="var">?pqdb</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="var">?pqdb</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="var">?pqdb</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pqdb</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>sqrt <span class="main">(</span><span class="var">?pqdb</span> <span class="main">*</span> <span class="var">?pqda</span><span class="main">)</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="var">?pqdb</span> <span class="main">/</span> <span class="var">?pqda</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?pqdb</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> real_sqrt_divide <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pqdb</span> <span class="main">=</span> <span class="var">?pqda</span> <span class="main">*</span> <span class="var">?pqab</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pqda</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> real_sqrt_pow2
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="var">?pqda</span> <span class="main">*</span> sqrt <span class="var">?pqab</span> <span class="main">+</span> sqrt <span class="var">?pqab</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?pqda</span> <span class="main">*</span> <span class="var">?pqab</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_mult power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ac</span> <span class="main">/</span> <span class="var">?bc</span> <span class="main">=</span> <span class="main">(</span><span class="var">?pqda</span> <span class="main">*</span> sqrt <span class="var">?pqab</span> <span class="main">+</span> sqrt <span class="var">?pqab</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?pqda</span> <span class="main">*</span> <span class="var">?pqab</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pqda</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pqab</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqda</span> <span class="main">*</span> <span class="var">?pqab</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_pos_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?bc</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ac</span> <span class="main">/</span> <span class="var">?bc</span> <span class="main">=</span> <span class="main">(</span><span class="var">?pqda</span> <span class="main">*</span> sqrt <span class="var">?pqab</span> <span class="main">+</span> sqrt <span class="var">?pqab</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?pqda</span> <span class="main">*</span> <span class="var">?pqab</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ac</span> <span class="main">*</span> <span class="main">(</span><span class="var">?pqda</span> <span class="main">*</span> <span class="var">?pqab</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="var">?bc</span> <span class="main">*</span> <span class="main">(</span><span class="var">?pqda</span> <span class="main">*</span> sqrt <span class="var">?pqab</span> <span class="main">+</span> sqrt <span class="var">?pqab</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqda</span> <span class="main">*</span> <span class="main">(</span><span class="var">?ac</span> <span class="main">*</span> <span class="var">?pqab</span> <span class="main">-</span> <span class="var">?bc</span> <span class="main">*</span> sqrt <span class="var">?pqab</span><span class="main">)</span> <span class="main">=</span> <span class="var">?bc</span> <span class="main">*</span> sqrt <span class="var">?pqab</span> <span class="main">-</span> <span class="var">?ac</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">q</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cross_ratio_correct_def<span class="main">)</span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ac</span> <span class="main">*</span> <span class="var">?pqab</span> <span class="main">-</span> <span class="var">?bc</span> <span class="main">*</span> sqrt <span class="var">?pqab</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ac</span> <span class="main">*</span> <span class="var">?pqab</span> <span class="main">-</span> <span class="var">?bc</span> <span class="main">*</span> sqrt <span class="var">?pqab</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pqda</span> <span class="main">*</span> <span class="main">(</span><span class="var">?ac</span> <span class="main">*</span> <span class="var">?pqab</span> <span class="main">-</span> <span class="var">?bc</span> <span class="main">*</span> sqrt <span class="var">?pqab</span><span class="main">)</span> <span class="main">=</span> <span class="var">?bc</span> <span class="main">*</span> sqrt <span class="var">?pqab</span> <span class="main">-</span> <span class="var">?ac</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bc</span> <span class="main">*</span> sqrt <span class="var">?pqab</span> <span class="main">-</span> <span class="var">?ac</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ac</span> <span class="main">*</span> <span class="var">?pqab</span> <span class="main">-</span> <span class="var">?bc</span> <span class="main">*</span> sqrt <span class="var">?pqab</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ac</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqab</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_1_equal<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pqda</span> <span class="main">*</span> <span class="main">(</span><span class="var">?ac</span> <span class="main">*</span> <span class="var">?pqab</span> <span class="main">-</span> <span class="var">?bc</span> <span class="main">*</span> sqrt <span class="var">?pqab</span><span class="main">)</span> <span class="main">=</span> <span class="var">?bc</span> <span class="main">*</span> sqrt <span class="var">?pqab</span> <span class="main">-</span> <span class="var">?ac</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqda</span> <span class="main">=</span> <span class="main">(</span><span class="var">?bc</span> <span class="main">*</span> sqrt <span class="var">?pqab</span> <span class="main">-</span> <span class="var">?ac</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?ac</span> <span class="main">*</span> <span class="var">?pqab</span> <span class="main">-</span> <span class="var">?bc</span> <span class="main">*</span> sqrt <span class="var">?pqab</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> perp_foot_cross_ratio_formula<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="main">(</span>endpoint_in_S <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>endpoint_in_S <span class="free">b</span> <span class="free">a</span><span class="main">)</span>
      <span class="main">(</span>perp_foot <span class="free">c</span> <span class="main">(</span>proj2_line_through <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span>
    <span class="main">=</span> <span class="main">(</span>cosh_dist <span class="free">b</span> <span class="free">c</span> <span class="main">*</span> sqrt <span class="main">(</span>exp_2dist <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">-</span> cosh_dist <span class="free">a</span> <span class="free">c</span><span class="main">)</span>
      <span class="main">/</span> <span class="main">(</span>cosh_dist <span class="free">a</span> <span class="free">c</span> <span class="main">*</span> exp_2dist <span class="free">a</span> <span class="free">b</span> <span class="main">-</span> cosh_dist <span class="free">b</span> <span class="free">c</span> <span class="main">*</span> sqrt <span class="main">(</span>exp_2dist <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?p</span> <span class="var">?q</span> <span class="var">?d</span> <span class="free">a</span>
    <span class="main">=</span> <span class="main">(</span><span class="var">?bc</span> <span class="main">*</span> sqrt <span class="var">?pqab</span> <span class="main">-</span> <span class="var">?ac</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?ac</span> <span class="main">*</span> <span class="var">?pqab</span> <span class="main">-</span> <span class="var">?bc</span> <span class="main">*</span> sqrt <span class="var">?pqab</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="var">?p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> endpoints_in_S_are_endpoints_in_S<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"proj2_line_through <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">a</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">b</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proj2_line_through_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?p</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?q</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_in_S_incident<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"drop_perp <span class="free">c</span> <span class="var">?l</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"M_perp <span class="var">?l</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> drop_perp_perp<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?d</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?d</span> <span class="var">?m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perp_foot_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="free">c</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> drop_perp_incident<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹are_endpoints_in_S <span class="var">?p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?p</span> <span class="var">?l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?q</span> <span class="var">?l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹M_perp <span class="var">?l</span> <span class="var">?m</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?d</span> <span class="var">?l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?d</span> <span class="var">?m</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?p</span> <span class="var">?q</span> <span class="var">?d</span> <span class="free">a</span>
    <span class="main">=</span> <span class="main">(</span><span class="var">?bc</span> <span class="main">*</span> sqrt <span class="main">(</span>cross_ratio <span class="var">?p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">-</span> <span class="var">?ac</span><span class="main">)</span>
    <span class="main">/</span> <span class="main">(</span><span class="var">?ac</span> <span class="main">*</span> <span class="main">(</span>cross_ratio <span class="var">?p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">-</span> <span class="var">?bc</span> <span class="main">*</span> sqrt <span class="main">(</span>cross_ratio <span class="var">?p</span> <span class="var">?q</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> described_perp_foot_cross_ratio_formula<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?p</span> <span class="var">?q</span> <span class="var">?d</span> <span class="free">a</span>
    <span class="main">=</span> <span class="main">(</span><span class="var">?bc</span> <span class="main">*</span> sqrt <span class="var">?pqab</span> <span class="main">-</span> <span class="var">?ac</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?ac</span> <span class="main">*</span> <span class="var">?pqab</span> <span class="main">-</span> <span class="var">?bc</span> <span class="main">*</span> sqrt <span class="var">?pqab</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> exp_2dist_def<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Klein--Beltrami model satisfies axiom 5›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> statement69<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">a'</span> <span class="free">b'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="free">c</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">b'</span> <span class="free">c'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">c</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">a'</span> <span class="free">c'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J</span><span class="main">.</span> is_K2_isometry <span class="bound">J</span>
  <span class="main">∧</span> hyp2_cltn2 <span class="free">a</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">a'</span> <span class="main">∧</span> hyp2_cltn2 <span class="free">b</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">b'</span> <span class="main">∧</span> hyp2_cltn2 <span class="free">c</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">c'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="free">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">a'</span> <span class="free">b'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a'</span> <span class="main">=</span> <span class="free">b'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2.A3_reversed<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="free">c</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">b'</span> <span class="free">c'</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J</span><span class="main">.</span> is_K2_isometry <span class="bound">J</span>
    <span class="main">∧</span> hyp2_cltn2 <span class="free">a</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">a'</span> <span class="main">∧</span> hyp2_cltn2 <span class="free">b</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">b'</span> <span class="main">∧</span> hyp2_cltn2 <span class="free">c</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">c'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_hyp2_C_def<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="free">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">a'</span> <span class="free">b'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a'</span> <span class="main">≠</span> <span class="free">b'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2.A3'<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pa</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?pb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?pc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?pa'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="free">a'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?pb'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="free">b'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?pc'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="free">c'</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pp</span></span> <span class="skolem"><span class="skolem">pq</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">pp'</span></span> <span class="skolem"><span class="skolem">pq'</span></span> <span class="skolem"><span class="skolem">l'</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span> <span class="main">=</span> endpoint_in_S <span class="var">?pa</span> <span class="var">?pb</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pq</span> <span class="main">=</span> endpoint_in_S <span class="var">?pb</span> <span class="var">?pa</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> proj2_line_through <span class="var">?pa</span> <span class="var">?pb</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp'</span> <span class="main">=</span> endpoint_in_S <span class="var">?pa'</span> <span class="var">?pb'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pq'</span> <span class="main">=</span> endpoint_in_S <span class="var">?pb'</span> <span class="var">?pa'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">=</span> proj2_line_through <span class="var">?pa'</span> <span class="var">?pb'</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pd</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">pd'</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">m'</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pd</span> <span class="main">=</span> perp_foot <span class="var">?pc</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">=</span> perp_up <span class="var">?pc</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> drop_perp <span class="var">?pc</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pd'</span> <span class="main">=</span> perp_foot <span class="var">?pc'</span> <span class="skolem">l'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span> <span class="main">=</span> perp_up <span class="var">?pc'</span> <span class="skolem">l'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">=</span> drop_perp <span class="var">?pc'</span> <span class="skolem">l'</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp'</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pq</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pq'</span> <span class="main">∈</span> S"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pp_def <span class="keyword2"><span class="keyword">and</span></span> pp'_def <span class="keyword2"><span class="keyword">and</span></span> pq_def <span class="keyword2"><span class="keyword">and</span></span> pq'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 endpoint_in_S<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a'</span> <span class="main">≠</span> <span class="free">b'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pa'</span> <span class="main">≠</span> <span class="var">?pb'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Rep_hyp2_inject<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pa</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pb</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pa'</span> <span class="skolem">l'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pb'</span> <span class="skolem">l'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> l_def l'_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> proj2_line_through_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">pp</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">pp'</span> <span class="skolem">l'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">pq</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">pq'</span> <span class="skolem">l'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pp_def <span class="keyword2"><span class="keyword">and</span></span> pp'_def <span class="keyword2"><span class="keyword">and</span></span> pq_def <span class="keyword2"><span class="keyword">and</span></span> pq'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 endpoint_in_S_incident<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pp</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pp'</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">pp</span> <span class="skolem">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">pp'</span> <span class="skolem">l'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pa</span> <span class="skolem">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pa'</span> <span class="skolem">l'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"right_angle <span class="skolem">pp</span> <span class="skolem">pd</span> <span class="skolem">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"right_angle <span class="skolem">pp'</span> <span class="skolem">pd'</span> <span class="skolem">ps'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pd_def <span class="keyword2"><span class="keyword">and</span></span> ps_def <span class="keyword2"><span class="keyword">and</span></span> pd'_def <span class="keyword2"><span class="keyword">and</span></span> ps'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2
      perp_foot_up_right_angle <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">pp</span></span> <span class="var"><span class="quoted"><span class="var">?pc</span></span></span> <span class="var"><span class="quoted"><span class="var">?pa</span></span></span> <span class="quoted"><span class="skolem">l</span></span><span class="main"><span class="main">]</span></span>
      perp_foot_up_right_angle <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">pp'</span></span> <span class="var"><span class="quoted"><span class="var">?pc'</span></span></span> <span class="var"><span class="quoted"><span class="var">?pa'</span></span></span> <span class="quoted"><span class="skolem">l'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> right_angle_to_right_angle <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">pp</span></span> <span class="quoted"><span class="skolem">pd</span></span> <span class="quoted"><span class="skolem">ps</span></span> <span class="quoted"><span class="skolem">pp'</span></span> <span class="quoted"><span class="skolem">pd'</span></span> <span class="quoted"><span class="skolem">ps'</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">pp</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">pp'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">pd</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">pd'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">ps</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">ps'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?paJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?pa</span> <span class="skolem">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?pbJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?pb</span> <span class="skolem">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?pcJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="var">?pc</span> <span class="skolem">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?pdJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">pd</span> <span class="skolem">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?ppJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">pp</span> <span class="skolem">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?pqJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">pq</span> <span class="skolem">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?psJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2 <span class="skolem">ps</span> <span class="skolem">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?lJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2_line <span class="skolem">l</span> <span class="skolem">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?mJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"apply_cltn2_line <span class="skolem">m</span> <span class="skolem">J</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">pd</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">pd'</span> <span class="skolem">l'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">pd</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">pd'</span> <span class="skolem">m'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> pd_def pd'_def m_def m'_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> perp_foot_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">pp</span> <span class="skolem">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">pq</span> <span class="skolem">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">pd</span> <span class="skolem">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pa</span> <span class="skolem">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pb</span> <span class="skolem">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="skolem">pp</span><span class="main">,</span><span class="skolem">pq</span><span class="main">,</span><span class="skolem">pd</span><span class="main">,</span><span class="var">?pa</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="skolem">pp</span><span class="main">,</span><span class="skolem">pq</span><span class="main">,</span><span class="var">?pa</span><span class="main">,</span><span class="var">?pb</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> pd_def proj2_set_Col_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">l</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa'</span> <span class="main">≠</span> <span class="var">?pb'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span> <span class="main">≠</span> <span class="skolem">pq</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp'</span> <span class="main">≠</span> <span class="skolem">pq'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pp_def <span class="keyword2"><span class="keyword">and</span></span> pq_def <span class="keyword2"><span class="keyword">and</span></span> pp'_def <span class="keyword2"><span class="keyword">and</span></span> pq'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 endpoint_in_S_swap<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pa</span> <span class="skolem">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pa'</span> <span class="skolem">l'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pd</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pd'</span> <span class="main">∈</span> hyp2"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pd_def <span class="keyword2"><span class="keyword">and</span></span> pd'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 perp_foot_hyp2 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?pa</span></span></span> <span class="quoted"><span class="skolem">l</span></span> <span class="var"><span class="quoted"><span class="var">?pc</span></span></span><span class="main"><span class="main">]</span></span>
      perp_foot_hyp2 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?pa'</span></span></span> <span class="quoted"><span class="skolem">l'</span></span> <span class="var"><span class="quoted"><span class="var">?pc'</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pa</span> <span class="skolem">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pa'</span> <span class="skolem">l'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">∈</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span> <span class="main">∈</span> S"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ps_def <span class="keyword2"><span class="keyword">and</span></span> ps'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 perp_up_in_S <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?pc</span></span></span> <span class="var"><span class="quoted"><span class="var">?pa</span></span></span> <span class="quoted"><span class="skolem">l</span></span><span class="main"><span class="main">]</span></span>
      perp_up_in_S <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?pc'</span></span></span> <span class="var"><span class="quoted"><span class="var">?pa'</span></span></span> <span class="quoted"><span class="skolem">l'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pd</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pp</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ps</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pd</span> <span class="main">≠</span> <span class="skolem">pp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pa</span> <span class="main">≠</span> <span class="skolem">pp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pb</span> <span class="main">≠</span> <span class="skolem">pp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pd</span> <span class="main">≠</span> <span class="skolem">ps</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 hyp2_S_not_equal<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pq</span> <span class="main">∈</span> S›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqJ</span> <span class="main">∈</span> S"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_K2_isometry_def<span class="main">)</span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pd</span> <span class="main">≠</span> <span class="skolem">pp</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">pd</span> <span class="skolem">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">pp</span> <span class="skolem">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">pd'</span> <span class="skolem">l'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">pp'</span> <span class="skolem">l'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lJ</span> <span class="main">=</span> <span class="skolem">l'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pdJ</span> <span class="main">=</span> <span class="skolem">pd'</span>›</span></span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ppJ</span> <span class="main">=</span> <span class="skolem">pp'</span>›</span></span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> apply_cltn2_line_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">pq</span> <span class="skolem">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pa</span> <span class="skolem">l</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pb</span> <span class="skolem">l</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pqJ</span> <span class="skolem">l'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?paJ</span> <span class="skolem">l'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pbJ</span> <span class="skolem">l'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> <span class="quoted"><span class="quoted">‹<span class="var">?lJ</span> <span class="main">=</span> <span class="skolem">l'</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa'</span> <span class="main">≠</span> <span class="var">?pb'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pqJ</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pa'</span> <span class="skolem">l'</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pb'</span> <span class="skolem">l'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pqJ</span> <span class="skolem">l'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqJ</span> <span class="main">=</span> <span class="skolem">pp'</span> <span class="main">∨</span> <span class="var">?pqJ</span> <span class="main">=</span> <span class="skolem">pq'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pp'_def <span class="keyword2"><span class="keyword">and</span></span> pq'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 endpoints_in_S_incident_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pp</span> <span class="main">≠</span> <span class="skolem">pq</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> apply_cltn2_injective
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp'</span> <span class="main">≠</span> <span class="var">?pqJ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> <span class="quoted"><span class="quoted">‹<span class="var">?ppJ</span> <span class="main">=</span> <span class="skolem">pp'</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqJ</span> <span class="main">=</span> <span class="skolem">pq'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa'</span> <span class="main">≠</span> <span class="var">?pb'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="skolem">pd'</span> <span class="var">?pa'</span>
    <span class="main">=</span> <span class="main">(</span>cosh_dist <span class="var">?pb'</span> <span class="var">?pc'</span> <span class="main">*</span> sqrt <span class="main">(</span>exp_2dist <span class="var">?pa'</span> <span class="var">?pb'</span><span class="main">)</span> <span class="main">-</span> cosh_dist <span class="var">?pa'</span> <span class="var">?pc'</span><span class="main">)</span>
      <span class="main">/</span> <span class="main">(</span>cosh_dist <span class="var">?pa'</span> <span class="var">?pc'</span> <span class="main">*</span> exp_2dist <span class="var">?pa'</span> <span class="var">?pb'</span>
        <span class="main">-</span> cosh_dist <span class="var">?pb'</span> <span class="var">?pc'</span> <span class="main">*</span> sqrt <span class="main">(</span>exp_2dist <span class="var">?pa'</span> <span class="var">?pb'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pp'_def <span class="keyword2"><span class="keyword">and</span></span> pq'_def <span class="keyword2"><span class="keyword">and</span></span> pd'_def <span class="keyword2"><span class="keyword">and</span></span> l'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 perp_foot_cross_ratio_formula<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>cosh_dist <span class="var">?pb</span> <span class="var">?pc</span> <span class="main">*</span> sqrt <span class="main">(</span>exp_2dist <span class="var">?pa</span> <span class="var">?pb</span><span class="main">)</span> <span class="main">-</span> cosh_dist <span class="var">?pa</span> <span class="var">?pc</span><span class="main">)</span>
    <span class="main">/</span> <span class="main">(</span>cosh_dist <span class="var">?pa</span> <span class="var">?pc</span> <span class="main">*</span> exp_2dist <span class="var">?pa</span> <span class="var">?pb</span>
      <span class="main">-</span> cosh_dist <span class="var">?pb</span> <span class="var">?pc</span> <span class="main">*</span> sqrt <span class="main">(</span>exp_2dist <span class="var">?pa</span> <span class="var">?pb</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_hyp2_C_exp_2dist real_hyp2_C_cosh_dist<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">≠</span> <span class="var">?pb</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cross_ratio <span class="skolem">pp</span> <span class="skolem">pq</span> <span class="skolem">pd</span> <span class="var">?pa</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pp_def <span class="keyword2"><span class="keyword">and</span></span> pq_def <span class="keyword2"><span class="keyword">and</span></span> pd_def <span class="keyword2"><span class="keyword">and</span></span> l_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 perp_foot_cross_ratio_formula<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="skolem">pp</span><span class="main">,</span><span class="skolem">pq</span><span class="main">,</span><span class="skolem">pd</span><span class="main">,</span><span class="var">?pa</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pp</span> <span class="main">≠</span> <span class="skolem">pq</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pd</span> <span class="main">≠</span> <span class="skolem">pp</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">≠</span> <span class="skolem">pp</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cross_ratio <span class="var">?ppJ</span> <span class="var">?pqJ</span> <span class="var">?pdJ</span> <span class="var">?paJ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cross_ratio_cltn2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ppJ</span> <span class="main">=</span> <span class="skolem">pp'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pqJ</span> <span class="main">=</span> <span class="skolem">pq'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pdJ</span> <span class="main">=</span> <span class="skolem">pd'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cross_ratio <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="skolem">pd'</span> <span class="var">?paJ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="skolem">pd'</span> <span class="var">?paJ</span> <span class="main">=</span> cross_ratio <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="skolem">pd'</span> <span class="var">?pa'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?paJ</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pbJ</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pcJ</span> <span class="main">∈</span> hyp2"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> apply_cltn2_Rep_hyp2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">pp'</span> <span class="skolem">l'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">pq'</span> <span class="skolem">l'</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">pd'</span> <span class="skolem">l'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?paJ</span> <span class="skolem">l'</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pa'</span> <span class="skolem">l'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pbJ</span> <span class="skolem">l'</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pb'</span> <span class="skolem">l'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="skolem">pp'</span><span class="main">,</span><span class="skolem">pq'</span><span class="main">,</span><span class="skolem">pd'</span><span class="main">,</span><span class="var">?paJ</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="skolem">pp'</span><span class="main">,</span><span class="skolem">pq'</span><span class="main">,</span><span class="skolem">pd'</span><span class="main">,</span><span class="var">?pa'</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="skolem">pp'</span><span class="main">,</span><span class="skolem">pq'</span><span class="main">,</span><span class="var">?pa'</span><span class="main">,</span><span class="var">?pbJ</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="skolem">pp'</span><span class="main">,</span><span class="skolem">pq'</span><span class="main">,</span><span class="var">?pa'</span><span class="main">,</span><span class="var">?pb'</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_set_Col_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">l'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pp'</span> <span class="main">≠</span> <span class="skolem">pq'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pp'</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pq'</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pd'</span> <span class="main">∈</span> hyp2›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?paJ</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pbJ</span> <span class="main">∈</span> hyp2›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="skolem">pd'</span> <span class="var">?paJ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="skolem">pd'</span> <span class="var">?pa'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="var">?pa'</span> <span class="var">?pbJ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"are_endpoints_in_S <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="var">?pa'</span> <span class="var">?pb'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> are_endpoints_in_S_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="skolem">pd'</span> <span class="var">?paJ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="skolem">pd'</span> <span class="var">?pa'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="var">?pa'</span> <span class="var">?pbJ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="var">?pa'</span> <span class="var">?pb'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> are_endpoints_in_S_cross_ratio_correct<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="skolem">pd'</span> <span class="var">?paJ</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="skolem">pd'</span> <span class="var">?pa'</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹cross_ratio <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="skolem">pd'</span> <span class="var">?paJ</span> <span class="main">=</span> cross_ratio <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="skolem">pd'</span> <span class="var">?pa'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?paJ</span> <span class="main">=</span> <span class="var">?pa'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cross_ratio_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ppJ</span> <span class="main">=</span> <span class="skolem">pp'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pqJ</span> <span class="main">=</span> <span class="skolem">pq'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="var">?pa'</span> <span class="var">?pbJ</span> <span class="main">=</span> cross_ratio <span class="var">?ppJ</span> <span class="var">?pqJ</span> <span class="var">?paJ</span> <span class="var">?pbJ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_set_Col <span class="main">{</span><span class="skolem">pp</span><span class="main">,</span><span class="skolem">pq</span><span class="main">,</span><span class="var">?pa</span><span class="main">,</span><span class="var">?pb</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pp</span> <span class="main">≠</span> <span class="skolem">pq</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pa</span> <span class="main">≠</span> <span class="skolem">pp</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pb</span> <span class="main">≠</span> <span class="skolem">pp</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cross_ratio <span class="skolem">pp</span> <span class="skolem">pq</span> <span class="var">?pa</span> <span class="var">?pb</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_cltn2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="free">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">a'</span> <span class="free">b'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cross_ratio <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="var">?pa'</span> <span class="var">?pb'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pp_def pq_def pp'_def pq'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_hyp2_C_cross_ratio_endpoints_in_S<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="var">?pa'</span> <span class="var">?pbJ</span> <span class="main">=</span> cross_ratio <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="var">?pa'</span> <span class="var">?pb'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="var">?pa'</span> <span class="var">?pbJ</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="skolem">pp'</span> <span class="skolem">pq'</span> <span class="var">?pa'</span> <span class="var">?pb'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pbJ</span> <span class="main">=</span> <span class="var">?pb'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_unique<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?pc</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="skolem">pd</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="skolem">ps</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cc'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?pc'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cd'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="skolem">pd'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cs'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="skolem">ps'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?ccJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?pcJ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cdJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?pdJ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?csJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="var">?psJ</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pa</span> <span class="skolem">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pa'</span> <span class="skolem">l'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cd</span> <span class="var">?cc</span> <span class="var">?cs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cd'</span> <span class="var">?cc'</span> <span class="var">?cs'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pd_def <span class="keyword2"><span class="keyword">and</span></span> ps_def <span class="keyword2"><span class="keyword">and</span></span> pd'_def <span class="keyword2"><span class="keyword">and</span></span> ps'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 perp_up_at_end <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?pc</span></span></span> <span class="var"><span class="quoted"><span class="var">?pa</span></span></span> <span class="quoted"><span class="skolem">l</span></span><span class="main"><span class="main">]</span></span>
      perp_up_at_end <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?pc'</span></span></span> <span class="var"><span class="quoted"><span class="var">?pa'</span></span></span> <span class="quoted"><span class="skolem">l'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pd</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ps</span> <span class="main">∈</span> S›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cd</span> <span class="var">?cc</span> <span class="var">?cs</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cdJ</span> <span class="var">?ccJ</span> <span class="var">?csJ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 statement_63<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cd'</span> <span class="var">?ccJ</span> <span class="var">?cs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> <span class="quoted"><span class="quoted">‹<span class="var">?pdJ</span> <span class="main">=</span> <span class="skolem">pd'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?psJ</span> <span class="main">=</span> <span class="skolem">ps'</span>›</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?paJ</span> <span class="main">=</span> <span class="var">?pa'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="var">?pa'</span> <span class="var">?pcJ</span> <span class="main">=</span> cosh_dist <span class="var">?paJ</span> <span class="var">?pcJ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cosh_dist <span class="var">?pa</span> <span class="var">?pc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 K2_isometry_cosh_dist<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="free">c</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">a'</span> <span class="free">c'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cosh_dist <span class="var">?pa'</span> <span class="var">?pc'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_hyp2_C_cosh_dist<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="var">?pa'</span> <span class="var">?pcJ</span> <span class="main">=</span> cosh_dist <span class="var">?pa'</span> <span class="var">?pc'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"M_perp <span class="skolem">l'</span> <span class="skolem">m'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> m'_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> drop_perp_perp<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pc</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pc'</span> <span class="skolem">m'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> m_def m'_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> drop_perp_incident<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pa</span> <span class="skolem">l</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pa'</span> <span class="skolem">l'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">ps</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">ps'</span> <span class="skolem">m'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ps_def <span class="keyword2"><span class="keyword">and</span></span> m_def <span class="keyword2"><span class="keyword">and</span></span> ps'_def <span class="keyword2"><span class="keyword">and</span></span> m'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 perp_up_incident <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?pc</span></span></span> <span class="var"><span class="quoted"><span class="var">?pa</span></span></span> <span class="quoted"><span class="skolem">l</span></span><span class="main"><span class="main">]</span></span>
      perp_up_incident <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?pc'</span></span></span> <span class="var"><span class="quoted"><span class="var">?pa'</span></span></span> <span class="quoted"><span class="skolem">l'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pd</span> <span class="main">≠</span> <span class="skolem">ps</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">pd</span> <span class="skolem">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">pd'</span> <span class="skolem">m'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?mJ</span> <span class="main">=</span> <span class="skolem">m'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pdJ</span> <span class="main">=</span> <span class="skolem">pd'</span>›</span></span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?psJ</span> <span class="main">=</span> <span class="skolem">ps'</span>›</span></span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apply_cltn2_line_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pc</span> <span class="skolem">m</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="var">?pcJ</span> <span class="skolem">m'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> <span class="quoted"><span class="quoted">‹<span class="var">?mJ</span> <span class="main">=</span> <span class="skolem">m'</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹M_perp <span class="skolem">l'</span> <span class="skolem">m'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> Rep_hyp2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a'</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pd'</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pcJ</span> <span class="main">∈</span> hyp2›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Rep_hyp2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c'</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pa'</span> <span class="skolem">l'</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">pd'</span> <span class="skolem">l'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="skolem">pd'</span> <span class="skolem">m'</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹proj2_incident <span class="var">?pc'</span> <span class="skolem">m'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="skolem">pd'</span> <span class="var">?pcJ</span> <span class="main">=</span> cosh_dist <span class="var">?pa'</span> <span class="var">?pcJ</span> <span class="main">/</span> cosh_dist <span class="skolem">pd'</span> <span class="var">?pa'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="skolem">pd'</span> <span class="var">?pc'</span> <span class="main">=</span> cosh_dist <span class="var">?pa'</span> <span class="var">?pc'</span> <span class="main">/</span> cosh_dist <span class="skolem">pd'</span> <span class="var">?pa'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cosh_dist_perp_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cosh_dist <span class="var">?pa'</span> <span class="var">?pcJ</span> <span class="main">=</span> cosh_dist <span class="var">?pa'</span> <span class="var">?pc'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="skolem">pd'</span> <span class="var">?pcJ</span> <span class="main">=</span> cosh_dist <span class="skolem">pd'</span> <span class="var">?pc'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pd'</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pcJ</span> <span class="main">∈</span> hyp2›</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pc'</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ps'</span> <span class="main">∈</span> S›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cd'</span> <span class="var">?ccJ</span> <span class="var">?cs'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cd'</span> <span class="var">?cc'</span> <span class="var">?cs'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pcJ</span> <span class="main">=</span> <span class="var">?pc'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cosh_dist_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?paJ</span> <span class="main">=</span> <span class="var">?pa'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pbJ</span> <span class="main">=</span> <span class="var">?pb'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="free">a</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">a'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="free">b</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">b'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="free">c</span> <span class="skolem">J</span> <span class="main">=</span> <span class="free">c'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> hyp2_cltn2_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">J</span><span class="main">.</span> is_K2_isometry <span class="bound">J</span>
    <span class="main">∧</span> hyp2_cltn2 <span class="free">a</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">a'</span> <span class="main">∧</span> hyp2_cltn2 <span class="free">b</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">b'</span> <span class="main">∧</span> hyp2_cltn2 <span class="free">c</span> <span class="bound">J</span> <span class="main">=</span> <span class="free">c'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">J</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hyp2_axiom5<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">a'</span> <span class="bound">b'</span> <span class="bound">c'</span> <span class="bound">d'</span><span class="main">.</span>
  <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a'</span> <span class="bound">b'</span> <span class="bound">c'</span> <span class="main">∧</span> <span class="bound">a</span> <span class="bound">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a'</span> <span class="bound">b'</span> <span class="main">∧</span> <span class="bound">b</span> <span class="bound">c</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">b'</span> <span class="bound">c'</span>
    <span class="main">∧</span> <span class="bound">a</span> <span class="bound">d</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a'</span> <span class="bound">d'</span> <span class="main">∧</span> <span class="bound">b</span> <span class="bound">d</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">b'</span> <span class="bound">d'</span>
  <span class="main">⟶</span> <span class="bound">c</span> <span class="bound">d</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">c'</span> <span class="bound">d'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">standard</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">b'</span> <span class="skolem">c'</span>
    <span class="main">∧</span> <span class="skolem">a</span> <span class="skolem">d</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a'</span> <span class="skolem">d'</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="skolem">d</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">b'</span> <span class="skolem">d'</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a'</span> <span class="skolem">b'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">c</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">b'</span> <span class="skolem">c'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">d</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a'</span> <span class="skolem">d'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">d</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">b'</span> <span class="skolem">d'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a'</span> <span class="skolem">b'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="skolem">d</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">b'</span> <span class="skolem">d'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="skolem">d</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a'</span> <span class="skolem">d'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> statement69 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">a'</span></span> <span class="quoted"><span class="skolem">b'</span></span> <span class="quoted"><span class="skolem">d</span></span> <span class="quoted"><span class="skolem">d'</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_K2_isometry <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">a</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">a'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">b</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">b'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">d</span> <span class="skolem">J</span> <span class="main">=</span> <span class="skolem">d'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?aJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">a</span> <span class="skolem">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?bJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">b</span> <span class="skolem">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">c</span> <span class="skolem">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?dJ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_cltn2 <span class="skolem">d</span> <span class="skolem">J</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a'</span> <span class="skolem">b'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">≠</span> <span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2.A3'<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="var">?aJ</span> <span class="var">?bJ</span> <span class="var">?cJ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_hyp2_B_hyp2_cltn2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="var">?cJ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> <span class="quoted"><span class="quoted">‹<span class="var">?aJ</span> <span class="main">=</span> <span class="skolem">a'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?bJ</span> <span class="main">=</span> <span class="skolem">b'</span>›</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">c</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="var">?bJ</span> <span class="var">?cJ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_hyp2_C_hyp2_cltn2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">c</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">b'</span> <span class="var">?cJ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> <span class="quoted"><span class="quoted">‹<span class="var">?bJ</span> <span class="main">=</span> <span class="skolem">b'</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="skolem">c</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">b'</span> <span class="skolem">c'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="var">?cJ</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">b'</span> <span class="skolem">c'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2.A2'<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">≠</span> <span class="skolem">b'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="var">?cJ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cJ</span> <span class="main">=</span> <span class="skolem">c'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2_extend_segment_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_K2_isometry <span class="skolem">J</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="skolem">d</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">c'</span> <span class="skolem">d'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cJ</span> <span class="main">=</span> <span class="skolem">c'</span>›</span></span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?dJ</span> <span class="main">=</span> <span class="skolem">d'</span>›</span></span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_hyp2_C_hyp2_cltn2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> hyp2<span class="main">:</span> tarski_first5 <span class="quoted">real_hyp2_C</span> <span class="quoted">real_hyp2_B</span>
  <span class="keyword1"><span class="command">using</span></span> hyp2_axiom4 <span class="keyword2"><span class="keyword">and</span></span> hyp2_axiom5
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Klein--Beltrami model satisfies axioms 6, 7, and 11›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hyp2_axiom6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">a</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">standard</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ca</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="main">(</span>Rep_hyp2 <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cart2_pt <span class="main">(</span>Rep_hyp2 <span class="skolem">b</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?ca</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_hyp2_B_def hyp2_rep_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ca</span> <span class="main">=</span> <span class="var">?cb</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_euclid.A6'<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="skolem">a</span> <span class="main">=</span> Rep_hyp2 <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 hyp2_S_cart2_inj<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Rep_hyp2_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> between_inverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>hyp2_rep <span class="free">p</span><span class="main">)</span> <span class="free">v</span> <span class="main">(</span>hyp2_rep <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="main">(</span>hyp2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?u</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?w</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> norm_hyp2_rep_lt_1<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?u</span> <span class="free">v</span> <span class="var">?w</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">-</span> <span class="var">?u</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?w</span> <span class="main">-</span> <span class="var">?u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_euclid_B_def<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">-</span> <span class="var">?u</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?w</span> <span class="main">-</span> <span class="var">?u</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?w</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">v</span> <span class="main">≤</span> norm <span class="main">(</span><span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?w</span><span class="main">)</span> <span class="main">+</span> norm <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> norm_triangle_ineq <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≤</span> <span class="main">1</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">v</span> <span class="main">≤</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> norm <span class="var">?w</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> norm <span class="var">?u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">v</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?w</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?u</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="var">?u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹norm <span class="var">?u</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">v</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹norm <span class="var">?w</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> norm <span class="var">?w</span> <span class="main">&lt;</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹norm <span class="var">?u</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≤</span> <span class="main">1</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> mult_mono <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?u</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> norm <span class="var">?u</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> norm <span class="var">?w</span> <span class="main">&lt;</span> <span class="skolem">l</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> norm <span class="var">?w</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> norm <span class="var">?u</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹norm <span class="free">v</span> <span class="main">≤</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> norm <span class="var">?w</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> norm <span class="var">?u</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">v</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="main">(</span>hyp2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2_rep_abs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> between_switch<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="main">(</span>hyp2_rep <span class="free">p</span><span class="main">)</span> <span class="free">v</span> <span class="main">(</span>hyp2_rep <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">p</span> <span class="main">(</span>hyp2_abs <span class="free">v</span><span class="main">)</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="main">(</span>hyp2_abs <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> between_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">p</span> <span class="main">(</span>hyp2_abs <span class="free">v</span><span class="main">)</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_hyp2_B_def<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hyp2_axiom7<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">p</span> <span class="bound">c</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">b</span> <span class="bound">q</span> <span class="bound">c</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">p</span> <span class="bound">x</span> <span class="bound">b</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">q</span> <span class="bound">x</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">p</span> <span class="skolem">q</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ca</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="skolem">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="skolem">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="skolem">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="skolem">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="skolem">q</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a</span> <span class="skolem">p</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">b</span> <span class="skolem">q</span> <span class="skolem">c</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cp</span> <span class="var">?cc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cb</span> <span class="var">?cq</span> <span class="var">?cc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_hyp2_B_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> real_euclid.A7' <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?ca</span></span></span> <span class="var"><span class="quoted"><span class="var">?cp</span></span></span> <span class="var"><span class="quoted"><span class="var">?cc</span></span></span> <span class="var"><span class="quoted"><span class="var">?cb</span></span></span> <span class="var"><span class="quoted"><span class="var">?cq</span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cx</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cp</span> <span class="skolem">cx</span> <span class="var">?cb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cq</span> <span class="skolem">cx</span> <span class="var">?ca</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">p</span> <span class="main">(</span>hyp2_abs <span class="skolem">cx</span><span class="main">)</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">q</span> <span class="main">(</span>hyp2_abs <span class="skolem">cx</span><span class="main">)</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> between_switch<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">p</span> <span class="bound">x</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">q</span> <span class="bound">x</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"hyp2_abs <span class="skolem">cx</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hyp2_axiom11<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>
  <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">x</span> <span class="bound">b</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hyp2 set"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>
    <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">x</span> <span class="bound">b</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>
      <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">x</span> <span class="bound">b</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>
      <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">x</span> <span class="bound">b</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cX</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="main">`</span> <span class="skolem">X</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cY</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="main">`</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?ca</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="skolem">a</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cw</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="skolem">w</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cz</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="skolem">z</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a</span> <span class="bound">x</span> <span class="bound">y</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">cx</span> <span class="bound">cy</span><span class="main">.</span> <span class="bound">cx</span> <span class="main">∈</span> <span class="var">?cX</span> <span class="main">∧</span> <span class="bound">cy</span> <span class="main">∈</span> <span class="var">?cY</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="bound">cx</span> <span class="bound">cy</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_hyp2_B_def<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> real_euclid.A11' <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?cX</span></span></span> <span class="var"><span class="quoted"><span class="var">?cY</span></span></span> <span class="var"><span class="quoted"><span class="var">?ca</span></span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">cx</span> <span class="bound">cy</span><span class="main">.</span> <span class="bound">cx</span> <span class="main">∈</span> <span class="var">?cX</span> <span class="main">∧</span> <span class="bound">cy</span> <span class="main">∈</span> <span class="var">?cY</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">cx</span> <span class="skolem">cb</span> <span class="bound">cy</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cw</span> <span class="skolem">cb</span> <span class="var">?cz</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="main">(</span>hyp2_abs <span class="skolem">cb</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">cb</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="var">?b</span> <span class="main">=</span> <span class="skolem">cb</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> between_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">cx</span> <span class="bound">cy</span><span class="main">.</span> <span class="bound">cx</span> <span class="main">∈</span> <span class="var">?cX</span> <span class="main">∧</span> <span class="bound">cy</span> <span class="main">∈</span> <span class="var">?cY</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="bound">cx</span> <span class="skolem">cb</span> <span class="bound">cy</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">x</span> <span class="var">?b</span> <span class="bound">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_hyp2_B_def<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">x</span> <span class="bound">b</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> tarski_absolute_space <span class="quoted">real_hyp2_C</span> <span class="quoted">real_hyp2_B</span>
  <span class="keyword1"><span class="command">using</span></span> hyp2_axiom6 <span class="keyword2"><span class="keyword">and</span></span> hyp2_axiom7 <span class="keyword2"><span class="keyword">and</span></span> hyp2_axiom11
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Klein--Beltrami model satisfies the dimension-specific axioms›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hyp2_rep_abs_examples<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="main">(</span>hyp2_abs <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="var">?a</span> <span class="main">=</span> <span class="var">?ca</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="main">(</span>hyp2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> vector <span class="main">[</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">]</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="var">?b</span> <span class="main">=</span> <span class="var">?cb</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="main">(</span>hyp2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">]</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="var">?c</span> <span class="main">=</span> <span class="var">?cc</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="main">(</span>hyp2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">,</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> vector <span class="main">[</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">,</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">]</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="var">?d</span> <span class="main">=</span> <span class="var">?cd</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="main">(</span>hyp2_abs <span class="main">(</span>vector <span class="main">[</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> vector <span class="main">[</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">]</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="var">?t</span> <span class="main">=</span> <span class="var">?ct</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?ca</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?cb</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?cc</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?cd</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?ct</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> norm_vec_def L2_set_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_2 power2_eq_square<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="var">?a</span> <span class="main">=</span> <span class="var">?ca</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="var">?b</span> <span class="main">=</span> <span class="var">?cb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="var">?c</span> <span class="main">=</span> <span class="var">?cc</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="var">?d</span> <span class="main">=</span> <span class="var">?cd</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="var">?t</span> <span class="main">=</span> <span class="var">?ct</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_rep_abs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hyp2_axiom8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">∧</span> <span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">a</span> <span class="main">∧</span> <span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">c</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ca</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_abs <span class="var">?ca</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_abs <span class="var">?cb</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_abs <span class="var">?cc</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> hyp2_rep_abs_examples <span class="keyword2"><span class="keyword">and</span></span> non_Col_example
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>hyp2.Col <span class="var">?a</span> <span class="var">?b</span> <span class="var">?c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> hyp2.Col_def real_euclid.Col_def real_hyp2_B_def<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">∧</span> <span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">a</span> <span class="main">∧</span> <span class="main">¬</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">c</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> hyp2.Col_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hyp2_axiom9<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="bound">q</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="bound">q</span> <span class="main">∧</span> <span class="bound">a</span> <span class="bound">p</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">q</span> <span class="main">∧</span> <span class="bound">b</span> <span class="bound">p</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">b</span> <span class="bound">q</span> <span class="main">∧</span> <span class="bound">c</span> <span class="bound">p</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">c</span> <span class="bound">q</span>
  <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">a</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">c</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="skolem">p</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a</span> <span class="skolem">q</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="skolem">p</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">b</span> <span class="skolem">q</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="skolem">p</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">c</span> <span class="skolem">q</span>
    <span class="main">⟶</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">a</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">c</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="skolem">p</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a</span> <span class="skolem">q</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="skolem">p</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">b</span> <span class="skolem">q</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="skolem">p</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">c</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">p</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">p</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">b</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="skolem">p</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">c</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="skolem">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?pq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="skolem">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?pa</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="skolem">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?pb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="skolem">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?pc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_hyp2 <span class="skolem">c</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> proj2_line_through <span class="var">?pp</span> <span class="var">?pq</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="skolem"><span class="skolem">pt</span></span> <span class="skolem"><span class="skolem">stpq</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> drop_perp <span class="var">?pa</span> <span class="skolem">l</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">=</span> endpoint_in_S <span class="var">?pp</span> <span class="var">?pq</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">=</span> endpoint_in_S <span class="var">?pq</span> <span class="var">?pp</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">stpq</span> <span class="main">=</span> exp_2dist <span class="var">?pp</span> <span class="var">?pq</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pp</span> <span class="main">≠</span> <span class="var">?pq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2_inject<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> Rep_hyp2
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">stpq</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> stpq_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_2dist_positive<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="skolem">stpq</span> <span class="main">*</span> sqrt <span class="skolem">stpq</span> <span class="main">=</span> <span class="skolem">stpq</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> Rep_hyp2 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pp</span> <span class="main">≠</span> <span class="var">?pq</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">stpq</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> stpq_def<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_2dist_1_equal<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="var">?pa</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="var">?pb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"z_non_zero <span class="var">?pc</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hyp2 hyp2_S_z_non_zero<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">pd</span> <span class="main">∈</span> <span class="main">{</span><span class="var">?pa</span><span class="main">,</span><span class="var">?pb</span><span class="main">,</span><span class="var">?pc</span><span class="main">}</span><span class="main">.</span>
      cross_ratio <span class="skolem">ps</span> <span class="skolem">pt</span> <span class="main">(</span>perp_foot <span class="bound">pd</span> <span class="skolem">l</span><span class="main">)</span> <span class="var">?pp</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="skolem">stpq</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pd</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pd</span> <span class="main">∈</span> <span class="main">{</span><span class="var">?pa</span><span class="main">,</span><span class="var">?pb</span><span class="main">,</span><span class="var">?pc</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Rep_hyp2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pd</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pe</span></span> <span class="skolem"><span class="skolem">x</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pe</span> <span class="main">=</span> perp_foot <span class="skolem">pd</span> <span class="skolem">l</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> cosh_dist <span class="var">?pp</span> <span class="skolem">pd</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pd</span> <span class="main">∈</span> <span class="main">{</span><span class="var">?pa</span><span class="main">,</span><span class="var">?pb</span><span class="main">,</span><span class="var">?pc</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="skolem">p</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a</span> <span class="skolem">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="skolem">p</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">b</span> <span class="skolem">q</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="skolem">p</span> <span class="keyword1">\&lt;congruent&gt;<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">c</span> <span class="skolem">q</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="skolem">pd</span> <span class="var">?pp</span> <span class="main">=</span> cosh_dist <span class="skolem">pd</span> <span class="var">?pq</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_hyp2_C_cosh_dist<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pd</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> Rep_hyp2
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> cosh_dist <span class="var">?pq</span> <span class="skolem">pd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> x_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cosh_dist_swap<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> Rep_hyp2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pd</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> cosh_dist_positive <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?pp</span></span></span> <span class="quoted"><span class="skolem">pd</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> x_def<span class="main">)</span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">from</span></span> Rep_hyp2 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pd</span> <span class="main">∈</span> hyp2›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pp</span> <span class="main">≠</span> <span class="var">?pq</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="skolem">ps</span> <span class="skolem">pt</span> <span class="skolem">pe</span> <span class="var">?pp</span>
        <span class="main">=</span> <span class="main">(</span>cosh_dist <span class="var">?pq</span> <span class="skolem">pd</span> <span class="main">*</span> sqrt <span class="skolem">stpq</span> <span class="main">-</span> cosh_dist <span class="var">?pp</span> <span class="skolem">pd</span><span class="main">)</span>
        <span class="main">/</span> <span class="main">(</span>cosh_dist <span class="var">?pp</span> <span class="skolem">pd</span> <span class="main">*</span>  <span class="skolem">stpq</span> <span class="main">-</span> cosh_dist <span class="var">?pq</span> <span class="skolem">pd</span> <span class="main">*</span> sqrt <span class="skolem">stpq</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> ps_def <span class="keyword2"><span class="keyword">and</span></span> pt_def <span class="keyword2"><span class="keyword">and</span></span> pe_def <span class="keyword2"><span class="keyword">and</span></span> l_def <span class="keyword2"><span class="keyword">and</span></span> stpq_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perp_foot_cross_ratio_formula<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x_def <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> cosh_dist <span class="var">?pq</span> <span class="skolem">pd</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> sqrt <span class="skolem">stpq</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">stpq</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> sqrt <span class="skolem">stpq</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹sqrt <span class="skolem">stpq</span> <span class="main">*</span> sqrt <span class="skolem">stpq</span> <span class="main">=</span> <span class="skolem">stpq</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> sqrt <span class="skolem">stpq</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> sqrt <span class="skolem">stpq</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="skolem">stpq</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">stpq</span> <span class="main">≠</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="skolem">stpq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="skolem">ps</span> <span class="skolem">pt</span> <span class="skolem">pe</span> <span class="var">?pp</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="skolem">stpq</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="skolem">ps</span> <span class="skolem">pt</span> <span class="main">(</span>perp_foot <span class="var">?pa</span> <span class="skolem">l</span><span class="main">)</span> <span class="var">?pp</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="skolem">stpq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">pd</span> <span class="main">∈</span> <span class="main">{</span><span class="var">?pa</span><span class="main">,</span><span class="var">?pb</span><span class="main">,</span><span class="var">?pc</span><span class="main">}</span><span class="main">.</span> proj2_incident <span class="bound">pd</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pd</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pd</span> <span class="main">∈</span> <span class="main">{</span><span class="var">?pa</span><span class="main">,</span><span class="var">?pb</span><span class="main">,</span><span class="var">?pc</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Rep_hyp2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pd</span> <span class="main">∈</span> hyp2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> Rep_hyp2 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pp</span> <span class="main">≠</span> <span class="var">?pq</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> proj2_line_through_incident
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="skolem">ps</span> <span class="skolem">pt</span> <span class="var">?pp</span> <span class="main">(</span>perp_foot <span class="skolem">pd</span> <span class="skolem">l</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cross_ratio_correct <span class="skolem">ps</span> <span class="skolem">pt</span> <span class="var">?pp</span> <span class="main">(</span>perp_foot <span class="var">?pa</span> <span class="skolem">l</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> ps_def <span class="keyword2"><span class="keyword">and</span></span> pt_def <span class="keyword2"><span class="keyword">and</span></span> l_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoints_in_S_perp_foot_cross_ratio_correct<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pd</span> <span class="main">∈</span> <span class="main">{</span><span class="var">?pa</span><span class="main">,</span><span class="var">?pb</span><span class="main">,</span><span class="var">?pc</span><span class="main">}</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">pd</span> <span class="main">∈</span> <span class="main">{</span><span class="var">?pa</span><span class="main">,</span><span class="var">?pb</span><span class="main">,</span><span class="var">?pc</span><span class="main">}</span><span class="main">.</span>
        cross_ratio <span class="skolem">ps</span> <span class="skolem">pt</span> <span class="main">(</span>perp_foot <span class="bound">pd</span> <span class="skolem">l</span><span class="main">)</span> <span class="var">?pp</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="skolem">stpq</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="skolem">ps</span> <span class="skolem">pt</span> <span class="main">(</span>perp_foot <span class="skolem">pd</span> <span class="skolem">l</span><span class="main">)</span> <span class="var">?pp</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="skolem">stpq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cross_ratio <span class="skolem">ps</span> <span class="skolem">pt</span> <span class="main">(</span>perp_foot <span class="var">?pa</span> <span class="skolem">l</span><span class="main">)</span> <span class="var">?pp</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="skolem">stpq</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="skolem">ps</span> <span class="skolem">pt</span> <span class="main">(</span>perp_foot <span class="skolem">pd</span> <span class="skolem">l</span><span class="main">)</span> <span class="var">?pp</span>
        <span class="main">=</span> cross_ratio <span class="skolem">ps</span> <span class="skolem">pt</span> <span class="main">(</span>perp_foot <span class="var">?pa</span> <span class="skolem">l</span><span class="main">)</span> <span class="var">?pp</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="skolem">ps</span> <span class="skolem">pt</span> <span class="var">?pp</span> <span class="main">(</span>perp_foot <span class="skolem">pd</span> <span class="skolem">l</span><span class="main">)</span>
        <span class="main">=</span> cross_ratio <span class="skolem">ps</span> <span class="skolem">pt</span> <span class="var">?pp</span> <span class="main">(</span>perp_foot <span class="var">?pa</span> <span class="skolem">l</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cross_ratio_swap_34 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">ps</span></span> <span class="quoted"><span class="skolem">pt</span></span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?pp</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="skolem">ps</span> <span class="skolem">pt</span> <span class="var">?pp</span> <span class="main">(</span>perp_foot <span class="skolem">pd</span> <span class="skolem">l</span><span class="main">)</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹cross_ratio_correct <span class="skolem">ps</span> <span class="skolem">pt</span> <span class="var">?pp</span> <span class="main">(</span>perp_foot <span class="var">?pa</span> <span class="skolem">l</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perp_foot <span class="skolem">pd</span> <span class="skolem">l</span> <span class="main">=</span> perp_foot <span class="var">?pa</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cross_ratio_unique<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> Rep_hyp2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pd</span> <span class="main">∈</span> hyp2›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> proj2_line_through_incident <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?pp</span></span></span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?pq</span></span></span></span></span><span class="main">]</span>
        <span class="keyword2"><span class="keyword">and</span></span> perp_foot_eq_implies_drop_perp_eq <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?pp</span></span></span> <span class="quoted"><span class="skolem">pd</span></span> <span class="quoted"><span class="skolem">l</span></span> <span class="var"><span class="quoted"><span class="var">?pa</span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"drop_perp <span class="skolem">pd</span> <span class="skolem">l</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> m_def l_def<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> drop_perp_incident <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">pd</span></span> <span class="quoted"><span class="skolem">l</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj2_incident <span class="skolem">pd</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_set_Col <span class="main">{</span><span class="var">?pa</span><span class="main">,</span><span class="var">?pb</span><span class="main">,</span><span class="var">?pc</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> proj2_set_Col_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proj2_Col <span class="var">?pa</span> <span class="var">?pb</span> <span class="var">?pc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_Col_iff_set_Col<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="var">?pa</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="var">?pb</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹z_non_zero <span class="var">?pc</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_euclid.Col <span class="main">(</span>hyp2_rep <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>hyp2_rep <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>hyp2_rep <span class="skolem">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> hyp2_rep_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj2_Col_iff_euclid_cart2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">a</span> <span class="main">∨</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">c</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_hyp2_B_def real_euclid.Col_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> hyp2<span class="main">:</span> tarski_absolute <span class="quoted">real_hyp2_C</span> <span class="quoted">real_hyp2_B</span>
  <span class="keyword1"><span class="command">using</span></span> hyp2_axiom8 <span class="keyword2"><span class="keyword">and</span></span> hyp2_axiom9
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Klein--Beltrami model violates the Euclidean axiom›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hyp2_axiom10_false<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">t</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">d</span> <span class="bound">t</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">b</span> <span class="bound">d</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">d</span>
  <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">x</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">c</span> <span class="bound">y</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">x</span> <span class="bound">t</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">t</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">d</span> <span class="bound">t</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">b</span> <span class="bound">d</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">d</span>
    <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">x</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">c</span> <span class="bound">y</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">x</span> <span class="bound">t</span> <span class="bound">y</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ca</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">,</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?ct</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vector <span class="main">[</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">]</span> <span class="main">::</span> real<span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_abs <span class="var">?ca</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_abs <span class="var">?cb</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_abs <span class="var">?cc</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_abs <span class="var">?cd</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_abs <span class="var">?ct</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cd</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?ct</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cd</span> <span class="main">-</span> <span class="var">?cb</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?cc</span> <span class="main">-</span> <span class="var">?cb</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> vector_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cd</span> <span class="var">?ct</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cb</span> <span class="var">?cd</span> <span class="var">?cc</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_euclid_B_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="var">?a</span> <span class="var">?d</span> <span class="var">?t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="var">?b</span> <span class="var">?d</span> <span class="var">?c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_hyp2_B_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_rep_abs_examples<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">≠</span> <span class="var">?d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">=</span> <span class="var">?d</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="var">?a</span> <span class="main">=</span> hyp2_rep <span class="var">?d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ca</span> <span class="main">=</span> <span class="var">?cd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_rep_abs_examples<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="var">?a</span> <span class="var">?d</span> <span class="var">?t</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="var">?b</span> <span class="var">?d</span> <span class="var">?c</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">t</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">d</span> <span class="bound">t</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">b</span> <span class="bound">d</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">d</span>
    <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">x</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">a</span> <span class="bound">c</span> <span class="bound">y</span> <span class="main">∧</span> <span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="bound">x</span> <span class="bound">t</span> <span class="bound">y</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="var">?a</span> <span class="var">?b</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="var">?a</span> <span class="var">?c</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">x</span> <span class="var">?t</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="skolem">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cy</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hyp2_rep <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="var">?a</span> <span class="var">?b</span> <span class="skolem">x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="var">?a</span> <span class="var">?c</span> <span class="skolem">y</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>K</sub></span> <span class="skolem">x</span> <span class="var">?t</span> <span class="skolem">y</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cx</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cc</span> <span class="var">?cy</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cx</span> <span class="var">?ct</span> <span class="var">?cy</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_hyp2_B_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp2_rep_abs_examples<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cb</span> <span class="var">?cx</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?ca</span> <span class="var">?cc</span> <span class="var">?cy</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">B<span class="hidden">⇩</span><sub>ℝ</sub></span> <span class="var">?cx</span> <span class="var">?ct</span> <span class="var">?cy</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cb</span> <span class="main">-</span> <span class="var">?ca</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?cx</span> <span class="main">-</span> <span class="var">?ca</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cc</span> <span class="main">-</span> <span class="var">?ca</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?cy</span> <span class="main">-</span> <span class="var">?ca</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ct</span> <span class="main">-</span> <span class="var">?cx</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?cy</span> <span class="main">-</span> <span class="var">?cx</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> real_euclid_B_def<span class="main">)</span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cb</span> <span class="main">-</span> <span class="var">?ca</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?cx</span> <span class="main">-</span> <span class="var">?ca</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cc</span> <span class="main">-</span> <span class="var">?ca</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?cy</span> <span class="main">-</span> <span class="var">?ca</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff forall_2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cb</span> <span class="main">-</span> <span class="var">?ca</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?cx</span> <span class="main">-</span> <span class="var">?ca</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cc</span> <span class="main">-</span> <span class="var">?ca</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?cy</span> <span class="main">-</span> <span class="var">?ca</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cx</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cy</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cx</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cy</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ct</span> <span class="main">-</span> <span class="var">?cx</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?cy</span> <span class="main">-</span> <span class="var">?cx</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ct</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cx</span> <span class="main">+</span> <span class="skolem">l</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?cy</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cx</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cy</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ct</span><span class="main">$</span><span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?cx</span><span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ct</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="var">?cy</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="var">?cy</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?cx</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cx</span><span class="main">$</span><span class="main">1</span> <span class="main">≤</span> <span class="main">¦</span><span class="var">?cx</span><span class="main">$</span><span class="main">1</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> norm <span class="var">?cx</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> component_le_norm_cart<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> norm_hyp2_rep_lt_1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cx</span><span class="main">$</span><span class="main">1</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> mult_less_cancel_left <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cx</span><span class="main">$</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">*</span> <span class="var">?cx</span><span class="main">$</span><span class="main">1</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?cx</span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cy</span><span class="main">$</span><span class="numeral">2</span> <span class="main">≤</span> <span class="main">¦</span><span class="var">?cy</span><span class="main">$</span><span class="numeral">2</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> norm <span class="var">?cy</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> component_le_norm_cart<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> norm_hyp2_rep_lt_1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cy</span><span class="main">$</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> mult_less_cancel_left <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cy</span><span class="main">$</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">*</span> <span class="var">?cy</span><span class="main">$</span><span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="var">?cy</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="var">?cy</span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cy</span><span class="main">$</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cy</span><span class="main">$</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hyp2_not_tarski<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>tarski real_hyp2_C real_hyp2_B<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hyp2_axiom10_false
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> tarski_def tarski_space_def tarski_space_axioms_def<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Therefore axiom 10 is independent.›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>