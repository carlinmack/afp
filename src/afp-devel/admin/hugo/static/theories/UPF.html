<div id="Monads">
<div class="head">
<h1>Theory Monads</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * HOL-TestGen --- theorem-prover based test case generation
 *                 http://www.brucker.ch/projects/hol-testgen/
 *                                                                            
 * Monads.thy --- a base testing theory for sequential computations.
 * This file is part of HOL-TestGen.
 *
 * Copyright (c) 2005-2012 ETH Zurich, Switzerland
 *               2009-2017 Univ. Paris-Sud, France 
 *               2009-2015 Achim D. Brucker, Germany
 *               2015-2017 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Basic Monad Theory for Sequential Computations›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  Monads 
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹General Framework for Monad-based Sequence-Test›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  As such, Higher-order Logic as a purely functional specification formalism has no built-in 
  mechanism for state and state-transitions. Forms of testing involving state require therefore 
  explicit mechanisms for their treatment inside the logic; a well-known technique to model
  states inside purely functional languages are \emph{monads} made popular by Wadler and Moggi 
  and extensively used in Haskell. \HOL is powerful enough to represent the most important 
  standard monads; however, it is not possible to represent monads as such due to well-known 
  limitations of the Hindley-Milner type-system. 

  Here is a variant for state-exception monads, that models precisely transition functions with 
  preconditions. Next, we declare the state-backtrack-monad. In all of them, our concept of 
  i/o-stepping functions can be formulated; these are functions mapping input to a given monad. 
  Later on, we will build the usual concepts of:
  \begin{enumerate}
    \item deterministic i/o automata,
    \item non-deterministic i/o automata, and
    \item labelled transition systems (LTS)
  \end{enumerate}
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹State Exception Monads›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'o</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'σ</span> <span class="main">⇀</span> <span class="main">(</span><span class="tfree">'o</span> <span class="main">×</span> <span class="tfree">'σ</span><span class="main">)</span>"</span></span>        
      
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bind_SE</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'o</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o'</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o'</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">bind_SE</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">σ</span> <span class="keyword1">of</span> None <span class="main">⇒</span> None 
                                        <span class="main">|</span> Some <span class="main">(</span><span class="bound">out</span><span class="main">,</span> <span class="bound">σ'</span><span class="main">)</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">out</span> <span class="bound">σ'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span> bind_SE <span class="main">(</span><span class="quoted">"<span class="keyword1">bind<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">syntax</span></span>
          <span class="quoted">"_bind_SE"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span><span class="main">(</span><span class="tfree">'o</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub><span class="main">,</span><span class="main">(</span><span class="tfree">'o'</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub><span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o'</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span>  
                                                                          <span class="main">(</span><span class="quoted">"<span class="keyword3">(2</span> _ <span class="keyword1">←</span> _<span class="keyword1">;</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>5<span class="main">,</span>8<span class="main">,</span>8<span class="main">]</span>8<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span> 
          <span class="quoted">"<span class="free">x</span> <span class="main">←</span> <span class="free">f</span><span class="main">;</span> <span class="free">g</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> bind_SE <span class="free">f</span> <span class="main">(</span><span class="main">%</span> <span class="free">x</span> <span class="main">.</span> <span class="free">g</span><span class="main">)</span>"</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unit_SE</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'o</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span>   <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">return</span> _<span class="keyword3">)</span>"</span> 8<span class="main">)</span> 
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">unit_SE</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> Some<span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="bound">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span>   unit_SE <span class="main">(</span><span class="quoted">"<span class="keyword1">unit<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fail<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'o</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">fail<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> None<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span>   fail<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub> <span class="main">(</span><span class="quoted">"<span class="keyword1">fail<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">assert_SE</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'σ</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>bool<span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">assert_SE</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">σ</span> <span class="keyword1">then</span> Some<span class="main">(</span>True<span class="main">,</span><span class="bound">σ</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span>   assert_SE <span class="main">(</span><span class="quoted">"<span class="keyword1">assert<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">assume_SE</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'σ</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>unit<span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">assume_SE</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">∃</span><span class="bound">σ</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">σ</span> <span class="keyword1">then</span> Some<span class="main">(</span><span class="main">()</span><span class="main">,</span> <span class="keyword1">SOME</span> <span class="bound">σ</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">σ</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span>   assume_SE <span class="main">(</span><span class="quoted">"<span class="keyword1">assume<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">if_SE</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'σ</span> <span class="main">⇒</span> bool<span class="main">,</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub><span class="main">,</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub><span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">if_SE</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="bound">σ</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="bound">σ</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="bound">σ</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">notation</span></span>   if_SE   <span class="main">(</span><span class="quoted">"<span class="keyword1">if<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The standard monad theorems about unit and associativity: 
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bind_left_unit <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="bound">x</span> <span class="main">←</span> <span class="keyword1">return</span> <span class="free">a</span><span class="main">;</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_SE_def bind_SE_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> bind_right_unit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="bound">x</span> <span class="main">←</span> <span class="free">m</span><span class="main">;</span> <span class="keyword1">return</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  unit_SE_def bind_SE_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="quoted">"σ"</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="skolem">σ</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> bind_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="bound">y</span> <span class="main">←</span> <span class="main">(</span><span class="bound">x</span> <span class="main">←</span> <span class="free">m</span><span class="main">;</span> <span class="free">k</span><span class="main">)</span><span class="main">;</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">←</span> <span class="free">m</span><span class="main">;</span> <span class="main">(</span><span class="bound">y</span> <span class="main">←</span> <span class="free">k</span><span class="main">;</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_SE_def bind_SE_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="quoted">"σ"</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="skolem">σ</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  In order to express test-sequences also on the object-level and to make our theory amenable to 
  formal reasoning over test-sequences, we represent them as lists of input and generalize the 
  bind-operator of the state-exception monad accordingly. The approach is straightforward, but 
  comes with a price: we have to encapsulate all input and output data into one type. Assume that 
  we have a typed interface to a module with the operations $op_1$, $op_2$, \ldots, $op_n$ with 
  the inputs $\iota_1$, $\iota_2$, \ldots, $\iota_n$ (outputs are treated analogously). Then we 
  can encode for this interface the general input - type:
  \begin{displaymath}
    \texttt{datatype}\ \texttt{in}\ =\ op_1\ ::\ \iota_1\ |\ ...\ |\ \iota_n
  \end{displaymath}
  Obviously, we loose some type-safety in this approach; we have to express that in traces only 
  \emph{corresponding} input and output belonging to the same operation will occur; this form 
  of side-conditions have to be expressed inside \HOL. From the user perspective, this will not 
  make much difference, since junk-data resulting from too weak typing can be ruled out by adopted
  front-ends. 
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  In order to express test-sequences also on the object-level and to make our theory amenable to 
  formal reasoning over test-sequences, we represent them as lists of input and generalize the 
  bind-operator of the state-exception monad accordingly. Thus, the notion of test-sequence
  is mapped to the notion of a \emph{computation}, a semantic notion; at times we will use 
  reifications of computations, \ie{} a data-type in order to make computation amenable to
  case-splitting and meta-theoretic reasoning. To this end,  we have to encapsulate all input 
  and output data into one type. Assume that we have a typed interface to a module with
  the operations $op_1$, $op_2$, \ldots, $op_n$ with the inputs  $\iota_1$, $\iota_2$, \ldots, 
  $\iota_n$ (outputs are treated analogously).
   Then we can encode for this interface the general input - type:
  \begin{displaymath}
  \texttt{datatype}\ \texttt{in}\ =\ op_1\ ::\ \iota_1\ |\ ...\ |\ \iota_n
  \end{displaymath}
  Obviously, we loose some type-safety in this approach; we have to express
  that in traces only \emph{corresponding} input and output belonging to the 
  same operation will occur; this form of side-conditions have to be expressed
  inside \HOL. From the user perspective, this will not make much difference,
  since junk-data resulting from too weak typing can be ruled out by adopted
  front-ends.›</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Note that the subsequent notion of a test-sequence allows the io stepping 
function (and the special case of a program under test) to stop execution 
\emph{within} the sequence; such premature terminations are characterized by an 
output list which is shorter than the input list. Note that our primary
notion of multiple execution ignores failure and reports failure
steps only by missing results ...›</span></span>


<span class="keyword1"><span class="command">fun</span></span>    <span class="entity">mbind</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'ι</span> list  <span class="main">⇒</span>  <span class="main">(</span><span class="tfree">'ι</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o</span> list<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span>  
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mbind</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">iostep</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> Some<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">mbind</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">iostep</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> 
                <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">iostep</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="keyword1">of</span> 
                     None   <span class="main">⇒</span> Some<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span>
                  <span class="main">|</span>  Some <span class="main">(</span><span class="bound">out</span><span class="main">,</span> <span class="bound">σ'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">mbind</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">iostep</span></span></span> <span class="bound">σ'</span> <span class="keyword1">of</span> 
                                          None    <span class="main">⇒</span> Some<span class="main">(</span><span class="main">[</span><span class="bound">out</span><span class="main">]</span><span class="main">,</span><span class="bound">σ'</span><span class="main">)</span> 
                                        <span class="main">|</span> Some<span class="main">(</span><span class="bound">outs</span><span class="main">,</span><span class="bound">σ''</span><span class="main">)</span> <span class="main">⇒</span> Some<span class="main">(</span><span class="bound">out</span><span class="main">#</span><span class="bound">outs</span><span class="main">,</span><span class="bound">σ''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹As mentioned, this definition is fail-safe; in case of an exception, 
the current state is maintained, no result is reported. 
An alternative is the fail-strict variant <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>mbind'›</span></span></span></span> defined below.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mbind_unit <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mbind <span class="main">[]</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">return</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_SE_def<span class="main">)</span>

    
<span class="keyword1"><span class="command">lemma</span></span> mbind_nofailure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mbind <span class="free">S</span> <span class="free">f</span> <span class="free">σ</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">σ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">S</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> mbind.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>unit_SE_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a S x
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> aa b
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The fail-strict version of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>mbind'›</span></span></span></span> looks as follows:›</span></span>
<span class="keyword1"><span class="command">fun</span></span>    <span class="entity">mbind'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'ι</span> list  <span class="main">⇒</span>  <span class="main">(</span><span class="tfree">'ι</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o</span> list<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mbind'</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">iostep</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> Some<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="free">mbind'</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">iostep</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> 
                <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">iostep</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="keyword1">of</span> 
                     None   <span class="main">⇒</span> None
                  <span class="main">|</span>  Some <span class="main">(</span><span class="bound">out</span><span class="main">,</span> <span class="bound">σ'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> mbind <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">iostep</span></span></span> <span class="bound">σ'</span> <span class="keyword1">of</span> 
                                          None    <span class="main">⇒</span> None   <span class="comment1">― ‹fail-strict›</span>
                                        <span class="main">|</span> Some<span class="main">(</span><span class="bound">outs</span><span class="main">,</span><span class="bound">σ''</span><span class="main">)</span> <span class="main">⇒</span> Some<span class="main">(</span><span class="bound">out</span><span class="main">#</span><span class="bound">outs</span><span class="main">,</span><span class="bound">σ''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  mbind' as failure strict operator can be seen as a foldr on bind---if the types would  
  match \ldots 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">try_SE</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'o</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o</span> option<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">try_SE</span> <span class="free"><span class="bound"><span class="entity">ioprog</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ioprog</span></span></span> <span class="bound">σ</span> <span class="keyword1">of</span>
                                      None <span class="main">⇒</span> Some<span class="main">(</span>None<span class="main">,</span> <span class="bound">σ</span><span class="main">)</span>
                                    <span class="main">|</span> Some<span class="main">(</span><span class="bound">outs</span><span class="main">,</span> <span class="bound">σ'</span><span class="main">)</span> <span class="main">⇒</span> Some<span class="main">(</span>Some <span class="bound">outs</span><span class="main">,</span> <span class="bound">σ'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In contrast <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">mbind</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> as a failure safe operator can roughly be seen 
       as a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">foldr</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> on bind - try:
       <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>m1 ; try m2 ; try m3; ...›</span></span></span></span>. Note, that the rough equivalence only holds for
       certain predicates in the sequence - length equivalence modulo None,
       for example. However, if a conditional is added, the equivalence
       can be made precise:›</span></span>


<span class="keyword1"><span class="command">lemma</span></span> mbind_try<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="bound">x</span> <span class="main">←</span> mbind <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">S</span><span class="main">)</span> <span class="free">F</span><span class="main">;</span> <span class="free">M</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> 
   <span class="main">(</span><span class="bound">a'</span> <span class="main">←</span> try_SE<span class="main">(</span><span class="free">F</span> <span class="free">a</span><span class="main">)</span><span class="main">;</span> 
      <span class="keyword1">if</span> <span class="bound">a'</span> <span class="main">=</span> None 
      <span class="keyword1">then</span> <span class="main">(</span><span class="free">M</span> <span class="main">[]</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="main">(</span><span class="bound">x</span> <span class="main">←</span> mbind <span class="free">S</span> <span class="free">F</span><span class="main">;</span> <span class="free">M</span> <span class="main">(</span>the <span class="bound">a'</span> <span class="main">#</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bind_SE_def try_SE_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free">a</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bind_SE_def try_SE_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> aa b
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"mbind <span class="free">S</span> <span class="free">F</span> <span class="skolem">b</span>"</span></span><span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹On this basis, a symbolic evaluation scheme can be established
  that reduces <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">mbind</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>-code to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">try_SE</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>-code and If-cascades.›</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">alt_SE</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'o</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub><span class="main">,</span> <span class="main">(</span><span class="tfree">'o</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub><span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span>   <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊓<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span>"</span> 10<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1"><span class="free">⊓<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">σ</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">σ</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">σ</span>
                                      <span class="main">|</span> Some <span class="bound">H</span> <span class="main">⇒</span> Some <span class="bound">H</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">malt_SE</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'o</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">malt_SE</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> foldr alt_SE <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1">fail<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span>   malt_SE <span class="main">(</span><span class="quoted">"<span class="keyword1">⨅<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> malt_SE_mt <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">⨅<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="main">[]</span> <span class="main">=</span> <span class="keyword1">fail<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> malt_SE_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> malt_SE_cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">⨅<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">⊓<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="main">(</span><span class="keyword1">⨅<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> malt_SE_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹State-Backtrack Monads›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This subsection is still rudimentary and as such an interesting
  formal analogue to the previous monad definitions. It is doubtful that it is
  interesting for testing and as a computational structure at all. 
  Clearly more relevant is ``sequence'' instead of ``set,'' which would
  rephrase Isabelle's internal tactic concept. 
›</span></span>


<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'o</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'σ</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o</span> <span class="main">×</span> <span class="tfree">'σ</span><span class="main">)</span> set"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bind_SB</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'o</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o</span> <span class="main">⇒</span>  <span class="main">(</span><span class="tfree">'o'</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o'</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">bind_SB</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">out</span><span class="main">,</span> <span class="bound">σ</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">out</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span>   bind_SB <span class="main">(</span><span class="quoted">"<span class="keyword1">bind<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unit_SB</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'o</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">returns</span> _<span class="keyword3">)</span>"</span> 8<span class="main">)</span> 
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">unit_SB</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="bound">σ</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span>   unit_SB <span class="main">(</span><span class="quoted">"<span class="keyword1">unit<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="quoted">"_bind_SB"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span><span class="main">(</span><span class="tfree">'o</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="main">,</span><span class="main">(</span><span class="tfree">'o'</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o'</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub>"</span></span> 
                                                                         <span class="main">(</span><span class="quoted">"<span class="keyword3">(2</span> _ <span class="keyword1">:=</span> _<span class="keyword1">;</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>5<span class="main">,</span>8<span class="main">,</span>8<span class="main">]</span>8<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span> 
          <span class="quoted">"<span class="free">x</span> <span class="main">:=</span> <span class="free">f</span><span class="main">;</span> <span class="free">g</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> bind_SB <span class="free">f</span> <span class="main">(</span><span class="main">%</span> <span class="free">x</span> <span class="main">.</span> <span class="free">g</span><span class="main">)</span>"</span>

<span class="keyword1"><span class="command">lemma</span></span> bind_left_unit_SB <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="bound">x</span> <span class="main">:=</span> <span class="keyword1">returns</span> <span class="free">a</span><span class="main">;</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_SB_def bind_SB_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> bind_right_unit_SB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="bound">x</span> <span class="main">:=</span> <span class="free">m</span><span class="main">;</span> <span class="keyword1">returns</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_SB_def bind_SB_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> bind_assoc_SB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="bound">y</span> <span class="main">:=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">:=</span> <span class="free">m</span><span class="main">;</span> <span class="free">k</span><span class="main">)</span><span class="main">;</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">:=</span> <span class="free">m</span><span class="main">;</span> <span class="main">(</span><span class="bound">y</span> <span class="main">:=</span> <span class="free">k</span><span class="main">;</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_SB_def bind_SB_def split_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹State Backtrack Exception Monad›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The following combination of the previous two Monad-Constructions allows for the semantic 
  foundation of a simple generic assertion language in the style of Schirmer's Simpl-Language or 
  Rustan Leino's Boogie-PL language. The key is to use the exceptional element None for violations 
  of the assert-statement. 
›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span>  <span class="main">(</span><span class="tfree">'o</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'σ</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'o</span> <span class="main">×</span> <span class="tfree">'σ</span><span class="main">)</span> set<span class="main">)</span> option"</span></span>
      
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bind_SBE</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'o</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o'</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o'</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">bind_SBE</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">σ</span> <span class="keyword1">of</span> None <span class="main">⇒</span> None 
                                         <span class="main">|</span> Some <span class="bound">S</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">S'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">out</span><span class="main">,</span> <span class="bound">σ'</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">out</span> <span class="bound">σ'</span><span class="main">)</span> <span class="main">`</span> <span class="bound">S</span>
                                                      <span class="keyword1">in</span>  <span class="keyword1">if</span> None <span class="main">∈</span> <span class="bound">S'</span> <span class="keyword1">then</span> None
                                                          <span class="keyword1">else</span> Some<span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>the <span class="main">`</span> <span class="bound">S'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="quoted">"_bind_SBE"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span><span class="main">(</span><span class="tfree">'o</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub><span class="main">,</span><span class="main">(</span><span class="tfree">'o'</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub><span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o'</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span> 
                                                                         <span class="main">(</span><span class="quoted">"<span class="keyword3">(2</span> _ <span class="keyword1">:≡</span> _<span class="keyword1">;</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>5<span class="main">,</span>8<span class="main">,</span>8<span class="main">]</span>8<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span> 
          <span class="quoted">"<span class="free">x</span> <span class="main">:≡</span> <span class="free">f</span><span class="main">;</span> <span class="free">g</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> bind_SBE <span class="free">f</span> <span class="main">(</span><span class="main">%</span> <span class="free">x</span> <span class="main">.</span> <span class="free">g</span><span class="main">)</span>"</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unit_SBE</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'o</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'o</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span>   <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">returning</span> _<span class="keyword3">)</span>"</span> 8<span class="main">)</span> 
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">unit_SBE</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> Some<span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="bound">σ</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">assert_SBE</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'σ</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>unit<span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">assert_SBE</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">σ</span> <span class="keyword1">then</span> Some<span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="main">()</span><span class="main">,</span><span class="bound">σ</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
                                      <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span>   assert_SBE <span class="main">(</span><span class="quoted">"<span class="keyword1">assert<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">assume_SBE</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'σ</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>unit<span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">assume_SBE</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">σ</span> <span class="keyword1">then</span> Some<span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="main">()</span><span class="main">,</span><span class="bound">σ</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
                                      <span class="keyword1">else</span> Some <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span>   assume_SBE <span class="main">(</span><span class="quoted">"<span class="keyword1">assume<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">havoc_SBE</span> <span class="main">::</span> <span class="quoted"><span class="quoted">" <span class="main">(</span>unit<span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span>MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">havoc_SBE</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span>  Some<span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> True<span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span>   havoc_SBE <span class="main">(</span><span class="quoted">"<span class="keyword1">havoc<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bind_left_unit_SBE <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="bound">x</span> <span class="main">:≡</span> <span class="keyword1">returning</span> <span class="free">a</span><span class="main">;</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_SBE_def bind_SBE_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> bind_right_unit_SBE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="bound">x</span> <span class="main">:≡</span> <span class="free">m</span><span class="main">;</span> <span class="keyword1">returning</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_SBE_def bind_SBE_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> HOL.ccontr<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Set.image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
   
<span class="keyword1"><span class="command">lemmas</span></span> aux <span class="main">=</span> trans<span class="main">[</span><span class="operator">OF</span> HOL.neq_commute<span class="main">,</span><span class="operator">OF</span> Option.not_None_eq<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> bind_assoc_SBE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="bound">y</span> <span class="main">:≡</span> <span class="main">(</span><span class="bound">x</span> <span class="main">:≡</span> <span class="free">m</span><span class="main">;</span> <span class="free">k</span><span class="main">)</span><span class="main">;</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">:≡</span> <span class="free">m</span><span class="main">;</span> <span class="main">(</span><span class="bound">y</span> <span class="main">:≡</span> <span class="free">k</span><span class="main">;</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_SBE_def bind_SBE_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span>
    <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="improper">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def Set.image_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">aa</span> <span class="skolem">b</span> <span class="skolem">ab</span> <span class="skolem">ba</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">aa</span> <span class="skolem">b</span> <span class="skolem">ab</span> <span class="skolem">ba</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">aa</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>split_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">aa</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> aux image_def split_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rev_bexI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">aa</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"None <span class="main">=</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">X</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> contrapos_pp<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">aa</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> None <span class="main">≠</span> case_prod <span class="main">(</span><span class="main">λ</span><span class="bound">out</span><span class="main">.</span> <span class="free">k</span><span class="main">)</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> aux image_def split_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rev_bexI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">aa</span> <span class="skolem">b</span> <span class="skolem">ab</span> <span class="skolem">ba</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">ab</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">ba</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span>"</span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aux<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>split_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"None<span class="main">∈</span><span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">h</span><span class="main">(</span>snd <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="improper">y</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>split_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">aa</span> <span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">a</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">b</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span>"</span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aux<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>split_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"None<span class="main">∈</span><span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">h</span><span class="main">(</span>snd <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="improper">y</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>split_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span> 
  
  

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Valid Test Sequences in the State Exception Monad›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This is still an unstructured merge of executable monad concepts and specification oriented 
  high-level properties initiating test procedures. 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">valid_SE</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'σ</span> <span class="main">⇒</span> <span class="main">(</span>bool<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨</span>"</span> 15<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≠</span> None <span class="main">∧</span> fst<span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This notation consideres failures as valid---a definition inspired by I/O conformance. 
  Note that it is not possible to define this concept once and for all in a Hindley-Milner 
  type-system. For the moment, we present it only for the state-exception monad, although for 
  the same definition, this notion is applicable to other monads as well.  
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> syntax_test <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">⊨</span> <span class="main">(</span><span class="bound">os</span> <span class="main">←</span> <span class="main">(</span>mbind <span class="free">ιs</span> <span class="free">ioprog</span><span class="main">)</span><span class="main">;</span> <span class="keyword1">return</span><span class="main">(</span>length <span class="free">ιs</span> <span class="main">=</span> length <span class="bound">os</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">oops</span></span>


<span class="keyword1"><span class="command">lemma</span></span> valid_true<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="main">(</span><span class="bound">s</span> <span class="main">←</span> <span class="keyword1">return</span> <span class="free">x</span> <span class="main">;</span> <span class="keyword1">return</span> <span class="main">(</span><span class="free">P</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_SE_def unit_SE_def bind_SE_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Recall mbind\_unit for the base case.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> valid_failure<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ioprog</span> <span class="free">a</span> <span class="free">σ</span> <span class="main">=</span> None <span class="main">⟹</span> 
                                   <span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="main">(</span><span class="bound">s</span> <span class="main">←</span> mbind <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">S</span><span class="main">)</span> <span class="free">ioprog</span> <span class="main">;</span> <span class="free">M</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                                   <span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="main">(</span><span class="free">M</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_SE_def unit_SE_def bind_SE_def<span class="main">)</span>



<span class="keyword1"><span class="command">lemma</span></span> valid_failure'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="free">σ</span> <span class="main">=</span> None <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span> <span class="main">←</span> <span class="free">A</span> <span class="main">;</span> <span class="free">M</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_SE_def unit_SE_def bind_SE_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> valid_successElem<span class="main">:</span> <span class="comment1">(* atomic boolean Monad "Query Functions" *)</span> 
                         <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="free">σ</span> <span class="main">=</span> Some<span class="main">(</span><span class="free">f</span> <span class="free">σ</span><span class="main">,</span><span class="free">σ</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_SE_def unit_SE_def bind_SE_def <span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> valid_success<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">ioprog</span> <span class="free">a</span> <span class="free">σ</span> <span class="main">=</span> Some<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">σ'</span><span class="main">)</span> <span class="main">⟹</span> 
                                  <span class="main">(</span><span class="free">σ</span>  <span class="main">⊨</span> <span class="main">(</span><span class="bound">s</span> <span class="main">←</span> mbind <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">S</span><span class="main">)</span> <span class="free">ioprog</span> <span class="main">;</span> <span class="free">M</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                                  <span class="main">(</span><span class="free">σ'</span> <span class="main">⊨</span> <span class="main">(</span><span class="bound">s</span> <span class="main">←</span> mbind <span class="free">S</span> <span class="free">ioprog</span> <span class="main">;</span> <span class="free">M</span> <span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_SE_def unit_SE_def bind_SE_def <span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"mbind <span class="free">S</span> <span class="free">ioprog</span> <span class="free">σ'</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> valid_success''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ioprog</span> <span class="free">a</span> <span class="free">σ</span> <span class="main">=</span> Some<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">σ'</span><span class="main">)</span> <span class="main">⟹</span>
                                    <span class="main">(</span><span class="free">σ</span>  <span class="main">⊨</span> <span class="main">(</span><span class="bound">s</span> <span class="main">←</span> mbind <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">S</span><span class="main">)</span> <span class="free">ioprog</span> <span class="main">;</span> <span class="keyword1">return</span> <span class="main">(</span><span class="free">P</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                                    <span class="main">(</span><span class="free">σ'</span> <span class="main">⊨</span> <span class="main">(</span><span class="bound">s</span> <span class="main">←</span> mbind <span class="free">S</span> <span class="free">ioprog</span> <span class="main">;</span> <span class="keyword1">return</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_SE_def unit_SE_def bind_SE_def <span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"mbind <span class="free">S</span> <span class="free">ioprog</span> <span class="free">σ'</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> valid_success'<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="free">σ</span> <span class="main">=</span> Some<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">σ'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span> <span class="main">←</span> <span class="free">A</span> <span class="main">;</span> <span class="free">M</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ'</span> <span class="main">⊨</span> <span class="main">(</span><span class="free">M</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_SE_def unit_SE_def bind_SE_def <span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> valid_both<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="main">(</span><span class="bound">s</span> <span class="main">←</span> mbind <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">S</span><span class="main">)</span> <span class="free">ioprog</span> <span class="main">;</span> <span class="keyword1">return</span> <span class="main">(</span><span class="free">P</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                         <span class="main">(</span><span class="keyword1">case</span> <span class="free">ioprog</span> <span class="free">a</span> <span class="free">σ</span> <span class="keyword1">of</span>
                               None <span class="main">⇒</span> <span class="main">(</span><span class="free">σ</span>  <span class="main">⊨</span> <span class="main">(</span><span class="keyword1">return</span> <span class="main">(</span><span class="free">P</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">|</span> Some<span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">σ'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">σ'</span>  <span class="main">⊨</span> <span class="main">(</span><span class="bound">s</span> <span class="main">←</span> mbind <span class="free">S</span> <span class="free">ioprog</span> <span class="main">;</span> <span class="keyword1">return</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">b</span><span class="main">#</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">ioprog</span> <span class="free">a</span> <span class="free">σ</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_failure valid_success'' <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> valid_propagate_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="main">(</span><span class="keyword1">return</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_SE_def unit_SE_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> valid_propagate_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">⊨</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span> <span class="main">←</span> <span class="free">A</span> <span class="main">;</span> <span class="free">M</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">∃</span> <span class="bound">v</span> <span class="bound">σ'</span><span class="main">.</span> the<span class="main">(</span><span class="free">A</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="bound">σ'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">σ'</span> <span class="main">⊨</span> <span class="main">(</span><span class="free">M</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_SE_def unit_SE_def bind_SE_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="free">σ</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="free">σ</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted">the</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> a b aa <span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"fst <span class="improper">aa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"snd <span class="improper">aa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>          
       
<span class="keyword1"><span class="command">lemma</span></span> valid_propagate_2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">⊨</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span> <span class="main">←</span> <span class="free">A</span> <span class="main">;</span> <span class="free">M</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">a</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="bound">a</span><span class="main">)</span> <span class="main">⊨</span> <span class="main">(</span><span class="free">M</span> <span class="main">(</span>fst <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_SE_def unit_SE_def bind_SE_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="free">σ</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="free">σ</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted">the</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> a b aa x1 x2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"fst <span class="improper">aa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"snd <span class="improper">aa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> valid_propagate_2''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">⊨</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span> <span class="main">←</span> <span class="free">A</span> <span class="main">;</span> <span class="free">M</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">v</span> <span class="bound">σ'</span><span class="main">.</span> <span class="free">A</span> <span class="free">σ</span> <span class="main">=</span> Some<span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="bound">σ'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">σ'</span> <span class="main">⊨</span> <span class="main">(</span><span class="free">M</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_SE_def unit_SE_def bind_SE_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="free">σ</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="free">σ</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted">the</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> a b aa <span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"fst <span class="improper">aa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"snd <span class="improper">aa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> valid_propoagate_3<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊨</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> Some <span class="main">(</span><span class="free">f</span> <span class="bound">σ</span><span class="main">,</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="free">σ<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_SE_def <span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> valid_propoagate_3'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">σ<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊨</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> None<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_SE_def <span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> assert_disch1 <span class="main">:</span><span class="quoted"><span class="quoted">" <span class="free">P</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="main">(</span><span class="bound">x</span> <span class="main">←</span> <span class="keyword1">assert<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="free">P</span><span class="main">;</span> <span class="free">M</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="main">(</span><span class="free">M</span> True<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bind_SE_def assert_SE_def valid_SE_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> assert_disch2 <span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="free">P</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="main">(</span><span class="bound">x</span> <span class="main">←</span> <span class="keyword1">assert<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="free">P</span> <span class="main">;</span> <span class="free">M</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bind_SE_def assert_SE_def valid_SE_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> assert_disch3 <span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="free">P</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="main">(</span><span class="keyword1">assert<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bind_SE_def assert_SE_def valid_SE_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> assert_D <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="main">(</span><span class="bound">x</span> <span class="main">←</span> <span class="keyword1">assert<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="free">P</span><span class="main">;</span> <span class="free">M</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">σ</span> <span class="main">∧</span> <span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="main">(</span><span class="free">M</span> True<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bind_SE_def assert_SE_def valid_SE_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> HOL.if_split_asm<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> assume_D <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="main">(</span><span class="bound">x</span> <span class="main">←</span> <span class="keyword1">assume<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="free">P</span><span class="main">;</span> <span class="free">M</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">σ</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">σ</span> <span class="main">∧</span>  <span class="bound">σ</span> <span class="main">⊨</span> <span class="main">(</span><span class="free">M</span> <span class="main">()</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bind_SE_def assume_SE_def valid_SE_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> HOL.if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Eps <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x a b 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"True"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Hilbert_Choice.someI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Hilbert_Choice.someI<span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  These two rule prove that the SE Monad in connection with the notion of valid sequence is 
  actually sufficient for a representation of a Boogie-like language. The SBE monad with explicit
  sets of states---to be shown below---is strictly speaking not necessary (and will therefore
  be discontinued in the development). 
›</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> if_SE_D1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="keyword1">if<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="free">P</span> <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> if_SE_def valid_SE_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> if_SE_D2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="keyword1">if<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="free">P</span> <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> if_SE_def valid_SE_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> if_SE_split_asm <span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="keyword1">if<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="free">P</span> <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="free">σ</span> <span class="main">∧</span> <span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">¬</span> <span class="free">P</span> <span class="free">σ</span> <span class="main">∧</span> <span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">σ</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> if_SE_D1 if_SE_D2<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> if_SE_split <span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="keyword1">if<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="free">P</span> <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="free">σ</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="free">P</span> <span class="free">σ</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">σ</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> if_SE_D1 if_SE_D2<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span> <span class="main">⊨</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="free">m</span> <span class="free">σ</span><span class="main">)</span> <span class="keyword1">of</span> None  <span class="main">⇒</span> False <span class="main">|</span> <span class="main">(</span>Some <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span>  <span class="main">⇒</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_SE_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="free">σ</span> <span class="main">=</span> None"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> not_None_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Valid Test Sequences in the State Exception Backtrack Monad›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This is still an unstructured merge of executable monad concepts and specification oriented 
  high-level properties initiating test procedures. 
›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">valid_SBE</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'σ</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub></span>"</span> 15<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≠</span> None<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This notation considers all non-failures as valid. 
›</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> assume_assert<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="main">(</span> <span class="main"><span class="bound">_</span></span> <span class="main">:≡</span> <span class="keyword1">assume<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="free">P</span> <span class="main">;</span> <span class="keyword1">assert<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="free">σ</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="free">σ</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_SBE_def assume_SBE_def assert_SBE_def bind_SBE_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> assert_intro<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="main">(</span><span class="keyword1">assert<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>E</sub></span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_SBE_def assume_SBE_def assert_SBE_def bind_SBE_def<span class="main">)</span>
    
    
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="UPFCore">
<div class="head">
<h1>Theory UPFCore</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * HOL-TestGen --- theorem-prover based test case generation
 *                 http://www.brucker.ch/projects/hol-testgen/
 *                                                                            
 * UPF
 * This file is part of HOL-TestGen.
 *
 * Copyright (c) 2005-2012 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2017 Université Paris-Sud, France
 *               2015-2017 The University of Sheffield, UK  
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹The Core of the Unified Policy Framework (UPF)›</span></span>
<span class="keyword1"><span class="command">theory</span></span>
  UPFCore
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="Monads.html">Monads</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Foundation›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The purpose of this theory is to formalize a somewhat non-standard view
  on the fundamental concept of a security policy which is worth outlining.
  This view has arisen from prior experience in the modelling of network
  (firewall) policies. Instead of regarding policies as relations on resources,
  sets of permissions, etc., we emphasise the view that a policy is a policy
  decision function that grants or denies access to resources, permissions, etc.
  In other words, we model the concrete function that implements the policy
  decision point in a system, and which represents a "wrapper" around the
  business logic. An advantage of this view is that it is compatible
  with many different policy models, enabling a uniform modelling framework to be
  defined. Furthermore, this function is typically a large cascade of nested
  conditionals, using conditions referring to an internal state and security
  contexts of the system or a user. This cascade of conditionals can easily be
  decomposed into a set of test cases similar to transformations used for binary
  decision diagrams (BDD), and motivate equivalence class testing for unit test and 
  sequence test scenarios. From the modelling perspective, using \HOL as
  its input language, we will consequently use the expressive power of its
  underlying functional  programming language, including the possibility to
  define higher-order combinators.

  In more detail, we model policies as partial functions based on input
  data $\alpha$ (arguments, system state, security context, ...) to output
  data $\beta$: 
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'α</span> decision <span class="main">=</span> allow <span class="tfree"><span class="quoted"><span class="tfree">'α</span></span></span> <span class="main">|</span> deny <span class="tfree"><span class="quoted"><span class="tfree">'α</span></span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> policy <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span>  <span class="main">⇀</span> <span class="tfree">'β</span> decision"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">|-&gt;</span>"</span> 0<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In the following, we introduce a number of shortcuts and alternative notations.
The type of policies is represented as:›</span></span>

<span class="keyword1"><span class="command">translations</span></span> <span class="main">(</span>type<span class="main">)</span>        <span class="quoted">"<span class="tfree"><span class="free">'α</span></span> <span class="main">|-&gt;</span> <span class="tfree"><span class="free">'β</span></span>"</span> <span class="main">&lt;=</span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"<span class="tfree"><span class="free">'α</span></span>  <span class="main">⇀</span> <span class="tfree"><span class="free">'β</span></span> decision"</span>
<span class="keyword1"><span class="command">type_notation</span></span> <span class="quoted">"policy"</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">↦</span>"</span> 0<span class="main">)</span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹... allowing the notation <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'α</span></span> <span class="main"><span class="main">↦</span></span> <span class="tfree"><span class="tfree">'β</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>  for the policy type and the
alternative notations for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">None</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Some</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of the \HOL library 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'α</span></span> option"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> type:›</span></span>

<span class="keyword1"><span class="command">notation</span></span>    <span class="quoted">"None"</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span>    <span class="quoted">"Some"</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⌊</span>_<span class="keyword1">⌋</span>"</span> 80<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Thus, the range of a policy may consist of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">⌊</span></span><span class="free"><span class="free">accept</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">⌋</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> data,
  of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">⌊</span></span>deny <span class="free"><span class="free">x</span></span><span class="main"><span class="main">⌋</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> data, as well as <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">⊥</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> modeling the undefinedness
  of a policy, i.e. a policy is considered as a partial function. Partial 
  functions are used since we describe elementary policies by partial system 
  behaviour, which are glued together by operators such as function override and 
  functional composition. 
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We define the two fundamental sets, the allow-set $Allow$ and the
  deny-set $Deny$ (written $A$ and $D$ set for short), to characterize these
  two main sets of the range of a policy. 
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Allow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> decision<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">Allow</span> <span class="main">=</span> range allow"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Deny</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> decision<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">Deny</span> <span class="main">=</span> range deny"</span></span>
 

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Policy Constructors›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Most elementary policy constructors are based on the
  update operation <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] "Fun.fun_upd_def"<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Fun.fun_upd_def<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  and the maplet-notation <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">a</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">x</span></span> <span class="main"><span class="main">↦</span></span> <span class="free"><span class="free">y</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> used for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">a</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">:=</span></span><span class="main"><span class="main">⌊</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">⌋</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

  Furthermore, we add notation adopted to our problem domain:›</span></span>

<span class="keyword1"><span class="command">nonterminal</span></span> policylets <span class="keyword2"><span class="keyword">and</span></span> policylet

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_policylet1"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">]</span> <span class="main">=&gt;</span> policylet"</span></span>                 <span class="main">(</span><span class="quoted">"_ <span class="keyword3">/</span><span class="keyword1">↦<span class="hidden">⇩</span><sub>+</sub></span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
  <span class="quoted">"_policylet2"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">]</span> <span class="main">=&gt;</span> policylet"</span></span>                 <span class="main">(</span><span class="quoted">"_ <span class="keyword3">/</span><span class="keyword1">↦<span class="hidden">⇩</span><sub>-</sub></span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
  <span class="quoted">""</span>             <span class="main">::</span> <span class="quoted"><span class="quoted">"policylet <span class="main">=&gt;</span> policylets"</span></span>               <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>
  <span class="quoted">"_Maplets"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>policylet<span class="main">,</span> policylets<span class="main">]</span> <span class="main">=&gt;</span> policylets"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">,</span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
  <span class="quoted">"_Maplets"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>policylet<span class="main">,</span> policylets<span class="main">]</span> <span class="main">=&gt;</span> policylets"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">,</span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
   <span class="quoted">"_MapUpd"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">|-&gt;</span> <span class="tfree">'b</span><span class="main">,</span> policylets<span class="main">]</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">|-&gt;</span> <span class="tfree">'b</span>"</span></span>  <span class="main">(</span><span class="quoted">"_<span class="keyword3">/</span><span class="keyword1">'(</span>_<span class="keyword1">')</span>"</span> <span class="main">[</span>900<span class="main">,</span>0<span class="main">]</span>900<span class="main">)</span>
  <span class="quoted">"_emptypolicy"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">|-&gt;</span> <span class="tfree">'b</span>"</span></span>                             <span class="main">(</span><span class="quoted">"<span class="keyword1">∅</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_MapUpd <span class="free">m</span> <span class="main">(</span>_Maplets <span class="free">xy</span> <span class="free">ms</span><span class="main">)</span>"</span>   <span class="main">⇌</span> <span class="quoted">"_MapUpd <span class="main">(</span>_MapUpd <span class="free">m</span> <span class="free">xy</span><span class="main">)</span> <span class="free">ms</span>"</span>
  <span class="quoted">"_MapUpd <span class="free">m</span> <span class="main">(</span>_policylet1 <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span>  <span class="main">⇌</span> <span class="quoted">"<span class="free">m</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="keyword1">CONST</span> Some <span class="main">(</span><span class="keyword1">CONST</span> allow <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span>
  <span class="quoted">"_MapUpd <span class="free">m</span> <span class="main">(</span>_policylet2 <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span>  <span class="main">⇌</span> <span class="quoted">"<span class="free">m</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="keyword1">CONST</span> Some <span class="main">(</span><span class="keyword1">CONST</span> deny <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="main">∅</span>"</span>                            <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> Map.empty"</span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Here are some lemmas essentially showing syntactic equivalences:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> test<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∅</span><span class="main">(</span><span class="free">x</span><span class="main">↦<span class="hidden">⇩</span><sub>+</sub></span><span class="free">a</span><span class="main">,</span> <span class="free">y</span><span class="main">↦<span class="hidden">⇩</span><sub>-</sub></span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">∅</span><span class="main">(</span><span class="free">x</span> <span class="main">↦<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">a</span><span class="main">,</span> <span class="free">y</span> <span class="main">↦<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">b</span><span class="main">)</span>"</span></span>   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> test2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">(</span><span class="free">x</span><span class="main">↦<span class="hidden">⇩</span><sub>+</sub></span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">↦<span class="hidden">⇩</span><sub>-</sub></span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span><span class="main">(</span><span class="free">x</span><span class="main">↦<span class="hidden">⇩</span><sub>-</sub></span><span class="free">b</span><span class="main">)</span>"</span></span>   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  We inherit a fairly rich theory on policy updates from Map here. Some examples are: 
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pol_upd_triv1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="free">k</span> <span class="main">=</span>   <span class="main">⌊</span>allow <span class="free">x</span><span class="main">⌋</span> <span class="main">⟹</span> <span class="free">t</span><span class="main">(</span><span class="free">k</span><span class="main">↦<span class="hidden">⇩</span><sub>+</sub></span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> pol_upd_triv2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="free">k</span> <span class="main">=</span> <span class="main">⌊</span>deny <span class="free">x</span><span class="main">⌋</span> <span class="main">⟹</span> <span class="free">t</span><span class="main">(</span><span class="free">k</span><span class="main">↦<span class="hidden">⇩</span><sub>-</sub></span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> pol_upd_allow_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">(</span><span class="free">k</span><span class="main">↦<span class="hidden">⇩</span><sub>+</sub></span><span class="free">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> pol_upd_deny_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">(</span><span class="free">k</span><span class="main">↦<span class="hidden">⇩</span><sub>-</sub></span><span class="free">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> pol_upd_eqD1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">(</span><span class="free">a</span><span class="main">↦<span class="hidden">⇩</span><sub>+</sub></span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span><span class="main">(</span><span class="free">a</span><span class="main">↦<span class="hidden">⇩</span><sub>+</sub></span><span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> map_upd_eqD1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pol_upd_eqD2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">(</span><span class="free">a</span><span class="main">↦<span class="hidden">⇩</span><sub>-</sub></span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span><span class="main">(</span><span class="free">a</span><span class="main">↦<span class="hidden">⇩</span><sub>-</sub></span><span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> map_upd_eqD1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pol_upd_neq1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">(</span><span class="free">a</span><span class="main">↦<span class="hidden">⇩</span><sub>+</sub></span><span class="free">x</span><span class="main">)</span> <span class="main">≠</span> <span class="free">n</span><span class="main">(</span><span class="free">a</span><span class="main">↦<span class="hidden">⇩</span><sub>-</sub></span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> map_upd_eqD1<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Override Operators›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Key operators for constructing policies are the override operators. There are four different 
  versions of them, with one of them being the override operator from the Map theory. As it is 
  common to compose policy rules in a ``left-to-right-first-fit''-manner, that one is taken as 
  default, defined by a syntax translation from the provided override operator from the Map 
  theory (which does it in reverse order).
›</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_policyoverride"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⨁</span>"</span> 100<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="free">p</span> <span class="main">⨁</span> <span class="free">q</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="free">q</span> <span class="main">++</span> <span class="free">p</span>"</span> 


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Some elementary facts inherited from Map are:
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> override_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⨁</span> <span class="main">∅</span> <span class="main">=</span> <span class="free">p</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> empty_override<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="main">⨁</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> override_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p1</span> <span class="main">⨁</span> <span class="main">(</span><span class="free">p2</span> <span class="main">⨁</span> <span class="free">p3</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p1</span> <span class="main">⨁</span> <span class="free">p2</span><span class="main">)</span> <span class="main">⨁</span> <span class="free">p3</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The following two operators are variants of the standard override.  For override\_A, 
  an allow of wins over a deny. For override\_D, the situation is dual. 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">override_A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">++'_A</span>"</span> 100<span class="main">)</span> 
<span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">m2</span></span></span> <span class="keyword1"><span class="free">++_A</span></span> <span class="free"><span class="bound"><span class="entity">m1</span></span></span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">m1</span></span></span> <span class="bound">x</span> <span class="keyword1">of</span> 
                 <span class="main">⌊</span>allow <span class="bound">a</span><span class="main">⌋</span> <span class="main">⇒</span>  <span class="main">⌊</span>allow <span class="bound">a</span><span class="main">⌋</span>
               <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">a</span><span class="main">⌋</span>  <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">m2</span></span></span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">⌊</span>allow <span class="bound">b</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>allow <span class="bound">b</span><span class="main">⌋</span> 
                                            <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">⌊</span>deny <span class="bound">a</span><span class="main">⌋</span><span class="main">)</span>
               <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">m2</span></span></span> <span class="bound">x</span><span class="main">)</span>
           <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_policyoverride_A"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⨁<span class="hidden">⇩</span><sub>A</sub></span>"</span> 100<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="free">p</span> <span class="keyword1">⨁<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">q</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="free">p</span> <span class="keyword1">++_A</span> <span class="free">q</span>"</span>

<span class="keyword1"><span class="command">lemma</span></span> override_A_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">⨁<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∅</span> <span class="main">=</span> <span class="free">p</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>override_A_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> empty_override_A<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="keyword1">⨁<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>override_A_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 


<span class="keyword1"><span class="command">lemma</span></span> override_A_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p1</span> <span class="keyword1">⨁<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="free">p2</span> <span class="keyword1">⨁<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">p3</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p1</span> <span class="keyword1">⨁<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">p2</span><span class="main">)</span> <span class="keyword1">⨁<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">p3</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> override_A_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> decision.splits  option.splits<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">override_D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">++'_D</span>"</span> 100<span class="main">)</span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">m1</span></span></span> <span class="keyword1"><span class="free">++_D</span></span> <span class="free"><span class="bound"><span class="entity">m2</span></span></span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">m2</span></span></span> <span class="bound">x</span> <span class="keyword1">of</span> 
                <span class="main">⌊</span>deny <span class="bound">a</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>deny <span class="bound">a</span><span class="main">⌋</span>
              <span class="main">|</span> <span class="main">⌊</span>allow <span class="bound">a</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">m1</span></span></span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">⌊</span>deny <span class="bound">b</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>deny <span class="bound">b</span><span class="main">⌋</span>
                                  <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">⌊</span>allow <span class="bound">a</span><span class="main">⌋</span><span class="main">)</span>
              <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">m1</span></span></span> <span class="bound">x</span> 
           <span class="main">)</span>"</span></span>
 
<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_policyoverride_D"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⨁<span class="hidden">⇩</span><sub>D</sub></span>"</span> 100<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="free">p</span> <span class="keyword1">⨁<span class="hidden">⇩</span><sub>D</sub></span> <span class="free">q</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="free">p</span> <span class="keyword1">++_D</span> <span class="free">q</span>"</span>

<span class="keyword1"><span class="command">lemma</span></span> override_D_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">⨁<span class="hidden">⇩</span><sub>D</sub></span> <span class="main">∅</span> <span class="main">=</span> <span class="free">p</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>override_D_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> empty_override_D<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="keyword1">⨁<span class="hidden">⇩</span><sub>D</sub></span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>override_D_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="skolem">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> override_D_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p1</span> <span class="keyword1">⨁<span class="hidden">⇩</span><sub>D</sub></span> <span class="main">(</span><span class="free">p2</span> <span class="keyword1">⨁<span class="hidden">⇩</span><sub>D</sub></span> <span class="free">p3</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p1</span> <span class="keyword1">⨁<span class="hidden">⇩</span><sub>D</sub></span> <span class="free">p2</span><span class="main">)</span> <span class="keyword1">⨁<span class="hidden">⇩</span><sub>D</sub></span> <span class="free">p3</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> override_D_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> decision.splits  option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Coercion Operators›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Often, especially when combining policies of different type, it is necessary to 
  adapt the input or output domain of a policy to a more refined context. 
›</span></span>                        

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  An analogous for the range of a policy is defined as follows: 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy_range_comp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'β</span><span class="main">⇒</span><span class="tfree">'γ</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span> <span class="main">↦</span><span class="tfree">'γ</span>"</span></span>   <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">o'_f</span>"</span> 55<span class="main">)</span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1"><span class="free">o_f</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span> <span class="keyword1">of</span>
                     <span class="main">⌊</span>allow <span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>allow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span><span class="main">)</span><span class="main">⌋</span>
                   <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>deny <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span><span class="main">)</span><span class="main">⌋</span>
                   <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_policy_range_comp"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'β</span><span class="main">⇒</span><span class="tfree">'γ</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span> <span class="main">↦</span><span class="tfree">'γ</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">o<span class="hidden">⇩</span><sub>f</sub></span>"</span> 55<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="free">p</span> <span class="keyword1">o<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">q</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="free">p</span> <span class="keyword1">o_f</span> <span class="free">q</span>"</span>

<span class="keyword1"><span class="command">lemma</span></span> policy_range_comp_strict <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">o<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">∅</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> policy_range_comp_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  A generalized version is, where separate coercion functions are applied to the result 
  depending on the decision of the policy is as follows: 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">range_split</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'β</span><span class="main">⇒</span><span class="tfree">'γ</span><span class="main">)</span><span class="main">×</span><span class="main">(</span><span class="tfree">'β</span><span class="main">⇒</span><span class="tfree">'γ</span><span class="main">)</span><span class="main">,</span><span class="tfree">'α</span> <span class="main">↦</span> <span class="tfree">'β</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span> <span class="main">↦</span> <span class="tfree">'γ</span>"</span></span>
                          <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∇</span>"</span> 100<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main"><span class="free">∇</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span> <span class="keyword1">of</span> 
                          <span class="main">⌊</span>allow <span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>allow <span class="main">(</span><span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span><span class="main">⌋</span>
                        <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">y</span><span class="main">⌋</span>  <span class="main">⇒</span> <span class="main">⌊</span>deny <span class="main">(</span><span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span><span class="main">⌋</span> 
                        <span class="main">|</span> <span class="main">⊥</span>        <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> range_split_strict<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∇</span> <span class="main">∅</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> range_split_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> range_split_charn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">g</span><span class="main">)</span> <span class="main">∇</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free">p</span> <span class="bound">x</span> <span class="keyword1">of</span> 
                           <span class="main">⌊</span>allow <span class="bound">x</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>allow <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">⌋</span>
                         <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">x</span><span class="main">⌋</span>  <span class="main">⇒</span> <span class="main">⌊</span>deny <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">⌋</span> 
                         <span class="main">|</span> <span class="main">⊥</span>        <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> range_split_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The connection between these two becomes apparent if considering the following lemma:
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> range_split_vs_range_compose<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">f</span><span class="main">)</span> <span class="main">∇</span> <span class="free">p</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">o<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> range_split_charn policy_range_comp_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> range_split_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>id<span class="main">,</span>id<span class="main">)</span> <span class="main">∇</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> range_split_charn id_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

<span class="keyword1"><span class="command">lemma</span></span> range_split_bi_compose <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f1</span><span class="main">,</span><span class="free">f2</span><span class="main">)</span> <span class="main">∇</span> <span class="main">(</span><span class="free">g1</span><span class="main">,</span><span class="free">g2</span><span class="main">)</span> <span class="main">∇</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="free">f1</span> <span class="keyword1">o</span> <span class="free">g1</span><span class="main">,</span><span class="free">f2</span> <span class="keyword1">o</span> <span class="free">g2</span><span class="main">)</span> <span class="main">∇</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> range_split_charn comp_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The next three operators are rather exotic and in most cases not used. 
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following is a variant of range\_split, where the change in the decision depends 
  on the input instead of the output. 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dom_split2a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'α</span> <span class="main">⇀</span> <span class="tfree">'γ</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">⇀</span><span class="tfree">'γ</span><span class="main">)</span><span class="main">,</span><span class="tfree">'α</span> <span class="main">↦</span> <span class="tfree">'β</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span> <span class="main">↦</span> <span class="tfree">'γ</span>"</span></span>         <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">Δa</span>"</span> 100<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">Δa</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span> <span class="keyword1">of</span> 
                          <span class="main">⌊</span>allow <span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>allow <span class="main">(</span>the <span class="main">(</span><span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>
                        <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">y</span><span class="main">⌋</span>  <span class="main">⇒</span>  <span class="main">⌊</span>deny <span class="main">(</span>the <span class="main">(</span><span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span> 
                        <span class="main">|</span> <span class="main">⊥</span>        <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dom_split2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'α</span> <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">⇒</span><span class="tfree">'γ</span><span class="main">)</span><span class="main">,</span><span class="tfree">'α</span> <span class="main">↦</span> <span class="tfree">'β</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span> <span class="main">↦</span> <span class="tfree">'γ</span>"</span></span>          <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">Δ</span>"</span> 100<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">Δ</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span> <span class="keyword1">of</span> 
                          <span class="main">⌊</span>allow <span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>allow <span class="main">(</span><span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">⌋</span>
                        <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">y</span><span class="main">⌋</span>  <span class="main">⇒</span>  <span class="main">⌊</span>deny <span class="main">(</span><span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">⌋</span>
                        <span class="main">|</span> <span class="main">⊥</span>        <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">range_split2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'α</span> <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">⇒</span><span class="tfree">'γ</span><span class="main">)</span><span class="main">,</span><span class="tfree">'α</span> <span class="main">↦</span> <span class="tfree">'β</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span> <span class="main">↦</span> <span class="main">(</span><span class="tfree">'β</span> <span class="main">×</span><span class="tfree">'γ</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∇2</span>"</span> 100<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">∇2</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span> <span class="keyword1">of</span> 
                          <span class="main">⌊</span>allow <span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>allow <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">⌋</span>
                        <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">y</span><span class="main">⌋</span>  <span class="main">⇒</span> <span class="main">⌊</span>deny <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">⌋</span> 
                        <span class="main">|</span> <span class="main">⊥</span>        <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The following operator is used for transition policies only: a transition policy is transformed 
  into a state-exception monad. Such a monad can for example be used for test case generation using 
  HOL-Testgen~\cite{brucker.ea:theorem-prover:2012}.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy2MON</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'ι</span><span class="main">×</span><span class="tfree">'σ</span> <span class="main">↦</span> <span class="tfree">'o</span><span class="main">×</span><span class="tfree">'σ</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'ι</span> <span class="main">⇒</span><span class="main">(</span><span class="tfree">'o</span> decision<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">policy2MON</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">ι</span> <span class="bound">σ</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="bound">ι</span><span class="main">,</span><span class="bound">σ</span><span class="main">)</span> <span class="keyword1">of</span>
                              <span class="main">⌊</span><span class="main">(</span>allow <span class="main">(</span><span class="bound">outs</span><span class="main">,</span><span class="bound">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span><span class="main">(</span>allow <span class="bound">outs</span><span class="main">,</span> <span class="bound">σ'</span><span class="main">)</span><span class="main">⌋</span>
                            <span class="main">|</span> <span class="main">⌊</span><span class="main">(</span>deny <span class="main">(</span><span class="bound">outs</span><span class="main">,</span><span class="bound">σ'</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>  <span class="main">⇒</span> <span class="main">⌊</span><span class="main">(</span>deny <span class="bound">outs</span><span class="main">,</span> <span class="bound">σ'</span><span class="main">)</span><span class="main">⌋</span>
                            <span class="main">|</span> <span class="main">⊥</span>                  <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> UPFCoreDefs <span class="main">=</span> Allow_def Deny_def override_A_def override_D_def policy_range_comp_def 
                     range_split_def dom_split2_def map_add_def restrict_map_def
<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="ElementaryPolicies">
<div class="head">
<h1>Theory ElementaryPolicies</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * HOL-TestGen --- theorem-prover based test case generation
 *                 http://www.brucker.ch/projects/hol-testgen/
 *                                                                            
 * UPF
 * This file is part of HOL-TestGen.
 *
 * Copyright (c) 2005-2012 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2017 Université Paris-Sud, France
 *               2015-2017 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Elementary Policies›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  ElementaryPolicies
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="UPFCore.html">UPFCore</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  In this theory, we introduce the elementary policies of UPF that build the basis 
  for more complex policies. These complex policies, respectively, embedding of 
  well-known access control or security models, are build by composing the elementary 
  policies defined in this theory. 
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The Core Policy Combinators: Allow and Deny Everything›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">deny_pfun</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">⇀</span><span class="tfree">'β</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">↦</span> <span class="tfree">'β</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">AllD</span>"</span><span class="main">)</span>
   <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">deny_pfun</span> <span class="free"><span class="bound"><span class="entity">pf</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">pf</span></span></span> <span class="bound">x</span> <span class="keyword1">of</span>
                          <span class="main">⌊</span><span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>deny <span class="main">(</span><span class="bound">y</span><span class="main">)</span><span class="main">⌋</span>
                         <span class="main">|</span><span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">allow_pfun</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">⇀</span><span class="tfree">'β</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">↦</span> <span class="tfree">'β</span><span class="main">)</span>"</span></span> <span class="main">(</span> <span class="quoted">"<span class="keyword1">AllA</span>"</span><span class="main">)</span>
   <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">allow_pfun</span> <span class="free"><span class="bound"><span class="entity">pf</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">pf</span></span></span> <span class="bound">x</span> <span class="keyword1">of</span>
                          <span class="main">⌊</span><span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>allow <span class="main">(</span><span class="bound">y</span><span class="main">)</span><span class="main">⌋</span>
                         <span class="main">|</span><span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_allow_pfun"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">⇀</span><span class="tfree">'β</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">↦</span> <span class="tfree">'β</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">A<span class="hidden">⇩</span><sub>p</sub></span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="keyword1">A<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">f</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">AllA</span> <span class="free">f</span>"</span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_deny_pfun"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">⇀</span><span class="tfree">'β</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">↦</span> <span class="tfree">'β</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">D<span class="hidden">⇩</span><sub>p</sub></span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="keyword1">D<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">f</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">AllD</span> <span class="free">f</span>"</span>

<span class="keyword1"><span class="command">notation</span></span>
   <span class="quoted">"deny_pfun"</span>  <span class="main">(</span><span class="keyword2"><span class="keyword">binder</span></span> <span class="quoted">"<span class="keyword1">∀D</span>"</span> 10<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted">"allow_pfun"</span> <span class="main">(</span><span class="keyword2"><span class="keyword">binder</span></span> <span class="quoted">"<span class="keyword1">∀A</span>"</span> 10<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> AllD_norm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"deny_pfun <span class="main">(</span>id <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∀D</span><span class="bound">x</span><span class="main">.</span> <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>id_def comp_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> AllD_norm2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"deny_pfun <span class="main">(</span>Some <span class="keyword1">o</span> id<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∀D</span><span class="bound">x</span><span class="main">.</span> <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>id_def comp_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> AllA_norm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"allow_pfun <span class="main">(</span>id <span class="keyword1">o</span> Some<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∀A</span><span class="bound">x</span><span class="main">.</span> <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>id_def comp_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> AllA_norm2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"allow_pfun <span class="main">(</span>Some <span class="keyword1">o</span> id<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∀A</span><span class="bound">x</span><span class="main">.</span> <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>id_def comp_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> AllA_apply<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∀A</span><span class="bound">x</span><span class="main">.</span> Some <span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⌊</span>allow <span class="main">(</span><span class="free">P</span> <span class="free">x</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>allow_pfun_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> AllD_apply<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∀D</span><span class="bound">x</span><span class="main">.</span> Some <span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⌊</span>deny <span class="main">(</span><span class="free">P</span> <span class="free">x</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>deny_pfun_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> neq_Allow_Deny<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pf</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">⟹</span> <span class="main">(</span>deny_pfun <span class="free">pf</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>allow_pfun <span class="free">pf</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> contrapos_nn<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fun_cong<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deny_pfun_def allow_pfun_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">pf</span> <span class="skolem">x</span> <span class="main">=</span>  <span class="main">⊥</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Common Instances›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">allow_all_fun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">⇒</span> <span class="tfree">'β</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">↦</span> <span class="tfree">'β</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">A<span class="hidden">⇩</span><sub>f</sub></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">allow_all_fun</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span>  allow_pfun <span class="main">(</span>Some <span class="keyword1">o</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">deny_all_fun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">⇒</span> <span class="tfree">'β</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">↦</span> <span class="tfree">'β</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">D<span class="hidden">⇩</span><sub>f</sub></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">deny_all_fun</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> deny_pfun <span class="main">(</span>Some <span class="keyword1">o</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">deny_all_id</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> <span class="main">↦</span> <span class="tfree">'α</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">D<span class="hidden">⇩</span><sub>I</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">deny_all_id</span>  <span class="main">≡</span> deny_pfun <span class="main">(</span>id <span class="keyword1">o</span> Some<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">allow_all_id</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> <span class="main">↦</span> <span class="tfree">'α</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">A<span class="hidden">⇩</span><sub>I</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allow_all_id</span>  <span class="main">≡</span> allow_pfun <span class="main">(</span>id <span class="keyword1">o</span> Some<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">allow_all</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">↦</span> unit<span class="main">)</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword1">A<span class="hidden">⇩</span><sub>U</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">allow_all</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>  <span class="main">=</span> <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_all</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">D<span class="hidden">⇩</span><sub>U</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deny_all</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>   <span class="main">=</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span>"</span></span>              

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹... and resulting properties:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">A<span class="hidden">⇩</span><sub>I</sub></span>  <span class="main">⨁</span> Map.empty  <span class="main">=</span> <span class="keyword1">A<span class="hidden">⇩</span><sub>I</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">A<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">f</span>  <span class="main">⨁</span> Map.empty  <span class="main">=</span> <span class="keyword1">A<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"allow_pfun Map.empty <span class="main">=</span> Map.empty"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allow_pfun_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> allow_left_cancel <span class="main">:</span><span class="quoted"><span class="quoted">"dom <span class="free">pf</span> <span class="main">=</span> UNIV <span class="main">⟹</span> <span class="main">(</span>allow_pfun <span class="free">pf</span><span class="main">)</span> <span class="main">⨁</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>allow_pfun <span class="free">pf</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> allow_pfun_def option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> deny_left_cancel <span class="main">:</span><span class="quoted"><span class="quoted">"dom <span class="free">pf</span> <span class="main">=</span> UNIV <span class="main">⟹</span> <span class="main">(</span>deny_pfun <span class="free">pf</span><span class="main">)</span> <span class="main">⨁</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>deny_pfun <span class="free">pf</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deny_pfun_def option.splits<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Domain, Range, and Restrictions›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Since policies are essentially maps, we inherit the basic definitions for 
  domain and range on  Maps: \\
  \verb+Map.dom_def+ :  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Map.dom_def<span class="antiquote"><span class="antiquote">}</span></span></span></span> \\
  whereas range is just an abrreviation for image:
  \begin{verbatim}
  abbreviation range :: "('a =&gt; 'b) =&gt; 'b set" 
  where -- "of function"  "range f == f ` UNIV"
  \end{verbatim}
  As a consequence, we inherit the following properties on
  policies:
  \begin{itemize}
  \item  \verb+Map.domD+ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Map.domD<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  \item\verb+Map.domI+ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Map.domI<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  \item\verb+Map.domIff+ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Map.domIff<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  \item\verb+Map.dom_const+ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Map.dom_const<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  \item\verb+Map.dom_def+ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Map.dom_def<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  \item\verb+Map.dom_empty+ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Map.dom_empty<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  \item\verb+Map.dom_eq_empty_conv+ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Map.dom_eq_empty_conv<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  \item\verb+Map.dom_eq_singleton_conv+ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Map.dom_eq_singleton_conv<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  \item\verb+Map.dom_fun_upd+ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Map.dom_fun_upd<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  \item\verb+Map.dom_if+ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Map.dom_if<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  \item\verb+Map.dom_map_add+ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Map.dom_map_add<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  \end{itemize}
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  However, some properties are specific to policy concepts: 
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> sub_ran <span class="main">:</span> <span class="quoted"><span class="quoted">"ran <span class="free">p</span>  <span class="main">⊆</span> Allow <span class="main">∪</span> Deny"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Allow_def Deny_def ran_def full_SetCompr_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x a
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    
<span class="keyword1"><span class="command">lemma</span></span> dom_allow_pfun <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"dom<span class="main">(</span>allow_pfun <span class="free">f</span><span class="main">)</span> <span class="main">=</span> dom <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> allow_pfun_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x y
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> dom_allow_all<span class="main">:</span> <span class="quoted"><span class="quoted">"dom<span class="main">(</span><span class="keyword1">A<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> allow_all_fun_def o_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dom_deny_pfun <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"dom<span class="main">(</span>deny_pfun <span class="free">f</span><span class="main">)</span> <span class="main">=</span> dom <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deny_pfun_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="improper">x</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> dom_deny_all<span class="main">:</span> <span class="quoted"><span class="quoted">" dom<span class="main">(</span><span class="keyword1">D<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deny_all_fun_def o_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ran_allow_pfun <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"ran<span class="main">(</span>allow_pfun <span class="free">f</span><span class="main">)</span> <span class="main">=</span> allow <span class="main">`</span><span class="main">(</span>ran <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allow_pfun_def ran_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x a 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> xa a
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> ran_allow_all<span class="main">:</span> <span class="quoted"><span class="quoted">"ran<span class="main">(</span><span class="keyword1">A<span class="hidden">⇩</span><sub>f</sub></span> id<span class="main">)</span> <span class="main">=</span> Allow"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allow_all_fun_def Allow_def o_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def ran_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> ran_deny_pfun<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ran<span class="main">(</span>deny_pfun <span class="free">f</span><span class="main">)</span> <span class="main">=</span> deny <span class="main">`</span> <span class="main">(</span>ran <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deny_pfun_def ran_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x a 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> xa a
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    
<span class="keyword1"><span class="command">lemma</span></span> ran_deny_all<span class="main">:</span> <span class="quoted"><span class="quoted">"ran<span class="main">(</span><span class="keyword1">D<span class="hidden">⇩</span><sub>f</sub></span> id<span class="main">)</span> <span class="main">=</span> Deny"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deny_all_fun_def Deny_def o_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def ran_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Reasoning over \verb+dom+ is most crucial since it paves the way for simplification and 
  reordering of policies composed by override (i.e. by the normal left-to-right rule composition
  method.
  \begin{itemize}
    \item \verb+Map.dom_map_add+ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Map.dom_map_add<span class="antiquote"><span class="antiquote">}</span></span></span></span>
    \item \verb+Map.inj_on_map_add_dom+ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Map.inj_on_map_add_dom<span class="antiquote"><span class="antiquote">}</span></span></span></span>
    \item \verb+Map.map_add_comm+ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Map.map_add_comm<span class="antiquote"><span class="antiquote">}</span></span></span></span>
    \item \verb+Map.map_add_dom_app_simps(1)+ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Map.map_add_dom_app_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
    \item \verb+Map.map_add_dom_app_simps(2)+ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Map.map_add_dom_app_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
    \item \verb+Map.map_add_dom_app_simps(3)+ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Map.map_add_dom_app_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
    \item \verb+Map.map_add_upd_left+ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Map.map_add_upd_left<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  \end{itemize}
  The latter rule also applies to allow- and deny-override.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dom_restrict</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'α</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">◃</span>"</span> 55<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main"><span class="free">◃</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dom_dom_restrict<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"dom<span class="main">(</span><span class="free">S</span> <span class="main">◃</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">S</span> <span class="main">∩</span> dom <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dom_restrict_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x y
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x y 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

<span class="keyword1"><span class="command">lemma</span></span> dom_restrict_idem<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dom <span class="free">p</span><span class="main">)</span> <span class="main">◃</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dom_restrict_def
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> neq_commute<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span><span class="operator">THEN</span> not_None_eq <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> dom_restrict_inter<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">◃</span> <span class="free">S</span> <span class="main">◃</span> <span class="free">p</span> <span class="main">=</span> <span class="free">T</span> <span class="main">∩</span> <span class="free">S</span> <span class="main">◃</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dom_restrict_def
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> neq_commute<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span><span class="operator">THEN</span> not_None_eq <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ran_restrict</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span><span class="main">,</span><span class="tfree">'β</span> decision set<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span> <span class="main">↦</span><span class="tfree">'β</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">▹</span>"</span> 55<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="free">▹</span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>Some<span class="main">`</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ran_restrict2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span><span class="main">,</span><span class="tfree">'β</span> decision set<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span> <span class="main">↦</span><span class="tfree">'β</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">▹2</span>"</span> 55<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="free">▹2</span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ran_restrict <span class="main">=</span> ran_restrict2"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ran_restrict_def ran_restrict2_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x xa xb
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="skolem">xb</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> inj_Some inj_image_mem_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 


<span class="keyword1"><span class="command">lemma</span></span> ran_ran_restrict<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"ran<span class="main">(</span><span class="free">p</span> <span class="main">▹</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="free">S</span> <span class="main">∩</span> ran <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ran_restrict_def image_def ran_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> ran_restrict_idem<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">▹</span> <span class="main">(</span>ran <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ran_restrict_def image_def Ball_def ran_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> contrapos_pp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> neq_commute<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span><span class="operator">THEN</span> not_None_eq <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> ran_restrict_inter<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">▹</span> <span class="free">S</span><span class="main">)</span> <span class="main">▹</span> <span class="free">T</span> <span class="main">=</span> <span class="free">p</span> <span class="main">▹</span> <span class="free">T</span> <span class="main">∩</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ran_restrict_def
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> neq_commute<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span><span class="operator">THEN</span> not_None_eq <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> ran_gen_A<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∀A</span><span class="bound">x</span><span class="main">.</span> <span class="main">⌊</span><span class="free">P</span> <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">▹</span> Allow <span class="main">=</span> <span class="main">(</span><span class="keyword1">∀A</span><span class="bound">x</span><span class="main">.</span> <span class="main">⌊</span><span class="free">P</span> <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Allow_def ran_restrict_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> ran_gen_D<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∀D</span><span class="bound">x</span><span class="main">.</span> <span class="main">⌊</span><span class="free">P</span> <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">▹</span> Deny <span class="main">=</span> <span class="main">(</span><span class="keyword1">∀D</span><span class="bound">x</span><span class="main">.</span> <span class="main">⌊</span><span class="free">P</span> <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Deny_def ran_restrict_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> ElementaryPoliciesDefs <span class="main">=</span> deny_pfun_def allow_pfun_def allow_all_fun_def deny_all_fun_def 
                                allow_all_id_def deny_all_id_def allow_all_def deny_all_def 
                                dom_restrict_def ran_restrict_def

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SeqComposition">
<div class="head">
<h1>Theory SeqComposition</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * HOL-TestGen --- theorem-prover based test case generation
 *                 http://www.brucker.ch/projects/hol-testgen/
 *                                                                            
 * This file is part of HOL-TestGen.
 *
 * Copyright (c) 2005-2012 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2017 Université Paris-Sud, France
 *               2015-2017 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Sequential Composition›</span></span>
<span class="keyword1"><span class="command">theory</span></span>  
  SeqComposition
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="ElementaryPolicies.html">ElementaryPolicies</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Sequential composition is based on the idea that two policies are to be combined by applying 
  the second policy to the output of the first one. Again, there are four possibilities how the 
  decisions can be combined.›</span></span> 

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Flattening›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  A key concept of sequential policy composition is the flattening of nested decisions. There are 
  four possibilities, and these possibilities will give the various flavours of policy composition.
›</span></span>
<span class="keyword1"><span class="command">fun</span></span>    <span class="entity">flat_orA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> decision<span class="main">)</span> decision <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> decision<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">flat_orA</span><span class="main">(</span>allow<span class="main">(</span>allow <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> allow <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
     <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">flat_orA</span><span class="main">(</span>allow<span class="main">(</span>deny <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> allow <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
     <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">flat_orA</span><span class="main">(</span>deny<span class="main">(</span>allow <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> allow <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
     <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">flat_orA</span><span class="main">(</span>deny<span class="main">(</span>deny <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>   <span class="main">=</span> deny <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
       
<span class="keyword1"><span class="command">lemma</span></span> flat_orA_deny<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"flat_orA <span class="free">x</span> <span class="main">=</span> deny <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> deny<span class="main">(</span>deny <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> α<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">α</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> α<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">α</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> flat_orA_allow<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"flat_orA <span class="free">x</span> <span class="main">=</span> allow <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> allow<span class="main">(</span>allow <span class="free">y</span><span class="main">)</span> 
                                                    <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> allow<span class="main">(</span>deny <span class="free">y</span><span class="main">)</span> 
                                                    <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> deny<span class="main">(</span>allow <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> α<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">α</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> α<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">α</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">fun</span></span>    <span class="entity">flat_orD</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> decision<span class="main">)</span> decision <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> decision<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">flat_orD</span><span class="main">(</span>allow<span class="main">(</span>allow <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> allow <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
     <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">flat_orD</span><span class="main">(</span>allow<span class="main">(</span>deny <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> deny <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
     <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">flat_orD</span><span class="main">(</span>deny<span class="main">(</span>allow <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> deny <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
     <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">flat_orD</span><span class="main">(</span>deny<span class="main">(</span>deny <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>   <span class="main">=</span> deny <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
       
<span class="keyword1"><span class="command">lemma</span></span> flat_orD_allow<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"flat_orD <span class="free">x</span> <span class="main">=</span> allow <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> allow<span class="main">(</span>allow <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> α<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">α</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> α<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">α</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> flat_orD_deny<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"flat_orD <span class="free">x</span> <span class="main">=</span> deny <span class="free">y</span> <span class="main">⟹</span>  <span class="free">x</span> <span class="main">=</span> deny<span class="main">(</span>deny <span class="free">y</span><span class="main">)</span> 
                                                   <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> allow<span class="main">(</span>deny <span class="free">y</span><span class="main">)</span> 
                                                   <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> deny<span class="main">(</span>allow <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> α<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">α</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> α<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">α</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">fun</span></span>    <span class="entity">flat_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> decision<span class="main">)</span> decision <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> decision<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">flat_1</span><span class="main">(</span>allow<span class="main">(</span>allow <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> allow <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
     <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">flat_1</span><span class="main">(</span>allow<span class="main">(</span>deny <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> allow <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
     <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">flat_1</span><span class="main">(</span>deny<span class="main">(</span>allow <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> deny <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
     <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">flat_1</span><span class="main">(</span>deny<span class="main">(</span>deny <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>   <span class="main">=</span> deny <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flat_1_allow<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"flat_1 <span class="free">x</span> <span class="main">=</span> allow <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> allow<span class="main">(</span>allow <span class="free">y</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> allow<span class="main">(</span>deny <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> α<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">α</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> α<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">α</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> flat_1_deny<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"flat_1 <span class="free">x</span> <span class="main">=</span> deny <span class="free">y</span> <span class="main">⟹</span>  <span class="free">x</span> <span class="main">=</span> deny<span class="main">(</span>deny <span class="free">y</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> deny<span class="main">(</span>allow <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> α<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">α</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> α<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">α</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">fun</span></span>    <span class="entity">flat_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> decision<span class="main">)</span> decision <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> decision<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">flat_2</span><span class="main">(</span>allow<span class="main">(</span>allow <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> allow <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
     <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">flat_2</span><span class="main">(</span>allow<span class="main">(</span>deny <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> deny <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
     <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">flat_2</span><span class="main">(</span>deny<span class="main">(</span>allow <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> allow <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
     <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">flat_2</span><span class="main">(</span>deny<span class="main">(</span>deny <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>   <span class="main">=</span> deny <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flat_2_allow<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"flat_2 <span class="free">x</span> <span class="main">=</span> allow <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> allow<span class="main">(</span>allow <span class="free">y</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> deny<span class="main">(</span>allow <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> α<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">α</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> α<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">α</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> flat_2_deny<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"flat_2 <span class="free">x</span> <span class="main">=</span> deny <span class="free">y</span> <span class="main">⟹</span>  <span class="free">x</span> <span class="main">=</span> deny<span class="main">(</span>deny <span class="free">y</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> allow<span class="main">(</span>deny <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> α<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">α</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> α<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">α</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Policy Composition›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The following definition allows to compose two policies. Denies and allows are transferred. 
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">lift</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">↦</span> <span class="tfree">'β</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> decision <span class="main">↦</span><span class="tfree">'β</span> decision<span class="main">)</span>"</span></span>  
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lift</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>deny <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>  <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">of</span> 
                             <span class="main">⌊</span><span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>deny <span class="bound">y</span><span class="main">⌋</span>
                           <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">lift</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>allow <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">of</span> 
                              <span class="main">⌊</span><span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>allow <span class="bound">y</span><span class="main">⌋</span>
                           <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_mt <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lift <span class="main">∅</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Since policies are maps, we inherit a composition on them. However, this results in nestings 
  of decisions---which must be flattened. As we now that there are four different forms of 
  flattening, we have four different forms of policy composition:›</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">comp_orA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'β</span><span class="main">↦</span><span class="tfree">'γ</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'γ</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">o'_orA</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="keyword1"><span class="free">o_orA</span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="main">≡</span> <span class="main">(</span>map_option flat_orA<span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span>lift <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>m</sub></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span>
  comp_orA  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">∘<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span> 55<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_orA_mt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∅</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_orA_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mt_comp_orA<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="free">p</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_orA_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">comp_orD</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'β</span><span class="main">↦</span><span class="tfree">'γ</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'γ</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">o'_orD</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="keyword1"><span class="free">o_orD</span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="main">≡</span> <span class="main">(</span>map_option flat_orD<span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span>lift <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>m</sub></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span>
  comp_orD  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">∘<span class="hidden">⇩</span><sub>o</sub>rD</span>"</span> 55<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_orD_mt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">o_orD</span> <span class="main">∅</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_orD_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mt_comp_orD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="keyword1">o_orD</span> <span class="free">p</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_orD_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">comp_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'β</span><span class="main">↦</span><span class="tfree">'γ</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'γ</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">o'_1</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="keyword1"><span class="free">o_1</span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="main">≡</span> <span class="main">(</span>map_option flat_1<span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span>lift <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>m</sub></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span>
  comp_1  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">∘<span class="hidden">⇩</span><sub>1</sub></span>"</span> 55<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_1_mt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∘<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∅</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_1_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mt_comp_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="main">∘<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_1_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">comp_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'β</span><span class="main">↦</span><span class="tfree">'γ</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'γ</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">o'_2</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="keyword1"><span class="free">o_2</span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="main">≡</span> <span class="main">(</span>map_option flat_2<span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span>lift <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>m</sub></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span>
  comp_2  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">∘<span class="hidden">⇩</span><sub>2</sub></span>"</span> 55<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_2_mt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∘<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∅</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_2_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mt_comp_2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="main">∘<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_2_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ParallelComposition">
<div class="head">
<h1>Theory ParallelComposition</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * HOL-TestGen --- theorem-prover based test case generation
 *                 http://www.brucker.ch/projects/hol-testgen/
 *                                                                            
 * This file is part of HOL-TestGen.
 *
 * Copyright (c) 2005-2012 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2017 Université Paris-Sud, France
 *               2015-2017 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Parallel Composition›</span></span>
<span class="keyword1"><span class="command">theory</span></span>  
  ParallelComposition
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="ElementaryPolicies.html">ElementaryPolicies</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The following combinators are based on the idea that two policies are executed in parallel. 
  Since both input and the output can differ, we chose to pair them. 
  
  The new input pair will often contain repetitions, which can be reduced using the 
  domain-restriction and domain-reduction operators. Using additional range-modifying operators 
  such as $\nabla$, decide which result argument is chosen; this might be the first or the latter 
  or, in case that $\beta = \gamma$, and $\beta$ underlies a lattice structure, the supremum or 
  infimum of both, or, an arbitrary combination of them.
  
  In any case, although we have strictly speaking a pairing of decisions and not a nesting of 
  them, we will apply the same notational conventions as for the latter, i.e. as for 
  flattening.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Parallel Combinators: Foundations›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  There are four possible semantics how the decision can be combined, thus there are four 
  parallel composition operators. For each of them, we prove several properties. 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prod_orA</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span><span class="main">,</span> <span class="tfree">'γ</span> <span class="main">↦</span><span class="tfree">'δ</span><span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">×</span><span class="tfree">'γ</span> <span class="main">↦</span> <span class="tfree">'β</span><span class="main">×</span><span class="tfree">'δ</span><span class="main">)</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="keyword1"><span class="free">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>A</sub></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="main">=</span>
       <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="bound">x</span> <span class="keyword1">of</span>
             <span class="main">⌊</span>allow <span class="bound">d1</span><span class="main">⌋</span> <span class="main">⇒</span><span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="bound">y</span> <span class="keyword1">of</span> 
                                   <span class="main">⌊</span>allow <span class="bound">d2</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>allow<span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">)</span><span class="main">⌋</span>
                                 <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">d2</span><span class="main">⌋</span>  <span class="main">⇒</span> <span class="main">⌊</span>allow<span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">)</span><span class="main">⌋</span>
                                 <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span> 
           <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">d1</span><span class="main">⌋</span><span class="main">⇒</span><span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="bound">y</span> <span class="keyword1">of</span>
                                   <span class="main">⌊</span>allow <span class="bound">d2</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>allow<span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">)</span><span class="main">⌋</span> 
                                 <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">d2</span><span class="main">⌋</span>  <span class="main">⇒</span> <span class="main">⌊</span>deny <span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">)</span><span class="main">⌋</span> 
                                 <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>
           <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> prod_orA_mt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∅</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_orA_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mt_prod_orA<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="free">p</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_orA_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> prod_orA_quasi_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p2</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="free">p1</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="free">p1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="free">p2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_orA_def policy_range_comp_def o_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prod_orD</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'α</span> <span class="main">↦</span> <span class="tfree">'β</span><span class="main">,</span> <span class="tfree">'γ</span> <span class="main">↦</span>   <span class="tfree">'δ</span><span class="main">]</span> <span class="main">⇒</span>  <span class="main">(</span><span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'γ</span> <span class="main">↦</span>  <span class="tfree">'β</span> <span class="main">×</span> <span class="tfree">'δ</span> <span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>D</sub></span>"</span> 55<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="keyword1"><span class="free">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>D</sub></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="main">=</span>
       <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="bound">x</span> <span class="keyword1">of</span>
             <span class="main">⌊</span>allow <span class="bound">d1</span><span class="main">⌋</span> <span class="main">⇒</span><span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="bound">y</span> <span class="keyword1">of</span> 
                                   <span class="main">⌊</span>allow <span class="bound">d2</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>allow<span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">)</span><span class="main">⌋</span>
                                 <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">d2</span><span class="main">⌋</span>  <span class="main">⇒</span> <span class="main">⌊</span>deny<span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">)</span><span class="main">⌋</span>
                                 <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span> 
           <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">d1</span><span class="main">⌋</span><span class="main">⇒</span><span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="bound">y</span> <span class="keyword1">of</span>
                                   <span class="main">⌊</span>allow <span class="bound">d2</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>deny<span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">)</span><span class="main">⌋</span> 
                                 <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">d2</span><span class="main">⌋</span>  <span class="main">⇒</span> <span class="main">⌊</span>deny <span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">)</span><span class="main">⌋</span> 
                                 <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>
           <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prod_orD_mt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>D</sub></span> <span class="main">∅</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_orD_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> mt_prod_orD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>D</sub></span> <span class="free">p</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_orD_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> prod_orD_quasi_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p2</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>D</sub></span> <span class="free">p1</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="free">p1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>D</sub></span> <span class="free">p2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_orD_def policy_range_comp_def o_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The following two combinators are by definition non-commutative, but still strict. 
›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prod_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span><span class="main">,</span> <span class="tfree">'γ</span> <span class="main">↦</span><span class="tfree">'δ</span><span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">×</span><span class="tfree">'γ</span> <span class="main">↦</span> <span class="tfree">'β</span><span class="main">×</span><span class="tfree">'δ</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⨂<span class="hidden">⇩</span><sub>1</sub></span>"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="main"><span class="free">⨂<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="main">≡</span>
       <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="bound">x</span> <span class="keyword1">of</span>
             <span class="main">⌊</span>allow <span class="bound">d1</span><span class="main">⌋</span><span class="main">⇒</span><span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="bound">y</span> <span class="keyword1">of</span> 
                                   <span class="main">⌊</span>allow <span class="bound">d2</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>allow<span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">)</span><span class="main">⌋</span>
                                 <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">d2</span><span class="main">⌋</span>  <span class="main">⇒</span> <span class="main">⌊</span>allow<span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">)</span><span class="main">⌋</span>
                                 <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span> 
           <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">d1</span><span class="main">⌋</span> <span class="main">⇒</span><span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="bound">y</span> <span class="keyword1">of</span>
                                   <span class="main">⌊</span>allow <span class="bound">d2</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>deny<span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">)</span><span class="main">⌋</span>
                                 <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">d2</span><span class="main">⌋</span>  <span class="main">⇒</span> <span class="main">⌊</span>deny<span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">)</span><span class="main">⌋</span>
                                 <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>
           <span class="main">|</span><span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> prod_1_mt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⨂<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∅</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_1_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> mt_prod_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="main">⨂<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_1_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prod_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span><span class="main">,</span> <span class="tfree">'γ</span> <span class="main">↦</span><span class="tfree">'δ</span><span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">×</span><span class="tfree">'γ</span> <span class="main">↦</span> <span class="tfree">'β</span><span class="main">×</span><span class="tfree">'δ</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⨂<span class="hidden">⇩</span><sub>2</sub></span>"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="main"><span class="free">⨂<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="main">≡</span>
       <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="bound">x</span> <span class="keyword1">of</span>
             <span class="main">⌊</span>allow <span class="bound">d1</span><span class="main">⌋</span> <span class="main">⇒</span><span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="bound">y</span> <span class="keyword1">of</span> 
                                   <span class="main">⌊</span>allow <span class="bound">d2</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>allow<span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">)</span><span class="main">⌋</span>
                                 <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">d2</span><span class="main">⌋</span>  <span class="main">⇒</span> <span class="main">⌊</span>deny <span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">)</span><span class="main">⌋</span>
                                 <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span> 
           <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">d1</span><span class="main">⌋</span><span class="main">⇒</span><span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="bound">y</span> <span class="keyword1">of</span>
                                   <span class="main">⌊</span>allow <span class="bound">d2</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>allow<span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">)</span><span class="main">⌋</span>
                                 <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">d2</span><span class="main">⌋</span> <span class="main">⇒</span>  <span class="main">⌊</span>deny <span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">)</span><span class="main">⌋</span> 
                                 <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>
           <span class="main">|</span><span class="main">⊥</span> <span class="main">⇒</span><span class="main">⊥</span><span class="main">)</span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> prod_2_mt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∅</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_2_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> mt_prod_2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_2_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prod_1_id</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'γ</span><span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">↦</span> <span class="tfree">'β</span><span class="main">×</span><span class="tfree">'γ</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⨂<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>I</sub></span>"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">⨂<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>I</sub></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⨂<span class="hidden">⇩</span><sub>1</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> prod_1_id_mt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>I</sub></span> <span class="main">∅</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_1_id_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> mt_prod_1_id<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>I</sub></span> <span class="free">p</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_1_id_def prod_1_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prod_2_id</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'β</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">↦</span><span class="tfree">'γ</span><span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">↦</span> <span class="tfree">'β</span><span class="main">×</span><span class="tfree">'γ</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⨂<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>I</sub></span>"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span><span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">⨂<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>I</sub></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> prod_2_id_mt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>I</sub></span> <span class="main">∅</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_2_id_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> mt_prod_2_id<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>I</sub></span> <span class="free">p</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_2_id_def prod_2_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Combinators for Transition Policies›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  For constructing transition policies, two additional combinators are required: one combines 
  state transitions by pairing the states, the other works equivalently on general maps. 
›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">parallel_map</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">⇀</span> <span class="tfree">'β</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'δ</span> <span class="main">⇀</span> <span class="tfree">'γ</span><span class="main">)</span> <span class="main">⇒</span> 
                            <span class="main">(</span><span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'δ</span>  <span class="main">⇀</span> <span class="tfree">'β</span> <span class="main">×</span> <span class="tfree">'γ</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span>"</span> 60<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="keyword1"><span class="free">⨂<span class="hidden">⇩</span><sub>M</sub></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">⌊</span><span class="bound">d1</span><span class="main">⌋</span> <span class="main">⇒</span>
                              <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="bound">y</span> <span class="keyword1">of</span> <span class="main">⌊</span><span class="bound">d2</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span><span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">)</span><span class="main">⌋</span>
                                                <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>
                                      <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">parallel_st</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'i</span> <span class="main">×</span> <span class="tfree">'σ</span> <span class="main">⇀</span> <span class="tfree">'σ</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">×</span> <span class="tfree">'σ'</span> <span class="main">⇀</span> <span class="tfree">'σ'</span><span class="main">)</span> <span class="main">⇒</span> 
                            <span class="main">(</span><span class="tfree">'i</span> <span class="main">×</span> <span class="tfree">'σ</span> <span class="main">×</span> <span class="tfree">'σ'</span> <span class="main">⇀</span> <span class="tfree">'σ</span> <span class="main">×</span> <span class="tfree">'σ'</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⨂<span class="hidden">⇩</span><sub>S</sub></span>"</span> 60<span class="main">)</span> 
<span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="keyword1"><span class="free">⨂<span class="hidden">⇩</span><sub>S</sub></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="bound">a</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Range Splitting›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The following combinator is a special case of both a parallel composition operator and a 
  range splitting operator. Its primary use case is when combining a policy with state transitions. 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">comp_ran_split</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'α</span> <span class="main">⇀</span> <span class="tfree">'γ</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">⇀</span><span class="tfree">'γ</span><span class="main">)</span><span class="main">,</span> <span class="tfree">'d</span> <span class="main">↦</span> <span class="tfree">'β</span><span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">↦</span> <span class="main">(</span><span class="tfree">'β</span> <span class="main">×</span> <span class="tfree">'γ</span><span class="main">)</span>"</span></span>
                          <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⨂<span class="hidden">⇩</span><sub>∇</sub></span>"</span> 100<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">⨂<span class="hidden">⇩</span><sub>∇</sub></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="keyword1">of</span> 
                          <span class="main">⌊</span>allow <span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span> <span class="main">|</span> <span class="main">⌊</span><span class="bound">z</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>allow <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">⌋</span><span class="main">)</span>
                        <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span>  <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span> <span class="main">|</span> <span class="main">⌊</span><span class="bound">z</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span>deny <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">⌋</span><span class="main">)</span>
                        <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹An alternative characterisation of the operator is as follows:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> comp_ran_split_charn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">g</span><span class="main">)</span>  <span class="main">⨂<span class="hidden">⇩</span><sub>∇</sub></span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span>
<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p</span>  <span class="main">▹</span> Allow<span class="main">)</span><span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="keyword1">A<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">⨁</span> 
 <span class="main">(</span><span class="main">(</span><span class="free">p</span>  <span class="main">▹</span> Deny<span class="main">)</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="keyword1">D<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_ran_split_def map_add_def o_def ran_restrict_def image_def
      Allow_def Deny_def dom_restrict_def prod_orA_def 
      allow_pfun_def deny_pfun_def 
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>option.splits decision.splits<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Distributivity of the parallel combinators›</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> distr_or1_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span> <span class="main">=</span> <span class="free">F1</span> <span class="main">⨁</span> <span class="free">F2</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">N</span>  <span class="main">⨂<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">F</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">N</span> <span class="main">⨂<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">F1</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span>  <span class="main">⨁</span> <span class="main">(</span><span class="main">(</span><span class="free">N</span>   <span class="main">⨂<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">F2</span><span class="main">)</span>  <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  prod_1_def map_add_def 
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> decision.splits option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_1_def map_add_def 
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> decision.splits option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> distr_or1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span> <span class="main">=</span> <span class="free">F1</span> <span class="main">⨁</span> <span class="free">F2</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span><span class="main">(</span><span class="free">g</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">N</span>  <span class="main">⨂<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">F</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">(</span><span class="free">g</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">N</span> <span class="main">⨂<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">F1</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">⨁</span>  <span class="main">(</span><span class="free">g</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">N</span> <span class="main">⨂<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">F2</span><span class="main">)</span>  <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_1_def map_add_def policy_range_comp_def 
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> decision.splits option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_1_def map_add_def 
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> decision.splits option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    
<span class="keyword1"><span class="command">lemma</span></span> distr_or2_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span> <span class="main">=</span> <span class="free">F1</span> <span class="main">⨁</span> <span class="free">F2</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">N</span>  <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">F</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">N</span> <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">F1</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span>  <span class="main">⨁</span> <span class="main">(</span><span class="main">(</span><span class="free">N</span>  <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">F2</span><span class="main">)</span>  <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_2_id_def prod_2_def map_add_def 
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> decision.splits option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_2_def map_add_def 
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> decision.splits option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> distr_or2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span> <span class="main">=</span> <span class="free">F1</span> <span class="main">⨁</span> <span class="free">F2</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">N</span>  <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">F</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">N</span> <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">F1</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>  <span class="main">⨁</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">N</span>  <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">F2</span><span class="main">)</span>  <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_2_id_def prod_2_def map_add_def policy_range_comp_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> decision.splits option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_2_def map_add_def 
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> decision.splits option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    
<span class="keyword1"><span class="command">lemma</span></span> distr_orA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span> <span class="main">=</span> <span class="free">F1</span> <span class="main">⨁</span> <span class="free">F2</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span><span class="main">(</span><span class="free">g</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">N</span>  <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="free">F</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">(</span><span class="free">g</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">N</span>  <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="free">F1</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>  <span class="main">⨁</span>  <span class="main">(</span><span class="free">g</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">N</span>  <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="free">F2</span><span class="main">)</span>  <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_orA_def map_add_def policy_range_comp_def 
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> decision.splits option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  map_add_def 
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> decision.splits option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    
<span class="keyword1"><span class="command">lemma</span></span> distr_orD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span> <span class="main">=</span> <span class="free">F1</span> <span class="main">⨁</span> <span class="free">F2</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span><span class="main">(</span><span class="free">g</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">N</span>  <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>D</sub></span> <span class="free">F</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">(</span><span class="free">g</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">N</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>D</sub></span> <span class="free">F1</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>  <span class="main">⨁</span>  <span class="main">(</span><span class="free">g</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">N</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>D</sub></span> <span class="free">F2</span><span class="main">)</span>  <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_orD_def map_add_def policy_range_comp_def 
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> decision.splits option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  map_add_def 
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> decision.splits option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    
<span class="keyword1"><span class="command">lemma</span></span> coerc_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="keyword1">o_f</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">d</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">o</span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> policy_range_comp_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> ParallelDefs <span class="main">=</span> prod_orA_def prod_orD_def prod_1_def prod_2_def parallel_map_def 
                      parallel_st_def comp_ran_split_def
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Normalisation">
<div class="head">
<h1>Theory Normalisation</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * HOL-TestGen --- theorem-prover based test case generation
 *                 http://www.brucker.ch/projects/hol-testgen/
 *                                                                            
 * This file is part of HOL-TestGen.
 *
 * Copyright (c) 2005-2012 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2017 Université Paris-Sud, France
 *               2015-2017 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Policy Transformations›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  Normalisation
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="SeqComposition.html">SeqComposition</a>
    <a href="ParallelComposition.html">ParallelComposition</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This theory provides the formalisations required for the transformation of UPF policies. 
  A typical usage scenario can be observed in the firewall case 
  study~\cite{brucker.ea:formal-fw-testing:2014}.
›</span></span>
  
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Elementary Operators›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  We start by providing several operators and theorems useful when reasoning about a list of 
  rules which should eventually be interpreted as combined using the standard override operator. 
›</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The following definition takes as argument a list of rules and returns a policy where the
  rules are combined using the standard override operator.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">list2policy</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">list2policy</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> foldr <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⨁</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">∅</span>"</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Determine the position of element of a list. 
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">position</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> <span class="main">⇒</span> <span class="tfree">'α</span> list <span class="main">⇒</span>  nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">position</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">[]</span>       <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">position</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">position</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Provides the first applied rule of a policy given as a list of rules. 
›</span></span>
<span class="keyword1"><span class="command">fun</span></span>  <span class="entity">applied_rule</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">applied_rule</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> dom <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>
                                 <span class="keyword1">else</span> <span class="main">(</span><span class="free">applied_rule</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">applied_rule</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">[]</span>    <span class="main">=</span> None"</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following is used if the list is constructed backwards. 
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">applied_rule_rev</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">applied_rule_rev</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span>  applied_rule <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>rev <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The following is a typical policy transformation. It can be applied to any type of policy and
  removes all the rules from a policy with an empty domain. It takes two arguments: a semantic
  interpretation function and a list of rules. 
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rm_MT_rules</span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rm_MT_rules</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> dom <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">=</span> <span class="main">{}</span>
                             <span class="keyword1">then</span> <span class="free">rm_MT_rules</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>
                             <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="main">(</span><span class="free">rm_MT_rules</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">rm_MT_rules</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following invariant establishes that there are no rules with an empty domain in a list 
  of rules. 
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">none_MT_rules</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">none_MT_rules</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>dom <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span>  <span class="main">(</span><span class="free">none_MT_rules</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">none_MT_rules</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">[]</span> <span class="main">=</span> True"</span></span> 
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The following related invariant establishes that the policy has not a completely empty domain. 
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">not_MT</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">not_MT</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>dom <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">not_MT</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="keyword1">else</span> True<span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">not_MT</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">[]</span> <span class="main">=</span> False"</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Next, a few theorems about the two invariants and the transformation:
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> none_MT_rules_vs_notMT<span class="main">:</span> <span class="quoted"><span class="quoted">"none_MT_rules  <span class="free">C</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> not_MT <span class="free">C</span> <span class="free">p</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> rmnMT<span class="main">:</span> <span class="quoted"><span class="quoted">"none_MT_rules <span class="free">C</span> <span class="main">(</span>rm_MT_rules <span class="free">C</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> rmnMT2<span class="main">:</span> <span class="quoted"><span class="quoted">"none_MT_rules <span class="free">C</span>  <span class="free">p</span> <span class="main">⟹</span>  <span class="main">(</span>rm_MT_rules <span class="free">C</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> nMTcharn<span class="main">:</span> <span class="quoted"><span class="quoted">"none_MT_rules <span class="free">C</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free">p</span><span class="main">.</span> dom <span class="main">(</span><span class="free">C</span> <span class="bound">r</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> nMTeqSet<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">=</span> set <span class="free">s</span> <span class="main">⟹</span> none_MT_rules <span class="free">C</span> <span class="free">p</span> <span class="main">=</span> none_MT_rules <span class="free">C</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nMTcharn<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> notMTnMT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">a</span> <span class="main">∈</span> set <span class="free">p</span><span class="main">;</span> none_MT_rules <span class="free">C</span> <span class="free">p</span><span class="main">⟧</span> <span class="main">⟹</span> dom <span class="main">(</span><span class="free">C</span> <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nMTcharn<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> none_MT_rulesconc<span class="main">:</span> <span class="quoted"><span class="quoted">"none_MT_rules <span class="free">C</span> <span class="main">(</span><span class="free">a</span><span class="main">@</span><span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main">)</span> <span class="main">⟹</span> none_MT_rules <span class="free">C</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> nMTtail<span class="main">:</span> <span class="quoted"><span class="quoted">"none_MT_rules <span class="free">C</span> <span class="free">p</span> <span class="main">⟹</span> none_MT_rules <span class="free">C</span> <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> not_MTimpnotMT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"not_MT <span class="free">C</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    
<span class="keyword1"><span class="command">lemma</span></span> SR3nMT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> not_MT <span class="free">C</span>  <span class="free">p</span> <span class="main">⟹</span> rm_MT_rules <span class="free">C</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> NMPcharn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">a</span> <span class="main">∈</span> set <span class="free">p</span><span class="main">;</span> dom <span class="main">(</span><span class="free">C</span> <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span> not_MT <span class="free">C</span>  <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> NMPrm<span class="main">:</span> <span class="quoted"><span class="quoted">"not_MT <span class="free">C</span>  <span class="free">p</span> <span class="main">⟹</span> not_MT <span class="free">C</span> <span class="main">(</span>rm_MT_rules <span class="free">C</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Next, a few theorems about applied\_rule:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> mrconc<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟹</span> applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Nil
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">xs</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> snoc 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def if_splits<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> mreq_end<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="free">b</span> <span class="main">=</span> Some <span class="free">r</span><span class="main">;</span> applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="free">c</span> <span class="main">=</span> Some <span class="free">r</span><span class="main">⟧</span> <span class="main">⟹</span> 
 applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mrconc<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> mrconcNone<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> None <span class="main">⟹</span>
                                applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">ys</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> snoc 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span><span class="free">C</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True snoc
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False snoc
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> mreq_endNone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="free">b</span> <span class="main">=</span> None<span class="main">;</span> applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="free">c</span> <span class="main">=</span> None<span class="main">⟧</span> <span class="main">⟹</span> 
     applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mrconcNone<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> mreq_end2<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="free">b</span> <span class="main">=</span> applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="free">c</span> <span class="main">⟹</span> 
     applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="free">b</span> <span class="main">=</span> None"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mreq_end mreq_endNone<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> mreq_end3<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="free">p</span> <span class="main">≠</span> None <span class="main">⟹</span>
                  applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="main">(</span><span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mrconc<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> mrNoneMT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">r</span> <span class="main">∈</span> set <span class="free">p</span><span class="main">;</span> applied_rule_rev <span class="free">C</span> <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> None<span class="main">⟧</span> <span class="main">⟹</span>
                              <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span><span class="free">C</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Nil
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> snoc
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> set <span class="skolem">ys</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> snoc True
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> snoc False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Distributivity of the Transformation.›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The scenario is the following (can be applied iteratively):
  \begin{itemize}
    \item Two policies are combined using one of the parallel combinators
    \item (e.g. P = P1 P2) (At least) one of the constituent policies has
    \item a normalisation procedures, which as output produces a list of
    \item policies that are semantically equivalent to the original policy if
    \item combined from left to right using the override operator.
  \end{itemize}
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The following function is crucial for the distribution. Its arguments are a policy, a list
  of policies, a parallel combinator, and a range and a domain coercion function. 
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">prod_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">↦</span><span class="tfree">'β</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'γ</span> <span class="main">↦</span><span class="tfree">'δ</span><span class="main">)</span> list<span class="main">)</span> <span class="main">⇒</span> 
                  <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span> <span class="main">↦</span><span class="tfree">'β</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'γ</span> <span class="main">↦</span><span class="tfree">'δ</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'γ</span><span class="main">)</span> <span class="main">↦</span> <span class="main">(</span><span class="tfree">'β</span> <span class="main">×</span> <span class="tfree">'δ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span>
                  <span class="main">(</span><span class="main">(</span><span class="tfree">'β</span> <span class="main">×</span> <span class="tfree">'δ</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'y</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'γ</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span>  
                  <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">↦</span> <span class="tfree">'y</span><span class="main">)</span> list<span class="main">)</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⨂<span class="hidden">⇩</span><sub>L</sub></span>"</span> 54<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prod_list</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">par_comb</span></span></span> <span class="free"><span class="bound"><span class="entity">ran_adapt</span></span></span> <span class="free"><span class="bound"><span class="entity">dom_adapt</span></span></span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">ran_adapt</span></span></span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">par_comb</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="keyword1">o</span> <span class="free"><span class="bound"><span class="entity">dom_adapt</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="free">prod_list</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="free"><span class="bound"><span class="entity">par_comb</span></span></span> <span class="free"><span class="bound"><span class="entity">ran_adapt</span></span></span> <span class="free"><span class="bound"><span class="entity">dom_adapt</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">prod_list</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">par_comb</span></span></span> <span class="free"><span class="bound"><span class="entity">ran_adapt</span></span></span> <span class="free"><span class="bound"><span class="entity">dom_adapt</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  An instance, as usual there are four of them. 
›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prod_2_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'α</span> <span class="main">↦</span><span class="tfree">'β</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'γ</span> <span class="main">↦</span><span class="tfree">'δ</span><span class="main">)</span> list<span class="main">)</span><span class="main">]</span> <span class="main">⇒</span> 
                  <span class="main">(</span><span class="main">(</span><span class="tfree">'β</span> <span class="main">×</span> <span class="tfree">'δ</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'y</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'γ</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> 
                  <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">↦</span> <span class="tfree">'y</span><span class="main">)</span> list<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⨂<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>L</sub></span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">⨂<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>L</sub></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span>  <span class="main">(</span><span class="main">λ</span> <span class="bound">d</span> <span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>L</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">(⨂<span class="hidden">⇩</span><sub>2</sub>)</span> <span class="bound">d</span> <span class="bound">r</span><span class="main">)</span>"</span></span>  
  
<span class="keyword1"><span class="command">lemma</span></span> list2listNMT<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> map <span class="free">sem</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> two_conc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prod_list <span class="free">x</span> <span class="main">(</span><span class="free">y</span><span class="main">#</span><span class="free">ys</span><span class="main">)</span> <span class="free">p</span> <span class="free">r</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>prod_list <span class="free">x</span> <span class="free">ys</span> <span class="free">p</span> <span class="free">r</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The following two invariants establish if the law of distributivity holds for a combinator
  and if an operator is strict regarding undefinedness. 
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_distr</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">is_distr</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">g</span> <span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">N</span> <span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">g</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">N</span> <span class="main">(</span><span class="bound">P1</span> <span class="main">⨁</span> <span class="bound">P2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">(</span><span class="bound">g</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">N</span> <span class="bound">P1</span><span class="main">)</span> <span class="keyword1">o</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">⨁</span> <span class="main">(</span><span class="bound">g</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">N</span> <span class="bound">P2</span><span class="main">)</span>  <span class="keyword1">o</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_strict</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">is_strict</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">r</span> <span class="bound">d</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">P1</span><span class="main">.</span> <span class="main">(</span><span class="bound">r</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">P1</span> <span class="main">∅</span> <span class="main">∘</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">∅</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_distr_orD<span class="main">:</span> <span class="quoted"><span class="quoted">"is_distr <span class="keyword1">(⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>D</sub>)</span> <span class="free">d</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_distr_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> distr_orD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> is_strict_orD<span class="main">:</span> <span class="quoted"><span class="quoted">"is_strict <span class="keyword1">(⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>D</sub>)</span> <span class="free">d</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_strict_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> policy_range_comp_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> is_distr_2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_distr <span class="main">(⨂<span class="hidden">⇩</span><sub>2</sub>)</span> <span class="free">d</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_distr_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> distr_or2<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
<span class="keyword1"><span class="command">lemma</span></span> is_strict_2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_strict <span class="main">(⨂<span class="hidden">⇩</span><sub>2</sub>)</span> <span class="free">d</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> is_strict_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> policy_range_comp_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> domStart<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> dom <span class="free">p1</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">p1</span> <span class="main">⨁</span> <span class="free">p2</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">p1</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_add_dom_app_simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> notDom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="free">A</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">A</span> <span class="free">x</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The following theorems are crucial: they establish the correctness of the distribution.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> Norm_Distr_1<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="main">(⨂<span class="hidden">⇩</span><sub>1</sub>)</span> <span class="free">P1</span> <span class="main">(</span>list2policy <span class="free">P2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> 
                                                   <span class="main">(</span><span class="main">(</span>list2policy <span class="main">(</span><span class="main">(</span><span class="free">P1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">P2</span><span class="main">)</span> <span class="main">(⨂<span class="hidden">⇩</span><sub>1</sub>)</span> <span class="free">r</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">P2</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> policy_range_comp_def  list2policy_def<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span><span class="free">r</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">P1</span> <span class="main">⨂<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∘</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list2policy_def policy_range_comp_def  prod_1_def 
          <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits prod.splits<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list2policy_def policy_range_comp_def  map_add_dom_app_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> prod_1_def
          <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits prod.splits<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> Norm_Distr_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="main">(⨂<span class="hidden">⇩</span><sub>2</sub>)</span> <span class="free">P1</span> <span class="main">(</span>list2policy <span class="free">P2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> 
                               <span class="main">(</span><span class="main">(</span>list2policy <span class="main">(</span><span class="main">(</span><span class="free">P1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">P2</span><span class="main">)</span> <span class="main">(⨂<span class="hidden">⇩</span><sub>2</sub>)</span> <span class="free">r</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">P2</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> policy_range_comp_def  list2policy_def<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span><span class="free">r</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">P1</span> <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∘</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list2policy_def prod_2_def policy_range_comp_def 
          <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits prod.splits<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  policy_range_comp_def  list2policy_def map_add_dom_app_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> prod_2_def
          <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits prod.splits<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> Norm_Distr_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">(⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>A</sub>)</span> <span class="free">P1</span> <span class="main">(</span>list2policy <span class="free">P2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> 
                                                 <span class="main">(</span><span class="main">(</span>list2policy <span class="main">(</span><span class="main">(</span><span class="free">P1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">P2</span><span class="main">)</span> <span class="keyword1">(⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>A</sub>)</span> <span class="free">r</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">P2</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> policy_range_comp_def  list2policy_def<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span><span class="free">r</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">P1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∘</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> policy_range_comp_def  list2policy_def prod_orA_def
          <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits prod.splits<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> policy_range_comp_def  list2policy_def map_add_dom_app_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> prod_orA_def
          <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits prod.splits<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

  
<span class="keyword1"><span class="command">lemma</span></span> Norm_Distr_D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">(⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>D</sub>)</span> <span class="free">P1</span> <span class="main">(</span>list2policy <span class="free">P2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> 
                                                  <span class="main">(</span><span class="main">(</span>list2policy <span class="main">(</span><span class="main">(</span><span class="free">P1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">P2</span><span class="main">)</span> <span class="keyword1">(⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>D</sub>)</span> <span class="free">r</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">P2</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> policy_range_comp_def  list2policy_def<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span><span class="free">r</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">P1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>D</sub></span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∘</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> policy_range_comp_def  list2policy_def prod_orD_def
          <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits prod.splits<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> policy_range_comp_def  list2policy_def map_add_dom_app_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> prod_orD_def
          <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits prod.splits<span class="main">)</span>  
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some domain reasoning›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> domSubsetDistr1<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="free">A</span> <span class="main">=</span> UNIV <span class="main">⟹</span> dom <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="free">A</span> <span class="main">⨂<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prod_1_def policy_range_comp_def dom_def  
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> decision.splits option.splits prod.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> domSubsetDistr2<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="free">A</span> <span class="main">=</span> UNIV <span class="main">⟹</span> dom <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="free">A</span> <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prod_2_def policy_range_comp_def dom_def 
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> decision.splits option.splits prod.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> domSubsetDistrA<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="free">A</span> <span class="main">=</span> UNIV <span class="main">⟹</span> dom <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prod_orA_def policy_range_comp_def dom_def 
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> decision.splits option.splits prod.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> domSubsetDistrD<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="free">A</span> <span class="main">=</span> UNIV <span class="main">⟹</span> dom <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>D</sub></span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prod_orD_def policy_range_comp_def dom_def 
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> decision.splits option.splits prod.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword2"><span class="keyword">end</span></span>


</pre>
</div><div id="NormalisationTestSpecification">
<div class="head">
<h1>Theory NormalisationTestSpecification</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * HOL-TestGen --- theorem-prover based test case generation
 *                 http://www.brucker.ch/projects/hol-testgen/
 *                                                                            
 * This file is part of HOL-TestGen.
 *
 * Copyright (c) 2005-2012 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2017 Université Paris-Sud, France
 *               2015-2017 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Policy Transformation for Testing›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  NormalisationTestSpecification
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="Normalisation.html">Normalisation</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This theory provides functions and theorems which are useful if one wants to test policy 
  which are transformed. Most exist in two versions: one where the domains of the rules
  of the list (which is the result of a transformation) are pairwise disjoint, and one where 
  this applies not for the last rule in a list (which is usually a default rules).

  The examples in the firewall case study provide a good documentation how these theories can
  be applied. 
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This invariant establishes that the domains of a list of rules are pairwise disjoint. 
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">disjDom</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">disjDom</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">.</span> dom <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∩</span> dom <span class="bound">y</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="free">disjDom</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">disjDom</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span> 

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">PUTList</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">⇒</span> bool"</span></span>
 <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">PUTList</span> <span class="free"><span class="bound"><span class="entity">PUT</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> dom <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">PUT</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">PUTList</span> <span class="free"><span class="bound"><span class="entity">PUT</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">PUTList</span> <span class="free"><span class="bound"><span class="entity">PUT</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">[]</span> <span class="main">=</span> True"</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> distrPUTL1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="free">P</span> <span class="main">⟹</span> <span class="main">(</span>list2policy <span class="free">PL</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">P</span> <span class="free">x</span>  
                             <span class="main">⟹</span>  <span class="main">(</span>PUTList <span class="free">PUT</span> <span class="free">x</span> <span class="free">PL</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">PUT</span> <span class="free">x</span> <span class="main">=</span> <span class="free">P</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">PL</span></span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list2policy_def dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> PUTList_None<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>list2policy <span class="free">list</span><span class="main">)</span> <span class="main">⟹</span> PUTList <span class="free">PUT</span> <span class="free">x</span> <span class="free">list</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list2policy_def dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> PUTList_DomMT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="free">list</span><span class="main">.</span> dom <span class="free">a</span> <span class="main">∩</span> dom <span class="bound">y</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">(</span>dom <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>list2policy <span class="free">list</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dom_def list2policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> distrPUTL2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="free">P</span> <span class="main">⟹</span> <span class="main">(</span>list2policy <span class="free">PL</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">P</span> <span class="free">x</span>  <span class="main">⟹</span> disjDom <span class="free">PL</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">PUT</span> <span class="free">x</span> <span class="main">=</span> <span class="free">P</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> PUTList <span class="free">PUT</span> <span class="free">x</span> <span class="free">PL</span> "</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">PL</span></span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list2policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a PL p
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="skolem">a</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"list2policy <span class="skolem">PL</span> <span class="free">x</span> <span class="main">=</span> <span class="free">P</span> <span class="free">x</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list2policy_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> PUTList_None<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> PUTList_DomMT<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list2policy_def dom_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> distrPUTL<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> dom <span class="free">P</span><span class="main">;</span> <span class="main">(</span>list2policy <span class="free">PL</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">P</span> <span class="free">x</span><span class="main">;</span> disjDom <span class="free">PL</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">PUT</span> <span class="free">x</span> <span class="main">=</span> <span class="free">P</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> PUTList <span class="free">PUT</span> <span class="free">x</span> <span class="free">PL</span> "</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> distrPUTL2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> PL <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">PL</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> distrPUTL1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  It makes sense to cater for the common special case where the normalisation returns a list 
  where the last element is a default-catch-all rule. It seems easier to cater for this globally,
  rather than to require the normalisation procedures to do this.  
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">gatherDomain_aux</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">gatherDomain_aux</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>dom <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∪</span> <span class="main">(</span><span class="free">gatherDomain_aux</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">gatherDomain_aux</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gatherDomain</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">gatherDomain</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>gatherDomain_aux <span class="main">(</span>butlast <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">PUTListGD</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">PUTListGD</span> <span class="free"><span class="bound"><span class="entity">PUT</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="main">(</span>gatherDomain <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> dom <span class="main">(</span>last <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">PUT</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span>last <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∧</span> 
                          <span class="main">(</span>PUTList <span class="free"><span class="bound"><span class="entity">PUT</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>butlast <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">disjDomGD</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">disjDomGD</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> disjDom <span class="main">(</span>butlast <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> distrPUTLG1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> dom <span class="free">P</span><span class="main">;</span> <span class="main">(</span>list2policy <span class="free">PL</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">P</span> <span class="free">x</span><span class="main">;</span> PUTListGD <span class="free">PUT</span> <span class="free">x</span> <span class="free">PL</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">PUT</span> <span class="free">x</span> <span class="main">=</span> <span class="free">P</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">PL</span></span><span class="main">)</span>  
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domIff PUTListGD_def disjDomGD_def gatherDomain_def list2policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dom_def domIff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> distrPUTLG2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">PL</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="free">P</span> <span class="main">⟹</span> <span class="main">(</span>list2policy <span class="main">(</span><span class="free">PL</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> disjDomGD <span class="free">PL</span> <span class="main">⟹</span> 
   <span class="main">(</span><span class="free">PUT</span> <span class="free">x</span> <span class="main">=</span> <span class="free">P</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> PUTListGD <span class="free">PUT</span> <span class="free">x</span> <span class="main">(</span><span class="free">PL</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PUTListGD_def disjDomGD_def gatherDomain_def list2policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">PL</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PUTList_DomMT PUTList_None domI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> distrPUTLG<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> dom <span class="free">P</span><span class="main">;</span> <span class="main">(</span>list2policy <span class="free">PL</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">P</span> <span class="free">x</span><span class="main">;</span> disjDomGD <span class="free">PL</span><span class="main">;</span> <span class="free">PL</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟧</span> <span class="main">⟹</span>  
  <span class="main">(</span><span class="free">PUT</span> <span class="free">x</span> <span class="main">=</span> <span class="free">P</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> PUTListGD <span class="free">PUT</span> <span class="free">x</span> <span class="free">PL</span> "</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> distrPUTLG2<span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> PL <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">PL</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> distrPUTLG1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword2"><span class="keyword">end</span></span>


</pre>
</div><div id="Analysis">
<div class="head">
<h1>Theory Analysis</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * HOL-TestGen --- theorem-prover based test case generation
 *                 http://www.brucker.ch/projects/hol-testgen/
 *                                                                            
 * UPF
 * This file is part of HOL-TestGen.
 *
 * Copyright (c) 2005-2012 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2017 Université Paris-Sud, France
 *               2015-2017 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************)</span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Properties on Policies›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  Analysis
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="ParallelComposition.html">ParallelComposition</a>
    <a href="SeqComposition.html">SeqComposition</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this theory, several standard policy properties are paraphrased in UPF terms. 
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Basic Properties›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹A Policy Has no Gaps›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gap_free</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">gap_free</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>dom <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> UNIV<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Comparing Policies›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Policy p is more defined than q:›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">more_defined</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span>bool"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">more_defined</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span>dom <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">⊆</span> dom <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">strictly_more_defined</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span>bool"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">strictly_more_defined</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span>dom <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">⊂</span> dom <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> strictly_more_vs_more<span class="main">:</span> <span class="quoted"><span class="quoted">"strictly_more_defined <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> more_defined <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> more_defined_def strictly_more_defined_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Policy p is more permissive than q:›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">more_permissive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊑<span class="hidden">⇩</span><sub>A</sub></span>"</span> 60<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">" <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">⊑<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span>  <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">⌊</span>allow <span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span> <span class="main">=</span> <span class="main">⌊</span>allow <span class="bound">z</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span>
                                   <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">y</span><span class="main">⌋</span>  <span class="main">⇒</span> True
                                   <span class="main">|</span> <span class="main">⊥</span>        <span class="main">⇒</span> True<span class="main">)</span><span class="main">)</span>"</span></span> 


<span class="keyword1"><span class="command">lemma</span></span> more_permissive_refl <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">p</span> "</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> more_permissive_def
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span> <span class="main"><span class="main">:</span></span> option.split decision.split<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> more_permissive_trans <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">p'</span> <span class="main">⟹</span> <span class="free">p'</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">p''</span> <span class="main">⟹</span>  <span class="free">p</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">p''</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> more_permissive_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span> <span class="main"><span class="main">:</span></span> option.split decision.split<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x y
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> 
        P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free">p''</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">⊥</span> <span class="main">⇒</span> True 
                                     <span class="main">|</span> <span class="main">⌊</span>allow <span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free">p'</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">⌊</span>allow <span class="bound">z</span><span class="main">⌋</span> 
                                     <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> True"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Policy p is more rejective than q:›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">more_rejective</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊑<span class="hidden">⇩</span><sub>D</sub></span>"</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">" <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">⊑<span class="hidden">⇩</span><sub>D</sub></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">⌊</span>deny <span class="bound">y</span><span class="main">⌋</span>  <span class="main">⇒</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span> <span class="main">=</span> <span class="main">⌊</span>deny <span class="bound">z</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span>
                                  <span class="main">|</span> <span class="main">⌊</span>allow <span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> True
                                  <span class="main">|</span> <span class="main">⊥</span>        <span class="main">⇒</span> True<span class="main">)</span><span class="main">)</span>"</span></span> 
    
    
<span class="keyword1"><span class="command">lemma</span></span> more_rejective_trans <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>D</sub></span> <span class="free">p'</span> <span class="main">⟹</span> <span class="free">p'</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>D</sub></span> <span class="free">p''</span> <span class="main">⟹</span>  <span class="free">p</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>D</sub></span> <span class="free">p''</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> more_rejective_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span> <span class="main"><span class="main">:</span></span> option.split decision.split<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x y
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> 
        P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free">p''</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">⊥</span> <span class="main">⇒</span> True 
                                     <span class="main">|</span> <span class="main">⌊</span>allow <span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> True 
                                     <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free">p'</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">⌊</span>deny <span class="bound">z</span><span class="main">⌋</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> more_rejective_refl <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>D</sub></span> <span class="free">p</span> "</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> more_rejective_def
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span> <span class="main"><span class="main">:</span></span> option.split decision.split<span class="main">)</span>
    
    
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">A<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">f</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> more_permissive_def allow_all_fun_def allow_pfun_def 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split decision.split<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">A<span class="hidden">⇩</span><sub>I</sub></span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> more_permissive_def allow_all_fun_def allow_pfun_def allow_all_id_def
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split decision.split<span class="main">)</span>
    
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Combined Data-Policy Refinement›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy_refinement</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a'</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span><span class="main">(</span><span class="tfree">'b'</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a'</span> <span class="main">↦</span> <span class="tfree">'b'</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> 
  <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊑<span class="hidden">⇘</span><sub></sub></span>_<span class="keyword1"><span class="hidden">⇙</span><span class="hidden">⇩</span><sub>,</sub><span class="hidden">⇘</span><sub></sub></span>_<span class="keyword1"><span class="hidden">⇙</span></span> _"</span> <span class="main">[</span>50<span class="main">,</span>50<span class="main">,</span>50<span class="main">,</span>50<span class="main">]</span>50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="free">⊑<span class="hidden">⇘</span><sub></sub></span></span><span class="free"><span class="bound"><span class="entity">abs<span class="hidden">⇩</span><sub>a</sub></span></span></span><span class="main"><span class="free"><span class="hidden">⇙</span><span class="hidden">⇩</span><sub>,</sub><span class="hidden">⇘</span><sub></sub></span></span><span class="free"><span class="bound"><span class="entity">abs<span class="hidden">⇩</span><sub>b</sub></span></span></span><span class="main"><span class="free"><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> 
              <span class="main">(</span><span class="main">∀</span> <span class="bound">a</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">a</span> <span class="keyword1">of</span> 
                      <span class="main">⊥</span> <span class="main">⇒</span> True
                    <span class="main">|</span> <span class="main">⌊</span>allow <span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a'</span><span class="main">∈</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">abs<span class="hidden">⇩</span><sub>a</sub></span></span></span> <span class="bound">x</span><span class="main">=</span><span class="bound">a</span><span class="main">}</span><span class="main">.</span> 
                                     <span class="main">∃</span> <span class="bound">b'</span><span class="main">.</span>  <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">a'</span> <span class="main">=</span> <span class="main">⌊</span>allow <span class="bound">b'</span><span class="main">⌋</span>
                                            <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">abs<span class="hidden">⇩</span><sub>b</sub></span></span></span> <span class="bound">b'</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>
                    <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a'</span><span class="main">∈</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">abs<span class="hidden">⇩</span><sub>a</sub></span></span></span> <span class="bound">x</span><span class="main">=</span><span class="bound">a</span><span class="main">}</span><span class="main">.</span> 
                                     <span class="main">∃</span> <span class="bound">b'</span><span class="main">.</span>  <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">a'</span> <span class="main">=</span> <span class="main">⌊</span>deny <span class="bound">b'</span><span class="main">⌋</span>
                                            <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">abs<span class="hidden">⇩</span><sub>b</sub></span></span></span> <span class="bound">b'</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>                                     
    
<span class="keyword1"><span class="command">theorem</span></span> polref_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊑<span class="hidden">⇘</span><sub></sub></span>id<span class="main"><span class="hidden">⇙</span><span class="hidden">⇩</span><sub>,</sub><span class="hidden">⇘</span><sub></sub></span>id<span class="main"><span class="hidden">⇙</span></span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> policy_refinement_def
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split decision.split<span class="main">)</span>
    
<span class="keyword1"><span class="command">theorem</span></span> polref_trans<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊑<span class="hidden">⇘</span><sub></sub></span><span class="free">f</span><span class="main"><span class="hidden">⇙</span><span class="hidden">⇩</span><sub>,</sub><span class="hidden">⇘</span><sub></sub></span><span class="free">g</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">p'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">⊑<span class="hidden">⇘</span><sub></sub></span><span class="free">f'</span><span class="main"><span class="hidden">⇙</span><span class="hidden">⇩</span><sub>,</sub><span class="hidden">⇘</span><sub></sub></span><span class="free">g'</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">p''</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊑<span class="hidden">⇘</span><sub></sub></span><span class="free">f</span> <span class="keyword1">o</span> <span class="free">f'</span><span class="main"><span class="hidden">⇙</span><span class="hidden">⇩</span><sub>,</sub><span class="hidden">⇘</span><sub></sub></span><span class="free">g</span> <span class="keyword1">o</span> <span class="free">g'</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">p''</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> A B<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> policy_refinement_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split decision.split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a a'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">f'</span> <span class="skolem">a'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="skolem">a'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">f'</span> <span class="skolem">a'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a a'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">f'</span> <span class="skolem">a'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="skolem">a'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">f'</span> <span class="skolem">a'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Equivalence of Policies›</span></span>
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Equivalence over domain D›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">p_eq_dom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span>bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">≈<span class="hidden">⇘</span><sub></sub></span>_<span class="keyword1"><span class="hidden">⇙</span></span> _"</span> <span class="main">[</span>60<span class="main">,</span>60<span class="main">,</span>60<span class="main">]</span>60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="free">≈<span class="hidden">⇘</span><sub></sub></span></span><span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main"><span class="free"><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>  <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹p and q have no conflicts›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">no_conflicts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">↦</span> <span class="tfree">'b</span><span class="main">)</span>  <span class="main">⇒</span>bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">no_conflicts</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span>dom <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> dom <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span>dom <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">.</span> 
    <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">⌊</span>allow <span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">x</span> <span class="main">=</span> <span class="main">⌊</span>allow <span class="bound">z</span><span class="main">⌋</span><span class="main">)</span>
               <span class="main">|</span> <span class="main">⌊</span>deny <span class="bound">y</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">x</span> <span class="main">=</span> <span class="main">⌊</span>deny <span class="bound">z</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> policy_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p_over_qA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">q</span> "</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  q_over_pA<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">p</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span>  p_over_qD<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>D</sub></span> <span class="free">p</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span>  q_over_pD<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>D</sub></span> <span class="free">q</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span>  dom_eq<span class="main">:</span>       <span class="quoted"><span class="quoted">"dom <span class="free">p</span> <span class="main">=</span> dom <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>                <span class="quoted"><span class="quoted">"no_conflicts <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> p_over_qA q_over_pA p_over_qD q_over_pD dom_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  no_conflicts_def more_permissive_def more_rejective_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> domI domIff dom_eq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Miscellaneous›</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> dom_inter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>dom <span class="free">p</span> <span class="main">∩</span> dom <span class="free">q</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⌊</span><span class="free">y</span><span class="main">⌋</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> dom_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="free">p</span> <span class="main">∩</span> dom <span class="free">q</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">p</span> <span class="keyword1">⨁<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">⨁<span class="hidden">⇩</span><sub>D</sub></span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> override_A_def override_D_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dom_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits option.splits decision.splits <span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> dom_split_alt_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">g</span><span class="main">)</span> <span class="keyword1">Δ</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span>dom<span class="main">(</span><span class="free">p</span> <span class="main">▹</span> Allow<span class="main">)</span> <span class="main">◃</span> <span class="main">(</span><span class="keyword1">A<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">⨁</span> <span class="main">(</span>dom<span class="main">(</span><span class="free">p</span> <span class="main">▹</span> Deny<span class="main">)</span> <span class="main">◃</span> <span class="main">(</span><span class="keyword1">D<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_split2_def Allow_def Deny_def dom_restrict_def
      deny_all_fun_def allow_all_fun_def map_add_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_add_def o_def deny_pfun_def ran_restrict_def image_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="UPF">
<div class="head">
<h1>Theory UPF</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * HOL-TestGen --- theorem-prover based test case generation
 *                 http://www.brucker.ch/projects/hol-testgen/
 *                                                                            
 * UPF
 * This file is part of HOL-TestGen.
 *
 * Copyright (c) 2005-2012 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2017 Université Paris-Sud, France
 *               2015-2017 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Putting Everything Together: UPF›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  UPF
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="Normalisation.html">Normalisation</a>
    <a href="NormalisationTestSpecification.html">NormalisationTestSpecification</a>
    <a href="Analysis.html">Analysis</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This is the top-level theory for the Unified Policy Framework (UPF) and, thus, 
  builds the base theory for using UPF.  For the moment, we only define a set of 
  lemmas for all core UPF definitions that is useful for using UPF:
›</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> UPFDefs <span class="main">=</span> UPFCoreDefs ParallelDefs ElementaryPoliciesDefs
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Service">
<div class="head">
<h1>Theory Service</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * HOL-TestGen --- theorem-prover based test case generation
 *                 http://www.brucker.ch/projects/hol-testgen/
 *
 * This file is part of HOL-TestGen.
 *
 * Copyright (c) 2010-2012 ETH Zurich, Switzerland
 *               2010-2015 Achim D. Brucker, Germany
 *               2010-2017 Université Paris-Sud, France
 *               2015-2017 The Univeristy of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Secure Service Specification›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  Service
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="UPF.html">UPF</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we model a simple Web service and its access control model 
  that allows the staff in a hospital to access health care records of patients. 
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Datatypes for Modelling Users and Roles›</span></span>
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Users›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  First, we introduce a type for users that we use to model that each 
  staff member has a unique id:
›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> user <span class="main">=</span> <span class="quoted">int</span>  <span class="comment1">(* Each NHS employee has a unique NHS_ID. *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Similarly, each patient has a unique id:
›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> patient <span class="main">=</span> <span class="quoted">int</span> <span class="comment1">(* Each patient gets a unique id *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Roles and Relationships›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In our example, we assume three different roles for members of the clinical staff:›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> role <span class="main">=</span>  ClinicalPractitioner <span class="main">|</span> Nurse <span class="main">|</span> Clerical 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  We model treatment relationships (legitimate relationships) between staff and patients 
  (respectively, their health records. This access control model is inspired by our detailed 
  NHS model.
›</span></span>     
<span class="keyword1"><span class="command">type_synonym</span></span> lr_id <span class="main">=</span> <span class="quoted">int</span>
<span class="keyword1"><span class="command">type_synonym</span></span> LR    <span class="main">=</span> <span class="quoted"><span class="quoted">"lr_id <span class="main">⇀</span> <span class="main">(</span>user set<span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The security context stores all the existing LRs.›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> Σ <span class="main">=</span> <span class="quoted"><span class="quoted">"patient <span class="main">⇀</span> LR"</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The user context stores the roles the users are in.›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> υ <span class="main">=</span> <span class="quoted"><span class="quoted">"user <span class="main">⇀</span> role"</span></span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Modelling Health Records and the Web Service API›</span></span>
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Health Records›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The content and the status of the entries of a health record›</span></span>
<span class="keyword1"><span class="command">datatype</span></span> data         <span class="main">=</span> dummyContent 
<span class="keyword1"><span class="command">datatype</span></span> status       <span class="main">=</span> Open <span class="main">|</span> Closed
<span class="keyword1"><span class="command">type_synonym</span></span> entry_id <span class="main">=</span> <span class="quoted">int</span>
<span class="keyword1"><span class="command">type_synonym</span></span> entry    <span class="main">=</span> <span class="quoted"><span class="quoted">"status <span class="main">×</span> user <span class="main">×</span> data"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> SCR      <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>entry_id <span class="main">⇀</span> entry<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> DB       <span class="main">=</span> <span class="quoted"><span class="quoted">"patient <span class="main">⇀</span> SCR"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹The Web Service API›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The operations provided by the service:›</span></span>
<span class="keyword1"><span class="command">datatype</span></span> Operation <span class="main">=</span> createSCR <span class="quoted">user</span> <span class="quoted">role</span> <span class="quoted">patient</span>  
                   <span class="main">|</span> appendEntry <span class="quoted">user</span> <span class="quoted">role</span> <span class="quoted">patient</span> <span class="quoted">entry_id</span> <span class="quoted">entry</span>
                   <span class="main">|</span> deleteEntry <span class="quoted">user</span> <span class="quoted">role</span> <span class="quoted">patient</span> <span class="quoted">entry_id</span>  
                   <span class="main">|</span> readEntry <span class="quoted">user</span> <span class="quoted">role</span> <span class="quoted">patient</span> <span class="quoted">entry_id</span>
                   <span class="main">|</span> readSCR <span class="quoted">user</span> <span class="quoted">role</span> <span class="quoted">patient</span>
                   <span class="main">|</span> addLR <span class="quoted">user</span> <span class="quoted">role</span> <span class="quoted">patient</span> <span class="quoted">lr_id</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>user set<span class="main">)</span>"</span></span>
                   <span class="main">|</span> removeLR <span class="quoted">user</span> <span class="quoted">role</span> <span class="quoted">patient</span> <span class="quoted">lr_id</span>
                   <span class="main">|</span> changeStatus <span class="quoted">user</span> <span class="quoted">role</span> <span class="quoted">patient</span> <span class="quoted">entry_id</span> <span class="quoted">status</span>
                   <span class="main">|</span> deleteSCR <span class="quoted">user</span> <span class="quoted">role</span> <span class="quoted">patient</span> 
                   <span class="main">|</span> editEntry <span class="quoted">user</span> <span class="quoted">role</span> <span class="quoted">patient</span> <span class="quoted">entry_id</span> <span class="quoted">entry</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_createSCR</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">is_createSCR</span> <span class="main">(</span>createSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">is_createSCR</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_appendEntry</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_appendEntry</span> <span class="main">(</span>appendEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
 <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">is_appendEntry</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> False"</span></span> 

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_deleteEntry</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_deleteEntry</span> <span class="main">(</span>deleteEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e_id</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
 <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">is_deleteEntry</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_readEntry</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_readEntry</span> <span class="main">(</span>readEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
 <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">is_readEntry</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_readSCR</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_readSCR</span> <span class="main">(</span>readSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
 <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">is_readSCR</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_changeStatus</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_changeStatus</span> <span class="main">(</span>changeStatus <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
 <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">is_changeStatus</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_deleteSCR</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_deleteSCR</span> <span class="main">(</span>deleteSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
 <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">is_deleteSCR</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_addLR</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_addLR</span> <span class="main">(</span>addLR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">lrid</span></span></span> <span class="free"><span class="bound"><span class="entity">lr</span></span></span> <span class="free"><span class="bound"><span class="entity">us</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
 <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">is_addLR</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_removeLR</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_removeLR</span> <span class="main">(</span>removeLR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">lr</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
 <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">is_removeLR</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_editEntry</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_editEntry</span> <span class="main">(</span>editEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e_id</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
 <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">is_editEntry</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">SCROp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Operation <span class="main">×</span> DB<span class="main">)</span> <span class="main">⇀</span> SCR"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">SCROp</span> <span class="main">(</span><span class="main">(</span>createSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">SCROp</span> <span class="main">(</span><span class="main">(</span>appendEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">SCROp</span> <span class="main">(</span><span class="main">(</span>deleteEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e_id</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">SCROp</span> <span class="main">(</span><span class="main">(</span>readEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">SCROp</span> <span class="main">(</span><span class="main">(</span>readSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">SCROp</span> <span class="main">(</span><span class="main">(</span>changeStatus <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">SCROp</span> <span class="main">(</span><span class="main">(</span>deleteSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">SCROp</span> <span class="main">(</span><span class="main">(</span>editEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e_id</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">SCROp</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">patientOfOp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Operation <span class="main">⇒</span> patient"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">patientOfOp</span> <span class="main">(</span>createSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">patientOfOp</span> <span class="main">(</span>appendEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">patientOfOp</span> <span class="main">(</span>deleteEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e_id</span></span></span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">patientOfOp</span> <span class="main">(</span>readEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">patientOfOp</span> <span class="main">(</span>readSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">patientOfOp</span> <span class="main">(</span>changeStatus <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">patientOfOp</span> <span class="main">(</span>deleteSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">patientOfOp</span> <span class="main">(</span>addLR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">lr</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">patientOfOp</span> <span class="main">(</span>removeLR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">lr</span></span></span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">patientOfOp</span> <span class="main">(</span>editEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e_id</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">userOfOp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Operation <span class="main">⇒</span> user"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">userOfOp</span> <span class="main">(</span>createSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">userOfOp</span> <span class="main">(</span>appendEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">userOfOp</span> <span class="main">(</span>deleteEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e_id</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">userOfOp</span> <span class="main">(</span>readEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">userOfOp</span> <span class="main">(</span>readSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">userOfOp</span> <span class="main">(</span>changeStatus <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">userOfOp</span> <span class="main">(</span>deleteSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">userOfOp</span> <span class="main">(</span>editEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e_id</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">userOfOp</span> <span class="main">(</span>addLR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">lr</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">userOfOp</span> <span class="main">(</span>removeLR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">lr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">roleOfOp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Operation <span class="main">⇒</span> role"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">roleOfOp</span> <span class="main">(</span>createSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">roleOfOp</span> <span class="main">(</span>appendEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">roleOfOp</span> <span class="main">(</span>deleteEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e_id</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">roleOfOp</span> <span class="main">(</span>readEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">roleOfOp</span> <span class="main">(</span>readSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">roleOfOp</span> <span class="main">(</span>changeStatus <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">roleOfOp</span> <span class="main">(</span>deleteSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">roleOfOp</span> <span class="main">(</span>editEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e_id</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">roleOfOp</span> <span class="main">(</span>addLR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">lr</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">roleOfOp</span> <span class="main">(</span>removeLR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">lr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">contentOfOp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Operation <span class="main">⇒</span> data"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">contentOfOp</span> <span class="main">(</span>appendEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>snd <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">contentOfOp</span> <span class="main">(</span>editEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>snd <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">contentStatic</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Operation <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">contentStatic</span> <span class="main">(</span>appendEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>snd <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dummyContent<span class="main">)</span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">contentStatic</span> <span class="main">(</span>editEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>snd <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dummyContent<span class="main">)</span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">contentStatic</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">allContentStatic</span> <span class="keyword2"><span class="keyword">where</span></span> 
   <span class="quoted"><span class="quoted">"<span class="free">allContentStatic</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>contentStatic <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free">allContentStatic</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">allContentStatic</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Modelling Access Control›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In the following, we define a rather complex access control model for our 
  scenario that extends traditional role-based access control 
  (RBAC)~\cite{sandhu.ea:role-based:1996} with treatment relationships and sealed 
  envelopes. Sealed envelopes (see~\cite{bruegger:generation:2012} for details)
  are a variant of break-the-glass access control (see~\cite{brucker.ea:extending:2009} 
  for a general motivation and explanation of break-the-glass access control).
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sealed Envelopes›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> SEPolicy <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Operation <span class="main">×</span> DB <span class="main">↦</span>  unit<span class="main">)</span> "</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">get_entry</span><span class="main">::</span> <span class="quoted"><span class="quoted">"DB <span class="main">⇒</span> patient <span class="main">⇒</span> entry_id <span class="main">⇒</span> entry option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">get_entry</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e_id</span></span></span> <span class="main">=</span>   <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span>
                                    <span class="main">|</span> <span class="main">⌊</span><span class="bound">Scr</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="bound">Scr</span> <span class="free"><span class="bound"><span class="entity">e_id</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">userHasAccess</span><span class="main">::</span> <span class="quoted"><span class="quoted">"user <span class="main">⇒</span> entry <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">userHasAccess</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> Open <span class="main">∨</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">readEntrySE</span> <span class="main">::</span> <span class="quoted">SEPolicy</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">readEntrySE</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> <span class="main">(</span>readEntry <span class="bound">u</span> <span class="bound">r</span> <span class="bound">p</span> <span class="bound">e_id</span><span class="main">,</span><span class="bound">S</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> get_entry <span class="bound">S</span> <span class="bound">p</span> <span class="bound">e_id</span> <span class="keyword1">of</span> 
                                                            <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span>
                                                          <span class="main">|</span> <span class="main">⌊</span><span class="bound">e</span><span class="main">⌋</span>  <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>userHasAccess <span class="bound">u</span> <span class="bound">e</span><span class="main">)</span> 
                                                                     <span class="keyword1">then</span> <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span> 
                                                                     <span class="keyword1">else</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span> <span class="main">)</span><span class="main">)</span>
                            <span class="main">|</span> <span class="bound">x</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">deleteEntrySE</span> <span class="main">::</span> <span class="quoted">SEPolicy</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">deleteEntrySE</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> <span class="main">(</span>deleteEntry <span class="bound">u</span> <span class="bound">r</span> <span class="bound">p</span> <span class="bound">e_id</span><span class="main">,</span><span class="bound">S</span><span class="main">)</span> <span class="main">⇒</span>  <span class="main">(</span><span class="keyword1">case</span> get_entry <span class="bound">S</span> <span class="bound">p</span> <span class="bound">e_id</span> <span class="keyword1">of</span> 
                                                                <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span>
                                                              <span class="main">|</span> <span class="main">⌊</span><span class="bound">e</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>userHasAccess <span class="bound">u</span> <span class="bound">e</span><span class="main">)</span> 
                                                                       <span class="keyword1">then</span> <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span> 
                                                                       <span class="keyword1">else</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span>   
                              <span class="main">|</span> <span class="bound">x</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">editEntrySE</span> <span class="main">::</span> <span class="quoted">SEPolicy</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">editEntrySE</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> <span class="main">(</span>editEntry <span class="bound">u</span> <span class="bound">r</span> <span class="bound">p</span> <span class="bound">e_id</span> <span class="bound">s</span><span class="main">,</span><span class="bound">S</span><span class="main">)</span> <span class="main">⇒</span>  <span class="main">(</span><span class="keyword1">case</span> get_entry <span class="bound">S</span> <span class="bound">p</span> <span class="bound">e_id</span> <span class="keyword1">of</span> 
                                                               <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⊥</span>
                                                             <span class="main">|</span> <span class="main">⌊</span><span class="bound">e</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>userHasAccess <span class="bound">u</span> <span class="bound">e</span><span class="main">)</span> 
                                                                      <span class="keyword1">then</span> <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span>
                                                                      <span class="keyword1">else</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">|</span> <span class="bound">x</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">SEPolicy</span> <span class="main">::</span> <span class="quoted">SEPolicy</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">SEPolicy</span> <span class="main">=</span>  editEntrySE <span class="main">⨁</span> deleteEntrySE <span class="main">⨁</span> readEntrySE <span class="main">⨁</span> <span class="keyword1">A<span class="hidden">⇩</span><sub>U</sub></span>"</span></span>
  

<span class="keyword1"><span class="command">lemmas</span></span> SEsimps <span class="main">=</span> SEPolicy_def get_entry_def userHasAccess_def
                 editEntrySE_def deleteEntrySE_def readEntrySE_def

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Legitimate Relationships›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> LRPolicy <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Operation <span class="main">×</span> Σ<span class="main">,</span> unit<span class="main">)</span> policy"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">hasLR</span><span class="main">::</span> <span class="quoted"><span class="quoted">"user <span class="main">⇒</span> patient <span class="main">⇒</span> Σ <span class="main">⇒</span> bool"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">hasLR</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">Σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">Σ</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span> <span class="main">⊥</span>     <span class="main">⇒</span> False  
                           <span class="main">|</span> <span class="main">⌊</span><span class="bound">lrs</span><span class="main">⌋</span>  <span class="main">⇒</span>  <span class="main">(</span><span class="main">∃</span><span class="bound">lr</span><span class="main">.</span> <span class="bound">lr</span><span class="main">∈</span><span class="main">(</span>ran <span class="bound">lrs</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∈</span> <span class="bound">lr</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">LRPolicy</span> <span class="main">::</span> <span class="quoted">LRPolicy</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">LRPolicy</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> hasLR <span class="main">(</span>userOfOp <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>patientOfOp <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span> 
                       <span class="keyword1">then</span> <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span> 
                       <span class="keyword1">else</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">createSCRPolicy</span> <span class="main">::</span> <span class="quoted">LRPolicy</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">createSCRPolicy</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span>   <span class="main">(</span>is_createSCR <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> 
                       <span class="keyword1">then</span> <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span> 
                       <span class="keyword1">else</span>  <span class="main">⊥</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">addLRPolicy</span> <span class="main">::</span> <span class="quoted">LRPolicy</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">addLRPolicy</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span>  <span class="main">(</span>is_addLR <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> 
                   <span class="keyword1">then</span> <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span> 
                   <span class="keyword1">else</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">LR_Policy</span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">LR_Policy</span> <span class="main">=</span> createSCRPolicy <span class="main">⨁</span> addLRPolicy <span class="main">⨁</span> LRPolicy <span class="main">⨁</span> <span class="keyword1">A<span class="hidden">⇩</span><sub>U</sub></span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> LRsimps <span class="main">=</span> LR_Policy_def createSCRPolicy_def addLRPolicy_def LRPolicy_def

<span class="keyword1"><span class="command">type_synonym</span></span> FunPolicy <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Operation <span class="main">×</span> DB <span class="main">×</span> Σ<span class="main">,</span>unit<span class="main">)</span> policy"</span></span> 

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">createFunPolicy</span> <span class="main">::</span> <span class="quoted">FunPolicy</span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">createFunPolicy</span> <span class="main">(</span><span class="main">(</span>createSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∈</span> dom <span class="free"><span class="bound"><span class="entity">D</span></span></span> 
                                                 <span class="keyword1">then</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span> 
                                                 <span class="keyword1">else</span> <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">createFunPolicy</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">addLRFunPolicy</span> <span class="main">::</span> <span class="quoted">FunPolicy</span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">addLRFunPolicy</span> <span class="main">(</span><span class="main">(</span>addLR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">us</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">∈</span> dom <span class="free"><span class="bound"><span class="entity">S</span></span></span> 
                                                 <span class="keyword1">then</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span> 
                                                 <span class="keyword1">else</span> <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">addLRFunPolicy</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">removeLRFunPolicy</span> <span class="main">::</span> <span class="quoted">FunPolicy</span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">removeLRFunPolicy</span> <span class="main">(</span><span class="main">(</span>removeLR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">∈</span> dom <span class="free"><span class="bound"><span class="entity">S</span></span></span> 
                                                    <span class="keyword1">then</span> <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span> 
                                                    <span class="keyword1">else</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">removeLRFunPolicy</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">readSCRFunPolicy</span> <span class="main">::</span> <span class="quoted">FunPolicy</span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">readSCRFunPolicy</span> <span class="main">(</span><span class="main">(</span>readSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∈</span> dom <span class="free"><span class="bound"><span class="entity">D</span></span></span> 
                                                <span class="keyword1">then</span> <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span> 
                                                <span class="keyword1">else</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">readSCRFunPolicy</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">deleteSCRFunPolicy</span> <span class="main">::</span> <span class="quoted">FunPolicy</span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">deleteSCRFunPolicy</span> <span class="main">(</span><span class="main">(</span>deleteSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∈</span> dom <span class="free"><span class="bound"><span class="entity">D</span></span></span> 
                                                    <span class="keyword1">then</span> <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span> 
                                                    <span class="keyword1">else</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">deleteSCRFunPolicy</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">changeStatusFunPolicy</span>  <span class="main">::</span> <span class="quoted">FunPolicy</span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">changeStatusFunPolicy</span> <span class="main">(</span>changeStatus <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span> <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∈</span> dom <span class="bound">x</span> 
                                  <span class="keyword1">then</span> <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span> 
                                  <span class="keyword1">else</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span><span class="main">)</span>
                     <span class="main">|</span> <span class="main"><span class="bound">_</span></span>  <span class="main">⇒</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span><span class="main">)</span>"</span></span> 
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">changeStatusFunPolicy</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">deleteEntryFunPolicy</span>  <span class="main">::</span> <span class="quoted">FunPolicy</span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">deleteEntryFunPolicy</span> <span class="main">(</span>deleteEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span> <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∈</span> dom <span class="bound">x</span> 
                                  <span class="keyword1">then</span> <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span> 
                                  <span class="keyword1">else</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span><span class="main">)</span>
                     <span class="main">|</span> <span class="main"><span class="bound">_</span></span>  <span class="main">⇒</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span><span class="main">)</span>"</span></span> 
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">deleteEntryFunPolicy</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">readEntryFunPolicy</span> <span class="main">::</span> <span class="quoted">FunPolicy</span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">readEntryFunPolicy</span> <span class="main">(</span>readEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span> <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span> <span class="main">⇒</span>  <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∈</span> dom <span class="bound">x</span> 
                                   <span class="keyword1">then</span> <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span> 
                                   <span class="keyword1">else</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span><span class="main">)</span>
                      <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span><span class="main">)</span>"</span></span> 
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">readEntryFunPolicy</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">appendEntryFunPolicy</span>  <span class="main">::</span> <span class="quoted">FunPolicy</span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">appendEntryFunPolicy</span> <span class="main">(</span>appendEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">ed</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span> <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span> <span class="main">⇒</span>  <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∈</span> dom <span class="bound">x</span> 
                                   <span class="keyword1">then</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span> 
                                   <span class="keyword1">else</span> <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span><span class="main">)</span>
                      <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span><span class="main">)</span>"</span></span> 
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">appendEntryFunPolicy</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">editEntryFunPolicy</span>  <span class="main">::</span> <span class="quoted">FunPolicy</span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">editEntryFunPolicy</span> <span class="main">(</span>editEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span> <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span> <span class="main">∈</span> dom <span class="bound">x</span> 
                                       <span class="keyword1">then</span> <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span> 
                                       <span class="keyword1">else</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span><span class="main">)</span>
                          <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span><span class="main">)</span>"</span></span> 
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">editEntryFunPolicy</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">FunPolicy</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">FunPolicy</span> <span class="main">=</span> editEntryFunPolicy <span class="main">⨁</span> appendEntryFunPolicy <span class="main">⨁</span>
              readEntryFunPolicy <span class="main">⨁</span> deleteEntryFunPolicy <span class="main">⨁</span> 
              changeStatusFunPolicy <span class="main">⨁</span> deleteSCRFunPolicy <span class="main">⨁</span>
              removeLRFunPolicy <span class="main">⨁</span> readSCRFunPolicy <span class="main">⨁</span>
              addLRFunPolicy <span class="main">⨁</span> createFunPolicy <span class="main">⨁</span> <span class="keyword1">A<span class="hidden">⇩</span><sub>U</sub></span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Modelling Core RBAC›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> RBACPolicy <span class="main">=</span> <span class="quoted"><span class="quoted">"Operation <span class="main">×</span> υ <span class="main">↦</span> unit"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">RBAC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>role <span class="main">×</span> Operation<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">RBAC</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> Nurse <span class="main">∧</span> is_readEntry <span class="bound">f</span><span class="main">}</span> <span class="main">∪</span>  
        <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> Nurse <span class="main">∧</span> is_readSCR <span class="bound">f</span><span class="main">}</span> <span class="main">∪</span>  
        <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> ClinicalPractitioner <span class="main">∧</span> is_appendEntry <span class="bound">f</span><span class="main">}</span> <span class="main">∪</span>  
        <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> ClinicalPractitioner <span class="main">∧</span> is_deleteEntry <span class="bound">f</span><span class="main">}</span> <span class="main">∪</span>  
        <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> ClinicalPractitioner <span class="main">∧</span> is_readEntry <span class="bound">f</span><span class="main">}</span> <span class="main">∪</span>  
        <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> ClinicalPractitioner <span class="main">∧</span> is_readSCR <span class="bound">f</span><span class="main">}</span> <span class="main">∪</span>  
        <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> ClinicalPractitioner <span class="main">∧</span> is_changeStatus <span class="bound">f</span><span class="main">}</span> <span class="main">∪</span>  
        <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> ClinicalPractitioner <span class="main">∧</span> is_editEntry <span class="bound">f</span><span class="main">}</span> <span class="main">∪</span>  
        <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> Clerical <span class="main">∧</span> is_createSCR <span class="bound">f</span><span class="main">}</span> <span class="main">∪</span>  
        <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> Clerical <span class="main">∧</span> is_deleteSCR <span class="bound">f</span><span class="main">}</span> <span class="main">∪</span>  
        <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> Clerical <span class="main">∧</span> is_addLR <span class="bound">f</span><span class="main">}</span>  <span class="main">∪</span>  
        <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> Clerical <span class="main">∧</span> is_removeLR <span class="bound">f</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">RBACPolicy</span> <span class="main">::</span> <span class="quoted">RBACPolicy</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">RBACPolicy</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">uc</span><span class="main">)</span><span class="main">.</span>
     <span class="keyword1">if</span>    <span class="main">(</span><span class="main">(</span>roleOfOp <span class="bound">f</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span> <span class="main">∈</span> RBAC <span class="main">∧</span> <span class="main">⌊</span>roleOfOp <span class="bound">f</span><span class="main">⌋</span> <span class="main">=</span> <span class="bound">uc</span> <span class="main">(</span>userOfOp <span class="bound">f</span><span class="main">)</span><span class="main">)</span> 
     <span class="keyword1">then</span>  <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span>
     <span class="keyword1">else</span>  <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The State Transitions and Output Function›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹State Transition›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">OpSuccessDB</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Operation <span class="main">×</span> DB<span class="main">)</span> <span class="main">⇀</span> DB"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">OpSuccessDB</span> <span class="main">(</span>createSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">↦</span><span class="main">∅</span><span class="main">)</span><span class="main">⌋</span>
                                                 <span class="main">|</span> <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">⌋</span><span class="main">)</span>"</span></span> 
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">OpSuccessDB</span> <span class="main">(</span><span class="main">(</span>appendEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> 
                                      <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span> <span class="main">⊥</span>  <span class="main">⇒</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">⌋</span>
                                                <span class="main">|</span> <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span> <span class="main">∈</span> <span class="main">(</span>dom <span class="bound">x</span><span class="main">)</span> 
                                                              <span class="keyword1">then</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">⌋</span> 
                                                              <span class="keyword1">else</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">↦</span> <span class="bound">x</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">ei</span></span></span><span class="main">↦</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">OpSuccessDB</span> <span class="main">(</span><span class="main">(</span>deleteSCR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">:=</span><span class="main">⊥</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">OpSuccessDB</span> <span class="main">(</span><span class="main">(</span>deleteEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> 
                                      <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">⌋</span>
                                                 <span class="main">|</span> <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span> <span class="main">⇒</span> Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">↦</span><span class="main">(</span><span class="bound">x</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">ei</span></span></span><span class="main">:=</span><span class="main">⊥</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">OpSuccessDB</span> <span class="main">(</span><span class="main">(</span>changeStatus <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> 
                                      <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">⌋</span>
                                                 <span class="main">|</span> <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span> <span class="keyword1">of</span>
                                                            <span class="main">⌊</span><span class="bound">e</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">↦</span> <span class="bound">x</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">ei</span></span></span><span class="main">↦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span>snd <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>
                                                          <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">OpSuccessDB</span> <span class="main">(</span><span class="main">(</span>editEntry <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> 
                                      <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span> <span class="main">⊥</span> <span class="main">⇒</span><span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">⌋</span>
                                                 <span class="main">|</span> <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">ei</span></span></span> <span class="keyword1">of</span>
                                                                 <span class="main">⌊</span><span class="bound">e</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">↦</span><span class="main">(</span><span class="bound">x</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">ei</span></span></span><span class="main">↦</span><span class="main">(</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>
                                                              <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">OpSuccessDB</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">⌋</span>"</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">OpSuccessSigma</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Operation <span class="main">×</span> Σ<span class="main">)</span> <span class="main">⇀</span> Σ"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">OpSuccessSigma</span> <span class="main">(</span>addLR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">lr_id</span></span></span> <span class="free"><span class="bound"><span class="entity">us</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> 
                   <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span> <span class="main">⌊</span><span class="bound">lrs</span><span class="main">⌋</span>  <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="bound">lrs</span> <span class="free"><span class="bound"><span class="entity">lr_id</span></span></span><span class="main">)</span> <span class="keyword1">of</span> 
                                               <span class="main">⊥</span>  <span class="main">⇒</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">↦</span><span class="main">(</span><span class="bound">lrs</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">lr_id</span></span></span><span class="main">↦</span><span class="free"><span class="bound"><span class="entity">us</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>                        
                                             <span class="main">|</span> <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span> <span class="main">⇒</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">⌋</span><span class="main">)</span>
                              <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">↦</span><span class="main">(</span>Map.empty<span class="main">(</span><span class="free"><span class="bound"><span class="entity">lr_id</span></span></span><span class="main">↦</span><span class="free"><span class="bound"><span class="entity">us</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">OpSuccessSigma</span> <span class="main">(</span>removeLR <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">lr_id</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> 
                   <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span> Some <span class="bound">lrs</span> <span class="main">⇒</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">↦</span><span class="main">(</span><span class="bound">lrs</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">lr_id</span></span></span><span class="main">:=</span><span class="main">⊥</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>
                              <span class="main">|</span> <span class="main">⊥</span> <span class="main">⇒</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">OpSuccessSigma</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">⌋</span>"</span></span>



<span class="keyword1"><span class="command">fun</span></span> <span class="entity">OpSuccessUC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Operation <span class="main">×</span> υ<span class="main">)</span> <span class="main">⇀</span> υ"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">OpSuccessUC</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">⌋</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Output›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> Output <span class="main">=</span> <span class="quoted">unit</span>  

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">OpSuccessOutput</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Operation<span class="main">)</span> <span class="main">⇀</span> Output"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
   <span class="quoted"><span class="quoted">"<span class="free">OpSuccessOutput</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⌊</span><span class="main">()</span><span class="main">⌋</span>"</span></span>
 

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">OpFailOutput</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Operation <span class="main">⇀</span>  Output"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">OpFailOutput</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⌊</span><span class="main">()</span><span class="main">⌋</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Combine All Parts›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">SE_LR_Policy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Operation <span class="main">×</span> DB <span class="main">×</span> Σ<span class="main">,</span> unit<span class="main">)</span> policy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">SE_LR_Policy</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>  <span class="keyword1">o<span class="hidden">⇩</span><sub>f</sub></span>  <span class="main">(</span>SEPolicy <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>D</sub></span> LR_Policy<span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="bound">a</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">SE_LR_FUN_Policy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Operation <span class="main">×</span> DB <span class="main">×</span> Σ<span class="main">,</span> unit<span class="main">)</span> policy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SE_LR_FUN_Policy</span> <span class="main">=</span>  <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>FunPolicy <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>D</sub></span> SE_LR_Policy<span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">SE_LR_RBAC_Policy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Operation <span class="main">×</span> DB <span class="main">×</span> Σ <span class="main">×</span> υ<span class="main">,</span> unit<span class="main">)</span> policy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SE_LR_RBAC_Policy</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> 
                        <span class="keyword1">o<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>RBACPolicy <span class="keyword1">⨂<span class="hidden">⇩</span><sub>∨</sub><span class="hidden">⇩</span><sub>D</sub></span> SE_LR_FUN_Policy<span class="main">)</span> 
                        <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ST_Allow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Operation <span class="main">×</span> DB <span class="main">×</span> Σ  <span class="main">×</span> υ <span class="main">⇀</span> Output <span class="main">×</span> DB <span class="main">×</span> Σ <span class="main">×</span> υ"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">ST_Allow</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>OpSuccessOutput <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span>OpSuccessDB <span class="keyword1">⨂<span class="hidden">⇩</span><sub>S</sub></span> OpSuccessSigma <span class="keyword1">⨂<span class="hidden">⇩</span><sub>S</sub></span> OpSuccessUC<span class="main">)</span><span class="main">)</span> 
                      <span class="keyword1">o</span> <span class="main">(</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ST_Deny</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Operation <span class="main">×</span> DB <span class="main">×</span> Σ <span class="main">×</span> υ <span class="main">⇀</span> Output <span class="main">×</span> DB <span class="main">×</span> Σ <span class="main">×</span> υ"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">ST_Deny</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">ope</span><span class="main">,</span><span class="bound">sp</span><span class="main">,</span><span class="bound">si</span><span class="main">,</span><span class="bound">uc</span><span class="main">)</span><span class="main">.</span> Some <span class="main">(</span><span class="main">()</span><span class="main">,</span> <span class="bound">sp</span><span class="main">,</span><span class="bound">si</span><span class="main">,</span><span class="bound">uc</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">SE_LR_RBAC_ST_Policy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Operation <span class="main">×</span> DB <span class="main">×</span> Σ  <span class="main">×</span> υ <span class="main">↦</span> Output <span class="main">×</span> DB <span class="main">×</span> Σ <span class="main">×</span> υ"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">SE_LR_RBAC_ST_Policy</span> <span class="main">=</span>   <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span><span class="bound">y</span><span class="main">)</span>  
                                     <span class="keyword1">o<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="main">(</span>ST_Allow<span class="main">,</span>ST_Deny<span class="main">)</span> <span class="main">⨂<span class="hidden">⇩</span><sub>∇</sub></span> SE_LR_RBAC_Policy<span class="main">)</span> 
                                     <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">PolMon</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Operation <span class="main">⇒</span> <span class="main">(</span>Output decision<span class="main">,</span>DB <span class="main">×</span> Σ <span class="main">×</span> υ<span class="main">)</span> MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">PolMon</span> <span class="main">=</span> <span class="main">(</span>policy2MON SE_LR_RBAC_ST_Policy<span class="main">)</span>"</span></span> 

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ServiceExample">
<div class="head">
<h1>Theory ServiceExample</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * HOL-TestGen --- theorem-prover based test case generation
 *                 http://www.brucker.ch/projects/hol-testgen/
 *
 * This file is part of HOL-TestGen.
 *
 * Copyright (c) 2010-2012 ETH Zurich, Switzerland
 *               2010-2014 Achim D. Brucker, Germany
 *               2010-2014 Université Paris-Sud, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Instantiating Our Secure Service Example›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  ServiceExample
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="Service.html">Service</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In the following, we briefly present an instantiations  of our secure service example 
  from the last section. We assume three different members of the health care staff and 
  two patients:
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Access Control Configuration›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">alice</span> <span class="main">::</span> <span class="quoted">user</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">alice</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bob</span> <span class="main">::</span> <span class="quoted">user</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bob</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">charlie</span> <span class="main">::</span> <span class="quoted">user</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">charlie</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">patient1</span> <span class="main">::</span> <span class="quoted">patient</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">patient1</span> <span class="main">=</span> <span class="numeral">5</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">patient2</span> <span class="main">::</span> <span class="quoted">patient</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">patient2</span> <span class="main">=</span> <span class="numeral">6</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">UC0</span> <span class="main">::</span> <span class="quoted">υ</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">UC0</span> <span class="main">=</span> Map.empty<span class="main">(</span>alice<span class="main">↦</span>Nurse<span class="main">)</span><span class="main">(</span>bob<span class="main">↦</span>ClinicalPractitioner<span class="main">)</span><span class="main">(</span>charlie<span class="main">↦</span>Clerical<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">entry1</span>  <span class="main">::</span> <span class="quoted">entry</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">entry1</span> <span class="main">=</span> <span class="main">(</span>Open<span class="main">,</span>alice<span class="main">,</span> dummyContent<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">entry2</span>  <span class="main">::</span> <span class="quoted">entry</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">entry2</span> <span class="main">=</span> <span class="main">(</span>Closed<span class="main">,</span>bob<span class="main">,</span> dummyContent<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">entry3</span>  <span class="main">::</span> <span class="quoted">entry</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">entry3</span> <span class="main">=</span> <span class="main">(</span>Closed<span class="main">,</span>alice<span class="main">,</span> dummyContent<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">SCR1</span> <span class="main">::</span> <span class="quoted">SCR</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">SCR1</span> <span class="main">=</span> <span class="main">(</span>Map.empty<span class="main">(</span><span class="main">1</span><span class="main">↦</span>entry1<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">SCR2</span> <span class="main">::</span> <span class="quoted">SCR</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">SCR2</span> <span class="main">=</span>  <span class="main">(</span>Map.empty<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Spine0</span> <span class="main">::</span> <span class="quoted">DB</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Spine0</span> <span class="main">=</span> Map.empty<span class="main">(</span>patient1<span class="main">↦</span>SCR1<span class="main">)</span><span class="main">(</span>patient2<span class="main">↦</span>SCR2<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">LR1</span> <span class="main">::</span> <span class="quoted">LR</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">LR1</span> <span class="main">=</span><span class="main">(</span>Map.empty<span class="main">(</span><span class="main">1</span><span class="main">↦</span><span class="main">{</span>alice<span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Σ0</span> <span class="main">::</span> <span class="quoted">Σ</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Σ0</span> <span class="main">=</span> <span class="main">(</span>Map.empty<span class="main">(</span>patient1<span class="main">↦</span>LR1<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Initial System State›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">σ0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"DB <span class="main">×</span> Σ<span class="main">×</span>υ"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">σ0</span> <span class="main">=</span> <span class="main">(</span>Spine0<span class="main">,</span>Σ0<span class="main">,</span>UC0<span class="main">)</span>"</span></span>
 
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Basic Properties›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="free">a</span> <span class="keyword1">of</span> allow <span class="bound">d</span> <span class="main">⇒</span> <span class="main">⌊</span><span class="free">X</span><span class="main">⌋</span> <span class="main">|</span> deny <span class="bound">d2</span> <span class="main">⇒</span> <span class="main">⌊</span><span class="free">Y</span><span class="main">⌋</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">cong</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> hasLR <span class="free">urp1_alice</span> <span class="main">1</span> Σ0 <span class="keyword1">then</span> <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span> <span class="keyword1">else</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span><span class="main">)</span> <span class="main">=</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> MonSimps <span class="main">=</span>  valid_SE_def unit_SE_def bind_SE_def
<span class="keyword1"><span class="command">lemmas</span></span> Psplits  <span class="main">=</span> option.splits unit.splits prod.splits decision.splits
<span class="keyword1"><span class="command">lemmas</span></span> PolSimps <span class="main">=</span> valid_SE_def unit_SE_def bind_SE_def if_splits policy2MON_def 
                  SE_LR_RBAC_ST_Policy_def map_add_def id_def LRsimps prod_2_def RBACPolicy_def 
                  SE_LR_Policy_def SEPolicy_def RBAC_def deleteEntrySE_def editEntrySE_def 
                  readEntrySE_def σ0_def Σ0_def UC0_def patient1_def patient2_def LR1_def 
                  alice_def bob_def charlie_def get_entry_def SE_LR_RBAC_Policy_def Allow_def 
                  Deny_def dom_restrict_def policy_range_comp_def prod_orA_def prod_orD_def 
                  ST_Allow_def ST_Deny_def Spine0_def SCR1_def SCR2_def entry1_def entry2_def 
                  entry3_def FunPolicy_def SE_LR_FUN_Policy_def o_def image_def UPFDefs

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"SE_LR_RBAC_Policy <span class="main">(</span><span class="main">(</span>createSCR alice Clerical patient1<span class="main">)</span><span class="main">,</span>σ0<span class="main">)</span><span class="main">=</span> Some <span class="main">(</span>deny <span class="main">()</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PolSimps<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> exBool<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">::</span>bool<span class="main">.</span> <span class="bound">a</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1"><span class="command">lemma</span></span> deny_allow<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span> <span class="main">∉</span> Some <span class="main">`</span> range allow"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1"><span class="command">lemma</span></span> allow_deny<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span> <span class="main">∉</span> Some <span class="main">`</span> range deny"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Policy as monad. Alice using her first urp can read the SCR of patient1.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>σ0 <span class="main">⊨</span> <span class="main">(</span><span class="bound">os</span> <span class="main">←</span> mbind <span class="main">[</span><span class="main">(</span>createSCR alice Clerical patient1<span class="main">)</span><span class="main">]</span> <span class="main">(</span>PolMon<span class="main">)</span><span class="main">;</span> 
       <span class="main">(</span><span class="keyword1">return</span> <span class="main">(</span><span class="bound">os</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span>deny <span class="main">(</span><span class="free">Out</span><span class="main">)</span> <span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PolMon_def MonSimps PolSimps<span class="main">)</span>
    
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Presenting her other urp, she is not allowed to read it.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"SE_LR_RBAC_Policy <span class="main">(</span><span class="main">(</span>appendEntry alice Clerical patient1 <span class="free">ei</span> <span class="free">d</span><span class="main">)</span><span class="main">,</span>σ0<span class="main">)</span><span class="main">=</span> <span class="main">⌊</span>deny <span class="main">()</span><span class="main">⌋</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PolSimps<span class="main">)</span>  

<span class="keyword2"><span class="keyword">end</span></span>


</pre>
</div>