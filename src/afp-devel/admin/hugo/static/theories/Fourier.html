<div id="Periodic">
<div class="head">
<h1>Theory Periodic</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Shifting the origin for integration of periodic functions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Periodic
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Analysis/Analysis.html">HOL-Analysis.Analysis</a>"</span> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> has_bochner_integral_null <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>euclidean_space"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">∈</span> null_sets lebesgue"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="free">N</span><span class="main">)</span> <span class="free">f</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> has_bochner_integral_iff
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">N</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> integrable_restrict_space<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">∩</span> space lebesgue <span class="main">∈</span> sets lebesgue"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable lebesgue <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicat_real <span class="free">N</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> integrable_cong_AE_imp<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable lebesgue <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lebesgue<span class="main">.</span> <span class="main">0</span> <span class="main">=</span> indicat_real <span class="free">N</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> indicator_def completion.null_sets_iff_AE eventually_mono<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicat_real <span class="free">N</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable lebesgue"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> borel_measurable_AE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ *<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="free">N</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> integral_eq_zero_AE<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lebesgue_on <span class="free">N</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> AE_I' <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> N<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">N</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms null_setsD2 null_sets_restrict_space<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> has_bochner_integral_null_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>euclidean_space"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">∈</span> null_sets lebesgue"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="free">N</span><span class="main">)</span> <span class="free">f</span> <span class="free">i</span> <span class="main">⟷</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms has_bochner_integral_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> periodic_integer_multiple<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">ℤ</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> L <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> nat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> of_nat <span class="skolem">n</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> L <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> of_nat <span class="skolem">n</span> <span class="main">*</span> <span class="free">a</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> of_int <span class="skolem">z</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">z</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nat of_nat_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> nat <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> of_int <span class="skolem">z</span> <span class="main">*</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span><span class="main">-</span><span class="skolem">z</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ints_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> Ints_1 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">fastforce</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> has_integral_offset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>euclidean_space"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">-</span><span class="free">c</span><span class="main">..</span><span class="free">b</span><span class="main">-</span><span class="free">c</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"indicat_real <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> indicat_real <span class="main">{</span><span class="free">a</span><span class="main">-</span><span class="free">c</span><span class="main">..</span><span class="free">b</span><span class="main">-</span><span class="free">c</span><span class="main">}</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"has_bochner_integral lebesgue <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> has_bochner_integral_restrict_space<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"has_bochner_integral lebesgue <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicat_real <span class="main">{</span><span class="free">a</span><span class="main">-</span><span class="free">c</span><span class="main">..</span><span class="free">b</span><span class="main">-</span><span class="free">c</span><span class="main">}</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_bochner_integral_lebesgue_real_affine_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> has_bochner_integral_restrict_space<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> has_integral_periodic_offset_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>euclidean_space"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">a</span><span class="main">+</span><span class="free">c</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">b</span><span class="main">..</span><span class="free">b</span><span class="main">+</span><span class="free">c</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> periodic <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="free">b</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> has_integral_offset <span class="main">[</span><span class="operator">OF</span> f<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">-</span><span class="free">b</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> has_integral_periodic_offset_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">a</span> <span class="main">+</span> <span class="free">c</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">a</span><span class="main">+</span><span class="free">c</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span><span class="main">(</span><span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">a</span><span class="main">+</span><span class="free">c</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> integrable_subinterval f has_bochner_integral_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">b</span><span class="main">..</span><span class="free">b</span><span class="main">+</span><span class="free">c</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span><span class="main">(</span><span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">a</span><span class="main">+</span><span class="free">c</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_integral_periodic_offset_lemma periodic <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span> <span class="main">+</span> <span class="free">c</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">+</span><span class="free">c</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span><span class="main">(</span><span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">+</span><span class="free">c</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> integrable_subinterval f has_bochner_integral_integrable integrable.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span> <span class="main">+</span> <span class="free">c</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span> <span class="main">+</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">a</span> <span class="main">+</span> <span class="free">c</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> integral_combine add.commute c f has_bochner_integral_iff le_add_same_cancel1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">+</span><span class="free">c</span><span class="main">..</span><span class="free">b</span><span class="main">+</span><span class="free">c</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_bochner_integral_combine <span class="main">[</span><span class="operator">OF</span> _ _ 2 3<span class="main">]</span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_right' has_integral_offset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> has_integral_periodic_offset_weak<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">b</span><span class="main">-</span><span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> c f has_integral_periodic_offset_pos periodic <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> per'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="free">a</span> <span class="main">-</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="main">-</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> periodic <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">-</span><span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> f'<span class="main">:</span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span> <span class="free">b</span><span class="main">..</span><span class="main">-</span> <span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> has_integral_periodic_offset_pos <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">c</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> f' per'<span class="main">]</span> c  False
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> has_bochner_integral_reflect_real <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> has_integral_periodic_offset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≤</span> <span class="free">a</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">∈</span> null_sets lebesgue"</span></span>
      <span class="keyword1"><span class="command">using</span></span> less_eq_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> f <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fba</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fba</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> frac<span class="main">(</span><span class="free">c</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">fba</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">using</span></span> periodic periodic_integer_multiple that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> floor <span class="main">(</span><span class="free">c</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Ints_of_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span>floor <span class="main">(</span><span class="free">c</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> frac <span class="main">(</span><span class="free">c</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> frac_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> fba_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="skolem">fba</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> fba_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> has_integral_periodic_offset_weak <span class="main"><span class="main">[</span></span><span class="operator">OF</span> f<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>frac <span class="main">(</span><span class="free">c</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> frac_unique_iff less_eq_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> frac <span class="main">(</span><span class="free">c</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">-</span> <span class="free">a</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> has_bochner_integralI_AE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ AE_I2<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fba</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"*"</span> borel_measurable_has_bochner_integral <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> measurable_lebesgue_cong <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eq<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> integrable_periodic_offset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> f has_integral_periodic_offset periodic
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_bochner_integral_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> absolutely_integrable_periodic_offset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">c</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms integrable_periodic_offset <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> integrable_restrict_space set_integrable_def add.commute <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> integral_periodic_offset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> has_integral_periodic_offset periodic
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_bochner_integral_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> periodic<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">_</span><span class="main">+</span><span class="free">c</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> integrable_periodic_offset <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">c</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> False not_integrable_integral_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Lspace">
<div class="head">
<h1>Theory Lspace</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Lspace as it is in HOL Light›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Mainly a repackaging of existing material from Lp›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Lspace
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Lp/Lp.html">Lp.Lp</a> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">lspace</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> measure <span class="main">⇒</span> ennreal <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> real<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lspace</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lspace_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L1_space integrable_restrict_space set_integrable_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspace_ennreal_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span>ennreal <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span><span class="main">.</span> integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>norm<span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Lp_measurable Lp_D <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Lp_I<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspace_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∞</span> <span class="main">&gt;</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span><span class="main">.</span> integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>norm<span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span>enn2real <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> enn2real <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lp_cases assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms lspace_ennreal_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lspace_iff'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∞</span> <span class="main">&gt;</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>norm<span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span>enn2real <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="free">S</span><span class="main">}</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⊆</span> <span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms integrable_on_lebesgue_on <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lspace_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">⊆</span> <span class="var">?lhs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lspace_iff <span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">xa</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">xa</span><span class="main">¦</span> <span class="keyword1">powr</span> enn2real <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> enn2real <span class="free">p</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> enn2real <span class="free">p</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="free">S</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> absolutely_integrable_on_iff_nonneg that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> L1_space S lspace_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lspace_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> lmeasurable"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top.not_eq_extremum<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lspace_iff'<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> enn2real <span class="free">p</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> enn2real <span class="free">q</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> measurable_bounded_by_integrable_imp_integrable<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> enn2real <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> measurable_abs_powr that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> max <span class="main">1</span> <span class="main">(</span>norm<span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> enn2real <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">absolutely_integrable_on</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_max_1<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> enn2real <span class="free">q</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="free">S</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nonnegative_absolutely_integrable_1 that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">integrable_on</span> <span class="free">S</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_abs_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> enn2real <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?g</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> enn2real <span class="free">p</span> <span class="main">≤</span> <span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> enn2real <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms enn2real_mono powr_mono that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> powr_le1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_max_iff_disj<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S fmeasurableD<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lspace_inclusion<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> lmeasurable"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">q</span> <span class="main">⊆</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms lspace_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lspace_const<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> lmeasurable"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lp_space assms finite_measure.integrable_const finite_measure_lebesgue_on<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspace_max<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> max <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>max <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">¦</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">¦</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> integrable_abs that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> max <span class="main">(</span><span class="main">¦</span><span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">¦</span><span class="main">)</span> <span class="main">(</span><span class="main">¦</span><span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> integrable_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integrable_bound<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>max <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> borel_measurable_max measurable_abs_powr that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Lp_space borel_measurable_max<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lspace_min<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> min <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>min <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">¦</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">¦</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> integrable_abs that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> max <span class="main">(</span><span class="main">¦</span><span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">¦</span><span class="main">)</span> <span class="main">(</span><span class="main">¦</span><span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> integrable_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integrable_bound<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>min <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> borel_measurable_min measurable_abs_powr that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Lp_space borel_measurable_min<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_space_numeral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"numeral <span class="free">n</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> borel_measurable <span class="free">M</span><span class="main">.</span> integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">^</span> numeral <span class="free">n</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Lp_space <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"numeral <span class="free">n</span>"</span></span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Square_Integrable">
<div class="head">
<h1>Theory Square_Integrable</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Square integrable functions over the reals›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Square_Integrable
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Lspace.html">Lspace</a> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Basic definitions›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">square_integrable</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> real set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">square'_integrable</span>"</span> 46<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1"><span class="free">square_integrable</span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∈</span> sets lebesgue <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">∧</span> integrable <span class="main">(</span>lebesgue_on <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> square_integrable_imp_measurable<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> square_integrable_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> square_integrable_imp_lebesgue<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> square_integrable_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> square_integrable_imp_lspace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms integrable_on_lebesgue_on nonnegative_absolutely_integrable_1 square_integrable_def zero_le_power2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms square_integrable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms Lp_space_numeral integrable_restrict_space set_integrable_def square_integrable_imp_measurable<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> square_integrable_iff_lspace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="numeral">2</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> square_integrable_imp_lspace <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Lp_space_numeral square_integrable_def integrable_on_lebesgue_on<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> square_integrable_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> square_integrable_def power2_eq_square integrable_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> square_integrable_neg_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="free">S</span> <span class="main">⟷</span> <span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> square_integrable_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> square_integrable_lmult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> square_integrable_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> square_integrable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> borel_measurable_scaleR <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"lebesgue_on <span class="free">S</span>"</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f integrable_0<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square mult_ac<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms square_integrable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> square_integrable_rmult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> square_integrable_lmult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> square_integrable_imp_absolutely_integrable_product<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> fS<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="bound">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms square_integrable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_abs Holder_inequality <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span></span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f g square_integrable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nonnegative_absolutely_integrable_1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span><span class="main">]</span> nonnegative_absolutely_integrable_1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fS integrable_restrict_space set_integrable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> absolutely_integrable_measurable_real borel_measurable_times square_integrable_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> square_integrable_imp_integrable_product<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_measurable assms integrable_abs_iff
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> absolutely_integrable_measurable_real square_integrable_def square_integrable_imp_absolutely_integrable_product<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> square_integrable_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> square_integrable_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms square_integrable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f g borel_measurable_add square_integrable_imp_measurable<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> power2_eq_square distrib_right distrib_left
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> Bochner_Integration.integrable_add<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f g square_integrable_imp_integrable_product <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f g square_integrable_imp_integrable_product <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> square_integrable_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span><span class="main">;</span> <span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> square_integrable_neg_eq square_integrable_add <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> square_integrable_abs <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> square_integrable_def borel_measurable_abs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> square_integrable_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">i</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">induction</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> continuous_imp_square_integrable <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> continuous_imp_integrable <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> square_integrable_def continuous_on_power continuous_imp_measurable_on_sets_lebesgue<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> square_integrable_imp_absolutely_integrable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> lmeasurable"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f S square_integrable_iff_lspace <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lspace_mono<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> S <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> lspace_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> square_integrable_imp_integrable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> lmeasurable"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> S absolutely_integrable_measurable_real f fmeasurableD integrable_abs_iff square_integrable_imp_absolutely_integrable<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ The norm and inner product in L2›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">l2product</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l2product</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">x</span> <span class="main">∂</span><span class="main">(</span>lebesgue_on <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">l2norm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space set<span class="main">,</span> <span class="tfree">'a</span> <span class="main">⇒</span> real<span class="main">]</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l2norm</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> sqrt <span class="main">(</span>l2product <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lnorm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> measure<span class="main">,</span> real<span class="main">,</span> <span class="tfree">'a</span> <span class="main">⇒</span> real<span class="main">]</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lnorm</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∂</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Holder_inequality_lnorm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
          <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> lnorm <span class="free">M</span> <span class="free">p</span> <span class="free">f</span> <span class="main">*</span> lnorm <span class="free">M</span> <span class="free">q</span> <span class="free">g</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span> <span class="main">¦</span> <span class="main">≤</span> lnorm <span class="free">M</span> <span class="free">p</span> <span class="free">f</span> <span class="main">*</span> lnorm <span class="free">M</span> <span class="free">q</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Holder_inequality assms lnorm_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l2norm_lnorm<span class="main">:</span> <span class="quoted"><span class="quoted">"l2norm <span class="free">S</span> <span class="free">f</span> <span class="main">=</span> lnorm <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="numeral">2</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lnorm_def l2norm_def l2product_def power2_eq_square powr_half_sqrt<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lnorm_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"lnorm <span class="free">M</span> <span class="free">p</span> <span class="free">f</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lnorm_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lnorm_minus_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"lnorm <span class="free">M</span> <span class="free">p</span> <span class="main">(</span><span class="free">g</span> <span class="main">-</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> lnorm <span class="free">M</span> <span class="free">p</span> <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lnorm_def abs_minus_commute<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ Extending a continuous function in a periodic way›</span></span>

<span class="keyword1"><span class="command">proposition</span></span> continuous_on_compose_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> contf<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">1</span> <span class="main">=</span> <span class="free">f</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> frac<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> frac<span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> caf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="main">0</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">;</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">⟧</span> <span class="main">⟹</span> continuous <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"frac <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> continuous_at_eps_delta dist_real_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> caf<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">d</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x'</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x'</span><span class="main">-</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="main">¦</span><span class="free">f</span><span class="main">(</span>frac <span class="bound">x'</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="main">0</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">e</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d0</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x'</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x'</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">;</span> <span class="main">¦</span><span class="bound">x'</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">d0</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x'</span> <span class="main">-</span> <span class="free">f</span> <span class="main">0</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> caf <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> dist_not_less_zero
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_within_eps_delta dist_real_def<span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x'</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x'</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">;</span> <span class="main">¦</span><span class="bound">x'</span> <span class="main">-</span> <span class="main">1</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">d1</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x'</span> <span class="main">-</span> <span class="free">f</span> <span class="main">0</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> caf <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> dist_not_less_zero f10
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_within_eps_delta dist_real_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI allI impI<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> min <span class="main">1</span> <span class="main">(</span>min <span class="skolem">d0</span> <span class="skolem">d1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d0</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d1</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span><span class="main">(</span>frac <span class="skolem">x'</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="main">0</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
            <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x'</span><span class="main">-</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">&lt;</span> min <span class="main">1</span> <span class="main">(</span>min <span class="skolem">d0</span> <span class="skolem">d1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x'</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x'</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">ℤ</span>›</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"frac <span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">-</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> frac_unique_iff<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> True d0 that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"frac <span class="skolem">x'</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">x'</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">ℤ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_le frac_unique_iff<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> False d1 that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_at_compose<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isCont frac <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False continuous_frac<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"frac <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False frac_lt_1<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isCont <span class="free">f</span><span class="main">(</span>frac <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> at_within_Icc_at greaterThanLessThan_iff le_cases not_le that<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> contf <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def continuous_on_eq_continuous_within<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">proposition</span></span> Tietze_periodic_interval<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> contf<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span> <span class="main">=</span> <span class="free">f</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∘</span> frac <span class="main">∘</span>
                <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">using</span></span> that affine_ineq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∘</span> frac<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> continuous_on_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> continuous_on_compose_frac<span class="main"><span class="main">]</span></span> continuous_on_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> contf<span class="main"><span class="main">]</span></span>
          <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fab<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="var">?g</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> * continuous_on_compose <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> True <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">b</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> frac_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fab<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"frac <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> frac_eq<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> frac <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">b</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> frac <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> True frac_1_eq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?g</span> <span class="skolem">x</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> that False order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Lspace stuff›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eNorm_triangle_eps<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="main">(</span><span class="free">x'</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"defect <span class="free">N</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">e</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="free">x'</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span> <span class="main">⟹</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> Norm <span class="free">N</span> <span class="main">(</span><span class="free">x'</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> nt<span class="main">:</span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="main">(</span><span class="free">x'</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">⊤</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms top.not_eq_extremum <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Norm_def diff_gr0_ennreal<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Norm <span class="free">N</span> <span class="main">(</span><span class="free">x'</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="free">x'</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that nt  <span class="keyword1"><span class="command">unfolding</span></span> Norm_def  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> enn2real_nonneg ennreal_1 ennreal_enn2real ennreal_minus<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>ennreal<span class="main">)</span> <span class="main">&lt;</span> <span class="var">?d</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> d ennreal_less_zero_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="free">x'</span><span class="main">)</span> <span class="main">&lt;</span> <span class="var">?d</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">using</span></span> that assms eNorm_triangular_ineq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">-</span> <span class="free">x'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x'</span> <span class="main">-</span> <span class="free">x</span>"</span></span><span class="main">]</span> le_less_trans less_diff_eq_ennreal
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Norm_def nt<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> topspace_topology<span class="hidden">⇩</span><sub>N</sub> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"defect <span class="free">N</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"topspace <span class="main">(</span>topology<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> topspace <span class="main">(</span>topology<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟶</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">x'</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x'</span>
      <span class="keyword1"><span class="command">using</span></span> eNorm_triangle_eps
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms that<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> topspace_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">y</span><span class="main">.</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> UnionI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> openin_topology<span class="hidden">⇩</span><sub>N</sub>_I<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tendsto_ine<span class="hidden">⇩</span><sub>N</sub>_iff_limitin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"defect <span class="free">N</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tendsto_ine<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="free">u</span> <span class="free">x</span> <span class="main">=</span> limitin <span class="main">(</span>topology<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span><span class="main">)</span> <span class="free">u</span> <span class="free">x</span> sequentially"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="free">u</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"openin <span class="main">(</span>topology<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span><span class="main">)</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="bound">y</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> openin_topology<span class="hidden">⇩</span><sub>N</sub>_D U <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> eventually_mono order_tendstoD<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> topspace <span class="main">(</span>topology<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="main">⟦</span>openin <span class="main">(</span>topology<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span><span class="main">)</span> <span class="bound">U</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="free">u</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order_tendstoI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> * <span class="main"><span class="main">[</span></span><span class="operator">OF</span> openin_topology<span class="hidden">⇩</span><sub>N</sub>_I<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="bound"><span class="bound">v</span></span><span class="main"><span class="main">.</span></span> eNorm <span class="free"><span class="free">N</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">v</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">&lt;</span></span> <span class="skolem"><span class="skolem">a</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms eNorm_triangle_eps that <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tendsto_ine<span class="hidden">⇩</span><sub>N</sub>_def limitin_def assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> tendsto_ine<span class="hidden">⇩</span><sub>N</sub>_iff_limitin_ge1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted">ennreal</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tendsto_ine<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">u</span> <span class="free">x</span> <span class="main">=</span> limitin <span class="main">(</span>topology<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="free">u</span> <span class="free">x</span> sequentially"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_ine<span class="hidden">⇩</span><sub>N</sub>_iff_limitin<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"defect <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> L_infinity<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> L_zero<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Lp<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Lp_cases assms ennreal_ge_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> tendsto_in<span class="hidden">⇩</span><sub>N</sub>_iff_limitin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"defect <span class="free">N</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">u</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="free">u</span> <span class="free">x</span> <span class="main">=</span> limitin <span class="main">(</span>topology<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span><span class="main">)</span> <span class="free">u</span> <span class="free">x</span> sequentially"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms tendsto_ine<span class="hidden">⇩</span><sub>N</sub>_iff_limitin tendsto_ine_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">corollary</span></span> tendsto_in<span class="hidden">⇩</span><sub>N</sub>_iff_limitin_ge1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted">ennreal</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> lspace <span class="free">M</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">u</span> <span class="bound">n</span> <span class="main">∈</span> lspace <span class="free">M</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">u</span> <span class="free">x</span> <span class="main">=</span> limitin <span class="main">(</span>topology<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="free">u</span> <span class="free">x</span> sequentially"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_in<span class="hidden">⇩</span><sub>N</sub>_iff_limitin<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"defect <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> L_infinity<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> L_zero<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Lp<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Lp_cases <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> ennreal_ge_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> l2product_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"l2product <span class="free">S</span> <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> l2product <span class="free">S</span> <span class="free">g</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2product_def mult.commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l2product_pos_le<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> l2product <span class="free">S</span> <span class="free">f</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> square_integrable_def l2product_def <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l2norm_pow_2<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span>l2norm <span class="free">S</span> <span class="free">f</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> l2product <span class="free">S</span> <span class="free">f</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2norm_def l2product_pos_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l2norm_pos_le<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> l2norm <span class="free">S</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2norm_def l2product_pos_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l2norm_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>l2norm <span class="free">S</span> <span class="free">f</span> <span class="main">≤</span> l2norm <span class="free">S</span> <span class="free">g</span> <span class="main">⟷</span> l2product <span class="free">S</span> <span class="free">f</span> <span class="free">f</span> <span class="main">≤</span> l2product <span class="free">S</span> <span class="free">g</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2norm_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l2norm_eq<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span>l2norm <span class="free">S</span> <span class="free">f</span> <span class="main">=</span> l2norm <span class="free">S</span> <span class="free">g</span> <span class="main">⟷</span> l2product <span class="free">S</span> <span class="free">f</span> <span class="free">f</span> <span class="main">=</span> l2product <span class="free">S</span> <span class="free">g</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2norm_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Schwartz_inequality_strong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"l2product <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">≤</span> l2norm <span class="free">S</span> <span class="free">f</span> <span class="main">*</span> l2norm <span class="free">S</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Holder_inequality_lnorm <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"lebesgue_on <span class="free"><span class="free">S</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">g</span></span></span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> square_integrable_def l2product_def abs_mult <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> l2norm_lnorm<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Schwartz_inequality_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>l2product <span class="free">S</span> <span class="free">f</span> <span class="free">g</span><span class="main">¦</span> <span class="main">≤</span> l2norm <span class="free">S</span> <span class="free">f</span> <span class="main">*</span> l2norm <span class="free">S</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>l2product <span class="free">S</span> <span class="free">f</span> <span class="free">g</span><span class="main">¦</span> <span class="main">≤</span> l2product <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> l2product_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> integral_abs_bound_integral<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms square_integrable_imp_integrable_product<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> l2norm <span class="free">S</span> <span class="free">f</span> <span class="main">*</span> l2norm <span class="free">S</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Schwartz_inequality_strong assms<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Schwartz_inequality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"l2product <span class="free">S</span> <span class="free">f</span> <span class="free">g</span> <span class="main">≤</span> l2norm <span class="free">S</span> <span class="free">f</span> <span class="main">*</span> l2norm <span class="free">S</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Schwartz_inequality_abs assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


<span class="keyword1"><span class="command">lemma</span></span> lnorm_triangle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> lspace <span class="free">M</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> lspace <span class="free">M</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lnorm <span class="free">M</span> <span class="free">p</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> lnorm <span class="free">M</span> <span class="free">p</span> <span class="free">f</span> <span class="main">+</span> lnorm <span class="free">M</span> <span class="free">p</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lp_D<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lp_measurable f g <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lnorm_def <span class="keyword1"><span class="command">using</span></span> Minkowski_inequality<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lnorm_triangle_fun<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> lspace <span class="free">M</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> lspace <span class="free">M</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lnorm <span class="free">M</span> <span class="free">p</span> <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> lnorm <span class="free">M</span> <span class="free">p</span> <span class="free">f</span> <span class="main">+</span> lnorm <span class="free">M</span> <span class="free">p</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lnorm_triangle <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_fun_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l2norm_triangle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> l2norm <span class="free">S</span> <span class="free">f</span> <span class="main">+</span> l2norm <span class="free">S</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> square_integrable_imp_lspace<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> lnorm_triangle <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="quoted">"lebesgue_on <span class="free">S</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2norm_lnorm<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> l2product_ladd<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span><span class="main">;</span> <span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span><span class="main">;</span> <span class="free">h</span> <span class="keyword1">square_integrable</span> <span class="free">S</span><span class="main">⟧</span>
    <span class="main">⟹</span> l2product <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">h</span> <span class="main">=</span> l2product <span class="free">S</span> <span class="free">f</span> <span class="free">h</span> <span class="main">+</span> l2product <span class="free">S</span> <span class="free">g</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2product_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> square_integrable_imp_integrable_product<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l2product_radd<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span><span class="main">;</span> <span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span><span class="main">;</span> <span class="free">h</span> <span class="keyword1">square_integrable</span> <span class="free">S</span><span class="main">⟧</span>
    <span class="main">⟹</span> l2product <span class="free">S</span> <span class="free">f</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> l2product <span class="free">S</span> <span class="free">f</span> <span class="free">g</span> <span class="main">+</span> l2product <span class="free">S</span> <span class="free">f</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2product_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> square_integrable_imp_integrable_product<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l2product_ldiff<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span><span class="main">;</span> <span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span><span class="main">;</span> <span class="free">h</span> <span class="keyword1">square_integrable</span> <span class="free">S</span><span class="main">⟧</span>
    <span class="main">⟹</span> l2product <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">h</span> <span class="main">=</span> l2product <span class="free">S</span> <span class="free">f</span> <span class="free">h</span> <span class="main">-</span> l2product <span class="free">S</span> <span class="free">g</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2product_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> square_integrable_imp_integrable_product<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l2product_rdiff<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span><span class="main">;</span> <span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span><span class="main">;</span> <span class="free">h</span> <span class="keyword1">square_integrable</span> <span class="free">S</span><span class="main">⟧</span>
    <span class="main">⟹</span> l2product <span class="free">S</span> <span class="free">f</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> l2product <span class="free">S</span> <span class="free">f</span> <span class="free">g</span> <span class="main">-</span> l2product <span class="free">S</span> <span class="free">f</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2product_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> square_integrable_imp_integrable_product<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l2product_lmult<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span><span class="main">;</span> <span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span><span class="main">⟧</span>
    <span class="main">⟹</span> l2product <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> l2product <span class="free">S</span> <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2product_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l2product_rmult<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span><span class="main">;</span> <span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span><span class="main">⟧</span>
    <span class="main">⟹</span> l2product <span class="free">S</span> <span class="free">f</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> l2product <span class="free">S</span> <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2product_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l2product_lzero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l2product <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2product_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l2product_rzero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l2product <span class="free">S</span> <span class="free">f</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2product_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l2product_lsum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"l2product <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> l2product <span class="free">S</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> I
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induction</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">i</span> <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> S <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2product_ladd square_integrable_imp_lebesgue<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> l2product_rsum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"l2product <span class="free">S</span> <span class="free">g</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> l2product <span class="free">S</span> <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> l2product_lsum <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2product_sym<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l2norm_lmult<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span> <span class="main">⟹</span> l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="main">*</span> l2norm <span class="free">S</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2norm_def l2product_rmult l2product_sym real_sqrt_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l2norm_rmult<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span> <span class="main">⟹</span> l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> l2norm <span class="free">S</span> <span class="free">f</span> <span class="main">*</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> l2norm_lmult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l2norm_neg<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span> <span class="main">⟹</span> l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> l2norm <span class="free">S</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> l2norm_lmult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> l2norm_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms square_integrable_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> l2norm_neg <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Completeness (Riesz-Fischer)›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eNorm_eq_lnorm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">f</span> <span class="main">∈</span> lspace <span class="free">M</span> <span class="free">p</span><span class="main">;</span> <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> eNorm <span class="main">(</span>𝔏 <span class="main">(</span>ennreal <span class="free">p</span><span class="main">)</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> ennreal <span class="main">(</span>lnorm <span class="free">M</span> <span class="free">p</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lp_D<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> lnorm_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Norm_eq_lnorm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">f</span> <span class="main">∈</span> lspace <span class="free">M</span> <span class="free">p</span><span class="main">;</span> <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> Norm <span class="main">(</span>𝔏 <span class="main">(</span>ennreal <span class="free">p</span><span class="main">)</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> lnorm <span class="free">M</span> <span class="free">p</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lp_D<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> lnorm_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> eNorm_ge1_triangular_ineq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">x</span> <span class="main">+</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eNorm_triangular_ineq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lp<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A mere repackaging of the theorem <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Lp_complete<span class="antiquote"><span class="antiquote">}</span></span></span></span>, but nearly as much work again.›</span></span>
<span class="keyword1"><span class="command">proposition</span></span> l2_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cauchy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">N</span><span class="main">.</span> l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="numeral">2</span> <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">f</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">⊤</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f infinity_ennreal_def spaceN_diff spaceN_iff square_integrable_imp_lspace<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"cauchy_ine<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="numeral">2</span> <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cauchy_ine<span class="hidden">⇩</span><sub>N</sub>_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">M</span><span class="main">.</span> eNorm <span class="main">(</span>𝔏 <span class="numeral">2</span> <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">e</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>real <span class="skolem">r</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> cauchy <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">m</span> <span class="main">≥</span> <span class="skolem">N</span><span class="main">;</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">N</span><span class="main">⟧</span> <span class="main">⟹</span> l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">m</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI allI impI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="numeral">2</span> <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">f</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
          <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> fnm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">f</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">unfolding</span></span> square_integrable_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> borel_measurable_diff'<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">n</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="skolem">m</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> lnorm <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="numeral">2</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">n</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="skolem">m</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> l2norm_lnorm<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Norm <span class="main">(</span>𝔏 <span class="numeral">2</span> <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">f</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Lp_Norm <span class="main">[</span><span class="operator">OF</span> _ fnm<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lnorm_def<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> N <span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> real finite
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Norm_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"tendsto_ine<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="numeral">2</span> <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lp_complete complete<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> fng_to_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="main">(</span>𝔏 <span class="numeral">2</span> <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> g Lp_D<span class="main">(</span>4<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"lebesgue_on <span class="free">S</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tendsto_ine<span class="hidden">⇩</span><sub>N</sub>_def minus_fun_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">M</span> <span class="main">⟹</span> eNorm <span class="main">(</span>𝔏 <span class="numeral">2</span> <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">⊤</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lim_explicit<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> open_lessThan diff_self eNorm_zero lessThan_iff local.finite<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="numeral">2</span> <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="skolem">M</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">⊤</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eNorm_uminus <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="main">_</span> <span class="bound">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_fun_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="numeral">2</span> <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">M</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">⊤</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f square_integrable_imp_lspace <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spaceN_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="numeral">2</span> <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">&lt;</span> <span class="main">⊤</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eNorm_ge1_triangular_ineq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="quoted">"lebesgue_on <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">-</span> <span class="free">f</span> <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">M</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> not_le top.not_eq_extremum
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_fun_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> g_space<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="numeral">2</span> <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spaceN_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> square_integrable_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Lp_measurable g_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f square_integrable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> g_space square_integrable_def square_integrable_iff_lspace <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">g</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">using</span></span> f spaceN_diff square_integrable_imp_lspace <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> fng_to_0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ennreal <span class="main">(</span>lnorm <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="numeral">2</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_fun_def <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> eNorm_eq_lnorm<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> lnorm <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="numeral">2</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ennreal_tendsto_0_iff lnorm_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  l2norm_lnorm lnorm_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Approximation of functions in Lp by bounded and continuous ones›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lspace_bounded_measurable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lebesgue_on <span class="free">S</span><span class="main">.</span> norm <span class="main">(</span><span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> norm <span class="main">(</span><span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lspace_ennreal_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Bochner_Integration.integrable_bound<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspace_approximate_bounded<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> lmeasurable"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"lnorm <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span> <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f_bm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lp_measurable f <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> max <span class="main">(</span><span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>min <span class="bound">n</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="var">?f</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Lp_domination_limit<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="var">?f</span> <span class="bound">n</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> f_bm borel_measurable_max borel_measurable_min borel_measurable_const<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">∘</span> <span class="free">f</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Lp_Banach_lattice <span class="main">[</span><span class="operator">OF</span> f<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> dist <span class="main">(</span><span class="var">?f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> space <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">e</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span><span class="var">?f</span> <span class="skolem">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">⌈</span><span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span><span class="main">¦</span><span class="main">⌉</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_real_def max_def min_def abs_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lebesgue_on <span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> max <span class="main">(</span><span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>min <span class="bound">n</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> tendstoI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_bm<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> lspace<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">n</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span><span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> f lspace_const lspace_min lspace_max <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> S<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> lnorm <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tendsto_in<span class="hidden">⇩</span><sub>N</sub>_def Norm_eq_lnorm <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> f<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>lnorm <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span> <span class="main">(</span><span class="var">?f</span> <span class="skolem">N</span> <span class="main">-</span> <span class="free">f</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> LIMSEQ_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">¦</span>max <span class="main">(</span><span class="main">-</span> real <span class="skolem">N</span><span class="main">)</span> <span class="main">(</span>min <span class="main">(</span>real <span class="skolem">N</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="var">?f</span> <span class="skolem">N</span> <span class="main">`</span> <span class="free">S</span><span class="main">::</span>real set<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bounded_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lnorm <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span> <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="var">?f</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lnorm_minus_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lspace<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> borel_measurable_imp_continuous_limit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>euclidean_space"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> continuous_on UNIV <span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lebesgue_on <span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">g</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">h</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="keyword1">measurable_on</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> S h measurable_on_iff_borel_measurable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">∈</span> null_sets lebesgue"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> continuous_on UNIV <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> tends<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="skolem">N</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">then</span> <span class="free">h</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> measurable_on_def negligible_iff_null_sets<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lebesgue_on <span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">h</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> AE_I'<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">∩</span> <span class="free">S</span> <span class="main">∈</span> null_sets <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S N null_set_Int2 null_sets_restrict_space<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> space <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">h</span> <span class="bound">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">N</span> <span class="main">∩</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tends <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">proposition</span></span> lspace_approximate_continuous<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> lmeasurable"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"lnorm <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span> <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="skolem">h</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lesse2<span class="main">:</span> <span class="quoted"><span class="quoted">"lnorm <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span> <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lspace_approximate_bounded <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">S</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">e</span></span></span><span class="main"><span class="main"><span class="main">/</span></span></span><span class="numeral"><span class="numeral"><span class="numeral">2</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bounded_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> bmh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h lspace_ennreal_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> contg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> continuous_on UNIV <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> gle<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">¦</span><span class="skolem">g</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> tends<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lebesgue_on <span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">h</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> continuous_on UNIV <span class="main">(</span><span class="skolem">γ</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> tends<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lebesgue_on <span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="skolem">γ</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">h</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> borel_measurable_imp_continuous_limit S bmh <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> max <span class="main">(</span><span class="main">-</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">(</span>min <span class="skolem">B</span> <span class="main">(</span><span class="skolem">γ</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="skolem">thesis</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="main">(</span><span class="var">?g</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> cont<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?g</span> <span class="skolem">n</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>  <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def min_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> max <span class="main">(</span><span class="main">-</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">(</span>min <span class="skolem">B</span> <span class="main">(</span><span class="skolem">γ</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">h</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">γ</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">h</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> B <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> LIMSEQ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_def max_def dist_real_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lebesgue_on <span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="var">?g</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">h</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> tends <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> lspace_B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">p</span>›</span></span> lspace_const<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lspace_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">n</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> lspace_bounded_measurable<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">n</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> borel_measurable_continuous_onI contg measurable_completion measurable_restrict_space1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lebesgue_on <span class="free">S</span><span class="main">.</span> norm <span class="main">(</span><span class="main">¦</span><span class="skolem">g</span> <span class="skolem">n</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> norm <span class="main">(</span><span class="main">¦</span><span class="skolem">B</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> gle S <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">p</span>›</span></span> powr_mono2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> lspace_B <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="skolem">g</span> <span class="skolem">h</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Lp_domination_limit <span class="main"><span class="main">[</span></span><span class="operator">OF</span> bmh _ lspace_B tends<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Lp_measurable lspace_g <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lebesgue_on <span class="free">S</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">g</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> S gle <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tendsto_in<span class="hidden">⇩</span><sub>N</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">N</span><span class="main">.</span> lnorm <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> LIMSEQ_D <span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Norm_eq_lnorm <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">p</span>›</span></span> h lspace_g<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"lnorm <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">N</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> minus_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="free">e</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> half_gt_zero order_refl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="main">(</span><span class="skolem">g</span> <span class="skolem">N</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contg<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">N</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span>ennreal <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lspace_g<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lnorm <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span> <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="skolem">h</span> <span class="main">+</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">N</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> lnorm <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span> <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">+</span> lnorm <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">N</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lnorm_triangle_fun<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lspace_g h assms<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span>  <span class="main">&lt;</span> <span class="free">e</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lesse2 N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lnorm_minus_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lnorm <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="free">p</span> <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="skolem">g</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">proposition</span></span> square_integrable_approximate_continuous<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> lmeasurable"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f square_integrable_imp_lspace<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> contg<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="skolem">g</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="numeral">2</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> less_e<span class="main">:</span> <span class="quoted"><span class="quoted">"lnorm <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="numeral">2</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lspace_approximate_continuous <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">e</span></span><span class="main">]</span> S <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">e</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> minus_fun_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> g2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S fmeasurableD square_integrable_iff_lspace<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> less_e <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2norm_lnorm<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contg<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> absolutely_integrable_approximate_continuous<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> lmeasurable"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">absolutely_integrable_on</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">1</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> lnorm<span class="main">:</span> <span class="quoted"><span class="quoted">"lnorm <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> lspace_approximate_continuous<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span>ennreal <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S f fmeasurableD lspace_1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">absolutely_integrable_on</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> S <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> lspace <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">1</span>›</span></span> lspace_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="keyword1">absolutely_integrable_on</span> <span class="free">S</span>›</span></span> f<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L1_D<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> S * fmeasurableD lspace_1<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lnorm S <span class="keyword1"><span class="command">unfolding</span></span> lnorm_def absolutely_integrable_on_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Confine">
<div class="head">
<h1>Theory Confine</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Confining a series to a set›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Confine
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">confine</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>zero<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">confine</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> confine_UNIV <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"confine <span class="free">f</span> UNIV <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> confine_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_confine_eq_Int<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span>confine <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="free">I</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∩</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="free">f</span><span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">a</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms sum.inter_restrict <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> confine_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sums_confine_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>real_normed_vector"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"confine <span class="free">f</span> <span class="free">N</span> <span class="keyword1">sums</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"confine <span class="free">g</span> <span class="free">N</span> <span class="keyword1">sums</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"confine <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">i</span><span class="main">)</span> <span class="free">N</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">N</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">N</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">N</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="bound">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> sums_add <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"confine <span class="free">f</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="quoted">"confine <span class="free">g</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> confine_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sums_confine_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>real_normed_vector"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"confine <span class="free">f</span> <span class="free">N</span> <span class="keyword1">sums</span> <span class="free">a</span> <span class="main">⟹</span> confine <span class="main">(</span>uminus <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="free">N</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> sums_minus <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"confine <span class="free">f</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> confine_def if_distrib <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">uminus</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sums_confine_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>real_normed_algebra"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"confine <span class="free">f</span> <span class="free">N</span> <span class="keyword1">sums</span> <span class="free">a</span> <span class="main">⟹</span> confine <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="free">N</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> sums_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"confine <span class="free">f</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> confine_def if_distrib <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span><span class="free">c</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sums_confine_divide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>real_normed_field"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"confine <span class="free">f</span> <span class="free">N</span> <span class="keyword1">sums</span> <span class="free">a</span> <span class="main">⟹</span> confine <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">c</span><span class="main">)</span> <span class="free">N</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="free">a</span><span class="main">/</span><span class="free">c</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> sums_divide <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"confine <span class="free">f</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> confine_def if_distrib <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">/</span><span class="free">c</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sums_confine_divide_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>real_normed_field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"confine <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">c</span><span class="main">)</span> <span class="free">N</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="free">a</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> confine <span class="free">f</span> <span class="free">N</span> <span class="keyword1">sums</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"confine <span class="free">f</span> <span class="free">N</span> <span class="keyword1">sums</span> <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"confine <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">c</span><span class="main">)</span> <span class="free">N</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sums_confine_mult <span class="main">[</span><span class="operator">OF</span> that<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sums_confine_divide<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sums_confine<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>real_normed_vector"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"confine <span class="free">f</span> <span class="free">N</span> <span class="keyword1">sums</span> <span class="free">l</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span><span class="bound">n</span><span class="main">}</span> <span class="main">∩</span> <span class="free">N</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_def atLeast0LessThan confine_def sum.inter_restrict<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sums_confine_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>real_normed_vector"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"confine <span class="free">f</span> <span class="free">N</span> <span class="keyword1">sums</span> <span class="free">l</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{..</span><span class="bound">n</span><span class="main">}</span> <span class="main">∩</span> <span class="free">N</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_def_le atLeast0AtMost confine_def sum.inter_restrict<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Fourier_Aux2">
<div class="head">
<h1>Theory Fourier_Aux2</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Lemmas possibly destined for future Isabelle releases›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Fourier_Aux2
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Analysis/Analysis.html">HOL-Analysis.Analysis</a>"</span> 
<span class="keyword2"><span class="keyword">begin</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> integral_sin_Z <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> lebesgue_integral_eq_integral<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_imp_integrable_real <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms Ints_cases integral_sin_nx <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> integral_sin_Z' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms integral_sin_Z mult_commute_abs<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> integral_cos_Z <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos<span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> lebesgue_integral_eq_integral<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_imp_integrable_real <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ints_cases assms integral_cos_nx of_int_0_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> integral_cos_Z' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos<span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms integral_cos_Z mult_commute_abs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> odd_even_cases <span class="main">[</span><span class="operator">case_names</span> 0 odd even<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> odd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> even<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nat_induct2 One_nat_def Suc_1 add_Suc_right assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> dvdE even odd oddE<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Fourier">
<div class="head">
<h1>Theory Fourier</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹The basics of Fourier series›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Ported from HOL Light; thanks to Manuel Eberl for help with the real asymp proof methods›</span></span>

<span class="keyword1"><span class="command">theory</span></span> <span class="quoted">"Fourier"</span>
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Periodic.html">Periodic</a> <a href="Square_Integrable.html">Square_Integrable</a> <span class="quoted">"<a href="../../HOL/HOL-Real_Asymp/Real_Asymp.html">HOL-Real_Asymp.Real_Asymp</a>"</span> <a href="Confine.html">Confine</a> <a href="Fourier_Aux2.html">Fourier_Aux2</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Orthonormal system of L2 functions and their Fourier coefficients›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">orthonormal_system</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">orthonormal_system</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> l2product <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">m</span> <span class="main">=</span> <span class="bound">n</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">orthonormal_coeff</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space set <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">orthonormal_coeff</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> l2product <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> orthonormal_system_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"orthonormal_system <span class="free">S</span> <span class="free">w</span> <span class="main">⟹</span> l2product <span class="free">S</span> <span class="main">(</span><span class="free">w</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">m</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> orthonormal_system_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> orthonormal_system_l2norm<span class="main">:</span>
   <span class="quoted"><span class="quoted">"orthonormal_system <span class="free">S</span> <span class="free">w</span> <span class="main">⟹</span> l2norm <span class="free">S</span> <span class="main">(</span><span class="free">w</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2norm_def orthonormal_system_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> orthonormal_partial_sum_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> os<span class="main">:</span> <span class="quoted"><span class="quoted">"orthonormal_system <span class="free">S</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">w</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">a</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">w</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span>
        <span class="main">(</span>l2norm <span class="free">S</span> <span class="free">f</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span>  <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">a</span> <span class="bound">i</span> <span class="main">*</span> orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f square_integrable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">a</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">w</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> square_integrable_sum square_integrable_lmult w <span class="quoted"><span class="quoted">‹finite <span class="free">I</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2norm_pow_2 orthonormal_coeff_def orthonormal_system_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2product_rdiff l2product_sym
           l2product_rsum l2product_rmult <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square if_distrib <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">_</span> <span class="main">*</span> <span class="bound">x</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> orthonormal_optimal_partial_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orthonormal_system <span class="free">S</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">w</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">w</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
       <span class="main">≤</span> l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">a</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">w</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="skolem">i</span> <span class="main">*</span> l2product <span class="free">S</span> <span class="free">f</span><span class="main">(</span><span class="free">w</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">a</span> <span class="skolem">i</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>l2product <span class="free">S</span> <span class="free">f</span><span class="main">(</span><span class="free">w</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> sum_squares_bound <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"l2product <span class="free">S</span> <span class="free">f</span><span class="main">(</span><span class="free">w</span> <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">a</span> <span class="bound">i</span> <span class="main">*</span> l2product <span class="free">S</span> <span class="free">f</span><span class="main">(</span><span class="free">w</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>l2product <span class="free">S</span> <span class="free">f</span><span class="main">(</span><span class="free">w</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left sum_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms square_integrable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2norm_le square_integrable_sum square_integrable_diff square_integrable_lmult <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> l2norm_pow_2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> orthonormal_coeff_def orthonormal_partial_sum_diff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2product_sym power2_eq_square sum.distrib<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Bessel_inequality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orthonormal_system <span class="free">S</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">w</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">(</span>orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>l2norm <span class="free">S</span> <span class="free">f</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> orthonormal_partial_sum_diff <span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> add_diff_cancel_left' diff_ge_0_iff_ge zero_le_power2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Fourier_series_square_summable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> os<span class="main">:</span> <span class="quoted"><span class="quoted">"orthonormal_system <span class="free">S</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">w</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span>confine <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"incseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{..</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> incseq_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sum_mono2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{..</span><span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>l2norm <span class="free">S</span> <span class="free">f</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bessel_inequality assms<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{..</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">L</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> incseq_convergent <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">r</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∃</span><span class="bound">no</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">no</span><span class="main">.</span> <span class="main">¦</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..</span><span class="bound">n</span><span class="main">}</span> <span class="main">∩</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span>orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span> <span class="skolem">L</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="bound">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LIMSEQ_iff Int_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> summable_def sums_confine_le LIMSEQ_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> orthonormal_Fourier_partial_sum_diff_squared<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> os<span class="main">:</span> <span class="quoted"><span class="quoted">"orthonormal_system <span class="free">S</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">w</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">w</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span>
         <span class="main">(</span>l2norm <span class="free">S</span> <span class="free">f</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">(</span>orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> orthonormal_partial_sum_diff <span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> Fourier_series_l2_summable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> os<span class="main">:</span> <span class="quoted"><span class="quoted">"orthonormal_system <span class="free">S</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">w</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{..</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">w</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">⇢</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f square_integrable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Θ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">A</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">∩</span> <span class="bound">A</span><span class="main">.</span> orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">w</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ψ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"confine <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> si<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Θ</span> <span class="skolem">A</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> square_integrable_lmult w square_integrable_sum S that<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">N</span><span class="main">.</span> l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?Θ</span> <span class="main">{..</span><span class="bound">m</span><span class="main">}</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?Θ</span> <span class="main">{..</span><span class="bound">n</span><span class="main">}</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">e</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="var">?Ψ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Fourier_series_square_summable <span class="main"><span class="main">[</span></span><span class="operator">OF</span> os w f<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Cauchy <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> sum <span class="var">?Ψ</span> <span class="main">{..</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> summable_def sums_def_le convergent_eq_Cauchy<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">m</span><span class="main">≥</span><span class="skolem">M</span><span class="main">;</span> <span class="bound">n</span><span class="main">≥</span><span class="skolem">M</span><span class="main">⟧</span> <span class="main">⟹</span> dist <span class="main">(</span>sum <span class="var">?Ψ</span> <span class="main">{..</span><span class="bound">m</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>sum <span class="var">?Ψ</span> <span class="main">{..</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Cauchy_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">m</span><span class="main">≥</span><span class="skolem">M</span><span class="main">;</span> <span class="skolem">n</span><span class="main">≥</span><span class="skolem">M</span><span class="main">⟧</span> <span class="main">⟹</span> l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?Θ</span> <span class="main">{..</span><span class="skolem">m</span><span class="main">}</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?Θ</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_class.linorder_wlog<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>le <span class="skolem">m</span> <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> sum_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">f</span><span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> sum <span class="skolem">f</span><span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{..</span><span class="skolem">m</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> sum <span class="skolem">f</span><span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="skolem">m</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{..</span><span class="skolem">m</span><span class="main">}</span> <span class="main">∪</span> <span class="free">I</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="skolem">m</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{..</span><span class="skolem">m</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="skolem">m</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> sum.union_disjoint<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?Θ</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?Θ</span> <span class="main">{..</span><span class="skolem">m</span><span class="main">}</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>
            <span class="main">≤</span> <span class="main">¦</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{..</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_diff<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>l2norm <span class="free">S</span> <span class="main">(</span><span class="var">?Θ</span> <span class="main">{</span>Suc <span class="skolem">m</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>
            <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="skolem">m</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> l2product <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="skolem">m</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">w</span> <span class="bound">j</span> <span class="bound">x</span><span class="main">)</span>
                                               <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">w</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2norm_pow_2 l2product_rsum si w<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="skolem">m</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="skolem">m</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span>
                            orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">*</span> orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> l2product <span class="free">S</span> <span class="main">(</span><span class="free">w</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2product_lsum l2product_lmult l2product_rmult si w <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">¦</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="skolem">m</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">¦</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> orthonormal_system_eq <span class="main"><span class="main">[</span></span><span class="operator">OF</span> os<span class="main"><span class="main">]</span></span> power2_eq_square if_distrib <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span><span class="main">_</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>l2norm <span class="free">S</span> <span class="main">(</span><span class="var">?Θ</span> <span class="main">{</span>Suc <span class="skolem">m</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">¦</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="skolem">m</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> M <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">≥</span><span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span><span class="main">≥</span><span class="skolem">M</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_real_def sum_confine_eq_Int Int_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?Θ</span> <span class="main">{..</span><span class="skolem">m</span><span class="main">}</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?Θ</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> l2norm_diff <span class="main">[</span><span class="operator">OF</span> si si<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_less_imp_less<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sym <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> l2norm_diff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> si<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> si <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="main">_</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span> l2_complete <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="var">?Θ</span> <span class="main">{..</span><span class="bound">n</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Fourier_series_l2_summable_strong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> os<span class="main">:</span> <span class="quoted"><span class="quoted">"orthonormal_system <span class="free">S</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">w</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{..</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">w</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
           <span class="main">⇢</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f square_integrable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> teng<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{..</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">w</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Fourier_series_l2_summable <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_unique<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Θ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">A</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">∩</span> <span class="bound">A</span><span class="main">.</span> orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">w</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> l2product <span class="free">S</span> <span class="main">(</span><span class="free">w</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?Θ</span> <span class="main">{..</span><span class="bound">n</span><span class="main">}</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="var">?Θ</span> <span class="main">{..</span><span class="bound">n</span><span class="main">}</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">⇢</span> orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> orthonormal_coeff_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> l2product <span class="free">S</span> <span class="main">(</span><span class="free">w</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?Θ</span> <span class="main">{..</span><span class="bound">n</span><span class="main">}</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_eventually<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"l2product <span class="free">S</span> <span class="main">(</span><span class="free">w</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?Θ</span> <span class="main">{..</span><span class="skolem">j</span><span class="main">}</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
            <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>›</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2product_rdiff l2product_rsum l2product_rmult orthonormal_coeff_def w f S<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> orthonormal_system_eq <span class="main"><span class="main">[</span></span><span class="operator">OF</span> os<span class="main"><span class="main">]</span></span> if_distrib <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span><span class="main">_</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> l2product <span class="free">S</span> <span class="main">(</span><span class="free">w</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?Θ</span> <span class="main">{..</span><span class="bound">n</span><span class="main">}</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> eventually_at_top_linorder <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> l2product <span class="free">S</span> <span class="main">(</span><span class="free">w</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?Θ</span> <span class="main">{..</span><span class="bound">n</span><span class="main">}</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> Lim_null_comparison <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ teng<span class="main"><span class="main">]</span></span> eventuallyI<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>l2product <span class="free">S</span> <span class="main">(</span><span class="free">w</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?Θ</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> l2norm <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?Θ</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
            <span class="keyword1"><span class="command">using</span></span> Schwartz_inequality_abs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?Θ</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S g f w orthonormal_system_l2norm <span class="main"><span class="main">[</span></span><span class="operator">OF</span> os<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that tendsto_add <span class="main">[</span><span class="operator">OF</span> 1 2<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> l2product_radd<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2product_radd w f g S<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g teng<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Actual trigonometric orthogonality relations›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> integrable_sin_cx<span class="main">:</span>
  <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_imp_integrable_real <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> integrable_cos_cx<span class="main">:</span>
  <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos<span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_imp_integrable_real <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> integral_cos_Z' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos<span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms integral_cos_Z mult_commute_abs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> integral_sin_and_cos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span> <span class="free">n</span><span class="main">::</span><span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos<span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¦</span><span class="free">m</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">n</span><span class="main">¦</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="keyword1">else</span> pi <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos<span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">m</span> <span class="main">≥</span> <span class="main">0</span><span class="main">;</span> <span class="free">n</span> <span class="main">≥</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">m</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="keyword1">then</span> pi <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¦</span><span class="free">m</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">n</span><span class="main">¦</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="keyword1">then</span> pi <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if sin_times_sin cos_times_sin sin_times_cos cos_times_cos
                    integrable_sin_cx integrable_cos_cx mult_ac
               <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> distrib_left distrib_right left_diff_distrib right_diff_distrib<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> integral_sin_and_cos_Z <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span> <span class="free">n</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos<span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¦</span><span class="free">m</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">n</span><span class="main">¦</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="keyword1">else</span> pi <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos<span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¦</span><span class="free">m</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">n</span><span class="main">¦</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="keyword1">then</span> pi <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Ints_def
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command">unfolding</span></span> integral_sin_and_cos
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> integral_sin_and_cos_N <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span> <span class="free">n</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="main">ℕ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="main">ℕ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">m</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="keyword1">then</span> pi <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Nats_altdef1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> integral_sin_and_cos<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> integrable_sin_and_cos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span> <span class="free">n</span><span class="main">::</span><span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos<span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos<span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_imp_integrable_real <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sqrt_pi_ge1<span class="main">:</span> <span class="quoted"><span class="quoted">"sqrt pi <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pi_gt3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">trigonometric_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">trigonometric_set</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span>
    <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> sqrt<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> odd <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span>real<span class="main">(</span>Suc <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> sqrt<span class="main">(</span>pi<span class="main">)</span>
    <span class="keyword1">else</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos<span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> sqrt pi<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> trigonometric_set<span class="main">:</span>
  <span class="quoted"><span class="quoted">"trigonometric_set <span class="main">0</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> sqrt<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"trigonometric_set <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> sin<span class="main">(</span>real<span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">/</span> sqrt<span class="main">(</span>pi<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"trigonometric_set <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> cos<span class="main">(</span>real<span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">/</span> sqrt<span class="main">(</span>pi<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"trigonometric_set <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> cos<span class="main">(</span>real<span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">/</span> sqrt<span class="main">(</span>pi<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trigonometric_set_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> add_divide_distrib<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> trigonometric_set_even<span class="main">:</span>
   <span class="quoted"><span class="quoted">"trigonometric_set<span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> sqrt<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos<span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> sqrt pi<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trigonometric_set_def add_divide_distrib <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> orthonormal_system_trigonometric_set<span class="main">:</span>
    <span class="quoted"><span class="quoted">"orthonormal_system <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> trigonometric_set"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"l2product <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span>trigonometric_set <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>trigonometric_set <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> odd_even_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> odd_even_cases<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trigonometric_set l2product_def measure_restrict_space<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>odd <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> odd_even_cases<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trigonometric_set l2product_def double_not_eq_Suc_double<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>even <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> odd_even_cases<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trigonometric_set l2product_def Suc_double_not_eq_double<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> orthonormal_system_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> square_integrable_trigonometric_set<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span>trigonometric_set <span class="free">i</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> sqrt pi<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span>real <span class="free">i</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> sqrt pi<span class="main">)</span> "</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trigonometric_set_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Weierstrass for trigonometric polynomials›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Weierstrass_trig_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> contf<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="free">z</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">z</span> <span class="keyword1">within</span> <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> Im <span class="main">∘</span> Ln<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"complex_of_real <span class="main">∘</span> <span class="free">g</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> pi<span class="main">)</span> <span class="main">∘</span> Im <span class="main">∘</span> Ln <span class="main">∘</span> uminus"</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">z</span> <span class="keyword1">within</span> <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>complex_of_real <span class="main">∘</span> <span class="free">g</span> <span class="main">∘</span> Im <span class="main">∘</span> Ln<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_transform_within<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≥</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> True complex_nonneg_Reals_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">z</span> <span class="keyword1">within</span> <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="var">?f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_within_Ln <span class="dynamic"><span class="dynamic">continuous_intros</span></span> continuous_on_imp_continuous_within <span class="main"><span class="main">[</span></span><span class="operator">OF</span> contf<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">x'</span> <span class="main">=</span>  <span class="main">(</span>complex_of_real <span class="main">∘</span> <span class="free">g</span> <span class="main">∘</span> Im <span class="main">∘</span> Ln<span class="main">)</span> <span class="skolem">x'</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">x'</span> <span class="free">z</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x'</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ln_minus add.commute periodic<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> 1 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">z</span> <span class="keyword1">within</span> <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Re <span class="main">∘</span> complex_of_real <span class="main">∘</span> <span class="free">g</span> <span class="main">∘</span> Im <span class="main">∘</span> Ln<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> o_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_Re<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"complex_of_real <span class="main">∘</span> <span class="free">g</span> <span class="main">∘</span> Im <span class="main">∘</span> Ln <span class="main">∘</span> uminus"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_less nonpos_Reals_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">z</span> <span class="keyword1">within</span> <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>complex_of_real <span class="main">∘</span> <span class="free">g</span> <span class="main">∘</span> Im <span class="main">∘</span> Ln<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_within_Ln <span class="dynamic"><span class="dynamic">continuous_intros</span></span> continuous_on_imp_continuous_within <span class="main"><span class="main">[</span></span><span class="operator">OF</span> contf<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">z</span> <span class="keyword1">within</span> <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Re <span class="main">∘</span> complex_of_real <span class="main">∘</span> <span class="free">g</span> <span class="main">∘</span> Im <span class="main">∘</span> Ln<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> o_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_Re<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">cx_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>complex <span class="main">⇒</span> real<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    Re<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="main">∈</span> <span class="free">cx_poly</span>"</span></span>
  <span class="main">|</span> Im<span class="main">:</span> <span class="quoted"><span class="quoted">"Im <span class="main">∈</span> <span class="free">cx_poly</span>"</span></span>
  <span class="main">|</span> const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">cx_poly</span>"</span></span>
  <span class="main">|</span> add<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∈</span> <span class="free">cx_poly</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">∈</span> <span class="free">cx_poly</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">cx_poly</span>"</span></span>
  <span class="main">|</span> mult<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∈</span> <span class="free">cx_poly</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">∈</span> <span class="free">cx_poly</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">cx_poly</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> cx_poly.intros <span class="main">[</span><span class="operator">intro</span><span class="main">]</span>


<span class="keyword1"><span class="command">lemma</span></span> Weierstrass_trig_polynomial<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> contf<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fpi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="main">-</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> pi"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">n</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span> <span class="free">b</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">⟹</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">k</span> <span class="main">*</span> sin <span class="main">(</span><span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">b</span> <span class="bound">k</span> <span class="main">*</span> cos <span class="main">(</span><span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> CR<span class="main">:</span> function_ring_on <span class="quoted"><span class="quoted">"cx_poly"</span></span> <span class="quoted"><span class="quoted">"sphere <span class="main">0</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> cx_poly"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">induction</span> <span class="main">(</span><span class="operator">assumption</span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">::</span><span class="quoted">complex</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> sphere <span class="main">0</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> sphere <span class="main">0</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">≠</span> Re <span class="skolem">y</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x</span> <span class="main">≠</span> Im <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> complex_eqI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">∈</span>cx_poly<span class="main">.</span> <span class="bound">f</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="bound">f</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cx_poly.Im cx_poly.Re<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cx_poly.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> Im <span class="main">∘</span> Ln<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">z</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> contg<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> gf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">⟹</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Tietze_periodic_interval <span class="main">[</span><span class="operator">OF</span> contf fpi<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">∘</span> Im <span class="main">∘</span> Ln<span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_transform_within<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="var">?f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Weierstrass_trig_1 <span class="main">[</span><span class="operator">OF</span> contg periodic that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sphere_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">x'</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> Im <span class="main">∘</span> Ln<span class="main">)</span> <span class="skolem">x'</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> sphere <span class="main">0</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">x'</span> <span class="skolem">z</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x'</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="skolem">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Im_Ln_le_pi <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x'</span></span><span class="main">]</span> mpi_less_Im_Ln <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> gf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> Im <span class="main">∘</span> Ln<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> continuous_on_eq_continuous_within mem_sphere_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> cx_poly"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> sphere <span class="main">0</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">¦</span><span class="main">(</span><span class="free">f</span> <span class="main">∘</span> Im <span class="main">∘</span> Ln<span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CR.Stone_Weierstrass_basic <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> Im <span class="main">∘</span> Ln"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">trigpoly</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="bound">a</span> <span class="bound">k</span> <span class="main">*</span> sin<span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span>  <span class="bound">b</span> <span class="bound">k</span> <span class="main">*</span> cos<span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> tp_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span>
    <span class="keyword1"><span class="command">unfolding</span></span> trigpoly_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> tp_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span> <span class="skolem">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span> <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">g</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">b1</span></span> <span class="keyword2"><span class="keyword">where</span></span> feq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n1</span><span class="main">.</span> <span class="skolem">a1</span> <span class="bound">k</span> <span class="main">*</span> sin <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">b1</span> <span class="bound">k</span> <span class="main">*</span> cos <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">trigpoly</span> <span class="skolem">f</span>›</span></span> trigpoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n2</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">b2</span></span> <span class="keyword2"><span class="keyword">where</span></span> geq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n2</span><span class="main">.</span> <span class="skolem">a2</span> <span class="bound">k</span> <span class="main">*</span> sin <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">b2</span> <span class="bound">k</span> <span class="main">*</span> cos <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">trigpoly</span> <span class="skolem">g</span>›</span></span> trigpoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">n1</span> <span class="keyword1">then</span> <span class="skolem">a1</span> <span class="bound">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">n2</span> <span class="keyword1">then</span> <span class="skolem">a2</span> <span class="bound">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">n1</span> <span class="keyword1">then</span> <span class="skolem">b1</span> <span class="bound">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">n2</span> <span class="keyword1">then</span> <span class="skolem">b2</span> <span class="bound">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> max <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">a</span><span class="main">}</span> <span class="main">=</span> <span class="main">{..</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> max <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{..</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span> <span class="main">≤</span> max <span class="skolem">n1</span> <span class="skolem">n2</span><span class="main">.</span> <span class="var">?a</span> <span class="bound">k</span> <span class="main">*</span> sin <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="var">?b</span> <span class="bound">k</span> <span class="main">*</span> cos <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> feq geq <span class="dynamic"><span class="dynamic">algebra_simps</span></span> eq sum.distrib if_distrib <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">_</span> <span class="main">*</span> <span class="bound">u</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> sum.inter_filter<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> trigpoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> tp_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">⟹</span> <span class="skolem">trigpoly</span><span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">induction</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tp_const tp_add<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> tp_cmul<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">c</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> feq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">k</span> <span class="main">*</span> sin <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">b</span> <span class="bound">k</span> <span class="main">*</span> cos <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">trigpoly</span> <span class="skolem">f</span>›</span></span> trigpoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">a</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">b</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> cos <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> feq <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sum_distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> trigpoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> tp_cdiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">c</span>
    <span class="keyword1"><span class="command">using</span></span> tp_cmul <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">trigpoly</span> <span class="skolem">f</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">c</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_inverse_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> tp_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span> <span class="skolem">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span> <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">g</span>
    <span class="keyword1"><span class="command">using</span></span> tp_add <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">trigpoly</span> <span class="skolem">f</span>›</span></span> tp_cmul <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">trigpoly</span> <span class="skolem">g</span>›</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> tp_sin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">ℕ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">unfolding</span></span> trigpoly_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> real <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Nats_cases <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="main">ℕ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span> <span class="main">≤</span> nat<span class="main">⌊</span><span class="skolem">n</span><span class="main">⌋</span><span class="main">.</span> <span class="bound">a</span> <span class="bound">i</span> <span class="main">*</span> sin <span class="main">(</span>real <span class="bound">i</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="bound">b</span> <span class="bound">i</span> <span class="main">*</span> cos <span class="main">(</span>real <span class="bound">i</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> if_distrib <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">*</span> <span class="main">_</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> tp_cos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">ℕ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">unfolding</span></span> trigpoly_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> real <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Nats_cases <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="main">ℕ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span> <span class="main">≤</span> nat<span class="main">⌊</span><span class="skolem">n</span><span class="main">⌋</span><span class="main">.</span> <span class="bound">a</span> <span class="bound">i</span> <span class="main">*</span> sin <span class="main">(</span>real <span class="bound">i</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="bound">b</span> <span class="bound">i</span> <span class="main">*</span> cos <span class="main">(</span>real <span class="bound">i</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> if_distrib <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">*</span> <span class="main">_</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> tp_sincos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="skolem">i</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="skolem">j</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">trigpoly</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="skolem">i</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="skolem">j</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                   <span class="skolem">trigpoly</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos<span class="main">(</span><span class="skolem">i</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="skolem">j</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">trigpoly</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos<span class="main">(</span><span class="skolem">i</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="skolem">j</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">i</span> <span class="skolem">j</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> linorder_wlog <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">j</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">j</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_times_sin cos_times_cos sin_times_cos cos_times_sin diff_divide_distrib 
                    tp_add tp_diff tp_cdiv tp_cos tp_sin <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> left_diff_distrib distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> tp_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span> <span class="skolem">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span> <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">g</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">b1</span></span> <span class="keyword2"><span class="keyword">where</span></span> feq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n1</span><span class="main">.</span> <span class="skolem">a1</span> <span class="bound">k</span> <span class="main">*</span> sin <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">b1</span> <span class="bound">k</span> <span class="main">*</span> cos <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">trigpoly</span> <span class="skolem">f</span>›</span></span> trigpoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n2</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">b2</span></span> <span class="keyword2"><span class="keyword">where</span></span> geq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n2</span><span class="main">.</span> <span class="skolem">a2</span> <span class="bound">k</span> <span class="main">*</span> sin <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">b2</span> <span class="bound">k</span> <span class="main">*</span> cos <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">trigpoly</span> <span class="skolem">g</span>›</span></span> trigpoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> feq geq
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sum_product tp_sum tp_add tp_cmul tp_sincos <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">trigpoly</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span>  <span class="skolem">f</span><span class="main">(</span>exp<span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> of_real <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> cx_poly"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
    <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">induction</span>
    <span class="keyword3"><span class="command">case</span></span> Re
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> tp_cos <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Re_exp<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Im
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> tp_sin <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Im_exp<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tp_const tp_add tp_mult<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">(</span>iexp <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">k</span> <span class="main">*</span> sin <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">b</span> <span class="bound">k</span> <span class="main">*</span> cos <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> cx_poly›</span></span><span class="main">]</span> trigpoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span> <span class="skolem">θ</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">k</span> <span class="main">*</span> sin <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">b</span> <span class="bound">k</span> <span class="main">*</span> cos <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">θ</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">θ</span> <span class="main">-</span> <span class="skolem">g</span> <span class="main">(</span>iexp <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> Im <span class="main">∘</span> Ln<span class="main">)</span> <span class="main">(</span>iexp <span class="skolem">θ</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">g</span> <span class="main">(</span>iexp <span class="skolem">θ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span> <span class="main">=</span> <span class="main">-</span>pi"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_minus fpi<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> g <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"exp<span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> of_real <span class="skolem">θ</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹A bit of extra hacking round so that the ends of a function are OK›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> integral_tweak_ends<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">f</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"l2norm <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">f</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span><span class="main">+</span><span class="main">1</span> <span class="main">/</span> real<span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
               <span class="keyword1">then</span> <span class="main">(</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> real <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> abeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">a</span><span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> True
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"*"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> abeq
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">a</span><span class="main">+</span><span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_eq <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">(</span></span>Suc <span class="skolem"><span class="skolem">n</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">d</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">*</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">a</span></span><span class="main"><span class="main">+</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="main"><span class="main">(</span></span>Suc <span class="skolem"><span class="skolem">n</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">-</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> False <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span><span class="main">+</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">d</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> bmg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> measurable_restrict_space1<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> borel_measurable_if_I <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> borel_measurable_const<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bmf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">k</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> bm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{..</span><span class="free">a</span><span class="main">+</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">measurable</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> measurable_completion measurable_restrict_space1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> borel_measurable_power measurable_restrict_space1<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> borel_measurable_if_I <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">{..</span> <span class="free">a</span><span class="main">+</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> bm<span class="main">]</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> int_d2<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">d</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_imp_integrable_real <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">k</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="var">?g</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">a</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> real <span class="skolem">N</span> <span class="main">&lt;</span> <span class="skolem">x</span><span class="main">-</span><span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> real_arch_invD <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">-</span><span class="free">a</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inverse_eq_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="free">a</span><span class="main">+</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> real <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≥</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">+</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> real <span class="skolem">k</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">a</span><span class="main">+</span><span class="main">1</span> <span class="main">/</span> real <span class="skolem">N</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">N</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_eventually eventually_sequentiallyI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">N</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tends<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">k</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="var">?g</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> le_d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> norm <span class="main">(</span><span class="var">?f</span> <span class="bound">k</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">a</span><span class="main">+</span><span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">then</span> real <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> space <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> abs_le_square_iff<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_if zero_less_mult_iff mult_left_le<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> integ<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="var">?g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable_dominated_convergence <span class="main">[</span><span class="operator">OF</span> bmg bmf int_d2 tends le_d2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="var">?g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integral_dominated_convergence <span class="main">[</span><span class="operator">OF</span> bmg bmf int_d2 tends le_d2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≥</span> <span class="skolem">N</span> <span class="main">⟹</span> <span class="main">¦</span><span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="var">?g</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">e</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lim_sequentially dist_real_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> real <span class="skolem">M</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">-</span><span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> real_arch_invD <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">-</span><span class="free">a</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> diff_gt_0_iff_gt inverse_eq_divide neq0_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="var">?f</span> <span class="main">(</span>max <span class="skolem">M</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="var">?g</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">e</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?φ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span><span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>Suc <span class="main">(</span>max <span class="skolem">M</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">(</span>Suc <span class="main">(</span>max <span class="skolem">M</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>Suc <span class="main">(</span>max <span class="skolem">M</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="var">?φ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cont<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> real <span class="main">(</span>max <span class="skolem">M</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="skolem">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">M</span>›</span></span> frac_le<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">b</span> <span class="main">≤</span> <span class="free">a</span><span class="main">+</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> real <span class="main">(</span>max <span class="skolem">M</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> M <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> max.cobounded1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span> <span class="quoted"><span class="skolem">N</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?φ</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> null_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">∈</span> null_sets <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_sets_restrict_space<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> <span class="var">?g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> integral_eq_zero_AE AE_I' <span class="main"><span class="main">[</span></span><span class="operator">OF</span> null_a<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"l2norm <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="var">?φ</span> <span class="main">&lt;</span> sqrt <span class="main">(</span><span class="free">e</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> l2norm_def l2product_def power2_eq_square <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> real_sqrt_less_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"*"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"l2norm <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="var">?φ</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> square_integrable_approximate_continuous_ends<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">b</span> <span class="main">=</span> <span class="free">g</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"l2norm <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> contg<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lg<span class="main">:</span> <span class="quoted"><span class="quoted">"l2norm <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> square_integrable_approximate_continuous
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> box_real<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> half_gt_zero_iff lmeasurable_cbox<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> conth<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="skolem">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">g</span> <span class="free">b</span> <span class="main">-</span> <span class="skolem">g</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lh<span class="main">:</span> <span class="quoted"><span class="quoted">"l2norm <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="skolem">h</span> <span class="main">&lt;</span> <span class="free">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integral_tweak_ends <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> zero_less_divide_iff zero_less_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="skolem">h</span>›</span></span> continuous_imp_square_integrable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> continuous_on_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> contg<span class="main"><span class="main">]</span></span> conth <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> continuous_imp_square_integrable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="free">b</span> <span class="main">+</span> <span class="skolem">h</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">g</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">h</span> <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">g</span> <span class="free">b</span> <span class="main">-</span> <span class="skolem">g</span> <span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"l2norm <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> le_less_trans <span class="main"><span class="main">[</span></span><span class="operator">OF</span> l2norm_triangle <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">-</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="free"><span class="free">a</span></span><span class="main"><span class="main">..</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">h</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>›</span></span> f square_integrable_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>›</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"l2norm <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> l2norm <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>›</span></span> l2norm_neg lg lh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"l2norm <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Hence the main approximation result›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Weierstrass_l2_trig_polynomial<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">n</span> <span class="free">a</span> <span class="free">b</span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">k</span> <span class="main">*</span> sin<span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">b</span> <span class="bound">k</span> <span class="main">*</span> cos<span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?φ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="bound">a</span> <span class="bound">k</span> <span class="main">*</span> sin<span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="bound">b</span> <span class="bound">k</span> <span class="main">*</span> cos<span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> contg<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> geq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">(</span><span class="main">-</span>pi<span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span> pi"</span></span>
           <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> norm_fg<span class="main">:</span> <span class="quoted"><span class="quoted">"l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> square_integrable_approximate_continuous_ends <span class="main"><span class="main">[</span></span><span class="operator">OF</span> f<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> g_phi_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">⟹</span> <span class="main">¦</span><span class="skolem">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="var">?φ</span> <span class="skolem">n</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="bound">x</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">e</span><span class="main">/</span><span class="numeral">6</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> Weierstrass_trig_polynomial <span class="main">[</span><span class="operator">OF</span> contg geq<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">/</span><span class="numeral">6</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> zero_less_divide_iff zero_less_numeral<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> si<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?φ</span> <span class="skolem">n</span> <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">u</span> <span class="skolem">v</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> square_integrable_sum continuous_imp_square_integrable<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="skolem">k</span> <span class="main">*</span> sin <span class="main">(</span>real <span class="skolem">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">v</span> <span class="skolem">k</span> <span class="main">*</span> cos <span class="main">(</span>real <span class="skolem">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="var">?φ</span> <span class="skolem">n</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="var">?φ</span> <span class="skolem">n</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="var">?φ</span> <span class="skolem">n</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> l2norm_triangle<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f g square_integrable_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="var">?φ</span> <span class="skolem">n</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> g si square_integrable_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> g_phi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="var">?φ</span> <span class="skolem">n</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> g si square_integrable_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="var">?φ</span> <span class="skolem">n</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> l2norm_def l2product_def power2_eq_square <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> real_le_lsqrt<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="var">?φ</span> <span class="skolem">n</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integral_nonneg_AE<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="var">?φ</span> <span class="skolem">n</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>
            <span class="main">≤</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">e</span> <span class="main">/</span> <span class="numeral">6</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> integral_mono<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="var">?φ</span> <span class="skolem">n</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> g_phi square_integrable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">e</span> <span class="main">/</span> <span class="numeral">6</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> continuous_imp_integrable_real<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">(</span><span class="var">?φ</span> <span class="skolem">n</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">e</span> <span class="main">/</span> <span class="numeral">6</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> space <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> g_phi_less that
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_le_square_iff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> less_eq_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> pi_less_4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power2_eq_square measure_restrict_space<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="var">?φ</span> <span class="skolem">n</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> norm_fg <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="var">?φ</span> <span class="skolem">n</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">proposition</span></span> Weierstrass_l2_trigonometric_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">n</span> <span class="free">a</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> lee<span class="main">:</span>
    <span class="quoted"><span class="quoted">"l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">k</span> <span class="main">*</span> sin<span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">b</span> <span class="bound">k</span> <span class="main">*</span> cos<span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Weierstrass_l2_trig_polynomial <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> sqrt<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">0</span>
                <span class="keyword1">else</span> <span class="keyword1">if</span> even <span class="bound">k</span> <span class="keyword1">then</span> sqrt pi <span class="main">*</span> <span class="skolem">b</span><span class="main">(</span><span class="bound">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>
                <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="keyword1">then</span> sqrt pi <span class="main">*</span> <span class="skolem">a</span><span class="main">(</span><span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>
                <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">⟷</span> <span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">b</span> <span class="bound">k</span> <span class="main">*</span> cos <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">b</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">b</span> <span class="bound">i</span> <span class="main">*</span> cos <span class="main">(</span>real <span class="bound">i</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">k</span> <span class="main">*</span> sin <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="keyword1">then</span> sqrt pi <span class="main">*</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> real <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">/</span> sqrt pi<span class="main">)</span>"</span></span>
                   <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> n'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc <span class="skolem">n'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> not0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">k</span> <span class="main">*</span> sin <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atMost_atLeast0 sum_shift_lb_Suc0_0<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> real <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> sum.reindex_bij_betw <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw Suc <span class="main">{..</span><span class="skolem">n'</span><span class="main">}</span> <span class="main">{</span>Suc <span class="main">0</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atMost_atLeast0 n'<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="skolem">n'</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> real <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> n' lessThan_Suc_atMost <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> if_distrib <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">/</span><span class="main">_</span>"</span></span><span class="main"><span class="main">]</span></span> sum.inter_restrict <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> B <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">k</span> <span class="main">*</span> sin<span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">b</span> <span class="bound">k</span> <span class="main">*</span> cos<span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">≤</span> Suc<span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="var">?a</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum.in_pairs_0 trigonometric_set_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.distrib if_distrib <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">*</span><span class="main">_</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> lee <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">≤</span> Suc<span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="var">?a</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Convergence wrt the L2 norm of trigonometric Fourier series›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Fourier_coefficient</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fourier_coefficient</span> <span class="main">≡</span> orthonormal_coeff <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> trigonometric_set"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Fourier_series_l2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> trigonometric_set <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
         <span class="main">⇢</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lim_sequentially dist_real_def Fourier_coefficient_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> orthonormal_coeff <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> trigonometric_set <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> trigonometric_set <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">N</span><span class="main">.</span> <span class="main">¦</span>l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?h</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">e</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> lte<span class="main">:</span> <span class="quoted"><span class="quoted">"l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">N</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Weierstrass_l2_trigonometric_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span>›</span></span> assms<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI allI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?h</span> <span class="skolem">m</span> <span class="bound">x</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?h</span> <span class="skolem">m</span> <span class="bound">x</span><span class="main">)</span><span class="main">¦</span> <span class="main">=</span> l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?h</span> <span class="skolem">m</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> abs_of_nonneg<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span>  <span class="var">?h</span> <span class="skolem">m</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> l2norm_pos_le square_integrable_diff square_integrable_sum square_integrable_lmult
                square_integrable_trigonometric_set assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">N</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">m</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">N</span> <span class="keyword1">then</span> <span class="skolem">a</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> trigonometric_set <span class="bound">i</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">N</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">i</span> <span class="main">*</span> trigonometric_set <span class="bound">i</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
            <span class="keyword1"><span class="command">using</span></span> sum.inter_restrict <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="skolem">m</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> B <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="skolem">N</span><span class="main">}</span>"</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> that
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> if_distrib <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">_</span>"</span></span><span class="main"><span class="main">]</span></span> min_absorb2 <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?h</span> <span class="skolem">m</span> <span class="bound">x</span><span class="main">)</span>
                <span class="main">≤</span> l2norm <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">m</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">N</span> <span class="keyword1">then</span> <span class="skolem">a</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> trigonometric_set <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> orthonormal_optimal_partial_sum
              <span class="main">[</span><span class="operator">OF</span> orthonormal_system_trigonometric_set square_integrable_trigonometric_set assms<span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lte<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Fourier coefficients go to 0 (weak form of Riemann-Lebesgue)›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> trigonometric_set_mul_absolutely_integrable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> trigonometric_set <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_bounded_measurable_product_real<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trigonometric_set <span class="free">n</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> square_integrable_def square_integrable_trigonometric_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span>trigonometric_set <span class="free">n</span> <span class="main">`</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bounded_iff <span class="keyword1"><span class="command">using</span></span> pi_gt3 sqrt_pi_ge1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trigonometric_set_def dist_real_def
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order_trans <span class="main"><span class="main">[</span></span><span class="operator">OF</span> abs_sin_le_one<span class="main"><span class="main">]</span></span> order_trans <span class="main"><span class="main">[</span></span><span class="operator">OF</span> abs_cos_le_one<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> trigonometric_set_mul_integrable<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">⟹</span> integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> trigonometric_set <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> trigonometric_set_mul_absolutely_integrable
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integrable_restrict_space set_integrable_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> trigonometric_set_integrable <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span>trigonometric_set <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> trigonometric_set_mul_integrable <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main">=</span></span> <span class="quoted">id</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> absolutely_integrable_imp_integrable fmeasurableD interval_cbox lmeasurable_cbox square_integrable_imp_absolutely_integrable square_integrable_trigonometric_set<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> absolutely_integrable_sin_product<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_bounded_measurable_product_real<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> borel_measurable_integrable integrable_sin_cx mult_commute_abs<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> abs_sin_le_one bounded_iff imageE real_norm_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> absolutely_integrable_cos_product<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos<span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_bounded_measurable_product_real<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> borel_measurable_integrable integrable_cos_cx mult_commute_abs<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> abs_cos_le_one bounded_iff imageE real_norm_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> Fourier_products_integrable_cos<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos<span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   Fourier_products_integrable_sin<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_cos_product absolutely_integrable_sin_product assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> integrable_restrict_space set_integrable_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> Riemann_lebesgue_square_integrable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orthonormal_system <span class="free">S</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">w</span> <span class="bound">i</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">square_integrable</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"orthonormal_coeff <span class="free">S</span> <span class="free">w</span> <span class="free">f</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Fourier_series_square_summable <span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted">UNIV</span><span class="main">]</span> summable_LIMSEQ_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">proposition</span></span> Riemann_lebesgue<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Fourier_coefficient <span class="free">f</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lim_sequentially
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> gabs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
                <span class="keyword2"><span class="keyword">and</span></span> fg_e2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_approximate_continuous <span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> box_real<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> half_gt_zero_iff lmeasurable_cbox<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">square_integrable</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹continuous_on UNIV <span class="skolem">g</span>›</span></span> continuous_imp_square_integrable continuous_on_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orthonormal_coeff <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> trigonometric_set <span class="skolem">g</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Riemann_lebesgue_square_integrable orthonormal_system_trigonometric_set square_integrable_trigonometric_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">N</span> <span class="main">⟹</span> <span class="main">¦</span>orthonormal_coeff <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> trigonometric_set <span class="skolem">g</span> <span class="bound">n</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lim_sequentially <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> half_gt_zero_iff norm_conv_dist real_norm_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Fourier_coefficient <span class="free">f</span> <span class="skolem">n</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> trigonometric_set <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> N <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">N</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> orthonormal_coeff_def l2product_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> trigonometric_set <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gabs trigonometric_set_mul_integrable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> trigonometric_set <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms trigonometric_set_mul_integrable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> trigonometric_set <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span>
                        <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> trigonometric_set <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">¦</span>
                     <span class="main">=</span> <span class="main">¦</span><span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> trigonometric_set <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> Bochner_Integration.integral_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> integral_abs_bound_integral<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> trigonometric_set <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gabs assms trigonometric_set_mul_integrable<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> gabs assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> absolutely_integrable_imp_integrable<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> space <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>pi <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> pi"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>trigonometric_set <span class="skolem">n</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> pi_ge_two
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trigonometric_set_def<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> sqrt_pi_ge1 abs_sin_le_one order_trans abs_cos_le_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>trigonometric_set <span class="skolem">n</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abs_ge_zero mult_right_mono <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult abs_minus_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> trigonometric_set <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span>
           <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> trigonometric_set <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">¦</span>
          <span class="main">≤</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> N <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">N</span>›</span></span><span class="main">]</span> fg_e2
      <span class="keyword1"><span class="command">unfolding</span></span> Fourier_coefficient_def orthonormal_coeff_def l2product_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">no</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">no</span><span class="main">.</span> dist <span class="main">(</span>Fourier_coefficient <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Riemann_lebesgue_sin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span>real <span class="bound">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lim_sequentially
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">N</span> <span class="main">⟹</span> <span class="main">¦</span>Fourier_coefficient <span class="free">f</span> <span class="bound">n</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">4</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Riemann_lebesgue <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> lim_sequentially
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> norm_conv_dist real_norm_def zero_less_divide_iff zero_less_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> sin <span class="main">(</span>real <span class="skolem">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Fourier_coefficient <span class="free">f</span><span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">4</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> N Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> sin <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> sqrt pi <span class="main">*</span> <span class="skolem">e</span> <span class="main">/</span> <span class="numeral">4</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fourier_coefficient_def orthonormal_coeff_def
          trigonometric_set_def l2product_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span>›</span></span> pi_less_4 real_sqrt_less_mono <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">no</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">no</span><span class="main">.</span> dist <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> sin <span class="main">(</span>real <span class="bound">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> le_neq_implies_less less_add_same_cancel2 less_trans norm_conv_dist real_norm_def zero_less_one<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Riemann_lebesgue_cos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos<span class="main">(</span>real <span class="bound">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lim_sequentially
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">N</span> <span class="main">⟹</span> <span class="main">¦</span>Fourier_coefficient <span class="free">f</span> <span class="bound">n</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">4</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Riemann_lebesgue <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> lim_sequentially
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> norm_conv_dist real_norm_def zero_less_divide_iff zero_less_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> cos <span class="main">(</span>real <span class="skolem">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span>real <span class="skolem">n</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Fourier_coefficient <span class="free">f</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">4</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> N Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> cos <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> sqrt pi <span class="main">*</span> <span class="skolem">e</span> <span class="main">/</span> <span class="numeral">4</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fourier_coefficient_def orthonormal_coeff_def
          trigonometric_set_def l2product_def <span class="dynamic"><span class="dynamic">field_simps</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span>›</span></span> pi_less_4 real_sqrt_less_mono <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">no</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">no</span><span class="main">.</span> dist <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> cos <span class="main">(</span>real <span class="bound">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> le_neq_implies_less less_add_same_cancel2 less_trans norm_conv_dist real_norm_def zero_less_one<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Riemann_lebesgue_sin_half<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> sin <span class="main">(</span><span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sin_add<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?INT</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="var">?INT</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="bound">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span>
                 <span class="var">?INT</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos<span class="main">(</span><span class="bound">n</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="var">?INT</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>sin <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> cos <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_transform_eventually<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> sin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> absolutely_integrable_sin_product assms<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> cos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> absolutely_integrable_cos_product assms<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="var">?f</span> <span class="bound">n</span> <span class="main">=</span> <span class="var">?INT</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>sin <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> cos <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mult.assoc
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eventuallyI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Bochner_Integration.integral_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> cos absolutely_integrable_sin_product sin absolutely_integrable_cos_product absolutely_integrable_imp_integrable<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">⇢</span> <span class="main">0</span> <span class="main">+</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mult.assoc
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_add Riemann_lebesgue_sin Riemann_lebesgue_cos sin cos<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">⇢</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Fourier_sum_limit_pair<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">l</span>
     <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">l</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lim_sequentially dist_real_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N1</span></span> <span class="keyword2"><span class="keyword">where</span></span> N1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">N1</span> <span class="main">⟹</span> <span class="main">¦</span>Fourier_coefficient <span class="free">f</span> <span class="bound">n</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Riemann_lebesgue <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> lim_sequentially
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> norm_conv_dist real_norm_def zero_less_divide_iff zero_less_numeral<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N2</span></span> <span class="keyword2"><span class="keyword">where</span></span> N2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">N2</span> <span class="main">⟹</span> <span class="main">¦</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">unfolding</span></span> lim_sequentially dist_real_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span>›</span></span> half_gt_zero_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">no</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">no</span><span class="main">.</span> <span class="main">¦</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI allI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N1</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">N2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">N1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">N2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">≥</span> <span class="skolem">N2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 1<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> N2 <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">≥</span> <span class="skolem">N2</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> N2 <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">≥</span> <span class="skolem">N2</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Fourier_coefficient <span class="free">f</span><span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> trigonometric_set <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>trigonometric_set <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trigonometric_set<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> abs_sin_le_one sqrt_pi_ge1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order_trans<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Fourier_coefficient <span class="free">f</span><span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> N1 <span class="quoted"><span class="quoted">‹<span class="skolem">N1</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> abs_mult
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> abs_ge_zero le_less_trans mult_left_mono mult_less_iff1 zero_less_one<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 2<span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> sum.atMost_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lim_sequentially
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> imp_forward ex_forward<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Express Fourier sum in terms of the special expansion at the origin›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Fourier_sum_0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">≤</span> <span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span>
     <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> trigonometric_set <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">0</span><span class="main">..</span> Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_left<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">0</span><span class="main">..</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">-</span> <span class="main">{..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> trigonometric_set <span class="bound">i</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarsimp</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
			<span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Suc <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"even <span class="free">n</span>"</span></span>
			  <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span><span class="main"><span class="keyword3">+</span></span>
			<span class="keyword1"><span class="command">moreover</span></span>
			<span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"trigonometric_set <span class="skolem">i</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
			<span class="keyword1"><span class="command">ultimately</span></span>
			<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Fourier_coefficient <span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
				<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trigonometric_set_def<span class="main">)</span>
		<span class="keyword1"><span class="command">qed</span></span>
	<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span>
 	  <span class="keyword1"><span class="command">unfolding</span></span> sum.in_pairs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trigonometric_set atMost_atLeast0<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Fourier_sum_0_explicit<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="main">0</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">(</span>Fourier_coefficient <span class="free">f</span> <span class="main">0</span> <span class="main">/</span> sqrt <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> sqrt pi"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="main">0</span><span class="main">)</span>
        <span class="main">=</span> Fourier_coefficient <span class="free">f</span> <span class="main">0</span> <span class="main">*</span> trigonometric_set <span class="main">0</span> <span class="main">0</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fourier_sum_0 sum.atLeast_Suc_atMost<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Fourier_coefficient <span class="free">f</span> <span class="main">0</span> <span class="main">*</span> trigonometric_set <span class="main">0</span> <span class="main">0</span> <span class="main">=</span> Fourier_coefficient <span class="free">f</span> <span class="main">0</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="numeral">2</span> <span class="main">*</span> sqrt pi<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_mult trigonometric_set<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> sqrt pi"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trigonometric_set_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_divide_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atMost_atLeast0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Fourier_sum_0_integrals<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="free">f</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span>
           <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">.</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos<span class="main">(</span><span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="free">f</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> sqrt <span class="numeral">2</span> <span class="main">*</span> sqrt pi<span class="main">)</span> <span class="main">=</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="free">f</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> real_sqrt_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> trigonometric_set <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> sqrt pi
               <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> cos <span class="main">(</span><span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> pi"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trigonometric_set_def sum_divide_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Fourier_sum_0_explicit
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fourier_coefficient_def orthonormal_coeff_def l2product_def trigonometric_set add_divide_distrib<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Fourier_sum_0_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span>
       <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">.</span> cos<span class="main">(</span><span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> pi"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> Fourier_products_integrable_cos <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> cos <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="free">f</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> cos <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> real <span class="bound">k</span><span class="main">)</span><span class="main">)</span>
               <span class="main">=</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> cos <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> Bochner_Integration.integral_sum<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> cos <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> real <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span>Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">using</span></span> that * <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bochner_Integration.integral_sum mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Fourier_products_integrable_cos <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> absolutely_integrable_imp_integrable <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fourier_sum_0_integrals sum_distrib_left assms <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹How Fourier coefficients behave under addition etc›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Fourier_coefficient_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span>
                Fourier_coefficient <span class="free">f</span> <span class="free">i</span> <span class="main">+</span> Fourier_coefficient <span class="free">g</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms trigonometric_set_mul_integrable
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fourier_coefficient_def orthonormal_coeff_def l2product_def distrib_left<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Fourier_coefficient_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">-</span> Fourier_coefficient <span class="free">f</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms trigonometric_set_mul_integrable
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fourier_coefficient_def orthonormal_coeff_def l2product_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Fourier_coefficient_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> Fourier_coefficient <span class="free">f</span> <span class="free">i</span> <span class="main">-</span> Fourier_coefficient <span class="free">g</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> mg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> absolutely_integrable_measurable_real<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Fourier_coefficient_add <span class="main">[</span><span class="operator">OF</span> f mg<span class="main">]</span> Fourier_coefficient_minus <span class="main">[</span><span class="operator">OF</span> g<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Fourier_coefficient_const<span class="main">:</span>
   <span class="quoted"><span class="quoted">"Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Fourier_coefficient_def orthonormal_coeff_def l2product_def trigonometric_set_def <span class="dynamic"><span class="dynamic">divide_simps</span></span> measure_restrict_space<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Fourier_offset_term<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> trigonometric_set <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">0</span>
        <span class="main">=</span> Fourier_coefficient <span class="free">f</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> trigonometric_set <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">t</span>
        <span class="main">+</span> Fourier_coefficient <span class="free">f</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> trigonometric_set <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> real <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> cos <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">t</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Fourier_products_integrable_cos <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span>"</span></span><span class="main">]</span> f
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>sin <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">t</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Fourier_products_integrable_sin <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span>"</span></span><span class="main">]</span> f
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span>real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> cos <span class="main">(</span>real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> has_integral_periodic_offset<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span>real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_bounded_measurable_product_real<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span>real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_imp_measurable_on_sets_lebesgue <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span>real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> boundedI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> B<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> f <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> cos <span class="main">(</span>real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_bochner_integral_integrable integrable_restrict_space set_integrable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span>real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>pi <span class="main">-</span> <span class="main">-</span> pi<span class="main">)</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>pi <span class="main">-</span> <span class="main">-</span> pi<span class="main">)</span><span class="main">)</span> <span class="main">=</span> cos <span class="main">(</span>real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> periodic cos.plus_of_nat <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span>real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> cos <span class="main">(</span>real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> cos <span class="main">(</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span>
           <span class="main">=</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> cos <span class="main">(</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_bochner_integral_integral_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> cos <span class="main">(</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cos <span class="main">(</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> cos <span class="main">(</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>
                 <span class="main">+</span> sin <span class="main">(</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> sin <span class="main">(</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cos_diff <span class="dynamic"><span class="dynamic">algebra_simps</span></span> 1 2 <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> integral_mult_left_zero integral_mult_right_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> cos <span class="main">(</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span>
        <span class="main">=</span> cos <span class="main">(</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> cos <span class="main">(</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>
        <span class="main">+</span> sin <span class="main">(</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> sin <span class="main">(</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Fourier_coefficient_def orthonormal_coeff_def trigonometric_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> l2product_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Fourier_sum_offset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> Fourier_coefficient <span class="free">f</span> <span class="main">0</span> <span class="main">*</span> trigonometric_set <span class="main">0</span> <span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atMost_atLeast0 sum.atLeast_Suc_atMost<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span>
        <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span> Suc <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">≤</span> Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span><span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> trigonometric_set <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> atMost_atLeast0 <span class="keyword1"><span class="command">using</span></span> sum.shift_bounds_cl_Suc_ivl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">≤</span> Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">.</span> Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> trigonometric_set <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum.in_pairs_0
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong <span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Fourier_coefficient <span class="free">f</span><span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> trigonometric_set <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="main">+</span> Fourier_coefficient <span class="free">f</span><span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> trigonometric_set <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> trigonometric_set <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">+</span> Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> trigonometric_set <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{..</span><span class="skolem">n'</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
        <span class="keyword1"><span class="command">using</span></span> that Fourier_offset_term <span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trigonometric_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> atMost_atLeast0 sum.shift_bounds_cl_Suc_ivl<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>
           <span class="main">=</span> Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">*</span> trigonometric_set <span class="main">0</span> <span class="main">0</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atMost_atLeast0 sum.atLeast_Suc_atMost<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Fourier_coefficient <span class="free">f</span> <span class="main">0</span> <span class="main">*</span> trigonometric_set <span class="main">0</span> <span class="free">t</span>
               <span class="main">=</span> Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">*</span> trigonometric_set <span class="main">0</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fourier_coefficient_def orthonormal_coeff_def trigonometric_set_def l2product_def integral_periodic_offset periodic<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Fourier_sum_offset_unpaired<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> trigonometric_set <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span>  trigonometric_set <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span> <span class="main">0</span> <span class="main">+</span>
                   Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> trigonometric_set <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms Fourier_sum_offset<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sum.in_pairs_0 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trigonometric_set<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trigonometric_set<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Express partial sums using Dirichlet kernel›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Dirichlet_kernel</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Dirichlet_kernel</span> <span class="main">≡</span>
           <span class="main">λ</span><span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> real <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>
                          <span class="keyword1">else</span> sin<span class="main">(</span><span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Dirichlet_kernel_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">⟹</span> Dirichlet_kernel <span class="main">0</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Dirichlet_kernel_def sin_zero_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Dirichlet_kernel_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Dirichlet_kernel <span class="free">n</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> Dirichlet_kernel <span class="free">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Dirichlet_kernel_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> Dirichlet_kernel_continuous_strong<span class="main">:</span>
   <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">&lt;..&lt;</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">}</span> <span class="main">(</span>Dirichlet_kernel <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span>Dirichlet_kernel <span class="free">n</span><span class="main">)</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">─</span><span class="main">0</span> <span class="main">→</span> real <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Dirichlet_kernel_def continuous_at True
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Lim_transform_eventually <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> sin<span class="main"><span class="main">(</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">n</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">*</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">/</span></span> <span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">2</span></span> <span class="main"><span class="main">*</span></span> sin<span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> * eventually_at_filter<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sin_zero_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> nhds <span class="skolem">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False t1_space_nhds <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Dirichlet_kernel_def continuous_at eventually_at_filter <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Lim_transform_eventually<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> continuous_on_eq_continuous_at<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Dirichlet_kernel_continuous<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span>Dirichlet_kernel <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> Dirichlet_kernel_continuous_strong<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> pi_gt_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>


<span class="keyword1"><span class="command">lemma</span></span> absolutely_integrable_mult_Dirichlet_kernel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_bounded_measurable_product_real<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Dirichlet_kernel <span class="free">n</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dirichlet_kernel_continuous continuous_imp_measurable_on_sets_lebesgue<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"compact <span class="main">(</span>Dirichlet_kernel <span class="free">n</span> <span class="main">`</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compact_continuous_image <span class="main"><span class="main">[</span></span><span class="operator">OF</span> Dirichlet_kernel_continuous<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span>Dirichlet_kernel <span class="free">n</span> <span class="main">`</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> compact_imp_bounded <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> cosine_sum_lemma<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> cos<span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span>  sin<span class="main">(</span><span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span>sin <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">-</span> sin <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="free">x</span> <span class="main">-</span> <span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>
        <span class="main">=</span> sin <span class="main">(</span>real <span class="free">n</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> sin <span class="main">(</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_right sum_distrib_right cos_times_sin<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Dirichlet_kernel_cosine_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Dirichlet_kernel <span class="free">n</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> cos<span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin <span class="main">(</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> cos <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin<span class="main">(</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sin_zero_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> cosine_sum_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Dirichlet_kernel_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> integrable_Dirichlet_kernel<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span>Dirichlet_kernel <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Dirichlet_kernel_continuous continuous_imp_integrable_real <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> integral_Dirichlet_kernel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span>Dirichlet_kernel <span class="free">n</span><span class="main">)</span> <span class="main">=</span> pi"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span>Dirichlet_kernel <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> cos <span class="main">(</span><span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pi_ge_two
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Bochner_Integration.integral_cong <span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl Dirichlet_kernel_cosine_sum<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> cos <span class="main">(</span><span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integral_add<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> cos <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integrable_sum<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> integrable_cos_cx mult_commute_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> pi"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span>Suc <span class="main">0</span> <span class="main">≤</span> <span class="bound">i</span><span class="main">;</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span><span class="main">⟧</span>
         <span class="main">⟹</span> integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span>real <span class="bound">i</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> integrable_cos_cx mult_commute_abs<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> cos <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bochner_Integration.integral_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> measure_restrict_space<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> integral_Dirichlet_kernel_half <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span>Dirichlet_kernel <span class="free">n</span><span class="main">)</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span> pi<span class="main">..</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>Dirichlet_kernel <span class="free">n</span><span class="main">)</span> <span class="main">+</span>
        <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span>Dirichlet_kernel <span class="free">n</span><span class="main">)</span> <span class="main">=</span> pi"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integral_combine <span class="main">[</span><span class="operator">OF</span> integrable_Dirichlet_kernel<span class="main">]</span> integral_Dirichlet_kernel <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span> pi<span class="main">..</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>Dirichlet_kernel <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span>Dirichlet_kernel <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integral_reflect_real <span class="main">[</span><span class="operator">of</span> <span class="quoted">pi</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"Dirichlet_kernel <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Fourier_sum_offset_Dirichlet_kernel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span>
            <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ft<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_periodic_offset <span class="main">[</span><span class="operator">OF</span> f<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span><span class="main">]</span> periodic <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> trigonometric_set <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Fourier_sum_offset_unpaired assms atMost_atLeast0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>
                 <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span> <span class="main">/</span> sqrt pi<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.atLeast_Suc_atMost trigonometric_set_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">+</span>
                   <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> cos <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fourier_coefficient_def orthonormal_coeff_def trigonometric_set_def l2product_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span>
                     <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span>cos <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Fourier_products_integrable_cos <span class="main">[</span><span class="operator">OF</span> ft<span class="main">]</span> absolutely_integrable_imp_integrable <span class="main">[</span><span class="operator">OF</span> ft<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span>
                     <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> cos <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> sum_distrib_right mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> cos <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>
        <span class="main">=</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> cos <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>
              <span class="main">=</span> Dirichlet_kernel <span class="free">n</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> pi <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> pi"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sin_zero_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> cos<span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> sin<span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> cosine_sum_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dirichlet_kernel_def False <span class="dynamic"><span class="dynamic">field_simps</span></span> sum_distrib_left<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dirichlet_kernel_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integral_cong <span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Fourier_sum_limit_Dirichlet_kernel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">l</span><span class="main">)</span>
     <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> pi <span class="main">*</span> <span class="free">l</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi<span class="main">)</span> <span class="main">⇢</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fourier_sum_limit_pair <span class="main"><span class="main">[</span></span><span class="operator">OF</span> f<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> Fourier_sum_offset_Dirichlet_kernel assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="bound">k</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> inverse pi<span class="main">)</span>
                    <span class="main">⇢</span> pi <span class="main">*</span> <span class="free">l</span> <span class="main">*</span> inverse pi"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tendsto_mult_right_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inverse pi"</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹A directly deduced sufficient condition for convergence at a point›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> simple_Fourier_convergence_periodic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ft<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Φ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ψ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fft<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f absolutely_integrable_measurable_real<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> fxt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_periodic_offset assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Φ</span> <span class="main">⇢</span> <span class="main">0</span> <span class="main">⟷</span> <span class="var">?Ψ</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fourier_sum_limit_Dirichlet_kernel fft periodic<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Φ</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_transform_eventually <span class="main"><span class="main">[</span></span><span class="operator">OF</span> that eventually_sequentiallyI<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span>
        <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span>
          <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong <span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
        <span class="keyword3"><span class="command">assume</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span>Suc <span class="main">0</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span>trigonometric_set <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trigonometric_set_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="skolem">k</span> <span class="main">*</span> trigonometric_set <span class="skolem">k</span> <span class="free">t</span> <span class="main">=</span> Fourier_coefficient <span class="free">f</span> <span class="skolem">k</span> <span class="main">*</span> trigonometric_set <span class="skolem">k</span> <span class="free">t</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">unfolding</span></span> Fourier_coefficient_def orthonormal_coeff_def l2product_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> right_diff_distrib f absolutely_integrable_measurable_real trigonometric_set_mul_integrable<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Fourier_coefficient <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">0</span> <span class="main">*</span> trigonometric_set <span class="main">0</span> <span class="free">t</span> <span class="main">=</span>
                     Fourier_coefficient <span class="free">f</span> <span class="main">0</span> <span class="main">*</span> trigonometric_set <span class="main">0</span> <span class="free">t</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">unfolding</span></span> Fourier_coefficient_def orthonormal_coeff_def l2product_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> trigonometric_set absolutely_integrable_imp_integrable measure_restrict_space<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.atLeast_Suc_atMost atMost_atLeast0<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Ψ</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="var">?Ψ</span> <span class="bound">n</span> <span class="main">=</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Dirichlet_kernel_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integral_cong <span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> sin_zero_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eq
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ft set_integrable_divide Riemann_lebesgue_sin_half<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LIM_zero_cancel<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹A more natural sufficient Hoelder condition at a point›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bounded_inverse_sin_half<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">B</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">-</span><span class="free">d</span><span class="main">&lt;..&lt;</span><span class="free">d</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¦</span>inverse <span class="main">(</span>sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span>sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">-</span> <span class="free">d</span><span class="main">&lt;..&lt;</span><span class="free">d</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> compact_imp_bounded compact_continuous_image<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">;</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> sin <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sin_zero_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">-</span><span class="free">d</span><span class="main">&lt;..&lt;</span><span class="free">d</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span>sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compact <span class="main">(</span><span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">-</span><span class="free">d</span><span class="main">&lt;..&lt;</span><span class="free">d</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compact_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bounded_pos<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">proposition</span></span> Hoelder_Fourier_convergence_periodic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ft<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x</span><span class="main">-</span><span class="free">t</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟹</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">M</span> <span class="main">*</span> <span class="main">¦</span><span class="bound">x</span><span class="main">-</span><span class="free">t</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> simple_Fourier_convergence_periodic <span class="main"><span class="main">[</span></span><span class="operator">OF</span> f<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> half<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> refl <span class="main"><span class="keyword3">|</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e0</span></span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e0</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">;</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e0</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¦</span>sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">4</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DERIV_def Lim_at dist_real_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">4</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span> <span class="main">⟹</span> <span class="main">¦</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="main">¦</span><span class="free">M</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"min <span class="free">d</span> <span class="skolem">e0</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e0</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">&lt;</span> min <span class="free">d</span> <span class="skolem">e0</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> sin <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="main">¦</span><span class="free">M</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"sin<span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> sin <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>inverse <span class="main">(</span>sin <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span><span class="main">¦</span> <span class="main">*</span> <span class="main">(</span><span class="main">¦</span><span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">¦</span> <span class="main">/</span> <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> eq
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mult_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sin <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">4</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> e0 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> x False <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">≤</span> <span class="main">¦</span>sin <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>inverse <span class="main">(</span>sin <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="numeral">4</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">¦</span> <span class="main">/</span> <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">M</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">t</span> <span class="main">-</span> <span class="free">t</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ft <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">+</span><span class="free">t</span>"</span></span><span class="main">]</span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> Transcendental.powr_mult_base<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">¦</span><span class="free">M</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">¦</span> <span class="main">/</span> <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="free">M</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">-</span> <span class="skolem">e</span><span class="main">&lt;..&lt;</span><span class="skolem">e</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¦</span>inverse <span class="main">(</span>sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bounded_inverse_sin_half <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> max <span class="main">(</span><span class="skolem">B</span> <span class="main">*</span> <span class="main">¦</span><span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">¦</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="main">¦</span><span class="free">M</span><span class="main">¦</span><span class="main">)</span> <span class="main">*</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> measurable_bounded_by_integrable_imp_absolutely_integrable<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> fxt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_periodic_offset assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">measurable</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_on_def fxt integrable_imp_measurable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_imp_measurable_on_sets_lebesgue <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_integral_diff fxt<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_integrable_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
       inverse <span class="free">a</span> <span class="main">*</span> pi <span class="keyword1">powr</span> <span class="free">a</span> <span class="main">-</span> inverse <span class="free">a</span> <span class="main">*</span> <span class="main">0</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span>
       <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fundamental_theorem_of_calculus_interior<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="free">a</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_on_powr' <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> inverse <span class="free">a</span> <span class="main">*</span> <span class="bound">b</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span>pi<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nonnegative_absolutely_integrable_1<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Henstock_Kurzweil_Integration.integrable_combine<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> int integrable_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">-</span> pi<span class="main">..</span><span class="main">0</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Henstock_Kurzweil_Integration.integrable_reflect_real <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> set_lebesgue_integral_eq_integral absolutely_integrable_max_1 absolutely_integrable_bounded_measurable_product_real set_integrable_abs <span class="dynamic"><span class="dynamic">measurable</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_constant_conv<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> sin <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?g</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> e <span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>inverse <span class="main">(</span>sin <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> B that <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>inverse <span class="main">(</span>sin <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">B</span> <span class="main">*</span> <span class="main">¦</span><span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">¦</span> <span class="main">/</span> <span class="main">¦</span>sin <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">B</span> <span class="main">*</span> <span class="main">¦</span><span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> periodic<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In particular, a Lipschitz condition at the point›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> Lipschitz_Fourier_convergence_periodic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ft<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x</span><span class="main">-</span><span class="free">t</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟹</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">M</span> <span class="main">*</span> <span class="main">¦</span><span class="bound">x</span><span class="main">-</span><span class="free">t</span><span class="main">¦</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Hoelder_Fourier_convergence_periodic <span class="main">[</span><span class="operator">OF</span> f <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In particular, if left and right derivatives both exist›</span></span>
<span class="keyword1"><span class="command">proposition</span></span> bi_differentiable_Fourier_convergence_periodic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">differentiable</span> at_left <span class="free">t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f_gt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">differentiable</span> at_right <span class="free">t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D_lt</span></span> <span class="keyword2"><span class="keyword">where</span></span> D_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound"><span class="bound">d</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span><span class="free">t</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> dist <span class="bound">x</span> <span class="free">t</span> <span class="main">∧</span> dist <span class="bound">x</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="bound">d</span> <span class="main">⟶</span> dist <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="skolem">D_lt</span> <span class="main">&lt;</span> <span class="bound">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_lt <span class="keyword1"><span class="command">unfolding</span></span> has_field_derivative_iff real_differentiable_def Lim_within
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lessThan_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d_lt</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d_lt</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> d_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">&lt;</span> <span class="free">t</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">¦</span><span class="main">;</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">d_lt</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¦</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">D_lt</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> dist_real_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dist_commute dist_real_def zero_less_one<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D_gt</span></span> <span class="keyword2"><span class="keyword">where</span></span> D_gt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound"><span class="bound">d</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&gt;</span><span class="free">t</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> dist <span class="bound">x</span> <span class="free">t</span> <span class="main">∧</span> dist <span class="bound">x</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="bound">d</span> <span class="main">⟶</span> dist <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="skolem">D_gt</span> <span class="main">&lt;</span> <span class="bound">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_gt <span class="keyword1"><span class="command">unfolding</span></span> has_field_derivative_iff real_differentiable_def Lim_within
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> greaterThan_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d_gt</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d_gt</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> d_gt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">&gt;</span> <span class="free">t</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">¦</span><span class="main">;</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">d_gt</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¦</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">D_gt</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> dist_real_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dist_commute dist_real_def zero_less_one<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Lipschitz_Fourier_convergence_periodic <span class="main"><span class="main">[</span></span><span class="operator">OF</span> f<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">¦</span> <span class="main">&lt;</span> min <span class="skolem">d_lt</span> <span class="skolem">d_gt</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">d_lt</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">d_gt</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="free">t</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">t</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&gt;</span><span class="free">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span><span class="main">¦</span><span class="skolem">D_lt</span><span class="main">¦</span> <span class="main">+</span> <span class="main">¦</span><span class="skolem">D_gt</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>  <span class="main">*</span> <span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">D_lt</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> d_lt <span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span><span class="main">¦</span> <span class="main">-</span> <span class="main">¦</span><span class="skolem">D_lt</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span><span class="main">¦</span><span class="skolem">D_lt</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comm_semiring_class.distrib <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">¦</span><span class="skolem">D_lt</span><span class="main">¦</span> <span class="main">+</span> <span class="main">¦</span><span class="skolem">D_gt</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 3
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">D_gt</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> d_gt <span class="main">[</span><span class="operator">OF</span> 3<span class="main">]</span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span><span class="main">¦</span> <span class="main">-</span> <span class="main">¦</span><span class="skolem">D_gt</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">t</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span><span class="main">¦</span><span class="skolem">D_gt</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comm_semiring_class.distrib <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">¦</span><span class="skolem">D_lt</span><span class="main">¦</span> <span class="main">+</span> <span class="main">¦</span><span class="skolem">D_gt</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">t</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">d_gt</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">d_lt</span>›</span></span> periodic<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹And in particular at points where the function is differentiable›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> differentiable_Fourier_convergence_periodic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fdif<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">differentiable</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bi_differentiable_Fourier_convergence_periodic<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> differentiable_at_withinI assms<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Use reflection to halve the region of integration›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> absolutely_integrable_mult_Dirichlet_kernel_reflected<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_mult_Dirichlet_kernel<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_periodic_offset <span class="main">[</span><span class="operator">OF</span> f<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span><span class="main">]</span> periodic
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> absolutely_integrable_reflect_real <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> absolutely_integrable_measurable_real borel_measurable_integrable integrable_Dirichlet_kernel<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> absolutely_integrable_mult_Dirichlet_kernel_reflected_part<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_mult_Dirichlet_kernel_reflected <span class="main">[</span><span class="operator">OF</span> f periodic<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">≤</span> pi›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> absolutely_integrable_on_subinterval<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> absolutely_integrable_mult_Dirichlet_kernel_reflected_part2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_mult_Dirichlet_kernel_reflected_part assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left right_diff_distrib<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> integral_reflect_and_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>euclidean_space"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span><span class="free">a</span><span class="main">..</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span><span class="free">a</span><span class="main">..</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span><span class="free">a</span><span class="main">..</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable_subinterval assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fm<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable_reflect_real <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span><span class="free">a</span><span class="main">..</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span><span class="free">a</span><span class="main">..</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span> <span class="main">+</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True assms integral_combine<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> add.inverse_inverse add.inverse_neutral integral_reflect_real<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fm f<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Fourier_sum_offset_Dirichlet_kernel_half<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span>
       <span class="main">=</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> fxt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_periodic_offset assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> int<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span>Dirichlet_kernel <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_integrable_integral_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span>
      <span class="main">=</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">+</span> Dirichlet_kernel <span class="free">n</span> <span class="main">(</span><span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="main">-</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_reflect_and_add absolutely_integrable_imp_integrable absolutely_integrable_mult_Dirichlet_kernel fxt<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> pi <span class="main">*</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_mult_Dirichlet_kernel_reflected_part <span class="main">[</span><span class="operator">OF</span> f periodic order_refl<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> absolutely_integrable_imp_integrable int<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fourier_sum_offset_Dirichlet_kernel assms <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Fourier_sum_limit_Dirichlet_kernel_half<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">l</span>
     <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> Fourier_sum_limit_pair <span class="main"><span class="main">[</span></span><span class="operator">OF</span> f<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lim_null <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> l<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">l</span></span><span class="main"><span class="main">]</span></span> Fourier_sum_offset_Dirichlet_kernel_half assms<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Localization principle: convergence only depends on values "nearby"›</span></span>

<span class="keyword1"><span class="command">proposition</span></span> Riemann_localization_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>
            <span class="main">-</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
         <span class="main">⇢</span> <span class="main">0</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="skolem">n</span> <span class="main">=</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="var">?f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="skolem">n</span> <span class="main">=</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> absolutely_integrable_imp_integrable absolutely_integrable_mult_Dirichlet_kernel f g <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> Bochner_Integration.integral_diff<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Bochner_Integration.integral_cong<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="var">?f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Dirichlet_kernel_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Bochner_Integration.integral_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Riemann_lebesgue_sin_half<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">-</span><span class="free">d</span><span class="main">&lt;..&lt;</span><span class="free">d</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¦</span>inverse <span class="main">(</span>sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bounded_inverse_sin_half <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> measurable_bounded_by_integrable_imp_absolutely_integrable<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">measurable</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_on_def f g integrable_imp_measurable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
             <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> continuous_imp_measurable_on_sets_lebesgue <span class="main"><span class="keyword3">|</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">B</span> <span class="main">*</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f g set_integrable_abs<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">B</span> <span class="main">*</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sin_zero_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> sin <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">B</span> <span class="main">*</span> <span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">B</span> <span class="main">*</span> <span class="main">¦</span>sin <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">¦</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> B <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> x <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_less_iff <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> <span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">B</span> <span class="main">*</span> <span class="main">¦</span>sin <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> abs_ge_zero mult.commute mult_left_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> set_integrable_divide <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Riemann_localization_integral_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>
            <span class="main">-</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span><span class="free">d</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
             <span class="main">⇢</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>
              <span class="main">-</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="free">d</span><span class="main">..</span><span class="free">d</span><span class="main">}</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">⇢</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Riemann_localization_integral <span class="main"><span class="main">[</span></span><span class="operator">OF</span> f _ <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span><span class="free">d</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f absolutely_integrable_on_subinterval <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">≤</span> pi›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">-</span> pi <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> pi <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="free">d</span><span class="main">..</span><span class="free">d</span><span class="main">}</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span>  <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>
                 <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="free">d</span><span class="main">..</span><span class="free">d</span><span class="main">}</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">≤</span> pi›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="free">d</span><span class="main">..</span><span class="free">d</span><span class="main">}</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> absolutely_integrable_restrict_UNIV <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> absolutely_integrable_restrict_UNIV <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">-</span><span class="free">d</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">f</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> integral_restrict <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">-</span><span class="free">d</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="main">_</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span>"</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> if_distrib <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Riemann_localization<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> perf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> perg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x</span><span class="main">-</span><span class="free">t</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">c</span>
     <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> Fourier_coefficient <span class="free">g</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> pi <span class="main">*</span> <span class="free">c</span>
    <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> pi <span class="main">*</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> Lim_transform_eq Riemann_localization_integral<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> absolutely_integrable_periodic_offset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fourier_sum_limit_Dirichlet_kernel assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Localize the earlier integral›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Riemann_localization_integral_range_half<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">-</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span><span class="free">d</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> absolutely_integrable_mult_Dirichlet_kernel absolutely_integrable_on_subinterval
              <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">≤</span> pi›</span></span> atLeastatMost_subset_iff f neg_le_iff_le<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_mult_Dirichlet_kernel <span class="main">[</span><span class="operator">OF</span> f<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> Riemann_localization_integral_range <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"*"</span> absolutely_integrable_imp_integrable integral_reflect_and_add<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Fourier_sum_limit_Dirichlet_kernel_part<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">l</span>
     <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_periodic_offset <span class="main">[</span><span class="operator">OF</span> f<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span><span class="main">]</span> periodic <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>
    <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_transform_eq<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> Riemann_localization_integral_range_half <span class="main"><span class="main">[</span></span><span class="operator">OF</span> int d<span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fourier_sum_limit_Dirichlet_kernel_half assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Make a harmless simplifying tweak to the Dirichlet kernel›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inte_Dirichlet_kernel_mul_expand<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="free">S</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span>
        <span class="main">=</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="free">S</span><span class="main">.</span> sin<span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span> <span class="main">(</span>integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>
      <span class="main">⟷</span> integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">S</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">}</span> <span class="main">∈</span> sets <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> True  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S sets_restrict_space_iff <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> conj_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> bm1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Dirichlet_kernel_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> * assms <span class="dynamic"><span class="dynamic">measurable</span></span> continuous_imp_measurable_on_sets_lebesgue <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> bm2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> assms <span class="dynamic"><span class="dynamic">measurable</span></span> continuous_imp_measurable_on_sets_lebesgue <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">∈</span> null_sets <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S null_sets_restrict_space<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI integral_cong_AE integrable_cong_AE bm1 bm2 AE_I' <span class="main"><span class="main">[</span></span><span class="operator">OF</span> 0<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Dirichlet_kernel_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Dirichlet_kernel_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Bochner_Integration.integral_cong Bochner_Integration.integrable_cong<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> integral_Dirichlet_kernel_mul_expand<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="free">S</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>
       <span class="main">=</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="free">S</span><span class="main">.</span> sin<span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?th1</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> integrable_Dirichlet_kernel_mul_expand<span class="main">:</span>
       <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>
    <span class="main">⟷</span> integrable <span class="main">(</span>lebesgue_on <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?th2</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> inte_Dirichlet_kernel_mul_expand <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">proposition</span></span> Fourier_sum_limit_sine_part<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">l</span>
     <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">.</span> sin<span class="main">(</span><span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?Ψ</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ftx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_periodic_offset assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ftmx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> absolutely_integrable_reflect_real <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> fbm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ftmx ftx<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Φ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?Φ</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Fourier_sum_limit_Dirichlet_kernel_part assms<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Φ</span> <span class="main">⇢</span> <span class="main">0</span> <span class="main">⟷</span> <span class="var">?Ψ</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_transform_eq <span class="main"><span class="main">[</span></span><span class="operator">OF</span> Lim_transform_eventually<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">.</span> sin<span class="main">(</span><span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">.</span>
            sin <span class="main">(</span><span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_restrict if_distrib <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">_</span> <span class="main">*</span> <span class="main">(</span><span class="bound">u</span> <span class="main">*</span> <span class="main">_</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span> mult.assoc <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> atLeastAtMost_iff <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> Riemann_lebesgue_sin_half absolutely_integrable_bounded_measurable_product_real<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">measurable</span></span> continuous_imp_measurable_on_sets_lebesgue <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> borel_measurable_if_lebesgue_on <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> atLeastAtMost_iff<span class="main">)</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> limg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?g</span> <span class="main">⤏</span> <span class="var">?g</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">a</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">)</span>"</span></span>   <span class="comment1">―‹thanks to Manuel Eberl›</span>
        <span class="keyword2"><span class="keyword">if</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?g</span> <span class="main">⤏</span> <span class="var">?g</span> <span class="free">d</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">d</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d sin_gt_zero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">real_asymp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?g</span> <span class="main">⤏</span> <span class="var">?g</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a that d sin_gt_zero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">real_asymp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that d
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">d</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> at_within_Icc_at at_within_Icc_at_right at_within_Icc_at_left<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> d  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> image_eqI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">…</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> compact_imp_bounded compact_continuous_image<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_on limg<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fbm<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">⇢</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="var">?f</span> <span class="bound">n</span> <span class="main">=</span> <span class="var">?Φ</span> <span class="bound">n</span> <span class="main">-</span> <span class="var">?Ψ</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_sequentiallyI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> Suc <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> d
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> integrable_Dirichlet_kernel_mul_expand <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> assms absolutely_integrable_imp_borel_measurable absolutely_integrable_on_subinterval <span class="main"><span class="main">[</span></span><span class="operator">OF</span> fbm<span class="main"><span class="main">]</span></span>
                       absolutely_integrable_imp_integrable absolutely_integrable_mult_Dirichlet_kernel_reflected_part2 <span class="main"><span class="keyword3">|</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> integrable_cong_AE_imp<span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="numeral">2</span> <span class="main">*</span> sin <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span>
          <span class="keyword1"><span class="command">using</span></span> abs_sin_x_le_abs_x <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> mult.commute abs_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> compact_imp_bounded compact_continuous_image <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bo<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> bounded_real <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">)</span> <span class="var">?g</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> absolutely_integrable_imp_integrable
              absolutely_integrable_on_subinterval <span class="main"><span class="main">[</span></span><span class="operator">OF</span> absolutely_integrable_mult_Dirichlet_kernel<span class="main"><span class="main">]</span></span>
              absolutely_integrable_bounded_measurable_product_real bo fbm
              <span class="dynamic"><span class="dynamic">measurable</span></span> continuous_imp_measurable_on_sets_lebesgue <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">measurable</span></span> absolutely_integrable_imp_borel_measurable
                       absolutely_integrable_on_subinterval <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ftx<span class="main"><span class="main">]</span></span> absolutely_integrable_on_subinterval <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ftmx<span class="main"><span class="main">]</span></span>
                       absolutely_integrable_continuous_real <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dirichlet_kernel <span class="skolem">n</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">=</span> sin <span class="main">(</span><span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
          <span class="keyword1"><span class="command">using</span></span> that d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dirichlet_kernel_def <span class="dynamic"><span class="dynamic">divide_simps</span></span> sin_zero_pi_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">.</span> <span class="var">?g</span> <span class="bound">x</span> <span class="main">=</span> sin <span class="main">(</span><span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> AE_I' <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> N<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">.</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">-</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">.</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> right_diff_distrib <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="main">_</span>"</span></span><span class="main"><span class="main">]</span></span> left_diff_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?Φ</span> <span class="skolem">n</span> <span class="main">-</span> <span class="var">?Ψ</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> d
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> measurable_restrict_mono <span class="main"><span class="main">[</span></span><span class="operator">OF</span> absolutely_integrable_imp_borel_measurable <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> fbm<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span>
                      integral_Dirichlet_kernel_mul_expand<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="var">?Φ</span> <span class="skolem">n</span> <span class="main">-</span> <span class="var">?Ψ</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Dini's test for the convergence of a Fourier series›</span></span>

<span class="keyword1"><span class="command">proposition</span></span> Fourier_Dini_test<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> int0d<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">¦</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">φ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> sin<span class="main">(</span><span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="skolem">φ</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lim_sequentially dist_real_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">¦</span> <span class="main">/</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> θ_def integral_eq_zero_null_sets<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span> <span class="skolem">θ</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> θ_def <span class="keyword1"><span class="command">using</span></span> indefinite_integral_continuous_real int0d <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">da</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x'</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x'</span> <span class="main">-</span> <span class="main">0</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="bound">da</span> <span class="main">⟶</span> <span class="main">¦</span><span class="skolem">θ</span> <span class="bound">x'</span> <span class="main">-</span> <span class="skolem">θ</span> <span class="main">0</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="bound">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_on_real_range <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> bspec <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">0</span> <span class="main">≤</span> <span class="bound">x'</span><span class="main">;</span> <span class="bound">x'</span> <span class="main">&lt;</span> <span class="skolem">k</span><span class="main">;</span> <span class="bound">x'</span> <span class="main">≤</span> <span class="free">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¦</span><span class="skolem">θ</span> <span class="bound">x'</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">δ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">≡</span> min <span class="free">d</span> <span class="main">(</span>min <span class="main">(</span><span class="skolem">k</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> pi<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">θ</span> <span class="skolem">δ</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">≤</span> pi"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> δ_def <span class="keyword1"><span class="command">using</span></span> k <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ftx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_periodic_offset assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ftmx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> absolutely_integrable_reflect_real <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">n</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">δ</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword1"><span class="command">unfolding</span></span> φ_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_bounded_measurable_product_real<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">δ</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_imp_measurable_on_sets_lebesgue <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">δ</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bounded_iff<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> abs_sin_le_one <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">δ</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> δ_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">measurable</span></span> absolutely_integrable_imp_borel_measurable
            absolutely_integrable_on_subinterval <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ftx<span class="main"><span class="main">]</span></span> absolutely_integrable_on_subinterval <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ftmx<span class="main"><span class="main">]</span></span>
            absolutely_integrable_continuous_real <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">δ</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>norm <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> integrable_subinterval <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">d</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>norm <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> int0d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> integrable_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">δ</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> δ_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">δ</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> absolutely_integrable_measurable<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">n</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="skolem">δ</span><span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword1"><span class="command">unfolding</span></span> φ_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_bounded_measurable_product_real<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="skolem">δ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_imp_measurable_on_sets_lebesgue <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="skolem">δ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bounded_iff<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> abs_sin_le_one <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="skolem">δ</span><span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_bounded_measurable_product_real<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="skolem">δ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> measurable_completion measurable_restrict_space1<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="skolem">δ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> inverse_eq_divide measurable_lebesgue_cong<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">δ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> inverse <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> inverse <span class="skolem">δ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">δ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span>inverse <span class="main">`</span> <span class="main">{</span><span class="skolem">δ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bounded_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="skolem">δ</span><span class="main">..</span>pi<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_on_subinterval<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ftx ftmx absolutely_integrable_on_const<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">δ</span><span class="main">..</span>pi<span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">δ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="skolem">δ</span><span class="main">..</span>pi<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> divide_inverse mult.commute set_integrable_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ftx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">δ</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bounded_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span>inverse <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">δ</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">δ</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> boundedI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> B <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">δ</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">δ</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> inverse <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="keyword1">then</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> UNIV"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> absolutely_integrable_bounded_measurable_product_real <span class="dynamic"><span class="dynamic">measurable</span></span> set_integral_diff<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lebesgue_on_UNIV_eq measurable_completion <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> absolutely_integrable_restrict_UNIV <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> S <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">δ</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>
               <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">δ</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> inverse <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="keyword1">then</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">δ</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> absolutely_integrable_restrict_UNIV <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> S <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> sin <span class="main">(</span><span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">δ</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span>
                                       <span class="main">+</span> sin <span class="main">(</span><span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">δ</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>
        <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Riemann_lebesgue_sin_half <span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_reflect_and_add absolutely_integrable_imp_integrable absolutely_integrable_sin_product <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">δ</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span>
               <span class="main">+</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">δ</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span>
           <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¬</span> <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">δ</span> <span class="keyword1">then</span> <span class="skolem">φ</span> <span class="skolem">n</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> φ_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¬</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">δ</span> <span class="keyword1">then</span> <span class="skolem">φ</span> <span class="bound">n</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≤</span> pi <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="main">¬</span> <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">δ</span> <span class="keyword1">then</span> <span class="skolem">φ</span> <span class="skolem">n</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>
               <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">δ</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≤</span> pi <span class="keyword1">then</span> <span class="skolem">φ</span> <span class="skolem">n</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">δ</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="skolem">δ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="skolem">φ</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> Lebesgue_Measure.integral_restrict_UNIV<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">≥</span><span class="skolem">N</span> <span class="main">⟹</span> <span class="main">¦</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="skolem">δ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="skolem">φ</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lim_sequentially dist_real_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span>›</span></span> diff_zero half_gt_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">n</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> int<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">φ</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_combine <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quasi_keyword"><span class="quasi_keyword">concl</span></span><span class="main"><span class="main"><span class="main">:</span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">pi</span></span></span><span class="main"><span class="main">]</span></span> absolutely_integrable_imp_integrable<span class="main">)</span> <span class="main">(</span><span class="operator">use</span>  <span class="quoted"><span class="quoted">‹<span class="skolem">δ</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">δ</span> <span class="main">≤</span> pi›</span></span> 1 2 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">δ</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="skolem">δ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integral_combine<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">δ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">δ</span> <span class="main">≤</span> pi›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">δ</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">n</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">δ</span><span class="main">}</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">l</span><span class="main">¦</span> <span class="main">/</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> integral_abs_bound_integral<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">δ</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">φ</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> integrable_subinterval <span class="quoted"><span class="quoted">‹<span class="skolem">δ</span> <span class="main">≤</span> pi›</span></span> int atLeastatMost_subset_iff order_refl<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">δ</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> δ_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">δ</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">l</span><span class="main">¦</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integrable_subinterval <span class="main"><span class="main">[</span></span><span class="operator">OF</span> int0d<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">φ</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">l</span><span class="main">¦</span> <span class="main">/</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> space <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">δ</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> φ_def <span class="dynamic"><span class="dynamic">divide_simps</span></span> abs_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute mult_left_le<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">n</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> N <span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> e2 <span class="keyword1"><span class="command">unfolding</span></span> θ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">N</span><span class="main">.</span> <span class="main">¦</span><span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">φ</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">0</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> φ_def <span class="keyword1"><span class="command">using</span></span> Fourier_sum_limit_sine_part assms pi_gt_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Cesaro summability of Fourier series using Fejér kernel›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Fejer_kernel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Fejer_kernel</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> Dirichlet_kernel <span class="bound">r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">n</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Fejer_kernel<span class="main">:</span>
     <span class="quoted"><span class="quoted">"Fejer_kernel <span class="free">n</span> <span class="free">x</span> <span class="main">=</span>
        <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span>
         <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">n</span><span class="main">/</span><span class="numeral">2</span>
         <span class="keyword1">else</span> sin<span class="main">(</span><span class="free">n</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span> <span class="main">*</span> sin<span class="main">(</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> sin<span class="main">(</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> real <span class="bound">r</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> real <span class="free">n</span> <span class="main">*</span> real <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Fejer_kernel_def Dirichlet_kernel_def <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> sum_divide_distrib<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> sin <span class="main">(</span><span class="main">(</span>real <span class="bound">r</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        sin <span class="main">(</span>real <span class="free">n</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span>real <span class="free">n</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> sin_times_sin<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_divide_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> False
    <span class="keyword1"><span class="command">unfolding</span></span> Fejer_kernel_def Dirichlet_kernel_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> power2_eq_square mult.commute <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> sum_divide_distrib<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Fejer_kernel_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Fejer_kernel <span class="main">0</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  <span class="quoted"><span class="quoted">"Fejer_kernel <span class="free">n</span> <span class="main">0</span> <span class="main">=</span> <span class="free">n</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Fejer_kernel<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Fejer_kernel_continuous_strong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">&lt;..&lt;</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">}</span> <span class="main">(</span>Fejer_kernel <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fejer_kernel_def <span class="dynamic"><span class="dynamic">continuous_intros</span></span> Dirichlet_kernel_continuous_strong<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fejer_kernel_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Fejer_kernel_continuous<span class="main">:</span>
  <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span>Fejer_kernel <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> Fejer_kernel_continuous_strong<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> pi_gt_zero <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> absolutely_integrable_mult_Fejer_kernel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fejer_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_bounded_measurable_product_real<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Fejer_kernel <span class="free">n</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fejer_kernel_continuous continuous_imp_measurable_on_sets_lebesgue<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span>Fejer_kernel <span class="free">n</span> <span class="main">`</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Fejer_kernel_continuous compact_continuous_image compact_imp_bounded <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> absolutely_integrable_mult_Fejer_kernel_reflected1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fejer_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> absolutely_integrable_mult_Fejer_kernel absolutely_integrable_periodic_offset<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> absolutely_integrable_mult_Fejer_kernel_reflected2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fejer_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> absolutely_integrable_reflect_real <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> absolutely_integrable_periodic_offset<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_mult_Fejer_kernel<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> absolutely_integrable_mult_Fejer_kernel_reflected3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fejer_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_on_const absolutely_integrable_mult_Fejer_kernel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> absolutely_integrable_mult_Fejer_kernel_reflected_part1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fejer_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_on_subinterval <span class="main"><span class="main">[</span></span><span class="operator">OF</span> absolutely_integrable_mult_Fejer_kernel_reflected1<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> absolutely_integrable_mult_Fejer_kernel_reflected_part2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fejer_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_on_subinterval <span class="main"><span class="main">[</span></span><span class="operator">OF</span> absolutely_integrable_mult_Fejer_kernel_reflected2<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> absolutely_integrable_mult_Fejer_kernel_reflected_part3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fejer_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_on_subinterval <span class="main"><span class="main">[</span></span><span class="operator">OF</span> absolutely_integrable_mult_Fejer_kernel_reflected2<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> absolutely_integrable_mult_Fejer_kernel_reflected_part4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fejer_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> distrib_left
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_integral_add absolutely_integrable_mult_Fejer_kernel_reflected_part1 absolutely_integrable_mult_Fejer_kernel_reflected_part2 assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> absolutely_integrable_mult_Fejer_kernel_reflected_part5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fejer_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> distrib_left right_diff_distrib
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_integral_add set_integral_diff absolutely_integrable_on_const
      absolutely_integrable_mult_Fejer_kernel_reflected_part1 absolutely_integrable_mult_Fejer_kernel_reflected_part2 assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> Fourier_sum_offset_Fejer_kernel_half<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="numeral">2</span><span class="main">*</span><span class="bound">r</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> <span class="free">n</span> <span class="main">-</span> <span class="free">l</span>
       <span class="main">=</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Fejer_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">r</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> real <span class="free">n</span> <span class="main">*</span> <span class="free">l</span>
       <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">r</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_subtractf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span>
                      <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Dirichlet_kernel <span class="bound">r</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fourier_sum_offset_Dirichlet_kernel_half assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Fejer_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Dirichlet_kernel <span class="skolem">i</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_mult_Dirichlet_kernel_reflected_part2<span class="main">(</span>2<span class="main">)</span> f periodic
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> absolutely_integrable_imp_integrable<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fejer_kernel_def <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> sum_divide_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_right <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> Bochner_Integration.integral_sum <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">r</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> real <span class="free">n</span> <span class="main">*</span> <span class="free">l</span> <span class="main">=</span> real <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Fejer_kernel <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Fourier_sum_limit_Fejer_kernel_half<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="numeral">2</span><span class="main">*</span><span class="bound">r</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">l</span>
         <span class="main">⟷</span>
         <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fejer_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">⇢</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="numeral">2</span><span class="main">*</span><span class="bound">r</span><span class="main">.</span>  Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LIM_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="numeral">2</span><span class="main">*</span><span class="bound">r</span><span class="main">.</span>  Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tendsto_mult_right_iff <span class="main">[</span><span class="operator">OF</span> pi_neq_zero<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> Lim_transform_eq <span class="main"><span class="main">[</span></span><span class="operator">OF</span> Lim_transform_eventually <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span> eventually_sequentiallyI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fourier_sum_offset_Fejer_kernel_half assms<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> has_integral_Fejer_kernel<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span>Fejer_kernel <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> pi<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> Dirichlet_kernel <span class="bound">r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> real <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> pi<span class="main">)</span> <span class="main">/</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_bochner_integral_iff integrable_Dirichlet_kernel has_bochner_integral_divide has_bochner_integral_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Fejer_kernel_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> has_integral_Fejer_kernel_half<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span>Fejer_kernel <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"has_bochner_integral <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> Dirichlet_kernel <span class="bound">r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> real <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> has_bochner_integral_sum has_bochner_integral_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> not_integrable_integral_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> has_bochner_integral_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Fejer_kernel_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Fejer_kernel_pos_le <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Fejer_kernel <span class="free">n</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fejer_kernel<span class="main">)</span>


<span class="keyword1"><span class="command">theorem</span></span> Fourier_Fejer_Cesaro_summable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">l</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> atMost <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> atLeast <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="numeral">2</span><span class="main">*</span><span class="bound">m</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">(</span><span class="free">l</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">u</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">l</span><span class="main">+</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">u</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Fejer_kernel <span class="bound">n</span> <span class="bound">u</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> h0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> atLeast <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> l0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">u</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fl
        <span class="keyword1"><span class="command">unfolding</span></span> Lim_within
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> all_forward imp_forward ex_forward conj_forward asm_rl<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">-</span><span class="improper">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dist_norm<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">have</span></span> r0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">u</span><span class="main">)</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fr
        <span class="keyword1"><span class="command">unfolding</span></span> Lim_within
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> all_forward imp_forward ex_forward conj_forward asm_rl<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">+</span><span class="improper">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dist_norm<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> tendsto_add <span class="main">[</span><span class="operator">OF</span> l0 r0<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> lim_sequentially dist_real_def diff_0_right
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span><span class="main">::</span><span class="quoted">real</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">x'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">;</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">x'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> h0 <span class="keyword1"><span class="command">unfolding</span></span> Lim_within dist_real_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> spec <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">/</span>pi"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ξ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ξ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">&lt;</span> pi"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">ξ</span> <span class="main">⟹</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">/</span>pi"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> that <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ξ<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"min <span class="skolem"><span class="skolem">x'</span></span> pi<span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> m2pi_less_pi <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">have</span></span> ftx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_periodic_offset assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ftmx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> absolutely_integrable_reflect_real <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> h_aint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> h_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> absolutely_integrable_on_const set_integral_diff set_integral_add<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ftx ftmx<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Fejer_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_null_comparison<span class="main">)</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">φ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="bound">n</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> norm <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Fejer_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">φ</span> <span class="bound">n</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_sequentiallyI<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> hint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> divide_inverse mult.commute <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">_</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_bounded_measurable_product_real<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sin <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> inverse <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ξ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sin_zero_pi_iff<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sin <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> inverse <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ξ</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cont continuous_imp_measurable_on_sets_lebesgue<span class="main">)</span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sin <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> inverse <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> cont <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compact_continuous_image compact_imp_bounded<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ξ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ξ</span> <span class="main">&lt;</span> pi›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> absolutely_integrable_on_subinterval <span class="main"><span class="main">[</span></span><span class="operator">OF</span> h_aint<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> absolutely_integrable_measurable o_def<span class="main">)</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ψ</span></span> <span class="keyword2"><span class="keyword">where</span></span>
              <span class="quoted"><span class="quoted">"<span class="skolem">ψ</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">n</span><span class="main">/</span><span class="numeral">2</span>
                         <span class="keyword1">else</span> <span class="main">(</span>sin <span class="main">(</span>real <span class="skolem">n</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span>sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">x</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="skolem">ψ</span> <span class="bound">x</span><span class="main">¦</span>
              <span class="main">≤</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> integral_abs_bound_integral<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Bochner_Integration.integrable_mult_left <span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">n</span>"</span></span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">ψ</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">h</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sin <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> real <span class="skolem">n</span>"</span></span>
              <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> space <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
              <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ξ</span>›</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ψ_def <span class="dynamic"><span class="dynamic">divide_simps</span></span> mult_less_0_iff abs_mult<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> square_le_1 mult_left_le_one_le<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="skolem">ψ</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> measurable_bounded_by_integrable_imp_lebesgue_integrable <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ **<span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">n</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>sin <span class="main">(</span><span class="skolem">n</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>inverse <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_imp_integrable <span class="main"><span class="main">[</span></span><span class="operator">OF</span> absolutely_integrable_bounded_measurable_product_real<span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>sin <span class="main">(</span>real <span class="skolem">n</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_imp_measurable_on_sets_lebesgue <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>sin <span class="main">(</span>real <span class="skolem">n</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> square_le_1 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> boundedI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> B<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sin <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> hint <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ψ</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> borel_measurable_integrable<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integrable_cong <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> sin<span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">n</span></span> <span class="main"><span class="main">/</span></span> <span class="numeral"><span class="numeral">2</span></span> <span class="main"><span class="main">*</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">^</span></span> <span class="numeral"><span class="numeral">2</span></span> <span class="main"><span class="main">/</span></span> <span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">2</span></span> <span class="main"><span class="main">*</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="main"><span class="main">*</span></span> sin<span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">^</span></span> <span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">*</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> refl<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ξ</span>›</span></span> **
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ψ_def <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> mult_less_0_iff abs_mult<span class="main">)</span>
                <span class="keyword1"><span class="command">using</span></span> Bochner_Integration.integrable_mult_left <span class="main">[</span><span class="operator">OF</span> ***<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">n</span>"</span></span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">ψ</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?g</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
                <span class="keyword1"><span class="command">using</span></span> that † <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ψ_def<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Fejer_kernel <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">φ</span> <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fejer_kernel φ_def ψ_def <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> Bochner_Integration.integral_divide <span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> φ_def divide_inverse
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tendsto_mult_right_zero lim_inverse_n<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">N</span> <span class="main">⟹</span> <span class="main">¦</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Fejer_kernel <span class="bound">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> lim_sequentially <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> half_gt_zero_iff norm_conv_dist real_norm_def <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">N</span><span class="main">.</span> <span class="main">¦</span><span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">u</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Fejer_kernel <span class="bound">n</span> <span class="bound">u</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">u</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI allI impI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
        <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> max <span class="main">1</span> <span class="skolem">N</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> N <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Fejer_kernel <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>Fejer_kernel <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span>Fejer_kernel <span class="skolem">n</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ξ</span> <span class="main">&lt;</span> pi›</span></span> has_bochner_integral_iff has_integral_Fejer_kernel_half
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> integral_mono_lebesgue_on_AE<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> pi"</span></span>
          <span class="keyword1"><span class="command">using</span></span> has_integral_Fejer_kernel_half <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_bochner_integral_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> int_le_pi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>Fejer_kernel <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> pi"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span><span class="main">.</span> Fejer_kernel <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span><span class="main">.</span> Fejer_kernel <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">/</span>pi<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fejer_kernel <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span>
                  <span class="main">=</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fejer_kernel <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> integral_cong_AE<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> <span class="skolem">P</span> <span class="bound">u</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">∪</span> Collect <span class="skolem">P</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">P</span> <span class="bound">u</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span>Collect <span class="skolem">P</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P</span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ξ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">∩</span> <span class="skolem">A</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fejer_kernel <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ξ</span> <span class="main">&lt;</span> pi›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> absolutely_integrable_imp_borel_measurable h_aint
                  absolutely_integrable_on_subinterval <span class="main"><span class="main">[</span></span><span class="operator">OF</span> absolutely_integrable_mult_Fejer_kernel<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fejer_kernel <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_borel_measurable Ball_def vimage_def Collect_conj_eq Collect_imp_eq * <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> Collect_neg_eq<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> all_forward imp_forward asm_rl<span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ξ</span>›</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> † sets.insert_in_sets sets_restrict_space_iff <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> conj_cong<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">∈</span> null_sets <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ξ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_sets_restrict_space<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span><span class="main">.</span> Fejer_kernel <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">x</span> <span class="main">=</span> Fejer_kernel <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> AE_I' <span class="main"><span class="main">[</span></span><span class="operator">OF</span> 0<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> eq
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> integral_abs_bound_integral<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span> pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_spike <span class="main"><span class="main">[</span></span><span class="operator">OF</span> h_aint<span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"negligible <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ξ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ξ</span> <span class="main">&lt;</span> pi›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fejer_kernel <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> absolutely_integrable_imp_integrable h_aint absolutely_integrable_on_subinterval <span class="main"><span class="main">[</span></span><span class="operator">OF</span> absolutely_integrable_mult_Fejer_kernel<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fejer_kernel <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> pi<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> absolutely_integrable_imp_integrable <span class="quoted"><span class="quoted">‹<span class="skolem">ξ</span> <span class="main">&lt;</span> pi›</span></span> absolutely_integrable_mult_Fejer_kernel_reflected_part3 less_eq_real_def<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Fejer_kernel <span class="skolem">n</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">h</span> <span class="skolem">x</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> Fejer_kernel <span class="skolem">n</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> pi"</span></span>
              <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> space <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
              <span class="keyword1"><span class="command">using</span></span> that ξ <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_mult eq <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> times_divide_eq_right <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_left_mono<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> int_le_pi <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> mult.commute <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">e</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fejer_kernel <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> h_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> absolutely_integrable_imp_integrable absolutely_integrable_mult_Fejer_kernel_reflected_part5 assms<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Fejer_kernel <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">x</span>
                 <span class="main">=</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">ξ</span><span class="main">}</span><span class="main">.</span> Fejer_kernel <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="skolem">ξ</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Fejer_kernel <span class="skolem">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integral_combine<span class="main">)</span> <span class="main">(</span><span class="operator">use</span>  <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ξ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ξ</span> <span class="main">&lt;</span> pi›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="keyword1">LINT</span> <span class="bound">u</span><span class="main">|</span>lebesgue_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> Fejer_kernel <span class="skolem">n</span> <span class="bound">u</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">u</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fourier_sum_limit_Fejer_kernel_half assms add_divide_distrib<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Fourier_Fejer_Cesaro_summable_simple<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> periodic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="numeral">2</span><span class="main">*</span><span class="bound">m</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="numeral">2</span><span class="main">*</span><span class="bound">m</span><span class="main">.</span> Fourier_coefficient <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> trigonometric_set <span class="bound">k</span> <span class="free">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">+</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Fourier_Fejer_Cesaro_summable<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">-</span> pi<span class="main">..</span>pi<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_continuous_real continuous_on_subset f <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">{..</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">x</span><span class="main">..}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Lim_at_imp_Lim_at_within continuous_on_def f <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> periodic Lim_at_imp_Lim_at_within continuous_on_def f<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


</pre>
</div>